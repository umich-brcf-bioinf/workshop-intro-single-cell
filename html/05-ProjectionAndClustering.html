<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="UM Bioinformatics Core" />

<meta name="date" content="2024-10-14" />

<title>Clustering and Projection</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>
<!--
Favicon dervied from
https://twemoji.twitter.com/
https://favicon.io/emoji-favicons/dna/
-->
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="shortcut icon" href="favicon-16x16.png" />
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Intro to scRNA-Seq</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="workshop_intro.html">Intro</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 1
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="00A-OrientingOnScRNASeq.html">Orienting on scRNA-Seq</a>
    </li>
    <li>
      <a href="01-GettingStarted.html">Getting Started with Seurat</a>
    </li>
    <li>
      <a href="00B-CellRangerInAction.html">Cell Ranger in Action</a>
    </li>
    <li>
      <a href="02-QCandFiltering.html">Secondary QC &amp; Filtering</a>
    </li>
    <li>
      <a href="03-Normalization.html">Normalization</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 2
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="04-PCAandIntegration.html">PCA &amp; Integration</a>
    </li>
    <li>
      <a href="05-ProjectionAndClustering.html">Projection &amp; Clustering</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 3
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="06-MarkerVisualization.html">Marker identification and visualization</a>
    </li>
    <li>
      <a href="07-CellTypeAnnos.html">Cell type annotation</a>
    </li>
    <li>
      <a href="08-DifferentialExpression.html">Differential expression analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="workshop_wrap_up.html">Wrap up</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Clustering and Projection</h1>
<h4 class="author">UM Bioinformatics Core</h4>
<h4 class="date">2024-10-14</h4>

</div>


<style type="text/css">
body, td {
   font-size: 18px;
}
code.r{
  font-size: 12px;
}
pre {
  font-size: 12px
}

table.fig, th.fig, td.fig {
  border: 1px solid black;
  border-collapse: collapse;
  padding: 15px;
}

table.fig, th.fig, td.fig {
  border: 1px solid black;
  border-collapse: collapse;
  padding: 15px;
}
</style>
<script>
  addClassKlippyTo("pre.r, pre.markdown, pre.bash");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<div id="workflow-overview" class="section level1 unlisted unnumbered">
<h1 class="unlisted unnumbered">Workflow Overview</h1>
<p><br/>
<img src="images/wayfinder/wayfinder.png" alt="wayfinder" style="height: 400px;"/>
<br/> <br/></p>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<!--- General goal: to generate clusters that reasonably approximate cell-types or sub-types of interest --->
<p>One of our goals in a single-cell analysis is to generate clusters
that reasonably approximate cell-types or sub-types of interest in our
samples before determining if there are differences in the proportions
of these populations or differences in gene expression within these
populations between experimental conditions.</p>
<table class="fig">
<tr class="fig">
<td class="fig">
<img
src="images/graphical_abstracts/graphical_abstract_cluster_projection.png" />
</td>
</tr>
<tr class="fig">
<td class="fig">
A. The prior step used the filtered, normalized counts as input to a
prinicpal component analysis. The top principle components (PCs) are the
input to the clustering step. <br/> B. Cells are plotted in a
high-dimensional space (where the num dimesnions = num of included PCs,
e.g. 15 dimensions); cells with similar gene expression profiles are
closer to each other and are clustered together. <br/> C. The cells
clusters are projected from the high-dimensional space (e.g. 15
dimensions) down to two-dimensional space for visualization.
</td>
</tr>
</table>
<p><br/></p>
<p>In this section, we will demonstrate how to generate clusters using
Seurat’s graph based clustering approach and visualize those clustering
assignments via a lower-dimensional projection of the full dataset.</p>
<p>Like other steps in our analysis, multiple parameters may need to be
tested and evaluated while we would expect that only the final would be
reported. Clustering is considered part of data exploration so an
iterative approach is reasonable, and often expected (<a
href="https://bioconductor.org/books/3.15/OSCA.basic/clustering.html">source</a>).</p>
<div id="objectives" class="section level2">
<h2>Objectives</h2>
<ul>
<li>Understand the clustering process and input parameters</li>
<li>Generate initial clusters using ``</li>
<li>Visualize our clustering results</li>
</ul>
<hr />
</div>
</div>
<div id="clustering-and-projection" class="section level1">
<h1>Clustering and projection</h1>
<p>Now that we selected a number of PCs that we think are likely to
represent biological variation and integrated our data across
samples/batches, our next task is clustering.</p>
<p>An important aspect of parameter selection for clustering is to
understand the “resolution” of the underlying biology and your
experimental design:</p>
<ul>
<li>Is answering your biological question dependent on identifying rarer
cell types or specific subtypes?<br />
</li>
<li>Or are broader cell-types more relevant to address your biological
question?</li>
</ul>
<p>The OSCA book has a <a
href="https://bioconductor.org/books/3.15/OSCA.basic/clustering.html#overview-1">helpful
analogy comparing clustering to microscopy</a> and points out that
“asking for an unqualified ‘best’ clustering is akin to asking for the
best magnification on a microscope without any context”.</p>
<p>To generate clusters, we will generate “communities” of cells using
the PCs we selected, before choosing a resolution parameter to divide
those communities into discrete clusters.</p>
<!--- Contrast the previous dimensionality reduction versus nearest neighbors clustering and plotting the cells in lower dimensionality with the cluster labels? --->
<div id="clustering" class="section level2">
<h2>Clustering</h2>
<p>Seurat uses a graph-based clustering approach to assign cells to
clusters using a distance metric based on the previously generated PCs,
with improvements based on work by (<a
href="https://academic.oup.com/bioinformatics/article/31/12/1974/214505">Xu
and Su 2015</a>) and CyTOF data (<a
href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4508757/">Levine et
al. 2015</a>) implemented in Seurat v3 and v5 and building on the
initial strategies for droplet-based single-cell technology (<a
href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4481139/">Macosko et
al. 2015</a>) (<a
href="https://satijalab.org/seurat/articles/pbmc3k_tutorial.html">source</a>).
A key aspect of this process is that while the clusters are based on
similarity of expression between the cells, the clustering is based on
the selected PCs and not the full data set.</p>
<center>
<div class="float">
<img
src="images/curriculum/05-ProjectionAndClustering/BioCellGene-NearestNeighborNetworks.png"
alt="Image: kNN example - section on graph based clustering (from Cambridge Bioinformatics course)" />
<div class="figcaption">Image: kNN example - section on graph based
clustering (from Cambridge Bioinformatics course)</div>
</div>
</center>
<p>To briefly summarize, cells are embedded in a k-nearest neighbors
(kNN) graph (illustrated above) based on “the euclidean distance in PCA
space” between the cells and the edge weights between any two cells
(e.g. their “closeness”) is refined based on Jaccard similarity (<a
href="https://hbctraining.github.io/scRNA-seq_online/lessons/07_SC_clustering_cells_SCT.html">source</a>).</p>
<details>
<summary>
<em>Additional context and sources for graph-based clustering</em>
</summary>
<a
href="https://biocellgen-public.svi.edu.au/mig_2019_scrnaseq-workshop/clustering-and-cell-annotation.html">Cambridge
Bioinformatics’ Analysis of single cell RNA-seq data course
materials</a>, the source of the image above, delves into kNN and other
graph based clustering methods in much greater detail, including
outlining possible downsides for these methods. To described kNN, we
have also drawn from the <a
href="https://holab-hku.github.io/Fundamental-scRNA/downstream.html#perform-linear-dimensional-reduction">Ho
Lab’s description of this process for Seurat v3</a> as well as the <a
href="https://hbctraining.github.io/scRNA-seq_online/lessons/07_SC_clustering_cells_SCT.html">HBC
materials on clustering</a> and the <a
href="https://bioconductor.org/books/3.15/OSCA.basic/clustering.html#clustering-graph">OSCA
book’s more general overview of graph based clustering</a>, which also
describes the drawbacks for these methods.
</details>
<p><br></p>
<p>This process is performed with the <code>FindNeighbors()</code> <a
href="https://satijalab.org/seurat/reference/findneighbors">command</a>,
using the number of principal components we selected in the previous
section.</p>
<p>The second step is to iteratively partition the kNN graph into
“cliques” or clusters using the Louvain modularity optimization
algorithm (for the default parameters), with the “granularity” of the
clusters set by a <code>resolution</code> parameter (<a
href="https://satijalab.org/seurat/articles/pbmc3k_tutorial.html">source</a>).</p>
<div class="float">
<img
src="images/curriculum/05-ProjectionAndClustering/HBC-07-k-meansFigure.png"
alt="Image: K-means clustering example (from Cambridge Bioinformatics course)" />
<div class="figcaption">Image: K-means clustering example (from
Cambridge Bioinformatics course)</div>
</div>
<p>We’ll use the <code>FindClusters()</code> <a
href="https://satijalab.org/seurat/reference/findclusters">function</a>,
selecting a resolution of <code>0.4</code> to start, although we could
also add other resolutions at this stage to look at in later steps. See
<a
href="https://link.springer.com/article/10.1140/epjb/e2013-40829-0">Waltman
and Jan van Eck (2013)</a> for the underlying algorithms.</p>
<p>Again, how a “cell type” or “subtype” should be defined for your data
is important to consider in selecting a resolution - we’d start with a
higher resolution for smaller/more rare clusters and a lower resolution
for larger/more general clusters.</p>
<p>Then, when we look at the meta data we should see that cluster labels
have been added for each cell:</p>
<pre class="r"><code># Code block - clustering steps
# Create KNN graph with `FindNeighbors()`
geo_so = FindNeighbors(geo_so, dims = 1:pcs, reduction = &#39;integrated.sct.rpca&#39;)

# generate clusters
geo_so = FindClusters(geo_so, resolution = 0.4, cluster.name = &#39;integrated.sct.rpca.clusters&#39;)</code></pre>
<pre><code>Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck

Number of nodes: 31560
Number of edges: 1032683

Running Louvain algorithm...
Maximum modularity in 10 random starts: 0.9451
Number of communities: 20
Elapsed time: 5 seconds</code></pre>
<pre class="r"><code># look at meta.data to see cluster labels
head(geo_so@meta.data)</code></pre>
<pre><code>                                            orig.ident nCount_RNA nFeature_RNA
HODay0replicate1_AAACCTGAGAGAACAG-1 HO.Day0.replicate1      10234         3226
HODay0replicate1_AAACCTGGTCATGCAT-1 HO.Day0.replicate1       3158         1499
HODay0replicate1_AAACCTGTCAGAGCTT-1 HO.Day0.replicate1      13464         4102
HODay0replicate1_AAACGGGAGAGACTTA-1 HO.Day0.replicate1        577          346
HODay0replicate1_AAACGGGAGGCCCGTT-1 HO.Day0.replicate1       1189          629
HODay0replicate1_AAACGGGCAACTGGCC-1 HO.Day0.replicate1       7726         2602
                                     day  replicate percent.mt nCount_SCT
HODay0replicate1_AAACCTGAGAGAACAG-1 Day0 replicate1   1.240962       6061
HODay0replicate1_AAACCTGGTCATGCAT-1 Day0 replicate1   7.536415       4609
HODay0replicate1_AAACCTGTCAGAGCTT-1 Day0 replicate1   3.112002       5319
HODay0replicate1_AAACGGGAGAGACTTA-1 Day0 replicate1   1.559792       3880
HODay0replicate1_AAACGGGAGGCCCGTT-1 Day0 replicate1   3.700589       4186
HODay0replicate1_AAACGGGCAACTGGCC-1 Day0 replicate1   2.938131       5855
                                    nFeature_SCT integrated.sct.rpca.clusters
HODay0replicate1_AAACCTGAGAGAACAG-1         2867                            1
HODay0replicate1_AAACCTGGTCATGCAT-1         1509                            1
HODay0replicate1_AAACCTGTCAGAGCTT-1         2386                            1
HODay0replicate1_AAACGGGAGAGACTTA-1         1032                            9
HODay0replicate1_AAACGGGAGGCCCGTT-1          915                            0
HODay0replicate1_AAACGGGCAACTGGCC-1         2587                            1
                                    seurat_clusters
HODay0replicate1_AAACCTGAGAGAACAG-1               1
HODay0replicate1_AAACCTGGTCATGCAT-1               1
HODay0replicate1_AAACCTGTCAGAGCTT-1               1
HODay0replicate1_AAACGGGAGAGACTTA-1               9
HODay0replicate1_AAACGGGAGGCCCGTT-1               0
HODay0replicate1_AAACGGGCAACTGGCC-1               1</code></pre>
<p>The result of <code>FindNeighbors()</code> adds graph information to
the <code>graphs</code> slot:</p>
<div class="float">
<img src="images/seurat_schematic/Slide8.png"
alt="Image: Schematic after FindNeighbors()." />
<div class="figcaption">Image: Schematic after FindNeighbors().</div>
</div>
<p>The result of <code>FindClusters()</code> adds two columns to the
<code>meta.data</code> table and changes the <code>active.ident</code>
to the “seurat_clusters” column. In other words, the cells now belong to
clusters rather than to their <code>orig.ident</code>.</p>
<div class="float">
<img src="images/seurat_schematic/Slide9.png"
alt="Image: Schematic after FindClusters()." />
<div class="figcaption">Image: Schematic after FindClusters().</div>
</div>
<p>Generally it’s preferable to err on the side of too many clusters, as
they can be combined manually in later steps. In our experience, this is
another parameter that often needs to be iteratively revised and
reviewed.</p>
<details>
<summary>
<em>Resolution parameter recommendations</em>
</summary>
The <a
href="https://holab-hku.github.io/Fundamental-scRNA/downstream.html#perform-linear-dimensional-reduction">Seurat
clustering tutorial</a> recommends selecting a resolution between 0.4 -
1.2 for datasets of approximately 3k cells, while the <a
href="https://hbctraining.github.io/scRNA-seq_online/lessons/07_SC_clustering_cells_SCT.html">HBC
course</a> recommends 0.4-1.4 for 3k-5k cells. However, in our
experience reasonable starting resolutions can be very dataset
dependent.
</details>
<p><br></p>
</div>
</div>
<div id="cluster-plots" class="section level1">
<h1>Cluster plots</h1>
<p>To visualize the cell clusters, we can use dimensionality reduction
techniques to visualize and explore our large, high-dimensional dataset.
Two popular methods that are supported by Seurat are t-distributed
stochastic neighbor embedding (t-SNE) and Uniform Manifold Approximation
and Projection (UMAP) techniques. These techniques allow us to visualize
our high-dimensional single-cell data in 2D space and see if cells
grouped together within graph-based clusters co-localize in these
representations (<a
href="https://satijalab.org/seurat/articles/pbmc3k_tutorial.html#run-non-linear-dimensional-reduction-umaptsne">source</a>).</p>
<p>While we unfortunately don’t have time to compare and contrast tSNE,
and UMAP, we would highly recommend <a
href="https://pair-code.github.io/understanding-umap/">this blog post
contrasting tSNE and UMAP</a> for illustrative examples. The Seurat
authors additionally caution that while these methods are useful for
data exploration, to avoid drawing biological conclusions solely based
on these visualizations (<a
href="https://satijalab.org/seurat/articles/pbmc3k_tutorial.html#run-non-linear-dimensional-reduction-umaptsne">source</a>).</p>
<p>To start this process, we’ll use the <code>RunUMAP()</code> <a
href="https://satijalab.org/seurat/reference/runumap">function</a> to
calculate the UMAP reduction for our data. Notice how the previous
dimensionality choices carry through the downstream analysis and that
the number of PCs selected in the previous steps are included as an
argument.</p>
<pre class="r"><code># Code block - create UMAP reduction
geo_so = RunUMAP(geo_so, dims = 1:pcs, reduction = &#39;integrated.sct.rpca&#39;, reduction.name = &#39;umap.integrated.sct.rpca&#39;)
geo_so # Notice a third reduction has been added: `umap.integrated.sct.rpca`</code></pre>
<pre><code>An object of class Seurat 
46955 features across 31560 samples within 2 assays 
Active assay: SCT (20466 features, 3000 variable features)
 3 layers present: counts, data, scale.data
 1 other assay present: RNA
 3 dimensional reductions calculated: unintegrated.sct.pca, integrated.sct.rpca, umap.integrated.sct.rpca</code></pre>
<p>The resulting Seurat object now has an additional
<code>umap.integrated.sct.rpca</code> in the <code>reduction</code>
slot:</p>
<div class="float">
<img src="images/seurat_schematic/Slide10.png"
alt="Image: Schematic after RunUMAP()." />
<div class="figcaption">Image: Schematic after RunUMAP().</div>
</div>
</div>
<div id="visualizing-and-evaluating-clustering" class="section level1">
<h1>Visualizing and evaluating clustering</h1>
<!--- How many clusters should I get and how do I adjust the number? --->
<!--- Add example of changing resolution?--->
<p>After we generate the UMAP reduction, we can then visualize the
results using the <code>DimPlot()</code> <a
href="https://satijalab.org/seurat/reference/dimplot">function</a>,
labeling our plot by the auto generated <code>seurat_clusters</code>
that correspond to the most recent clustering results generated.</p>
<p>At this stage, we want to determine if the clusters look fairly well
separated, if they seem to correspond to how cells are grouped in the
UMAP, and if the number of clusters is generally aligned with the
resolution of our biological question. Again, if there are “too many”
clusters that’s not necessarily a problem.</p>
<p>We can also look at the same UMAP labeled by <code>day</code> to
visually inspect if the UMAP structure corresponds to the
<code>day</code>.</p>
<pre class="r"><code># Code block - UMAP cluster visualization 
# cluster ID labels
post_integration_umap_plot_clusters = DimPlot(geo_so, group.by = &#39;seurat_clusters&#39;, label = TRUE, reduction = &#39;umap.integrated.sct.rpca&#39;) + NoLegend()
post_integration_umap_plot_clusters

ggsave(filename = &#39;results/figures/umap_integrated_sct_clusters.png&#39;, plot = post_integration_umap_plot_clusters, width = 6, height = 6, units = &#39;in&#39;)

# clusters with labels, split by condition
post_integration_umap_plot_split_clusters = DimPlot(geo_so, group.by = &#39;seurat_clusters&#39;, split.by = &#39;day&#39;, label = TRUE, reduction = &#39;umap.integrated.sct.rpca&#39;) + NoLegend()
post_integration_umap_plot_split_clusters

ggsave(filename = &#39;results/figures/umap_integrated_sct_split_clusters.png&#39;, plot = post_integration_umap_plot_clusters, width = 14, height = 6, units = &#39;in&#39;)

# UMAP with day labels (note - we added this column to the meta-data yesterday)
post_integration_umap_plot_day = DimPlot(geo_so, group.by = &#39;day&#39;, label = FALSE, reduction = &#39;umap.integrated.sct.rpca&#39;)
post_integration_umap_plot_day

ggsave(filename = &#39;results/figures/umap_integrated_sct_day.png&#39;, plot = post_integration_umap_plot_day, width = 8, height = 6, units = &#39;in&#39;)</code></pre>
<p><img src="images/curriculum/05-ProjectionAndClustering/05-umap_by_clusters-1.png" width="816" style="display: block; margin: auto;" /><img src="images/curriculum/05-ProjectionAndClustering/05-umap_by_clusters-2.png" width="816" style="display: block; margin: auto;" /><img src="images/curriculum/05-ProjectionAndClustering/05-umap_by_clusters-3.png" width="816" style="display: block; margin: auto;" /></p>
<p>Similar to the PCA plots, the <code>day</code> labeled UMAP can tell
us if technical sources of variation might be driving or stratifying the
clusters, which would suggest that the normalization and integration
steps should be revisted before proceeding.</p>
<p>Another approach is to evaluate the number of cells per cluster using
the <code>table()</code> function, split by <code>day</code> or split by
<code>orig.ident</code> to see if the individual samples are driving any
of the UMAP structure:</p>
<pre class="r"><code># Code block - cell count tables
# cells per cluster, split by condition
table(geo_so@meta.data$day, geo_so@meta.data$integrated.sct.rpca.clusters)</code></pre>
<pre><code>       
           0    1    2    3    4    5    6    7    8    9   10   11   12   13
  Day0   131 1176  923   54   68   23  166  169  108  105  265   56   42  136
  Day7  3903 2161  668 2314 2032 2263 1593  924  555  526  393  627  660  403
  Day21 1581 1458  898  110  242   34  461  142  454  363  211  104   65  158
       
          14   15   16   17   18   19
  Day0     3    0  151  137  132   30
  Day7   608  621  301   96   87  120
  Day21   35    2   42  258  190   22</code></pre>
<pre class="r"><code># cells per cluster per sample
table(geo_so@meta.data$orig.ident, geo_so@meta.data$integrated.sct.rpca.clusters)</code></pre>
<pre><code>                     
                         0    1    2    3    4    5    6    7    8    9   10
  HO.Day0.replicate1    37  338  234   22   23    8   51   57   23   24   70
  HO.Day0.replicate2    19  152  182    7    9    8   30   28   24   20   51
  HO.Day0.replicate3    46  423  273    8   22    2   49   51   31   30   73
  HO.Day0.replicate4    29  263  234   17   14    5   36   33   30   31   71
  HO.Day7.replicate1   613  558  242  794  507  819  368  256  106    0   28
  HO.Day7.replicate2  1331  458  149  524  528  477  462  214  165    0  277
  HO.Day7.replicate3  1092  831  182  555  522  607  408  301  187    0   72
  HO.Day7.replicate4   867  314   95  441  475  360  355  153   97  526   16
  HO.Day21.replicate1  418  477  263   37   63   12  141   40  133  103   65
  HO.Day21.replicate2  213  250  221   13   47    6   83   31   67   72   30
  HO.Day21.replicate3  223  223  190   18   49    4   94   26   75   65   32
  HO.Day21.replicate4  727  508  224   42   83   12  143   45  179  123   84
                     
                        11   12   13   14   15   16   17   18   19
  HO.Day0.replicate1    17   11   23    2    0   48   22   33   10
  HO.Day0.replicate2     8    8   30    1    0   12   24   13    3
  HO.Day0.replicate3    16   12   38    0    0   52   41   52    3
  HO.Day0.replicate4    15   11   45    0    0   39   50   34   14
  HO.Day7.replicate1   172  206   93    0  272   70   41   28   42
  HO.Day7.replicate2   187  165  123    0  126   89   18   13   18
  HO.Day7.replicate3   176  163  155    0  160   99   26   36   54
  HO.Day7.replicate4    92  126   32  608   63   43   11   10    6
  HO.Day21.replicate1   37   14   49   13    0   14   65   57    3
  HO.Day21.replicate2   16   14   26    4    0    5   53   28    7
  HO.Day21.replicate3   15   18   36    3    0    9   54   38    6
  HO.Day21.replicate4   36   19   47   15    2   14   86   67    6</code></pre>
<!-- consider adding later 
Add DimPlot for % mitochondria to see if high % are across dataset or limited to one/few clusters (related to what Olivia talked about during Day 1)

# Other approaches for visualizing scRNA-sq data
e.g. code for tSNE visualization 
-->
</div>
<div id="comparing-to-unintegrated-data" class="section level1">
<h1>Comparing to unintegrated data</h1>
<p>If we had proceeded with our filtered data and only normalized our
data without doing any integration, including through the dimensionality
reduction and clustering steps and then labeled the cells with their
sample of origin, then we would see the following for our data:</p>
<!--Add updated example of UMAP / sample labels for unintegrated data - need to check with Raymond regarding how best to do this in place -->
<pre><code>Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck

Number of nodes: 31560
Number of edges: 998753

Running Louvain algorithm...
Maximum modularity in 10 random starts: 0.9506
Number of communities: 22
Elapsed time: 5 seconds</code></pre>
<p><img src="images/curriculum/05-ProjectionAndClustering/05-run_umap_unintegrated-1.png" width="816" height="80%" style="display: block; margin: auto;" /></p>
<p>In the plot at left, we see that while there are distinct clusters,
those clusters seem to stratified by day. This suggests that without
integration, these batch effects could skew the biological variability
in our data. While on the right, we see little stratification within our
clusters which means the integration seems to have removed those batch
effects.</p>
<!-- Edit section to incorporate --->
<details>
<summary>
<strong>Rewind: Pre-integration evaluation clustering and visualization
(code)</strong>
</summary>
<p>Prior to integration, we could follow the same steps we’ve just run
for the integrated to see if the resulting clusters tend to be
determined by sample or condition (in this case, the day):</p>
<pre class="r"><code>geo_so = FindNeighbors(geo_so, dims = 1:pcs, assay = &#39;RNA&#39;, reduction = &#39;unintegrated.sct.pca&#39;, graph.name = c(&#39;RNA_nn&#39;, &#39;RNA_snn&#39;))
geo_so = FindClusters(geo_so, resolution = 0.4, graph.name = &#39;RNA_snn&#39;, cluster.name = &#39;unintegrated.sct.clusters&#39;)
geo_so = RunUMAP(geo_so, dims = 1:pcs, reduction = &#39;unintegrated.sct.pca&#39;, reduction.name = &#39;umap.unintegrated.sct.pca&#39;)</code></pre>
<p>The plots above were generated with:</p>
<pre class="r"><code># Code block - show unintegrated
pre_integration_umap_plot_orig.ident = DimPlot(geo_so, group.by = &#39;orig.ident&#39;, label = FALSE, reduction = &#39;umap.unintegrated.sct.pca&#39;)
ggsave(filename = &#39;results/figures/umap_unintegrated_sct_orig.ident.png&#39;, plot = pre_integration_umap_plot_orig.ident, width = 8, height = 6, units = &#39;in&#39;)

pre_integration_umap_plot_day = DimPlot(geo_so, group.by = &#39;day&#39;, label = FALSE, reduction = &#39;umap.unintegrated.sct.pca&#39;)
ggsave(filename = &#39;results/figures/umap_unintegrated_sct_day.png&#39;, plot = pre_integration_umap_plot_day, width = 8, height = 6, units = &#39;in&#39;)</code></pre>
</details>
<p><br> <br></p>
<details>
<summary>
<strong>Alternative clustering resolutions</strong>
</summary>
<p>While we show a single resolution, we can generate and plot multiple
resolutions iteratively and compare between them before selecting a
clustering result for the next steps:</p>
<pre class="r"><code>resolutions = c(0.4, 0.8)

for(res in resolutions) {
    message(res)

    cluster_column = sprintf(&#39;SCT_snn_res.%s&#39;, res)
    umap_file = sprintf(&#39;results/figures/umap_integrated_sct_%s.png&#39;, res)

    geo_so = FindClusters(geo_so, resolution = res)

    DimPlot(geo_so, group.by = cluster_column, label = TRUE, reduction = &#39;umap.integrated.sct.rpca&#39;) + NoLegend()
    ggsave(filename = umap_file, width = 8, height = 7, units = &#39;in&#39;)
}</code></pre>
<p>In the results, we’ll see multiple resolutions should now be added to
the metadata slot.</p>
<pre class="r"><code>head(geo_so@meta.data)</code></pre>
</details>
<p><br> <br></p>
</div>
<div id="save-our-progress" class="section level1">
<h1>Save our progress</h1>
<p>Before moving on to our next section, we will output our updated
Seurat object to file:</p>
<pre class="r"><code>saveRDS(geo_so, file = &#39;results/rdata/geo_so_sct_clustered.rds&#39;)</code></pre>
</div>
<div id="summary" class="section level1">
<h1>Summary</h1>
<p>In this section we:</p>
<ul>
<li>Generated cluster assignments for our cells using
<code>FindNeighbors()</code> and <code>FindClusters()</code></li>
<li>Evaluated our initial clusters using <code>RunUMAP</code>
dimensional reduction and visualization</li>
</ul>
<p>Next steps: Marker genes</p>
<hr />
<p>These materials have been adapted and extended from materials listed
above. These are open access materials distributed under the terms of
the <a href="http://creativecommons.org/licenses/by/4.0/">Creative
Commons Attribution license (CC BY 4.0)</a>, which permits unrestricted
use, distribution, and reproduction in any medium, provided the original
author and source are credited.</p>
<br/> <br/>
<hr/>
<table style="width:100%;">
<colgroup>
<col width="28%" />
<col width="42%" />
<col width="28%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><a href="04-PCAandIntegration.html">Previous
lesson</a></th>
<th align="center"><a href="#top">Top of this lesson</a></th>
<th align="right"><a href="06-MarkerVisualization.html">Next
lesson</a></th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiQ2x1c3RlcmluZyBhbmQgUHJvamVjdGlvbiIKYXV0aG9yOiAiVU0gQmlvaW5mb3JtYXRpY3MgQ29yZSIKZGF0ZTogImByIFN5cy5EYXRlKClgIgpvdXRwdXQ6CiAgICAgICAgaHRtbF9kb2N1bWVudDoKICAgICAgICAgICAgaW5jbHVkZXM6CiAgICAgICAgICAgICAgICBpbl9oZWFkZXI6IGhlYWRlci5odG1sCiAgICAgICAgICAgIHRoZW1lOiBwYXBlcgogICAgICAgICAgICB0b2M6IHRydWUKICAgICAgICAgICAgdG9jX2RlcHRoOiA0CiAgICAgICAgICAgIHRvY19mbG9hdDogdHJ1ZQogICAgICAgICAgICBudW1iZXJfc2VjdGlvbnM6IGZhbHNlCiAgICAgICAgICAgIGZpZ19jYXB0aW9uOiB0cnVlCiAgICAgICAgICAgIG1hcmtkb3duOiBHRk0KICAgICAgICAgICAgY29kZV9kb3dubG9hZDogdHJ1ZQotLS0KCjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+CmJvZHksIHRkIHsKICAgZm9udC1zaXplOiAxOHB4Owp9CmNvZGUucnsKICBmb250LXNpemU6IDEycHg7Cn0KcHJlIHsKICBmb250LXNpemU6IDEycHgKfQoKdGFibGUuZmlnLCB0aC5maWcsIHRkLmZpZyB7CiAgYm9yZGVyOiAxcHggc29saWQgYmxhY2s7CiAgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsKICBwYWRkaW5nOiAxNXB4Owp9Cgp0YWJsZS5maWcsIHRoLmZpZywgdGQuZmlnIHsKICBib3JkZXI6IDFweCBzb2xpZCBibGFjazsKICBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOwogIHBhZGRpbmc6IDE1cHg7Cn0KPC9zdHlsZT4KCmBgYHtyIGtsaXBweSwgZWNobz1GQUxTRSwgaW5jbHVkZT1UUlVFfQprbGlwcHk6OmtsaXBweShsYW5nID0gYygiciIsICJtYXJrZG93biIsICJiYXNoIiksIHBvc2l0aW9uID0gYygidG9wIiwgInJpZ2h0IikpCmBgYAoKYGBge3IsIGluY2x1ZGUgPSBGQUxTRX0Kc291cmNlKCIuLi9iaW4vY2h1bmstb3B0aW9ucy5SIikKa25pdHJfZmlnX3BhdGgoIjA1LVByb2plY3Rpb25BbmRDbHVzdGVyaW5nLzA1LSIpCmBgYAoKIyBXb3JrZmxvdyBPdmVydmlldyB7LnVubGlzdGVkIC51bm51bWJlcmVkfQoKPGJyLz4KPGltZyBzcmM9ImltYWdlcy93YXlmaW5kZXIvd2F5ZmluZGVyLnBuZyIgYWx0PSJ3YXlmaW5kZXIiIHN0eWxlPSJoZWlnaHQ6IDQwMHB4OyIvPgo8YnIvPgo8YnIvPgoKIyBJbnRyb2R1Y3Rpb24KCjwhLS0tIEdlbmVyYWwgZ29hbDogdG8gZ2VuZXJhdGUgY2x1c3RlcnMgdGhhdCByZWFzb25hYmx5IGFwcHJveGltYXRlIGNlbGwtdHlwZXMgb3Igc3ViLXR5cGVzIG9mIGludGVyZXN0IC0tLT4KT25lIG9mIG91ciBnb2FscyBpbiBhIHNpbmdsZS1jZWxsIGFuYWx5c2lzIGlzIHRvIGdlbmVyYXRlIGNsdXN0ZXJzIHRoYXQgcmVhc29uYWJseSBhcHByb3hpbWF0ZSBjZWxsLXR5cGVzIG9yIHN1Yi10eXBlcyBvZiBpbnRlcmVzdCBpbiBvdXIgc2FtcGxlcyBiZWZvcmUgZGV0ZXJtaW5pbmcgaWYgdGhlcmUgYXJlIGRpZmZlcmVuY2VzIGluIHRoZSBwcm9wb3J0aW9ucyBvZiB0aGVzZSBwb3B1bGF0aW9ucyBvciBkaWZmZXJlbmNlcyBpbiBnZW5lIGV4cHJlc3Npb24gd2l0aGluIHRoZXNlIHBvcHVsYXRpb25zIGJldHdlZW4gZXhwZXJpbWVudGFsIGNvbmRpdGlvbnMuCgo8dGFibGUgY2xhc3M9J2ZpZyc+Cjx0ciBjbGFzcz0nZmlnJz48dGQgY2xhc3M9J2ZpZyc+IVtdKGltYWdlcy9ncmFwaGljYWxfYWJzdHJhY3RzL2dyYXBoaWNhbF9hYnN0cmFjdF9jbHVzdGVyX3Byb2plY3Rpb24ucG5nKTwvdGQ+PC90cj4KPHRyIGNsYXNzPSdmaWcnPjx0ZCBjbGFzcz0nZmlnJz5BLiBUaGUgcHJpb3Igc3RlcCB1c2VkIHRoZSBmaWx0ZXJlZCwgbm9ybWFsaXplZCBjb3VudHMgYXMgaW5wdXQgdG8gYSBwcmluaWNwYWwgY29tcG9uZW50IGFuYWx5c2lzLiBUaGUgdG9wIHByaW5jaXBsZSBjb21wb25lbnRzIChQQ3MpIGFyZSB0aGUgaW5wdXQgdG8gdGhlIGNsdXN0ZXJpbmcgc3RlcC4gPGJyLz4KQi4gQ2VsbHMgYXJlIHBsb3R0ZWQgaW4gYSBoaWdoLWRpbWVuc2lvbmFsIHNwYWNlICh3aGVyZSB0aGUgbnVtIGRpbWVzbmlvbnMgPSBudW0gb2YgaW5jbHVkZWQgUENzLCBlLmcuIDE1IGRpbWVuc2lvbnMpOyBjZWxscyB3aXRoIHNpbWlsYXIgZ2VuZSBleHByZXNzaW9uIHByb2ZpbGVzIGFyZSBjbG9zZXIgdG8gZWFjaCBvdGhlciBhbmQgYXJlIGNsdXN0ZXJlZCB0b2dldGhlci4gPGJyLz4KQy4gVGhlIGNlbGxzIGNsdXN0ZXJzIGFyZSBwcm9qZWN0ZWQgZnJvbSB0aGUgaGlnaC1kaW1lbnNpb25hbCBzcGFjZSAoZS5nLiAxNSBkaW1lbnNpb25zKSBkb3duIHRvIHR3by1kaW1lbnNpb25hbCBzcGFjZSBmb3IgdmlzdWFsaXphdGlvbi4KPC90ZD48L3RyPgo8L3RhYmxlPgo8YnIvPgoKCkluIHRoaXMgc2VjdGlvbiwgd2Ugd2lsbCBkZW1vbnN0cmF0ZSBob3cgdG8gZ2VuZXJhdGUgY2x1c3RlcnMgdXNpbmcgU2V1cmF0J3MgZ3JhcGggYmFzZWQgY2x1c3RlcmluZyBhcHByb2FjaCBhbmQgdmlzdWFsaXplIHRob3NlIGNsdXN0ZXJpbmcgYXNzaWdubWVudHMgdmlhIGEgbG93ZXItZGltZW5zaW9uYWwgcHJvamVjdGlvbiBvZiB0aGUgZnVsbCBkYXRhc2V0LgoKTGlrZSBvdGhlciBzdGVwcyBpbiBvdXIgYW5hbHlzaXMsIG11bHRpcGxlIHBhcmFtZXRlcnMgbWF5IG5lZWQgdG8gYmUgdGVzdGVkIGFuZCBldmFsdWF0ZWQgd2hpbGUgd2Ugd291bGQgZXhwZWN0IHRoYXQgb25seSB0aGUgZmluYWwgd291bGQgYmUgcmVwb3J0ZWQuIENsdXN0ZXJpbmcgaXMgY29uc2lkZXJlZCBwYXJ0IG9mIGRhdGEgZXhwbG9yYXRpb24gc28gYW4gaXRlcmF0aXZlIGFwcHJvYWNoIGlzIHJlYXNvbmFibGUsIGFuZCBvZnRlbiBleHBlY3RlZCAoW3NvdXJjZV0oaHR0cHM6Ly9iaW9jb25kdWN0b3Iub3JnL2Jvb2tzLzMuMTUvT1NDQS5iYXNpYy9jbHVzdGVyaW5nLmh0bWwpKS4gCgoKIyMgT2JqZWN0aXZlcwoKLSBVbmRlcnN0YW5kIHRoZSBjbHVzdGVyaW5nIHByb2Nlc3MgYW5kIGlucHV0IHBhcmFtZXRlcnMKLSBHZW5lcmF0ZSBpbml0aWFsIGNsdXN0ZXJzIHVzaW5nIGBgIAotIFZpc3VhbGl6ZSBvdXIgY2x1c3RlcmluZyByZXN1bHRzCgotLS0KCmBgYHtyLCByZWFkX3Jkc19oaWRkZW4sIGVjaG8gPSBGQUxTRSwgd2FybmluZyA9IEZBTFNFLCBtZXNzYWdlID0gRkFMU0V9CmlmKCFleGlzdHMoJ2dlb19zbycpKSB7CiAgbGlicmFyeShTZXVyYXQpCiAgbGlicmFyeShCUENlbGxzKQogIGxpYnJhcnkodGlkeXZlcnNlKQoKICBvcHRpb25zKGZ1dHVyZS5nbG9iYWxzLm1heFNpemUgPSAxZTkpCgogIGdlb19zbyA9IHJlYWRSRFMoJ3Jlc3VsdHMvcmRhdGEvZ2VvX3NvX3NjdF9pbnRlZ3JhdGVkLnJkcycpCn0KYGBgCgojIENsdXN0ZXJpbmcgYW5kIHByb2plY3Rpb24KCk5vdyB0aGF0IHdlIHNlbGVjdGVkIGEgbnVtYmVyIG9mIFBDcyB0aGF0IHdlIHRoaW5rIGFyZSBsaWtlbHkgdG8gcmVwcmVzZW50IGJpb2xvZ2ljYWwgdmFyaWF0aW9uIGFuZCBpbnRlZ3JhdGVkIG91ciBkYXRhIGFjcm9zcyBzYW1wbGVzL2JhdGNoZXMsIG91ciBuZXh0IHRhc2sgaXMgY2x1c3RlcmluZy4gCgoKQW4gaW1wb3J0YW50IGFzcGVjdCBvZiBwYXJhbWV0ZXIgc2VsZWN0aW9uIGZvciBjbHVzdGVyaW5nIGlzIHRvIHVuZGVyc3RhbmQgdGhlICJyZXNvbHV0aW9uIiBvZiB0aGUgdW5kZXJseWluZyBiaW9sb2d5IGFuZCB5b3VyIGV4cGVyaW1lbnRhbCBkZXNpZ246ICAgCgotIElzIGFuc3dlcmluZyB5b3VyIGJpb2xvZ2ljYWwgcXVlc3Rpb24gZGVwZW5kZW50IG9uIGlkZW50aWZ5aW5nIHJhcmVyIGNlbGwgdHlwZXMgb3Igc3BlY2lmaWMgc3VidHlwZXM/ICAgCi0gT3IgYXJlIGJyb2FkZXIgY2VsbC10eXBlcyBtb3JlIHJlbGV2YW50IHRvIGFkZHJlc3MgeW91ciBiaW9sb2dpY2FsIHF1ZXN0aW9uPyAgIAoKVGhlIE9TQ0EgYm9vayBoYXMgYSBbaGVscGZ1bCBhbmFsb2d5IGNvbXBhcmluZyBjbHVzdGVyaW5nIHRvIG1pY3Jvc2NvcHldKGh0dHBzOi8vYmlvY29uZHVjdG9yLm9yZy9ib29rcy8zLjE1L09TQ0EuYmFzaWMvY2x1c3RlcmluZy5odG1sI292ZXJ2aWV3LTEpIGFuZCBwb2ludHMgb3V0IHRoYXQgImFza2luZyBmb3IgYW4gdW5xdWFsaWZpZWQgJ2Jlc3QnIGNsdXN0ZXJpbmcgaXMgYWtpbiB0byBhc2tpbmcgZm9yIHRoZSBiZXN0IG1hZ25pZmljYXRpb24gb24gYSBtaWNyb3Njb3BlIHdpdGhvdXQgYW55IGNvbnRleHQiLiAKClRvIGdlbmVyYXRlIGNsdXN0ZXJzLCB3ZSB3aWxsIGdlbmVyYXRlICJjb21tdW5pdGllcyIgb2YgY2VsbHMgdXNpbmcgdGhlIFBDcyB3ZSBzZWxlY3RlZCwgYmVmb3JlIGNob29zaW5nIGEgcmVzb2x1dGlvbiBwYXJhbWV0ZXIgdG8gZGl2aWRlIHRob3NlIGNvbW11bml0aWVzIGludG8gZGlzY3JldGUgY2x1c3RlcnMuCgo8IS0tLSBDb250cmFzdCB0aGUgcHJldmlvdXMgZGltZW5zaW9uYWxpdHkgcmVkdWN0aW9uIHZlcnN1cyBuZWFyZXN0IG5laWdoYm9ycyBjbHVzdGVyaW5nIGFuZCBwbG90dGluZyB0aGUgY2VsbHMgaW4gbG93ZXIgZGltZW5zaW9uYWxpdHkgd2l0aCB0aGUgY2x1c3RlciBsYWJlbHM/IC0tLT4KCiMjIENsdXN0ZXJpbmcKClNldXJhdCB1c2VzIGEgZ3JhcGgtYmFzZWQgY2x1c3RlcmluZyBhcHByb2FjaCB0byBhc3NpZ24gY2VsbHMgdG8gY2x1c3RlcnMgdXNpbmcgYSBkaXN0YW5jZSBtZXRyaWMgYmFzZWQgb24gdGhlIHByZXZpb3VzbHkgZ2VuZXJhdGVkIFBDcywgd2l0aCBpbXByb3ZlbWVudHMgYmFzZWQgb24gd29yayBieSAoW1h1IGFuZCBTdSAyMDE1XShodHRwczovL2FjYWRlbWljLm91cC5jb20vYmlvaW5mb3JtYXRpY3MvYXJ0aWNsZS8zMS8xMi8xOTc0LzIxNDUwNSkpIGFuZCBDeVRPRiBkYXRhIChbTGV2aW5lIGV0IGFsLiAyMDE1XShodHRwczovL3d3dy5uY2JpLm5sbS5uaWguZ292L3BtYy9hcnRpY2xlcy9QTUM0NTA4NzU3LykpIGltcGxlbWVudGVkIGluIFNldXJhdCB2MyBhbmQgdjUgYW5kIGJ1aWxkaW5nIG9uIHRoZSBpbml0aWFsIHN0cmF0ZWdpZXMgZm9yIGRyb3BsZXQtYmFzZWQgc2luZ2xlLWNlbGwgdGVjaG5vbG9neSAoW01hY29za28gZXQgYWwuIDIwMTVdKGh0dHBzOi8vd3d3Lm5jYmkubmxtLm5paC5nb3YvcG1jL2FydGljbGVzL1BNQzQ0ODExMzkvKSkgIChbc291cmNlXShodHRwczovL3NhdGlqYWxhYi5vcmcvc2V1cmF0L2FydGljbGVzL3BibWMza190dXRvcmlhbC5odG1sKSkuIEEga2V5IGFzcGVjdCBvZiB0aGlzIHByb2Nlc3MgaXMgdGhhdCB3aGlsZSB0aGUgY2x1c3RlcnMgYXJlIGJhc2VkIG9uIHNpbWlsYXJpdHkgb2YgZXhwcmVzc2lvbiBiZXR3ZWVuIHRoZSBjZWxscywgdGhlIGNsdXN0ZXJpbmcgaXMgYmFzZWQgb24gdGhlIHNlbGVjdGVkIFBDcyBhbmQgbm90IHRoZSBmdWxsIGRhdGEgc2V0LiAKCjxjZW50ZXI+CiFbSW1hZ2U6IGtOTiBleGFtcGxlIC0gc2VjdGlvbiBvbiBncmFwaCBiYXNlZCBjbHVzdGVyaW5nIChmcm9tIENhbWJyaWRnZSBCaW9pbmZvcm1hdGljcyBjb3Vyc2UpXSguL2ltYWdlcy9jdXJyaWN1bHVtLzA1LVByb2plY3Rpb25BbmRDbHVzdGVyaW5nL0Jpb0NlbGxHZW5lLU5lYXJlc3ROZWlnaGJvck5ldHdvcmtzLnBuZykKPC9jZW50ZXI+CgpUbyBicmllZmx5IHN1bW1hcml6ZSwgY2VsbHMgYXJlIGVtYmVkZGVkIGluIGEgay1uZWFyZXN0IG5laWdoYm9ycyAoa05OKSBncmFwaCAoaWxsdXN0cmF0ZWQgYWJvdmUpIGJhc2VkIG9uICJ0aGUgZXVjbGlkZWFuIGRpc3RhbmNlIGluIFBDQSBzcGFjZSIgYmV0d2VlbiB0aGUgY2VsbHMgYW5kIHRoZSBlZGdlIHdlaWdodHMgYmV0d2VlbiBhbnkgdHdvIGNlbGxzIChlLmcuIHRoZWlyICJjbG9zZW5lc3MiKSBpcyByZWZpbmVkIGJhc2VkIG9uIEphY2NhcmQgc2ltaWxhcml0eSAoW3NvdXJjZV0oaHR0cHM6Ly9oYmN0cmFpbmluZy5naXRodWIuaW8vc2NSTkEtc2VxX29ubGluZS9sZXNzb25zLzA3X1NDX2NsdXN0ZXJpbmdfY2VsbHNfU0NULmh0bWwpKS4KCjxkZXRhaWxzPgogICAgPHN1bW1hcnk+KkFkZGl0aW9uYWwgY29udGV4dCBhbmQgc291cmNlcyBmb3IgZ3JhcGgtYmFzZWQgY2x1c3RlcmluZyo8L3N1bW1hcnk+CiAgICBbQ2FtYnJpZGdlIEJpb2luZm9ybWF0aWNzJyBBbmFseXNpcyBvZiBzaW5nbGUgY2VsbCBSTkEtc2VxIGRhdGEgY291cnNlIG1hdGVyaWFsc10oaHR0cHM6Ly9iaW9jZWxsZ2VuLXB1YmxpYy5zdmkuZWR1LmF1L21pZ18yMDE5X3Njcm5hc2VxLXdvcmtzaG9wL2NsdXN0ZXJpbmctYW5kLWNlbGwtYW5ub3RhdGlvbi5odG1sKSwgdGhlIHNvdXJjZSBvZiB0aGUgaW1hZ2UgYWJvdmUsIGRlbHZlcyBpbnRvIGtOTiBhbmQgb3RoZXIgZ3JhcGggYmFzZWQgY2x1c3RlcmluZyBtZXRob2RzIGluIG11Y2ggZ3JlYXRlciBkZXRhaWwsIGluY2x1ZGluZyBvdXRsaW5pbmcgcG9zc2libGUgZG93bnNpZGVzIGZvciB0aGVzZSBtZXRob2RzLiAKICAgICBUbyBkZXNjcmliZWQga05OLCB3ZSBoYXZlIGFsc28gZHJhd24gZnJvbSB0aGUgW0hvIExhYidzIGRlc2NyaXB0aW9uIG9mIHRoaXMgcHJvY2VzcyBmb3IgU2V1cmF0IHYzXShodHRwczovL2hvbGFiLWhrdS5naXRodWIuaW8vRnVuZGFtZW50YWwtc2NSTkEvZG93bnN0cmVhbS5odG1sI3BlcmZvcm0tbGluZWFyLWRpbWVuc2lvbmFsLXJlZHVjdGlvbikgYXMgd2VsbCBhcyB0aGUgW0hCQyBtYXRlcmlhbHMgb24gY2x1c3RlcmluZ10oaHR0cHM6Ly9oYmN0cmFpbmluZy5naXRodWIuaW8vc2NSTkEtc2VxX29ubGluZS9sZXNzb25zLzA3X1NDX2NsdXN0ZXJpbmdfY2VsbHNfU0NULmh0bWwpIGFuZCB0aGUgW09TQ0EgYm9vaydzIG1vcmUgZ2VuZXJhbCBvdmVydmlldyBvZiBncmFwaCBiYXNlZCBjbHVzdGVyaW5nXShodHRwczovL2Jpb2NvbmR1Y3Rvci5vcmcvYm9va3MvMy4xNS9PU0NBLmJhc2ljL2NsdXN0ZXJpbmcuaHRtbCNjbHVzdGVyaW5nLWdyYXBoKSwgd2hpY2ggYWxzbyBkZXNjcmliZXMgdGhlIGRyYXdiYWNrcyBmb3IgdGhlc2UgbWV0aG9kcy4KPC9kZXRhaWxzPgo8YnI+CgpUaGlzIHByb2Nlc3MgaXMgcGVyZm9ybWVkIHdpdGggdGhlIGBGaW5kTmVpZ2hib3JzKClgIFtjb21tYW5kXShodHRwczovL3NhdGlqYWxhYi5vcmcvc2V1cmF0L3JlZmVyZW5jZS9maW5kbmVpZ2hib3JzKSwgdXNpbmcgdGhlIG51bWJlciBvZiBwcmluY2lwYWwgY29tcG9uZW50cyB3ZSBzZWxlY3RlZCBpbiB0aGUgcHJldmlvdXMgc2VjdGlvbi4KClRoZSBzZWNvbmQgc3RlcCBpcyB0byBpdGVyYXRpdmVseSBwYXJ0aXRpb24gdGhlIGtOTiBncmFwaCBpbnRvICJjbGlxdWVzIiBvciBjbHVzdGVycyB1c2luZyB0aGUgTG91dmFpbiBtb2R1bGFyaXR5IG9wdGltaXphdGlvbiBhbGdvcml0aG0gKGZvciB0aGUgZGVmYXVsdCBwYXJhbWV0ZXJzKSwgd2l0aCB0aGUgImdyYW51bGFyaXR5IiBvZiB0aGUgY2x1c3RlcnMgc2V0IGJ5IGEgYHJlc29sdXRpb25gIHBhcmFtZXRlciAoW3NvdXJjZV0oaHR0cHM6Ly9zYXRpamFsYWIub3JnL3NldXJhdC9hcnRpY2xlcy9wYm1jM2tfdHV0b3JpYWwuaHRtbCkpLgoKIVtJbWFnZTogSy1tZWFucyBjbHVzdGVyaW5nIGV4YW1wbGUgKGZyb20gQ2FtYnJpZGdlIEJpb2luZm9ybWF0aWNzIGNvdXJzZSldKC4vaW1hZ2VzL2N1cnJpY3VsdW0vMDUtUHJvamVjdGlvbkFuZENsdXN0ZXJpbmcvSEJDLTA3LWstbWVhbnNGaWd1cmUucG5nKQoKV2UnbGwgdXNlIHRoZSBgRmluZENsdXN0ZXJzKClgIFtmdW5jdGlvbl0oaHR0cHM6Ly9zYXRpamFsYWIub3JnL3NldXJhdC9yZWZlcmVuY2UvZmluZGNsdXN0ZXJzKSwgc2VsZWN0aW5nIGEgcmVzb2x1dGlvbiBvZiBgMC40YCB0byBzdGFydCwgYWx0aG91Z2ggd2UgY291bGQgYWxzbyBhZGQgb3RoZXIgcmVzb2x1dGlvbnMgYXQgdGhpcyBzdGFnZSB0byBsb29rIGF0IGluIGxhdGVyIHN0ZXBzLiBTZWUgW1dhbHRtYW4gYW5kIEphbiB2YW4gRWNrICgyMDEzKV0oaHR0cHM6Ly9saW5rLnNwcmluZ2VyLmNvbS9hcnRpY2xlLzEwLjExNDAvZXBqYi9lMjAxMy00MDgyOS0wKSBmb3IgdGhlIHVuZGVybHlpbmcgYWxnb3JpdGhtcy4KCkFnYWluLCBob3cgYSDigJxjZWxsIHR5cGXigJ0gb3Ig4oCcc3VidHlwZeKAnSBzaG91bGQgYmUgZGVmaW5lZCBmb3IgeW91ciBkYXRhIGlzIGltcG9ydGFudCB0byBjb25zaWRlciBpbiBzZWxlY3RpbmcgYSByZXNvbHV0aW9uIC0gd2UnZCBzdGFydCB3aXRoIGEgaGlnaGVyIHJlc29sdXRpb24gZm9yIHNtYWxsZXIvbW9yZSByYXJlIGNsdXN0ZXJzIGFuZCBhIGxvd2VyIHJlc29sdXRpb24gZm9yIGxhcmdlci9tb3JlIGdlbmVyYWwgY2x1c3RlcnMuICAKClRoZW4sIHdoZW4gd2UgbG9vayBhdCB0aGUgbWV0YSBkYXRhIHdlIHNob3VsZCBzZWUgdGhhdCBjbHVzdGVyIGxhYmVscyBoYXZlIGJlZW4gYWRkZWQgZm9yIGVhY2ggY2VsbDoKCmBgYHtyLCBmaW5kX25laWdoYm9ycywgY2FjaGUgPSBUUlVFLCBjYWNoZS5sYXp5ID0gRkFMU0UsIHdhcm5pbmcgPSBGQUxTRSwgbWVzc2FnZSA9IEZBTFNFfQojIENvZGUgYmxvY2sgLSBjbHVzdGVyaW5nIHN0ZXBzCiMgQ3JlYXRlIEtOTiBncmFwaCB3aXRoIGBGaW5kTmVpZ2hib3JzKClgCmdlb19zbyA9IEZpbmROZWlnaGJvcnMoZ2VvX3NvLCBkaW1zID0gMTpwY3MsIHJlZHVjdGlvbiA9ICdpbnRlZ3JhdGVkLnNjdC5ycGNhJykKCiMgZ2VuZXJhdGUgY2x1c3RlcnMKZ2VvX3NvID0gRmluZENsdXN0ZXJzKGdlb19zbywgcmVzb2x1dGlvbiA9IDAuNCwgY2x1c3Rlci5uYW1lID0gJ2ludGVncmF0ZWQuc2N0LnJwY2EuY2x1c3RlcnMnKQoKIyBsb29rIGF0IG1ldGEuZGF0YSB0byBzZWUgY2x1c3RlciBsYWJlbHMKaGVhZChnZW9fc29AbWV0YS5kYXRhKQpgYGAKClRoZSByZXN1bHQgb2YgYEZpbmROZWlnaGJvcnMoKWAgYWRkcyBncmFwaCBpbmZvcm1hdGlvbiB0byB0aGUgYGdyYXBoc2Agc2xvdDoKCiFbSW1hZ2U6IFNjaGVtYXRpYyBhZnRlciBGaW5kTmVpZ2hib3JzKCkuXShpbWFnZXMvc2V1cmF0X3NjaGVtYXRpYy9TbGlkZTgucG5nKQoKVGhlIHJlc3VsdCBvZiBgRmluZENsdXN0ZXJzKClgIGFkZHMgdHdvIGNvbHVtbnMgdG8gdGhlIGBtZXRhLmRhdGFgIHRhYmxlIGFuZCBjaGFuZ2VzIHRoZSBgYWN0aXZlLmlkZW50YCB0byB0aGUgInNldXJhdF9jbHVzdGVycyIgY29sdW1uLiBJbiBvdGhlciB3b3JkcywgdGhlIGNlbGxzIG5vdyBiZWxvbmcgdG8gY2x1c3RlcnMgcmF0aGVyIHRoYW4gdG8gdGhlaXIgYG9yaWcuaWRlbnRgLgoKIVtJbWFnZTogU2NoZW1hdGljIGFmdGVyIEZpbmRDbHVzdGVycygpLl0oaW1hZ2VzL3NldXJhdF9zY2hlbWF0aWMvU2xpZGU5LnBuZykKCkdlbmVyYWxseSBpdCdzIHByZWZlcmFibGUgdG8gZXJyIG9uIHRoZSBzaWRlIG9mIHRvbyBtYW55IGNsdXN0ZXJzLCBhcyB0aGV5IGNhbiBiZSBjb21iaW5lZCBtYW51YWxseSBpbiBsYXRlciBzdGVwcy4gSW4gb3VyIGV4cGVyaWVuY2UsIHRoaXMgaXMgYW5vdGhlciBwYXJhbWV0ZXIgdGhhdCBvZnRlbiBuZWVkcyB0byBiZSBpdGVyYXRpdmVseSByZXZpc2VkIGFuZCByZXZpZXdlZC4gCgo8ZGV0YWlscz4KICAgIDxzdW1tYXJ5PipSZXNvbHV0aW9uIHBhcmFtZXRlciByZWNvbW1lbmRhdGlvbnMqPC9zdW1tYXJ5PgogICAgVGhlIFtTZXVyYXQgY2x1c3RlcmluZyB0dXRvcmlhbF0oaHR0cHM6Ly9ob2xhYi1oa3UuZ2l0aHViLmlvL0Z1bmRhbWVudGFsLXNjUk5BL2Rvd25zdHJlYW0uaHRtbCNwZXJmb3JtLWxpbmVhci1kaW1lbnNpb25hbC1yZWR1Y3Rpb24pIHJlY29tbWVuZHMgc2VsZWN0aW5nIGEgcmVzb2x1dGlvbiBiZXR3ZWVuIDAuNCAtIDEuMiBmb3IgZGF0YXNldHMgb2YgYXBwcm94aW1hdGVseSAzayBjZWxscywgd2hpbGUgdGhlIFtIQkMgY291cnNlXShodHRwczovL2hiY3RyYWluaW5nLmdpdGh1Yi5pby9zY1JOQS1zZXFfb25saW5lL2xlc3NvbnMvMDdfU0NfY2x1c3RlcmluZ19jZWxsc19TQ1QuaHRtbCkgcmVjb21tZW5kcyAwLjQtMS40IGZvciAzay01ayBjZWxscy4gSG93ZXZlciwgaW4gb3VyIGV4cGVyaWVuY2UgcmVhc29uYWJsZSBzdGFydGluZyByZXNvbHV0aW9ucyBjYW4gYmUgdmVyeSBkYXRhc2V0IGRlcGVuZGVudC4KPC9kZXRhaWxzPgo8YnI+CgojIENsdXN0ZXIgcGxvdHMgCgpUbyB2aXN1YWxpemUgdGhlIGNlbGwgY2x1c3RlcnMsIHdlIGNhbiB1c2UgZGltZW5zaW9uYWxpdHkgcmVkdWN0aW9uIHRlY2huaXF1ZXMgdG8gdmlzdWFsaXplIGFuZCBleHBsb3JlIG91ciBsYXJnZSwgaGlnaC1kaW1lbnNpb25hbCBkYXRhc2V0LiBUd28gcG9wdWxhciBtZXRob2RzIHRoYXQgYXJlIHN1cHBvcnRlZCBieSBTZXVyYXQgYXJlIHQtZGlzdHJpYnV0ZWQgc3RvY2hhc3RpYyBuZWlnaGJvciBlbWJlZGRpbmcgKHQtU05FKSBhbmQgVW5pZm9ybSBNYW5pZm9sZCBBcHByb3hpbWF0aW9uIGFuZCBQcm9qZWN0aW9uIChVTUFQKSB0ZWNobmlxdWVzLiBUaGVzZSB0ZWNobmlxdWVzIGFsbG93IHVzIHRvIHZpc3VhbGl6ZSBvdXIgaGlnaC1kaW1lbnNpb25hbCBzaW5nbGUtY2VsbCBkYXRhIGluIDJEIHNwYWNlIGFuZCBzZWUgaWYgY2VsbHMgZ3JvdXBlZCB0b2dldGhlciB3aXRoaW4gZ3JhcGgtYmFzZWQgY2x1c3RlcnMgY28tbG9jYWxpemUgaW4gdGhlc2UgcmVwcmVzZW50YXRpb25zIChbc291cmNlXShodHRwczovL3NhdGlqYWxhYi5vcmcvc2V1cmF0L2FydGljbGVzL3BibWMza190dXRvcmlhbC5odG1sI3J1bi1ub24tbGluZWFyLWRpbWVuc2lvbmFsLXJlZHVjdGlvbi11bWFwdHNuZSkpLgoKV2hpbGUgd2UgdW5mb3J0dW5hdGVseSBkb24ndCBoYXZlIHRpbWUgdG8gY29tcGFyZSBhbmQgY29udHJhc3QgdFNORSwgYW5kIFVNQVAsIHdlIHdvdWxkIGhpZ2hseSByZWNvbW1lbmQgW3RoaXMgYmxvZyBwb3N0IGNvbnRyYXN0aW5nIHRTTkUgYW5kIFVNQVBdKGh0dHBzOi8vcGFpci1jb2RlLmdpdGh1Yi5pby91bmRlcnN0YW5kaW5nLXVtYXAvKSBmb3IgaWxsdXN0cmF0aXZlIGV4YW1wbGVzLiBUaGUgU2V1cmF0IGF1dGhvcnMgYWRkaXRpb25hbGx5IGNhdXRpb24gdGhhdCB3aGlsZSB0aGVzZSBtZXRob2RzIGFyZSB1c2VmdWwgZm9yIGRhdGEgZXhwbG9yYXRpb24sIHRvIGF2b2lkIGRyYXdpbmcgYmlvbG9naWNhbCBjb25jbHVzaW9ucyBzb2xlbHkgYmFzZWQgb24gdGhlc2UgdmlzdWFsaXphdGlvbnMgKFtzb3VyY2VdKGh0dHBzOi8vc2F0aWphbGFiLm9yZy9zZXVyYXQvYXJ0aWNsZXMvcGJtYzNrX3R1dG9yaWFsLmh0bWwjcnVuLW5vbi1saW5lYXItZGltZW5zaW9uYWwtcmVkdWN0aW9uLXVtYXB0c25lKSkuCgpUbyBzdGFydCB0aGlzIHByb2Nlc3MsIHdlJ2xsIHVzZSB0aGUgYFJ1blVNQVAoKWAgW2Z1bmN0aW9uXShodHRwczovL3NhdGlqYWxhYi5vcmcvc2V1cmF0L3JlZmVyZW5jZS9ydW51bWFwKSB0byBjYWxjdWxhdGUgdGhlIFVNQVAgcmVkdWN0aW9uIGZvciBvdXIgZGF0YS4gTm90aWNlIGhvdyB0aGUgcHJldmlvdXMgZGltZW5zaW9uYWxpdHkgY2hvaWNlcyBjYXJyeSB0aHJvdWdoIHRoZSBkb3duc3RyZWFtIGFuYWx5c2lzIGFuZCB0aGF0IHRoZSBudW1iZXIgb2YgUENzIHNlbGVjdGVkIGluIHRoZSBwcmV2aW91cyBzdGVwcyBhcmUgaW5jbHVkZWQgYXMgYW4gYXJndW1lbnQuCgpgYGB7ciwgcnVuX3VtYXAsIGNhY2hlID0gVFJVRSwgY2FjaGUubGF6eSA9IEZBTFNFLCB3YXJuaW5nID0gRkFMU0UsIG1lc3NhZ2UgPSBGQUxTRX0KIyBDb2RlIGJsb2NrIC0gY3JlYXRlIFVNQVAgcmVkdWN0aW9uCmdlb19zbyA9IFJ1blVNQVAoZ2VvX3NvLCBkaW1zID0gMTpwY3MsIHJlZHVjdGlvbiA9ICdpbnRlZ3JhdGVkLnNjdC5ycGNhJywgcmVkdWN0aW9uLm5hbWUgPSAndW1hcC5pbnRlZ3JhdGVkLnNjdC5ycGNhJykKZ2VvX3NvICMgTm90aWNlIGEgdGhpcmQgcmVkdWN0aW9uIGhhcyBiZWVuIGFkZGVkOiBgdW1hcC5pbnRlZ3JhdGVkLnNjdC5ycGNhYApgYGAKClRoZSByZXN1bHRpbmcgU2V1cmF0IG9iamVjdCBub3cgaGFzIGFuIGFkZGl0aW9uYWwgYHVtYXAuaW50ZWdyYXRlZC5zY3QucnBjYWAgaW4gdGhlIGByZWR1Y3Rpb25gIHNsb3Q6CgohW0ltYWdlOiBTY2hlbWF0aWMgYWZ0ZXIgUnVuVU1BUCgpLl0oaW1hZ2VzL3NldXJhdF9zY2hlbWF0aWMvU2xpZGUxMC5wbmcpCgojIFZpc3VhbGl6aW5nIGFuZCBldmFsdWF0aW5nIGNsdXN0ZXJpbmcKCjwhLS0tIEhvdyBtYW55IGNsdXN0ZXJzIHNob3VsZCBJIGdldCBhbmQgaG93IGRvIEkgYWRqdXN0IHRoZSBudW1iZXI/IC0tLT4KCjwhLS0tIEFkZCBleGFtcGxlIG9mIGNoYW5naW5nIHJlc29sdXRpb24/LS0tPgoKQWZ0ZXIgd2UgZ2VuZXJhdGUgdGhlIFVNQVAgcmVkdWN0aW9uLCB3ZSBjYW4gdGhlbiB2aXN1YWxpemUgdGhlIHJlc3VsdHMgdXNpbmcgdGhlIGBEaW1QbG90KClgIFtmdW5jdGlvbl0oaHR0cHM6Ly9zYXRpamFsYWIub3JnL3NldXJhdC9yZWZlcmVuY2UvZGltcGxvdCksIGxhYmVsaW5nIG91ciBwbG90IGJ5IHRoZSBhdXRvIGdlbmVyYXRlZCBgc2V1cmF0X2NsdXN0ZXJzYCB0aGF0IGNvcnJlc3BvbmQgdG8gdGhlIG1vc3QgcmVjZW50IGNsdXN0ZXJpbmcgcmVzdWx0cyBnZW5lcmF0ZWQuCgpBdCB0aGlzIHN0YWdlLCB3ZSB3YW50IHRvIGRldGVybWluZSBpZiB0aGUgY2x1c3RlcnMgbG9vayBmYWlybHkgd2VsbCBzZXBhcmF0ZWQsIGlmIHRoZXkgc2VlbSB0byBjb3JyZXNwb25kIHRvIGhvdyBjZWxscyBhcmUgZ3JvdXBlZCBpbiB0aGUgVU1BUCwgYW5kIGlmIHRoZSBudW1iZXIgb2YgY2x1c3RlcnMgaXMgZ2VuZXJhbGx5IGFsaWduZWQgd2l0aCB0aGUgcmVzb2x1dGlvbiBvZiBvdXIgYmlvbG9naWNhbCBxdWVzdGlvbi4gQWdhaW4sIGlmIHRoZXJlIGFyZSAidG9vIG1hbnkiIGNsdXN0ZXJzIHRoYXQncyBub3QgbmVjZXNzYXJpbHkgYSBwcm9ibGVtLgoKV2UgY2FuIGFsc28gbG9vayBhdCB0aGUgc2FtZSBVTUFQIGxhYmVsZWQgYnkgYGRheWAgdG8gdmlzdWFsbHkgaW5zcGVjdCBpZiB0aGUgVU1BUCBzdHJ1Y3R1cmUgY29ycmVzcG9uZHMgdG8gdGhlIGBkYXlgLgoKYGBge3IsIHVtYXBfYnlfY2x1c3RlcnMsIGZpZy5zaG93PSdob2xkJ30KIyBDb2RlIGJsb2NrIC0gVU1BUCBjbHVzdGVyIHZpc3VhbGl6YXRpb24gCiMgY2x1c3RlciBJRCBsYWJlbHMKcG9zdF9pbnRlZ3JhdGlvbl91bWFwX3Bsb3RfY2x1c3RlcnMgPSBEaW1QbG90KGdlb19zbywgZ3JvdXAuYnkgPSAnc2V1cmF0X2NsdXN0ZXJzJywgbGFiZWwgPSBUUlVFLCByZWR1Y3Rpb24gPSAndW1hcC5pbnRlZ3JhdGVkLnNjdC5ycGNhJykgKyBOb0xlZ2VuZCgpCnBvc3RfaW50ZWdyYXRpb25fdW1hcF9wbG90X2NsdXN0ZXJzCgpnZ3NhdmUoZmlsZW5hbWUgPSAncmVzdWx0cy9maWd1cmVzL3VtYXBfaW50ZWdyYXRlZF9zY3RfY2x1c3RlcnMucG5nJywgcGxvdCA9IHBvc3RfaW50ZWdyYXRpb25fdW1hcF9wbG90X2NsdXN0ZXJzLCB3aWR0aCA9IDYsIGhlaWdodCA9IDYsIHVuaXRzID0gJ2luJykKCiMgY2x1c3RlcnMgd2l0aCBsYWJlbHMsIHNwbGl0IGJ5IGNvbmRpdGlvbgpwb3N0X2ludGVncmF0aW9uX3VtYXBfcGxvdF9zcGxpdF9jbHVzdGVycyA9IERpbVBsb3QoZ2VvX3NvLCBncm91cC5ieSA9ICdzZXVyYXRfY2x1c3RlcnMnLCBzcGxpdC5ieSA9ICdkYXknLCBsYWJlbCA9IFRSVUUsIHJlZHVjdGlvbiA9ICd1bWFwLmludGVncmF0ZWQuc2N0LnJwY2EnKSArIE5vTGVnZW5kKCkKcG9zdF9pbnRlZ3JhdGlvbl91bWFwX3Bsb3Rfc3BsaXRfY2x1c3RlcnMKCmdnc2F2ZShmaWxlbmFtZSA9ICdyZXN1bHRzL2ZpZ3VyZXMvdW1hcF9pbnRlZ3JhdGVkX3NjdF9zcGxpdF9jbHVzdGVycy5wbmcnLCBwbG90ID0gcG9zdF9pbnRlZ3JhdGlvbl91bWFwX3Bsb3RfY2x1c3RlcnMsIHdpZHRoID0gMTQsIGhlaWdodCA9IDYsIHVuaXRzID0gJ2luJykKCiMgVU1BUCB3aXRoIGRheSBsYWJlbHMgKG5vdGUgLSB3ZSBhZGRlZCB0aGlzIGNvbHVtbiB0byB0aGUgbWV0YS1kYXRhIHllc3RlcmRheSkKcG9zdF9pbnRlZ3JhdGlvbl91bWFwX3Bsb3RfZGF5ID0gRGltUGxvdChnZW9fc28sIGdyb3VwLmJ5ID0gJ2RheScsIGxhYmVsID0gRkFMU0UsIHJlZHVjdGlvbiA9ICd1bWFwLmludGVncmF0ZWQuc2N0LnJwY2EnKQpwb3N0X2ludGVncmF0aW9uX3VtYXBfcGxvdF9kYXkKCmdnc2F2ZShmaWxlbmFtZSA9ICdyZXN1bHRzL2ZpZ3VyZXMvdW1hcF9pbnRlZ3JhdGVkX3NjdF9kYXkucG5nJywgcGxvdCA9IHBvc3RfaW50ZWdyYXRpb25fdW1hcF9wbG90X2RheSwgd2lkdGggPSA4LCBoZWlnaHQgPSA2LCB1bml0cyA9ICdpbicpCmBgYAoKU2ltaWxhciB0byB0aGUgUENBIHBsb3RzLCB0aGUgYGRheWAgbGFiZWxlZCBVTUFQIGNhbiB0ZWxsIHVzIGlmIHRlY2huaWNhbCBzb3VyY2VzIG9mIHZhcmlhdGlvbiBtaWdodCBiZSBkcml2aW5nIG9yIHN0cmF0aWZ5aW5nIHRoZSBjbHVzdGVycywgd2hpY2ggd291bGQgc3VnZ2VzdCB0aGF0IHRoZSBub3JtYWxpemF0aW9uIGFuZCBpbnRlZ3JhdGlvbiBzdGVwcyBzaG91bGQgYmUgcmV2aXN0ZWQgYmVmb3JlIHByb2NlZWRpbmcuCgpBbm90aGVyIGFwcHJvYWNoIGlzIHRvIGV2YWx1YXRlIHRoZSBudW1iZXIgb2YgY2VsbHMgcGVyIGNsdXN0ZXIgdXNpbmcgdGhlIGB0YWJsZSgpYCBmdW5jdGlvbiwgc3BsaXQgYnkgYGRheWAgb3Igc3BsaXQgYnkgYG9yaWcuaWRlbnRgIHRvIHNlZSBpZiB0aGUgaW5kaXZpZHVhbCBzYW1wbGVzIGFyZSBkcml2aW5nIGFueSBvZiB0aGUgVU1BUCBzdHJ1Y3R1cmU6CgpgYGB7ciwgdGFibGVfYnlfZGF5fQojIENvZGUgYmxvY2sgLSBjZWxsIGNvdW50IHRhYmxlcwojIGNlbGxzIHBlciBjbHVzdGVyLCBzcGxpdCBieSBjb25kaXRpb24KdGFibGUoZ2VvX3NvQG1ldGEuZGF0YSRkYXksIGdlb19zb0BtZXRhLmRhdGEkaW50ZWdyYXRlZC5zY3QucnBjYS5jbHVzdGVycykKCiMgY2VsbHMgcGVyIGNsdXN0ZXIgcGVyIHNhbXBsZQp0YWJsZShnZW9fc29AbWV0YS5kYXRhJG9yaWcuaWRlbnQsIGdlb19zb0BtZXRhLmRhdGEkaW50ZWdyYXRlZC5zY3QucnBjYS5jbHVzdGVycykKYGBgCgo8IS0tIGNvbnNpZGVyIGFkZGluZyBsYXRlciAKQWRkIERpbVBsb3QgZm9yICUgbWl0b2Nob25kcmlhIHRvIHNlZSBpZiBoaWdoICUgYXJlIGFjcm9zcyBkYXRhc2V0IG9yIGxpbWl0ZWQgdG8gb25lL2ZldyBjbHVzdGVycyAocmVsYXRlZCB0byB3aGF0IE9saXZpYSB0YWxrZWQgYWJvdXQgZHVyaW5nIERheSAxKQoKIyBPdGhlciBhcHByb2FjaGVzIGZvciB2aXN1YWxpemluZyBzY1JOQS1zcSBkYXRhCmUuZy4gY29kZSBmb3IgdFNORSB2aXN1YWxpemF0aW9uIAotLT4KCiMgQ29tcGFyaW5nIHRvIHVuaW50ZWdyYXRlZCBkYXRhCgpJZiB3ZSBoYWQgcHJvY2VlZGVkIHdpdGggb3VyIGZpbHRlcmVkIGRhdGEgYW5kIG9ubHkgbm9ybWFsaXplZCBvdXIgZGF0YSB3aXRob3V0IGRvaW5nIGFueSBpbnRlZ3JhdGlvbiwgaW5jbHVkaW5nIHRocm91Z2ggdGhlIGRpbWVuc2lvbmFsaXR5IHJlZHVjdGlvbiBhbmQgY2x1c3RlcmluZyBzdGVwcyBhbmQgdGhlbiBsYWJlbGVkIHRoZSBjZWxscyB3aXRoIHRoZWlyIHNhbXBsZSBvZiBvcmlnaW4sIHRoZW4gd2Ugd291bGQgc2VlIHRoZSBmb2xsb3dpbmcgZm9yIG91ciBkYXRhOgoKPCEtLUFkZCB1cGRhdGVkIGV4YW1wbGUgb2YgVU1BUCAvIHNhbXBsZSBsYWJlbHMgZm9yIHVuaW50ZWdyYXRlZCBkYXRhIC0gbmVlZCB0byBjaGVjayB3aXRoIFJheW1vbmQgcmVnYXJkaW5nIGhvdyBiZXN0IHRvIGRvIHRoaXMgaW4gcGxhY2UgLS0+IAoKYGBge3IsIHJ1bl91bWFwX3VuaW50ZWdyYXRlZCwgZWNobyA9IEZBTFNFLCBjYWNoZSA9IFRSVUUsIGNhY2hlLmxhenkgPSBGQUxTRSwgd2FybmluZyA9IEZBTFNFLCBtZXNzYWdlID0gRkFMU0UsIG91dC5oZWlnaHQ9JzgwJSd9CiMgQ3JlYXRlIEtOTiBncmFwaCB3aXRoIGBGaW5kTmVpZ2hib3JzKClgIGZvciB1bmludGVncmF0ZWQgZGF0YQpnZW9fc28gPSBGaW5kTmVpZ2hib3JzKGdlb19zbywgZGltcyA9IDE6cGNzLCByZWR1Y3Rpb24gPSAndW5pbnRlZ3JhdGVkLnNjdC5wY2EnKQoKIyBnZW5lcmF0ZSBjbHVzdGVycyBmb3IgdW5pbnRlZ3JhdGVkIGRhdGEKZ2VvX3NvID0gRmluZENsdXN0ZXJzKGdlb19zbywgcmVzb2x1dGlvbiA9IDAuNCwgY2x1c3Rlci5uYW1lID0gJ3VuaW50ZWdyYXRlZC5zY3QucGNhLmNsdXN0ZXJzJykKCmdlb19zbyA9IFJ1blVNQVAoZ2VvX3NvLCBkaW1zID0gMTpwY3MsIHJlZHVjdGlvbiA9ICd1bmludGVncmF0ZWQuc2N0LnBjYScsIHJlZHVjdGlvbi5uYW1lID0gJ3VtYXAudW5pbnRlZ3JhdGVkLnNjdC5wY2EnKQoKcHJlX2ludGVncmF0aW9uX3VtYXBfcGxvdF9kYXkgPSBEaW1QbG90KGdlb19zbywgZ3JvdXAuYnkgPSAnZGF5JywgbGFiZWwgPSBGQUxTRSwgcmVkdWN0aW9uID0gJ3VtYXAudW5pbnRlZ3JhdGVkLnNjdC5wY2EnKQoKcHJpbnQocHJlX2ludGVncmF0aW9uX3VtYXBfcGxvdF9kYXkgKyBwb3N0X2ludGVncmF0aW9uX3VtYXBfcGxvdF9kYXkpCmBgYAoKSW4gdGhlIHBsb3QgYXQgbGVmdCwgd2Ugc2VlIHRoYXQgd2hpbGUgdGhlcmUgYXJlIGRpc3RpbmN0IGNsdXN0ZXJzLCB0aG9zZSBjbHVzdGVycyBzZWVtIHRvIHN0cmF0aWZpZWQgYnkgZGF5LiBUaGlzIHN1Z2dlc3RzIHRoYXQgd2l0aG91dCBpbnRlZ3JhdGlvbiwgdGhlc2UgYmF0Y2ggZWZmZWN0cyBjb3VsZCBza2V3IHRoZSBiaW9sb2dpY2FsIHZhcmlhYmlsaXR5IGluIG91ciBkYXRhLiBXaGlsZSBvbiB0aGUgcmlnaHQsIHdlIHNlZSBsaXR0bGUgc3RyYXRpZmljYXRpb24gd2l0aGluIG91ciBjbHVzdGVycyB3aGljaCBtZWFucyB0aGUgaW50ZWdyYXRpb24gc2VlbXMgdG8gaGF2ZSByZW1vdmVkIHRob3NlIGJhdGNoIGVmZmVjdHMuCgo8IS0tIEVkaXQgc2VjdGlvbiB0byBpbmNvcnBvcmF0ZSAtLS0+Cgo8ZGV0YWlscz4KPHN1bW1hcnk+KipSZXdpbmQ6IFByZS1pbnRlZ3JhdGlvbiBldmFsdWF0aW9uIGNsdXN0ZXJpbmcgYW5kIHZpc3VhbGl6YXRpb24gKGNvZGUpKio8L3N1bW1hcnk+ClByaW9yIHRvIGludGVncmF0aW9uLCB3ZSBjb3VsZCBmb2xsb3cgdGhlIHNhbWUgc3RlcHMgd2UndmUganVzdCBydW4gZm9yIHRoZSBpbnRlZ3JhdGVkIHRvIHNlZSBpZiB0aGUgcmVzdWx0aW5nIGNsdXN0ZXJzIHRlbmQgdG8gYmUgZGV0ZXJtaW5lZCBieSBzYW1wbGUgb3IgY29uZGl0aW9uIChpbiB0aGlzIGNhc2UsIHRoZSBkYXkpOgoKYGBge3IsIGV2YWw9RkFMU0V9Cmdlb19zbyA9IEZpbmROZWlnaGJvcnMoZ2VvX3NvLCBkaW1zID0gMTpwY3MsIGFzc2F5ID0gJ1JOQScsIHJlZHVjdGlvbiA9ICd1bmludGVncmF0ZWQuc2N0LnBjYScsIGdyYXBoLm5hbWUgPSBjKCdSTkFfbm4nLCAnUk5BX3NubicpKQpnZW9fc28gPSBGaW5kQ2x1c3RlcnMoZ2VvX3NvLCByZXNvbHV0aW9uID0gMC40LCBncmFwaC5uYW1lID0gJ1JOQV9zbm4nLCBjbHVzdGVyLm5hbWUgPSAndW5pbnRlZ3JhdGVkLnNjdC5jbHVzdGVycycpCmdlb19zbyA9IFJ1blVNQVAoZ2VvX3NvLCBkaW1zID0gMTpwY3MsIHJlZHVjdGlvbiA9ICd1bmludGVncmF0ZWQuc2N0LnBjYScsIHJlZHVjdGlvbi5uYW1lID0gJ3VtYXAudW5pbnRlZ3JhdGVkLnNjdC5wY2EnKQpgYGAKCQpUaGUgcGxvdHMgYWJvdmUgd2VyZSBnZW5lcmF0ZWQgd2l0aDoKCmBgYHtyLCBldmFsPUZBTFNFfQojIENvZGUgYmxvY2sgLSBzaG93IHVuaW50ZWdyYXRlZApwcmVfaW50ZWdyYXRpb25fdW1hcF9wbG90X29yaWcuaWRlbnQgPSBEaW1QbG90KGdlb19zbywgZ3JvdXAuYnkgPSAnb3JpZy5pZGVudCcsIGxhYmVsID0gRkFMU0UsIHJlZHVjdGlvbiA9ICd1bWFwLnVuaW50ZWdyYXRlZC5zY3QucGNhJykKZ2dzYXZlKGZpbGVuYW1lID0gJ3Jlc3VsdHMvZmlndXJlcy91bWFwX3VuaW50ZWdyYXRlZF9zY3Rfb3JpZy5pZGVudC5wbmcnLCBwbG90ID0gcHJlX2ludGVncmF0aW9uX3VtYXBfcGxvdF9vcmlnLmlkZW50LCB3aWR0aCA9IDgsIGhlaWdodCA9IDYsIHVuaXRzID0gJ2luJykKCnByZV9pbnRlZ3JhdGlvbl91bWFwX3Bsb3RfZGF5ID0gRGltUGxvdChnZW9fc28sIGdyb3VwLmJ5ID0gJ2RheScsIGxhYmVsID0gRkFMU0UsIHJlZHVjdGlvbiA9ICd1bWFwLnVuaW50ZWdyYXRlZC5zY3QucGNhJykKZ2dzYXZlKGZpbGVuYW1lID0gJ3Jlc3VsdHMvZmlndXJlcy91bWFwX3VuaW50ZWdyYXRlZF9zY3RfZGF5LnBuZycsIHBsb3QgPSBwcmVfaW50ZWdyYXRpb25fdW1hcF9wbG90X2RheSwgd2lkdGggPSA4LCBoZWlnaHQgPSA2LCB1bml0cyA9ICdpbicpCmBgYAo8L2RldGFpbHM+Cjxicj4KPGJyPgoKPGRldGFpbHM+CjxzdW1tYXJ5PioqQWx0ZXJuYXRpdmUgY2x1c3RlcmluZyByZXNvbHV0aW9ucyoqPC9zdW1tYXJ5PgpXaGlsZSB3ZSBzaG93IGEgc2luZ2xlIHJlc29sdXRpb24sIHdlIGNhbiBnZW5lcmF0ZSBhbmQgcGxvdCBtdWx0aXBsZSByZXNvbHV0aW9ucyBpdGVyYXRpdmVseSBhbmQgY29tcGFyZSBiZXR3ZWVuIHRoZW0gYmVmb3JlIHNlbGVjdGluZyBhIGNsdXN0ZXJpbmcgcmVzdWx0IGZvciB0aGUgbmV4dCBzdGVwczoKCmBgYHtyLCBldmFsPUZBTFNFfQpyZXNvbHV0aW9ucyA9IGMoMC40LCAwLjgpCgpmb3IocmVzIGluIHJlc29sdXRpb25zKSB7CiAgICBtZXNzYWdlKHJlcykKCiAgICBjbHVzdGVyX2NvbHVtbiA9IHNwcmludGYoJ1NDVF9zbm5fcmVzLiVzJywgcmVzKQogICAgdW1hcF9maWxlID0gc3ByaW50ZigncmVzdWx0cy9maWd1cmVzL3VtYXBfaW50ZWdyYXRlZF9zY3RfJXMucG5nJywgcmVzKQoKICAgIGdlb19zbyA9IEZpbmRDbHVzdGVycyhnZW9fc28sIHJlc29sdXRpb24gPSByZXMpCgogICAgRGltUGxvdChnZW9fc28sIGdyb3VwLmJ5ID0gY2x1c3Rlcl9jb2x1bW4sIGxhYmVsID0gVFJVRSwgcmVkdWN0aW9uID0gJ3VtYXAuaW50ZWdyYXRlZC5zY3QucnBjYScpICsgTm9MZWdlbmQoKQogICAgZ2dzYXZlKGZpbGVuYW1lID0gdW1hcF9maWxlLCB3aWR0aCA9IDgsIGhlaWdodCA9IDcsIHVuaXRzID0gJ2luJykKfQpgYGAKCkluIHRoZSByZXN1bHRzLCB3ZSdsbCBzZWUgbXVsdGlwbGUgcmVzb2x1dGlvbnMgc2hvdWxkIG5vdyBiZSBhZGRlZCB0byB0aGUgbWV0YWRhdGEgc2xvdC4KCmBgYHtyLCBldmFsPUZBTFNFfQpoZWFkKGdlb19zb0BtZXRhLmRhdGEpCmBgYAo8L2RldGFpbHM+Cjxicj4KPGJyPgoKIyBTYXZlIG91ciBwcm9ncmVzcwoKQmVmb3JlIG1vdmluZyBvbiB0byBvdXIgbmV4dCBzZWN0aW9uLCB3ZSB3aWxsIG91dHB1dCBvdXIgdXBkYXRlZCBTZXVyYXQgb2JqZWN0IHRvIGZpbGU6CgpgYGB7ciwgc2F2ZV9yZHNfaGlkZGVuLCBlY2hvID0gRkFMU0V9CmlmKCFmaWxlLmV4aXN0cygncmVzdWx0cy9yZGF0YS9nZW9fc29fc2N0X2NsdXN0ZXJlZC5yZHMnKSkgewogIHNhdmVSRFMoZ2VvX3NvLCBmaWxlID0gJ3Jlc3VsdHMvcmRhdGEvZ2VvX3NvX3NjdF9jbHVzdGVyZWQucmRzJykKfQpgYGAKCmBgYHtyLCBldmFsPUZBTFNFfQpzYXZlUkRTKGdlb19zbywgZmlsZSA9ICdyZXN1bHRzL3JkYXRhL2dlb19zb19zY3RfY2x1c3RlcmVkLnJkcycpCmBgYAoKIyBTdW1tYXJ5CgpJbiB0aGlzIHNlY3Rpb24gd2U6CgotIEdlbmVyYXRlZCBjbHVzdGVyIGFzc2lnbm1lbnRzIGZvciBvdXIgY2VsbHMgdXNpbmcgYEZpbmROZWlnaGJvcnMoKWAgYW5kIGBGaW5kQ2x1c3RlcnMoKWAKLSBFdmFsdWF0ZWQgb3VyIGluaXRpYWwgY2x1c3RlcnMgdXNpbmcgYFJ1blVNQVBgIGRpbWVuc2lvbmFsIHJlZHVjdGlvbiBhbmQgdmlzdWFsaXphdGlvbgoKTmV4dCBzdGVwczogTWFya2VyIGdlbmVzCgotLS0tCgpUaGVzZSBtYXRlcmlhbHMgaGF2ZSBiZWVuIGFkYXB0ZWQgYW5kIGV4dGVuZGVkIGZyb20gbWF0ZXJpYWxzIGxpc3RlZCBhYm92ZS4gVGhlc2UgYXJlIG9wZW4gYWNjZXNzIG1hdGVyaWFscyBkaXN0cmlidXRlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIFtDcmVhdGl2ZSBDb21tb25zIEF0dHJpYnV0aW9uIGxpY2Vuc2UgKENDIEJZIDQuMCldKGh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LzQuMC8pLCB3aGljaCBwZXJtaXRzIHVucmVzdHJpY3RlZCB1c2UsIGRpc3RyaWJ1dGlvbiwgYW5kIHJlcHJvZHVjdGlvbiBpbiBhbnkgbWVkaXVtLCBwcm92aWRlZCB0aGUgb3JpZ2luYWwgYXV0aG9yIGFuZCBzb3VyY2UgYXJlIGNyZWRpdGVkLgoKPGJyLz4KPGJyLz4KPGhyLz4KfCBbUHJldmlvdXMgbGVzc29uXSgwNC1QQ0FhbmRJbnRlZ3JhdGlvbi5odG1sKSB8IFtUb3Agb2YgdGhpcyBsZXNzb25dKCN0b3ApIHwgW05leHQgbGVzc29uXSgwNi1NYXJrZXJWaXN1YWxpemF0aW9uLmh0bWwpIHwKfCA6LS0tIHwgOi0tLS06IHwgLS0tOiB8Cg==</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("05-ProjectionAndClustering.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
