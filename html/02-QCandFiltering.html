<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="UM Bioinformatics Core" />

<meta name="date" content="2024-02-19" />

<title>Initial Quality Control</title>

<script src="site_libs/header-attrs-2.21/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<!--
Favicon dervied from
https://twemoji.twitter.com/
https://favicon.io/emoji-favicons/dna/
-->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="shortcut icon" href="favicon-16x16.png" />
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Intro to scRNA-Seq</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="workshop_intro.html">Intro</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 1
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="00A-OrientingOnScRNASeq.html">Orienting on scRNA-Seq</a>
    </li>
    <li>
      <a href="00B-CellRangerInAction.html">Cell Ranger in Action</a>
    </li>
    <li>
      <a href="01-GettingStarted.html">Seurat</a>
    </li>
    <li>
      <a href="02-QCandFiltering.html">Secondary QC &amp; Filtering</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 2
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="03-Integration.html">Normalization</a>
    </li>
    <li>
      <a href="04-PCAandDimReduction.html">PCA &amp; Integration</a>
    </li>
    <li>
      <a href="05-ProjectionAndClustering.html">Projection &amp; Clustering</a>
    </li>
    <li>
      <a href="06-MarkerVisualization.html">Marker identification and visualization</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 3
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="07-CellTypeAnnos.html">Cell type annotation</a>
    </li>
    <li>
      <a href="08-DifferentialExpression.html">Differential expression analysis</a>
    </li>
    <li>
      <a href="09-IndependentExercise.html">Independent exercise</a>
    </li>
  </ul>
</li>
<li>
  <a href="workshop_wrap_up.html">Wrap up</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Initial Quality Control</h1>
<h4 class="author">UM Bioinformatics Core</h4>
<h4 class="date">2024-02-19</h4>

</div>


<style type="text/css">
body, td {
   font-size: 18px;
}
code.r{
  font-size: 12px;
}
pre {
  font-size: 12px
}
</style>
<div id="workflow-overview" class="section level1 unlisted unnumbered">
<h1 class="unlisted unnumbered">Workflow Overview</h1>
<p><br/>
<img src="images/wayfinder/wayfinder.png" alt="wayfinder" style="height: 400px;"/>
<br/> <br/></p>
</div>
<div id="objectives" class="section level1">
<h1>Objectives</h1>
<ul>
<li>Discuss QC measures and learn how to calculate and plot them.</li>
<li>Discuss cell-filtering approaches and apply them to our
dataset.</li>
</ul>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>As discussed at the start of the workshop, single-cell experiments
using 10x Chromium instrument aim to have droplets with one cell plus
one bead. However this is an inherently imperfect process and there are
other important considerations like how healthy or intact the cell was
at the time of measurement.</p>
<p>In this section, our goal is to use filtering thresholds to remove
“cells” that were poorly measured or either not cells at all or included
more than one cell.</p>
<p>Similar to many other areas of research, there are often gaps between
how single-cell data is presented versus the reality of running an
analysis. For example, only the final filtering thresholds might be
reported in a paper but our process for choosing those is likely to be
more iterative and include some trial and error.</p>
<!-- Challenge for instructors: Every vignette uses different filters, how to harmonize/give guidance? Related, how much to discuss arbitrary cutoffs and continued maturation of field?-->
<!-- Add links to relevant resources throughout -->
<!-- General guidance - likely to be moved to earlier section:
- Note with each function call what gets added to the Seurat object.
- Adding checks to ensure object is updated by learners since want to avoid generating copied objects
- Note what layers should be used for what, for example, counts used for FeaturePlots. RNA vs SCT assay. -->
</div>
<div id="quality-metrics" class="section level1">
<h1>Quality Metrics</h1>
<p>Cell Ranger is a first-pass filter to determine what is a “cell” and
what is not. Let’s dig deeper to determine when a droplet might contain
two cells, a very stressed cell, or some technical issue in the library
preparation. We will use some common metrics to determine low-quality
cells based on their expression profiles (<a
href="https://bioconductor.org/books/3.12/OSCA/quality-control.html#choice-of-qc-metrics">reference</a>).</p>
<ul>
<li>The total number of UMIs detected. Cells with a small number of UMIs
detected may indicate loss of RNA during library preparation via cell
lysis or inefficient cDNA capture / amplification. Cells with relatively
high number of UMIs detected may indicate a doublet.</li>
<li>The number of expressed features, defined as number of genes with
non-zero counts. Cells with very few measured genes are likely to be of
low-quality, and may distort downstream variance estimation or dimension
reduction steps.</li>
<li>The proportion of reads mapped to the mitochondrial genome. High
proportions of mitochondrial transcripts may indicate a damaged cell,
the measure of which may also distort downstream analysis steps.</li>
</ul>
<p>The number of UMIs detected (<code>nCount</code>) and number of
expressed features (<code>nFeature</code>) are already given in the meta
data table.</p>
<pre class="r"><code>head(geo_so@meta.data)</code></pre>
<pre><code>                                          orig.ident nCount_RNA nFeature_RNA
HODay0replicate1_AAACCTGAGAGAACAG-1 HODay0replicate1       9258         2709
HODay0replicate1_AAACCTGAGGAGTACC-1 HODay0replicate1         99           76
HODay0replicate1_AAACCTGAGGATCGCA-1 HODay0replicate1         71           55
HODay0replicate1_AAACCTGAGGCATTGG-1 HODay0replicate1         63           53
HODay0replicate1_AAACCTGCAACAACCT-1 HODay0replicate1         70           54
HODay0replicate1_AAACCTGCACCACCAG-1 HODay0replicate1        131          104</code></pre>
<p>We can add arbitrary per-cell information to this table such as:</p>
<ul>
<li>Summary statistics, such as percent mitochondrial reads for each
cell</li>
<li>Batch, condition, etc. for each cell</li>
<li>Cluster membership for each cell</li>
<li>Cell cycle phase for each cell</li>
<li>Other custom annotations for each cell</li>
</ul>
<p>In this workshop we will see examples of the first three, beginning
with percent mitochondrial reads.</p>
<blockquote>
<h4 id="why-total-umis-instead-of-total-reads"
class="unlisted unnumbered">Why total UMIs instead of total reads?</h4>
<p>Since a single-cell inherently contains a limited amount of RNA
molecules, a higher amount of PCR amplification is required to generate
the final sequencing library.</p>
<p>Since PCR can skew proportions of initial input materials, specific
sequences are included in the initial capture probes called unique
molecule identifiers (UMIs). As each initial probe has a different UMI
sequence, each RNA captured will be tagged with a different UMI, which
allows those initial RNAs and subsequent PCR duplicates to be identified
and duplicates collapsed as part of the initial processing by
CellRanger.</p>
</blockquote>
<blockquote>
<h4 id="other-meanings-of-nfeatures" class="unlisted unnumbered">Other
meanings of <code>nFeatures</code></h4>
<p>For other single-cell data types, <code>nFeatures</code> would
represent what’s being measured in that experiment. For single-cell
ATAC-seq, <code>nFeatures</code> would represents the total number of
peaks (e.g. accessible areas of DNA) per cell.</p>
</blockquote>
<div id="percent-mitochondrial-reads" class="section level2">
<h2>Percent mitochondrial reads</h2>
<p>The <code>PercentageFeatureSet()</code> function enables us to
quickly determine the counts belonging to a subset of the possible
features for each cell. Since mitochondrial transcripts in mouse begin
with “mt”, we will use that pattern to count the percentage of reads
coming from mitochondrial transcripts.</p>
<pre class="r"><code># We use &quot;mt&quot; because this is mouse, depending on the organism, this might need to be changed
geo_so@meta.data$percent.mt = PercentageFeatureSet(geo_so, pattern = &#39;^mt-&#39;)

# Alternate way to add this column
geo_so$percent.mt = PercentageFeatureSet(geo_so, pattern = &#39;^mt-&#39;)

# Alternate way to add this column
geo_so[[&#39;percent.mt&#39;]] = PercentageFeatureSet(geo_so, pattern = &#39;^mt-&#39;)

# Use summary() to quickly check the range of values
summary(geo_so$percent.mt)</code></pre>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  0.000   2.582   3.860  13.752  22.951  97.461 </code></pre>
<p>Just looking at the summary, we can see that there are some cells
with a high percentage of mitochondrial reads.</p>
<!-- Matt may have discussed UMIs as part of CellRanger processing and Liv/Tricia may touch on as part of library generation at end of Day 2 -->
</div>
</div>
<div id="identifying-low-quality-cells" class="section level1">
<h1>Identifying low-quality cells</h1>
<p>To identify low-quality cells, it’s helpful to visualize the QC
metrics across all cells and samples to understand the the
distributions. Let’s plot <code>nFeature_RNA</code>,
<code>nCount_RNA</code>, and <code>percent.mt</code>.</p>
<div id="visualizing-qc-metrics" class="section level2">
<h2>Visualizing QC metrics</h2>
<p>A violin plot can help show the distributions of a quantity across
multiple samples. Seurat has a built-in function, <code>VlnPlot()</code>
to quickly generate the plots we seek. As we make our plots, we’ll save
them to a file so we have them handy outside of R, perhaps to include in
a report or to share with collaborators. Let’s begin with the
<code>nFeature_RNA</code> violin plot.</p>
<pre class="r"><code>VlnPlot(geo_so, features = &#39;nFeature_RNA&#39;, assay = &#39;RNA&#39;, layer = &#39;counts&#39;) + NoLegend()
ggsave(filename = &#39;ISC_R/results/figures/qc_nFeature_violin.png&#39;, width = 12, height = 6, units = &#39;in&#39;)</code></pre>
<p><img src="images/curriculum/qc_nFeature_violin.png" /></p>
<p>We already note that the Day0 samples appear to have systematically
lower features detected per cell, with sample HODay0repoilcate1
appearing to have much lower features per cell. Let’s continue with the
<code>nCount_RNA</code> plot.</p>
<pre class="r"><code>VlnPlot(geo_so, features = &#39;nCount_RNA&#39;, assay = &#39;RNA&#39;, layer = &#39;counts&#39;) + NoLegend()
ggsave(filename = &#39;ISC_R/results/figures/qc_nCount_violin.png&#39;, width = 12, height = 6, units = &#39;in&#39;)</code></pre>
<p><img src="images/curriculum/qc_nCount_violin.png" /></p>
<p>We obesrve a similar pattern, where the Day0 samples appear to have
lower counts per cell than their Day7 and Day21 counterparts. There is
even an outlier cell in HODay0replicate1, with over 90K unique UMIs
detected. This cell is very likely a doublet. Finally, lets plot the
<code>percent.mt</code>.</p>
<pre class="r"><code>VlnPlot(geo_so, features = &#39;percent.mt&#39;, assay = &#39;RNA&#39;, layer = &#39;counts&#39;) + NoLegend()
ggsave(filename = &#39;ISC_R/results/figures/qc_mito_violin.png&#39;, width = 12, height = 6, units = &#39;in&#39;)</code></pre>
<p><img src="images/curriculum/qc_mito_violin.png" /></p>
<p>Immediately, HODay0replicate1 appears to have many cells with a high
percentage of mitochondrial reads. We observe that the other samples
appear to have a few cells with high percentage of mitochondrial reads,
but overall most cells tend to have &lt;10% mitochondrial reads. This is
a good sign.</p>
<p>Generally, many tutorials use a cutoff of 5-10% mitochondrial.
However, for some experiments high mitochondrial reads would be expected
(such as in cases where the condition/treatment or genotype increases
cell death), then a relaxed threshold would be necessary to preserve
biologically relevant cells.</p>
</div>
<div id="cell-counts" class="section level2">
<h2>Cell counts</h2>
<p>It’s a good idea to record how many cells we started with in our
experiment, and how many cells we have after filtering. So before we
discuss filtering further, let’s record the number of cells per
sample.</p>
<pre class="r"><code>cell_counts_pre_tbl = geo_so@meta.data %&gt;% count(orig.ident, name = &#39;prefilter_cells&#39;)
cell_counts_pre_tbl</code></pre>
<pre><code>          orig.ident prefilter_cells
1   HODay0replicate1           12666
2   HODay0replicate2             614
3   HODay0replicate3            1191
4   HODay0replicate4             949
5  HODay21replicate1            1607
6  HODay21replicate2             932
7  HODay21replicate3             967
8  HODay21replicate4            1986
9   HODay7replicate1            3405
10  HODay7replicate2            3694
11  HODay7replicate3            3786
12  HODay7replicate4            2964</code></pre>
<p>It appears that Cell Ranger called many more cells in
HODay0replicate1 than the other samples. Based on the QC visualization,
probably erroneously so.</p>
<!-- Otherwise comment on cell numbers? -->
</div>
<div id="using-fixed-thresholds" class="section level2">
<h2>Using fixed thresholds</h2>
<p>After looking at the plots of <code>nFeature_RNA</code>,
<code>nCount_RNA</code>, and <code>percent.mt</code>, we could decide to
consider cells with &lt;500 genes per cell, and &gt;25% mitochondrial
reads as low-quality, and filter the cells using the
<code>subset()</code> function. <a
href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7002453/">Sorkin et
al.</a> chose these thresholds:</p>
<blockquote>
<p>We filtered out cells with less than 500 genes per cell and with more
than 25% mitochondrial read content.</p>
</blockquote>
<p>We could preview what the resulting cell counts would be with these
thresholds:</p>
<pre class="r"><code>subset(geo_so, subset = nFeature_RNA &gt; 500 &amp; percent.mt &lt; 25)@meta.data %&gt;% 
    count(orig.ident, name = &#39;postfilter_cells&#39;)</code></pre>
<pre><code>          orig.ident postfilter_cells
1   HODay0replicate1             1003
2   HODay0replicate2              571
3   HODay0replicate3             1111
4   HODay0replicate4              876
5  HODay21replicate1             1537
6  HODay21replicate2              907
7  HODay21replicate3              945
8  HODay21replicate4             1956
9   HODay7replicate1             3265
10  HODay7replicate2             3578
11  HODay7replicate3             3668
12  HODay7replicate4             2903</code></pre>
<p>This removes a sizeable number of cells from HODay0replicate1, and
brings that sample into line with the other samples.</p>
</div>
<div id="using-adaptive-thresholds" class="section level2">
<h2>Using adaptive thresholds</h2>
<p>We could choose to remove outlier cells adaptively. This approach
assumes that most of the cells are of acceptable quality. Note, we’ve
already seen that many of the cells in HODay0replicate1 appear to be of
poor quality, and many of the Day0 cells have much lower
<code>nCount</code>s and <code>nFeature</code>s than their Day7 and
Day21 counterparts. For thus workshop we will use the above fixed
thresholds to match the publication.</p>
<!-- Resources for adaptive outlier detection https://bioconductor.org/books/3.12/OSCA/quality-control.html#identifying-low-quality-cells -->
</div>
</div>
<div id="removing-low-quality-cells" class="section level1">
<h1>Removing low-quality cells</h1>
<p>Let’s remove the cells with <code>nFeature_RNA &lt;= 500</code> and
<code>percent.mt &gt;= 25</code>.</p>
<pre class="r"><code>geo_so = subset(geo_so, subset = nFeature_RNA &gt; 500 &amp; percent.mt &lt; 25)</code></pre>
<p>Note that the <code>subset()</code> command uses an expression in
terms of the cells we <strong>want to keep</strong>. Now we’ll take a
look at the cells per sample post-filtering:</p>
<pre class="r"><code>cell_counts_post_tbl = geo_so@meta.data %&gt;% count(orig.ident, name = &#39;postfilter_cells&#39;)
cell_counts_post_tbl</code></pre>
<pre><code>          orig.ident postfilter_cells
1   HODay0replicate1             1003
2   HODay0replicate2              571
3   HODay0replicate3             1111
4   HODay0replicate4              876
5  HODay21replicate1             1537
6  HODay21replicate2              907
7  HODay21replicate3              945
8  HODay21replicate4             1956
9   HODay7replicate1             3265
10  HODay7replicate2             3578
11  HODay7replicate3             3668
12  HODay7replicate4             2903</code></pre>
<p>Looking at the total number of cells per sample is helpful to
understand both how the called “cells” compare to what was expected for
the experiment. It also allows us to determine the impact of our
filtering thresholds. Let’s combine the pre and post tables:</p>
<pre class="r"><code>cell_counts_tbl = cell_counts_pre_tbl %&gt;% left_join(cell_counts_post_tbl, by = &#39;orig.ident&#39;)
cell_counts_tbl</code></pre>
<pre><code>          orig.ident prefilter_cells postfilter_cells
1   HODay0replicate1           12666             1003
2   HODay0replicate2             614              571
3   HODay0replicate3            1191             1111
4   HODay0replicate4             949              876
5  HODay21replicate1            1607             1537
6  HODay21replicate2             932              907
7  HODay21replicate3             967              945
8  HODay21replicate4            1986             1956
9   HODay7replicate1            3405             3265
10  HODay7replicate2            3694             3578
11  HODay7replicate3            3786             3668
12  HODay7replicate4            2964             2903</code></pre>
<p>Let’s also write this table to a file.</p>
<pre class="r"><code>write_csv(cell_counts_tbl, file = &#39;ISC_R/results/tables/cell_filtering_counts.csv&#39;)</code></pre>
<!--What thresholds would we start with based on the plots alone? How does that compare to the thresholds reported in paper?-->
<!--Other “advanced” methods: out of scope for this workshop but there are packages  specifically developed to detect "doublets", e.g. droplets that contained more than one cell, such as DoubleFinder-->
<!--Additional aside - For single-nuclei experiments removing background/ambient RNA with CellBlender OR DecontX is an important additional step since nuclei are both sticky and porous-->
</div>
<div id="adding-phenotype-data" class="section level1">
<h1>Adding phenotype data</h1>
<p>The <code>orig.ident</code> column of the <code>meta.data</code>
table includes both replicate and day information. We’d like to use this
column to create new columns for day and replicate. Both of which will
come in handy later.</p>
<pre class="r"><code># Add .s separating the information in orig.ident
# NOTE, this relies on a uniform naming scheme!
geo_so$orig.ident = gsub(&#39;HO&#39;, &#39;HO.&#39;, geo_so$orig.ident)
geo_so$orig.ident = gsub(&#39;rep&#39;, &#39;.rep&#39;, geo_so$orig.ident)

# Add day information
geo_so$day = str_split(geo_so$orig.ident, pattern = &#39;[.]&#39;, simplify = TRUE)[,2]

# Add replicate column
geo_so$replicate = str_split(geo_so$orig.ident, pattern = &#39;[.]&#39;, simplify = TRUE)[,3]</code></pre>
</div>
<div id="summary" class="section level1">
<h1>Summary</h1>
<p>In this section we:</p>
<ul>
<li>Discussed quality metrics <code>nFeature</code>s,
<code>nCount</code>s, and <code>percent.mt</code>.</li>
<li>Visualized these metrics across cells / samples to help identify
low-quality cells.</li>
<li>Filtered low-quality cells using fixed thresholds.</li>
</ul>
<p>Next steps: dimensionality reduction using PCA</p>
<hr />
<p>These materials have been adapted and extended from materials listed
above. These are open access materials distributed under the terms of
the <a href="http://creativecommons.org/licenses/by/4.0/">Creative
Commons Attribution license (CC BY 4.0)</a>, which permits unrestricted
use, distribution, and reproduction in any medium, provided the original
author and source are credited.</p>
<br/> <br/>
<hr/>
<table style="width:100%;">
<colgroup>
<col width="28%" />
<col width="42%" />
<col width="28%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><a href="01-GettingStarted.html">Previous
lesson</a></th>
<th align="center"><a href="#top">Top of this lesson</a></th>
<th align="right"><a href="03-Integration.html">Next lesson</a></th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiSW5pdGlhbCBRdWFsaXR5IENvbnRyb2wiCmF1dGhvcjogIlVNIEJpb2luZm9ybWF0aWNzIENvcmUiCmRhdGU6ICJgciBTeXMuRGF0ZSgpYCIKb3V0cHV0OgogICAgICAgIGh0bWxfZG9jdW1lbnQ6CiAgICAgICAgICAgIGluY2x1ZGVzOgogICAgICAgICAgICAgICAgaW5faGVhZGVyOiBoZWFkZXIuaHRtbAogICAgICAgICAgICB0aGVtZTogcGFwZXIKICAgICAgICAgICAgdG9jOiB0cnVlCiAgICAgICAgICAgIHRvY19kZXB0aDogNAogICAgICAgICAgICB0b2NfZmxvYXQ6IHRydWUKICAgICAgICAgICAgbnVtYmVyX3NlY3Rpb25zOiBmYWxzZQogICAgICAgICAgICBmaWdfY2FwdGlvbjogdHJ1ZQogICAgICAgICAgICBtYXJrZG93bjogR0ZNCiAgICAgICAgICAgIGNvZGVfZG93bmxvYWQ6IHRydWUKLS0tCgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgpib2R5LCB0ZCB7CiAgIGZvbnQtc2l6ZTogMThweDsKfQpjb2RlLnJ7CiAgZm9udC1zaXplOiAxMnB4Owp9CnByZSB7CiAgZm9udC1zaXplOiAxMnB4Cn0KPC9zdHlsZT4KCmBgYHtyLCBpbmNsdWRlID0gRkFMU0V9CnNvdXJjZSgiLi4vYmluL2NodW5rLW9wdGlvbnMuUiIpCmtuaXRyX2ZpZ19wYXRoKCJYWCIpCmBgYAoKIyBXb3JrZmxvdyBPdmVydmlldyB7LnVubGlzdGVkIC51bm51bWJlcmVkfQoKPGJyLz4KPGltZyBzcmM9ImltYWdlcy93YXlmaW5kZXIvd2F5ZmluZGVyLnBuZyIgYWx0PSJ3YXlmaW5kZXIiIHN0eWxlPSJoZWlnaHQ6IDQwMHB4OyIvPgo8YnIvPgo8YnIvPgoKIyBPYmplY3RpdmVzCgotIERpc2N1c3MgUUMgbWVhc3VyZXMgYW5kIGxlYXJuIGhvdyB0byBjYWxjdWxhdGUgYW5kIHBsb3QgdGhlbS4KLSBEaXNjdXNzIGNlbGwtZmlsdGVyaW5nIGFwcHJvYWNoZXMgYW5kIGFwcGx5IHRoZW0gdG8gb3VyIGRhdGFzZXQuCgojIEludHJvZHVjdGlvbgoKQXMgZGlzY3Vzc2VkIGF0IHRoZSBzdGFydCBvZiB0aGUgd29ya3Nob3AsIHNpbmdsZS1jZWxsIGV4cGVyaW1lbnRzIHVzaW5nIDEweCBDaHJvbWl1bSBpbnN0cnVtZW50IGFpbSB0byBoYXZlIGRyb3BsZXRzIHdpdGggb25lIGNlbGwgcGx1cyBvbmUgYmVhZC4gSG93ZXZlciB0aGlzIGlzIGFuIGluaGVyZW50bHkgaW1wZXJmZWN0IHByb2Nlc3MgYW5kIHRoZXJlIGFyZSBvdGhlciBpbXBvcnRhbnQgY29uc2lkZXJhdGlvbnMgbGlrZSBob3cgaGVhbHRoeSBvciBpbnRhY3QgdGhlIGNlbGwgd2FzIGF0IHRoZSB0aW1lIG9mIG1lYXN1cmVtZW50LgoKSW4gdGhpcyBzZWN0aW9uLCBvdXIgZ29hbCBpcyB0byB1c2UgZmlsdGVyaW5nIHRocmVzaG9sZHMgdG8gcmVtb3ZlICJjZWxscyIgdGhhdCB3ZXJlIHBvb3JseSBtZWFzdXJlZCBvciBlaXRoZXIgbm90IGNlbGxzIGF0IGFsbCBvciBpbmNsdWRlZCBtb3JlIHRoYW4gb25lIGNlbGwuIAoKU2ltaWxhciB0byBtYW55IG90aGVyIGFyZWFzIG9mIHJlc2VhcmNoLCB0aGVyZSBhcmUgb2Z0ZW4gZ2FwcyBiZXR3ZWVuIGhvdyBzaW5nbGUtY2VsbCBkYXRhIGlzIHByZXNlbnRlZCB2ZXJzdXMgdGhlIHJlYWxpdHkgb2YgcnVubmluZyBhbiBhbmFseXNpcy4gRm9yIGV4YW1wbGUsIG9ubHkgdGhlIGZpbmFsIGZpbHRlcmluZyB0aHJlc2hvbGRzIG1pZ2h0IGJlIHJlcG9ydGVkIGluIGEgcGFwZXIgYnV0IG91ciBwcm9jZXNzIGZvciBjaG9vc2luZyB0aG9zZSBpcyBsaWtlbHkgdG8gYmUgbW9yZSBpdGVyYXRpdmUgYW5kIGluY2x1ZGUgc29tZSB0cmlhbCBhbmQgZXJyb3IuCgo8IS0tIENoYWxsZW5nZSBmb3IgaW5zdHJ1Y3RvcnM6IEV2ZXJ5IHZpZ25ldHRlIHVzZXMgZGlmZmVyZW50IGZpbHRlcnMsIGhvdyB0byBoYXJtb25pemUvZ2l2ZSBndWlkYW5jZT8gUmVsYXRlZCwgaG93IG11Y2ggdG8gZGlzY3VzcyBhcmJpdHJhcnkgY3V0b2ZmcyBhbmQgY29udGludWVkIG1hdHVyYXRpb24gb2YgZmllbGQ/LS0+IAo8IS0tIEFkZCBsaW5rcyB0byByZWxldmFudCByZXNvdXJjZXMgdGhyb3VnaG91dCAtLT4gCgo8IS0tIEdlbmVyYWwgZ3VpZGFuY2UgLSBsaWtlbHkgdG8gYmUgbW92ZWQgdG8gZWFybGllciBzZWN0aW9uOgotIE5vdGUgd2l0aCBlYWNoIGZ1bmN0aW9uIGNhbGwgd2hhdCBnZXRzIGFkZGVkIHRvIHRoZSBTZXVyYXQgb2JqZWN0LgotIEFkZGluZyBjaGVja3MgdG8gZW5zdXJlIG9iamVjdCBpcyB1cGRhdGVkIGJ5IGxlYXJuZXJzIHNpbmNlIHdhbnQgdG8gYXZvaWQgZ2VuZXJhdGluZyBjb3BpZWQgb2JqZWN0cwotIE5vdGUgd2hhdCBsYXllcnMgc2hvdWxkIGJlIHVzZWQgZm9yIHdoYXQsIGZvciBleGFtcGxlLCBjb3VudHMgdXNlZCBmb3IgRmVhdHVyZVBsb3RzLiBSTkEgdnMgU0NUIGFzc2F5LiAtLT4KCiMgUXVhbGl0eSBNZXRyaWNzCgpDZWxsIFJhbmdlciBpcyBhIGZpcnN0LXBhc3MgZmlsdGVyIHRvIGRldGVybWluZSB3aGF0IGlzIGEgImNlbGwiIGFuZCB3aGF0IGlzIG5vdC4gTGV0J3MgZGlnIGRlZXBlciB0byBkZXRlcm1pbmUgd2hlbiBhIGRyb3BsZXQgbWlnaHQgY29udGFpbiB0d28gY2VsbHMsIGEgdmVyeSBzdHJlc3NlZCBjZWxsLCBvciBzb21lIHRlY2huaWNhbCBpc3N1ZSBpbiB0aGUgbGlicmFyeSBwcmVwYXJhdGlvbi4gV2Ugd2lsbCB1c2Ugc29tZSBjb21tb24gbWV0cmljcyB0byBkZXRlcm1pbmUgbG93LXF1YWxpdHkgY2VsbHMgYmFzZWQgb24gdGhlaXIgZXhwcmVzc2lvbiBwcm9maWxlcyAoW3JlZmVyZW5jZV0oaHR0cHM6Ly9iaW9jb25kdWN0b3Iub3JnL2Jvb2tzLzMuMTIvT1NDQS9xdWFsaXR5LWNvbnRyb2wuaHRtbCNjaG9pY2Utb2YtcWMtbWV0cmljcykpLgoKLSBUaGUgdG90YWwgbnVtYmVyIG9mIFVNSXMgZGV0ZWN0ZWQuIENlbGxzIHdpdGggYSBzbWFsbCBudW1iZXIgb2YgVU1JcyBkZXRlY3RlZCBtYXkgaW5kaWNhdGUgbG9zcyBvZiBSTkEgZHVyaW5nIGxpYnJhcnkgcHJlcGFyYXRpb24gdmlhIGNlbGwgbHlzaXMgb3IgaW5lZmZpY2llbnQgY0ROQSBjYXB0dXJlIC8gYW1wbGlmaWNhdGlvbi4gQ2VsbHMgd2l0aCByZWxhdGl2ZWx5IGhpZ2ggbnVtYmVyIG9mIFVNSXMgZGV0ZWN0ZWQgbWF5IGluZGljYXRlIGEgZG91YmxldC4KLSBUaGUgbnVtYmVyIG9mIGV4cHJlc3NlZCBmZWF0dXJlcywgZGVmaW5lZCBhcyBudW1iZXIgb2YgZ2VuZXMgd2l0aCBub24temVybyBjb3VudHMuIENlbGxzIHdpdGggdmVyeSBmZXcgbWVhc3VyZWQgZ2VuZXMgYXJlIGxpa2VseSB0byBiZSBvZiBsb3ctcXVhbGl0eSwgYW5kIG1heSBkaXN0b3J0IGRvd25zdHJlYW0gdmFyaWFuY2UgZXN0aW1hdGlvbiBvciBkaW1lbnNpb24gcmVkdWN0aW9uIHN0ZXBzLgotIFRoZSBwcm9wb3J0aW9uIG9mIHJlYWRzIG1hcHBlZCB0byB0aGUgbWl0b2Nob25kcmlhbCBnZW5vbWUuIEhpZ2ggcHJvcG9ydGlvbnMgb2YgbWl0b2Nob25kcmlhbCB0cmFuc2NyaXB0cyBtYXkgaW5kaWNhdGUgYSBkYW1hZ2VkIGNlbGwsIHRoZSBtZWFzdXJlIG9mIHdoaWNoIG1heSBhbHNvIGRpc3RvcnQgZG93bnN0cmVhbSBhbmFseXNpcyBzdGVwcy4KClRoZSBudW1iZXIgb2YgVU1JcyBkZXRlY3RlZCAoYG5Db3VudGApIGFuZCBudW1iZXIgb2YgZXhwcmVzc2VkIGZlYXR1cmVzIChgbkZlYXR1cmVgKSBhcmUgYWxyZWFkeSBnaXZlbiBpbiB0aGUgbWV0YSBkYXRhIHRhYmxlLgoKYGBge3IsIGV2YWwgPSBGQUxTRX0KaGVhZChnZW9fc29AbWV0YS5kYXRhKQpgYGAKCn5+fgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnLmlkZW50IG5Db3VudF9STkEgbkZlYXR1cmVfUk5BCkhPRGF5MHJlcGxpY2F0ZTFfQUFBQ0NUR0FHQUdBQUNBRy0xIEhPRGF5MHJlcGxpY2F0ZTEgICAgICAgOTI1OCAgICAgICAgIDI3MDkKSE9EYXkwcmVwbGljYXRlMV9BQUFDQ1RHQUdHQUdUQUNDLTEgSE9EYXkwcmVwbGljYXRlMSAgICAgICAgIDk5ICAgICAgICAgICA3NgpIT0RheTByZXBsaWNhdGUxX0FBQUNDVEdBR0dBVENHQ0EtMSBIT0RheTByZXBsaWNhdGUxICAgICAgICAgNzEgICAgICAgICAgIDU1CkhPRGF5MHJlcGxpY2F0ZTFfQUFBQ0NUR0FHR0NBVFRHRy0xIEhPRGF5MHJlcGxpY2F0ZTEgICAgICAgICA2MyAgICAgICAgICAgNTMKSE9EYXkwcmVwbGljYXRlMV9BQUFDQ1RHQ0FBQ0FBQ0NULTEgSE9EYXkwcmVwbGljYXRlMSAgICAgICAgIDcwICAgICAgICAgICA1NApIT0RheTByZXBsaWNhdGUxX0FBQUNDVEdDQUNDQUNDQUctMSBIT0RheTByZXBsaWNhdGUxICAgICAgICAxMzEgICAgICAgICAgMTA0Cn5+fgoKV2UgY2FuIGFkZCBhcmJpdHJhcnkgcGVyLWNlbGwgaW5mb3JtYXRpb24gdG8gdGhpcyB0YWJsZSBzdWNoIGFzOgoKLSBTdW1tYXJ5IHN0YXRpc3RpY3MsIHN1Y2ggYXMgcGVyY2VudCBtaXRvY2hvbmRyaWFsIHJlYWRzIGZvciBlYWNoIGNlbGwKLSBCYXRjaCwgY29uZGl0aW9uLCBldGMuIGZvciBlYWNoIGNlbGwKLSBDbHVzdGVyIG1lbWJlcnNoaXAgZm9yIGVhY2ggY2VsbAotIENlbGwgY3ljbGUgcGhhc2UgZm9yIGVhY2ggY2VsbAotIE90aGVyIGN1c3RvbSBhbm5vdGF0aW9ucyBmb3IgZWFjaCBjZWxsCgpJbiB0aGlzIHdvcmtzaG9wIHdlIHdpbGwgc2VlIGV4YW1wbGVzIG9mIHRoZSBmaXJzdCB0aHJlZSwgYmVnaW5uaW5nIHdpdGggcGVyY2VudCBtaXRvY2hvbmRyaWFsIHJlYWRzLgoKPiAjIyMjIFdoeSB0b3RhbCBVTUlzIGluc3RlYWQgb2YgdG90YWwgcmVhZHM/IHsudW5saXN0ZWQgLnVubnVtYmVyZWR9Cj4gCj4gU2luY2UgYSBzaW5nbGUtY2VsbCBpbmhlcmVudGx5IGNvbnRhaW5zIGEgbGltaXRlZCBhbW91bnQgb2YgUk5BIG1vbGVjdWxlcywgYSBoaWdoZXIgYW1vdW50IG9mIFBDUiBhbXBsaWZpY2F0aW9uIGlzIHJlcXVpcmVkIHRvIGdlbmVyYXRlIHRoZSBmaW5hbCBzZXF1ZW5jaW5nIGxpYnJhcnkuCj4gCj4gU2luY2UgUENSIGNhbiBza2V3IHByb3BvcnRpb25zIG9mIGluaXRpYWwgaW5wdXQgbWF0ZXJpYWxzLCBzcGVjaWZpYyBzZXF1ZW5jZXMgYXJlIGluY2x1ZGVkIGluIHRoZSBpbml0aWFsIGNhcHR1cmUgcHJvYmVzIGNhbGxlZCB1bmlxdWUgbW9sZWN1bGUgaWRlbnRpZmllcnMgKFVNSXMpLiBBcyBlYWNoIGluaXRpYWwgcHJvYmUgaGFzIGEgZGlmZmVyZW50IFVNSSBzZXF1ZW5jZSwgZWFjaCBSTkEgY2FwdHVyZWQgd2lsbCBiZSB0YWdnZWQgd2l0aCBhIGRpZmZlcmVudCBVTUksIHdoaWNoIGFsbG93cyB0aG9zZSBpbml0aWFsIFJOQXMgYW5kIHN1YnNlcXVlbnQgUENSIGR1cGxpY2F0ZXMgdG8gYmUgaWRlbnRpZmllZCBhbmQgZHVwbGljYXRlcyBjb2xsYXBzZWQgYXMgcGFydCBvZiB0aGUgaW5pdGlhbCBwcm9jZXNzaW5nIGJ5IENlbGxSYW5nZXIuICAKCj4gIyMjIyBPdGhlciBtZWFuaW5ncyBvZiBgbkZlYXR1cmVzYCB7LnVubGlzdGVkIC51bm51bWJlcmVkfQo+IAo+IEZvciBvdGhlciBzaW5nbGUtY2VsbCBkYXRhIHR5cGVzLCBgbkZlYXR1cmVzYCB3b3VsZCByZXByZXNlbnQgd2hhdCdzIGJlaW5nIG1lYXN1cmVkIGluIHRoYXQgZXhwZXJpbWVudC4gRm9yIHNpbmdsZS1jZWxsIEFUQUMtc2VxLCBgbkZlYXR1cmVzYCB3b3VsZCByZXByZXNlbnRzIHRoZSB0b3RhbCBudW1iZXIgb2YgcGVha3MgKGUuZy4gYWNjZXNzaWJsZSBhcmVhcyBvZiBETkEpIHBlciBjZWxsLgoKIyMgUGVyY2VudCBtaXRvY2hvbmRyaWFsIHJlYWRzCgpUaGUgYFBlcmNlbnRhZ2VGZWF0dXJlU2V0KClgIGZ1bmN0aW9uIGVuYWJsZXMgdXMgdG8gcXVpY2tseSBkZXRlcm1pbmUgdGhlIGNvdW50cyBiZWxvbmdpbmcgdG8gYSBzdWJzZXQgb2YgdGhlIHBvc3NpYmxlIGZlYXR1cmVzIGZvciBlYWNoIGNlbGwuIFNpbmNlIG1pdG9jaG9uZHJpYWwgdHJhbnNjcmlwdHMgaW4gbW91c2UgYmVnaW4gd2l0aCAibXQiLCB3ZSB3aWxsIHVzZSB0aGF0IHBhdHRlcm4gdG8gY291bnQgdGhlIHBlcmNlbnRhZ2Ugb2YgcmVhZHMgY29taW5nIGZyb20gbWl0b2Nob25kcmlhbCB0cmFuc2NyaXB0cy4KCmBgYHtyLCBldmFsID0gRkFMU0V9CiMgV2UgdXNlICJtdCIgYmVjYXVzZSB0aGlzIGlzIG1vdXNlLCBkZXBlbmRpbmcgb24gdGhlIG9yZ2FuaXNtLCB0aGlzIG1pZ2h0IG5lZWQgdG8gYmUgY2hhbmdlZApnZW9fc29AbWV0YS5kYXRhJHBlcmNlbnQubXQgPSBQZXJjZW50YWdlRmVhdHVyZVNldChnZW9fc28sIHBhdHRlcm4gPSAnXm10LScpCgojIEFsdGVybmF0ZSB3YXkgdG8gYWRkIHRoaXMgY29sdW1uCmdlb19zbyRwZXJjZW50Lm10ID0gUGVyY2VudGFnZUZlYXR1cmVTZXQoZ2VvX3NvLCBwYXR0ZXJuID0gJ15tdC0nKQoKIyBBbHRlcm5hdGUgd2F5IHRvIGFkZCB0aGlzIGNvbHVtbgpnZW9fc29bWydwZXJjZW50Lm10J11dID0gUGVyY2VudGFnZUZlYXR1cmVTZXQoZ2VvX3NvLCBwYXR0ZXJuID0gJ15tdC0nKQoKIyBVc2Ugc3VtbWFyeSgpIHRvIHF1aWNrbHkgY2hlY2sgdGhlIHJhbmdlIG9mIHZhbHVlcwpzdW1tYXJ5KGdlb19zbyRwZXJjZW50Lm10KQpgYGAKCn5+fgogICBNaW4uIDFzdCBRdS4gIE1lZGlhbiAgICBNZWFuIDNyZCBRdS4gICAgTWF4LiAKICAwLjAwMCAgIDIuNTgyICAgMy44NjAgIDEzLjc1MiAgMjIuOTUxICA5Ny40NjEgCn5+fgoKSnVzdCBsb29raW5nIGF0IHRoZSBzdW1tYXJ5LCB3ZSBjYW4gc2VlIHRoYXQgdGhlcmUgYXJlIHNvbWUgY2VsbHMgd2l0aCBhIGhpZ2ggcGVyY2VudGFnZSBvZiBtaXRvY2hvbmRyaWFsIHJlYWRzLgoKPCEtLSBNYXR0IG1heSBoYXZlIGRpc2N1c3NlZCBVTUlzIGFzIHBhcnQgb2YgQ2VsbFJhbmdlciBwcm9jZXNzaW5nIGFuZCBMaXYvVHJpY2lhIG1heSB0b3VjaCBvbiBhcyBwYXJ0IG9mIGxpYnJhcnkgZ2VuZXJhdGlvbiBhdCBlbmQgb2YgRGF5IDIgLS0+CgojIElkZW50aWZ5aW5nIGxvdy1xdWFsaXR5IGNlbGxzCgpUbyBpZGVudGlmeSBsb3ctcXVhbGl0eSBjZWxscywgaXQncyBoZWxwZnVsIHRvIHZpc3VhbGl6ZSB0aGUgUUMgbWV0cmljcyBhY3Jvc3MgYWxsIGNlbGxzIGFuZCBzYW1wbGVzIHRvIHVuZGVyc3RhbmQgdGhlIHRoZSBkaXN0cmlidXRpb25zLiBMZXQncyBwbG90IGBuRmVhdHVyZV9STkFgLCBgbkNvdW50X1JOQWAsIGFuZCBgcGVyY2VudC5tdGAuIAoKIyMgVmlzdWFsaXppbmcgUUMgbWV0cmljcwoKQSB2aW9saW4gcGxvdCBjYW4gaGVscCBzaG93IHRoZSBkaXN0cmlidXRpb25zIG9mIGEgcXVhbnRpdHkgYWNyb3NzIG11bHRpcGxlIHNhbXBsZXMuIFNldXJhdCBoYXMgYSBidWlsdC1pbiBmdW5jdGlvbiwgYFZsblBsb3QoKWAgdG8gcXVpY2tseSBnZW5lcmF0ZSB0aGUgcGxvdHMgd2Ugc2Vlay4gQXMgd2UgbWFrZSBvdXIgcGxvdHMsIHdlJ2xsIHNhdmUgdGhlbSB0byBhIGZpbGUgc28gd2UgaGF2ZSB0aGVtIGhhbmR5IG91dHNpZGUgb2YgUiwgcGVyaGFwcyB0byBpbmNsdWRlIGluIGEgcmVwb3J0IG9yIHRvIHNoYXJlIHdpdGggY29sbGFib3JhdG9ycy4gTGV0J3MgYmVnaW4gd2l0aCB0aGUgYG5GZWF0dXJlX1JOQWAgdmlvbGluIHBsb3QuCgpgYGB7ciwgZXZhbCA9IEZBTFNFfQpWbG5QbG90KGdlb19zbywgZmVhdHVyZXMgPSAnbkZlYXR1cmVfUk5BJywgYXNzYXkgPSAnUk5BJywgbGF5ZXIgPSAnY291bnRzJykgKyBOb0xlZ2VuZCgpCmdnc2F2ZShmaWxlbmFtZSA9ICdJU0NfUi9yZXN1bHRzL2ZpZ3VyZXMvcWNfbkZlYXR1cmVfdmlvbGluLnBuZycsIHdpZHRoID0gMTIsIGhlaWdodCA9IDYsIHVuaXRzID0gJ2luJykKYGBgCgohW10oLi9pbWFnZXMvY3VycmljdWx1bS9xY19uRmVhdHVyZV92aW9saW4ucG5nKQoKV2UgYWxyZWFkeSBub3RlIHRoYXQgdGhlIERheTAgc2FtcGxlcyBhcHBlYXIgdG8gaGF2ZSBzeXN0ZW1hdGljYWxseSBsb3dlciBmZWF0dXJlcyBkZXRlY3RlZCBwZXIgY2VsbCwgd2l0aCBzYW1wbGUgSE9EYXkwcmVwb2lsY2F0ZTEgYXBwZWFyaW5nIHRvIGhhdmUgbXVjaCBsb3dlciBmZWF0dXJlcyBwZXIgY2VsbC4gTGV0J3MgY29udGludWUgd2l0aCB0aGUgYG5Db3VudF9STkFgIHBsb3QuCgpgYGB7ciwgZXZhbCA9IEZBTFNFfQpWbG5QbG90KGdlb19zbywgZmVhdHVyZXMgPSAnbkNvdW50X1JOQScsIGFzc2F5ID0gJ1JOQScsIGxheWVyID0gJ2NvdW50cycpICsgTm9MZWdlbmQoKQpnZ3NhdmUoZmlsZW5hbWUgPSAnSVNDX1IvcmVzdWx0cy9maWd1cmVzL3FjX25Db3VudF92aW9saW4ucG5nJywgd2lkdGggPSAxMiwgaGVpZ2h0ID0gNiwgdW5pdHMgPSAnaW4nKQpgYGAKCiFbXSguL2ltYWdlcy9jdXJyaWN1bHVtL3FjX25Db3VudF92aW9saW4ucG5nKQoKV2Ugb2Jlc3J2ZSBhIHNpbWlsYXIgcGF0dGVybiwgd2hlcmUgdGhlIERheTAgc2FtcGxlcyBhcHBlYXIgdG8gaGF2ZSBsb3dlciBjb3VudHMgcGVyIGNlbGwgdGhhbiB0aGVpciBEYXk3IGFuZCBEYXkyMSBjb3VudGVycGFydHMuIFRoZXJlIGlzIGV2ZW4gYW4gb3V0bGllciBjZWxsIGluIEhPRGF5MHJlcGxpY2F0ZTEsIHdpdGggb3ZlciA5MEsgdW5pcXVlIFVNSXMgZGV0ZWN0ZWQuIFRoaXMgY2VsbCBpcyB2ZXJ5IGxpa2VseSBhIGRvdWJsZXQuIEZpbmFsbHksIGxldHMgcGxvdCB0aGUgYHBlcmNlbnQubXRgLgoKYGBge3IsIGV2YWwgPSBGQUxTRX0KVmxuUGxvdChnZW9fc28sIGZlYXR1cmVzID0gJ3BlcmNlbnQubXQnLCBhc3NheSA9ICdSTkEnLCBsYXllciA9ICdjb3VudHMnKSArIE5vTGVnZW5kKCkKZ2dzYXZlKGZpbGVuYW1lID0gJ0lTQ19SL3Jlc3VsdHMvZmlndXJlcy9xY19taXRvX3Zpb2xpbi5wbmcnLCB3aWR0aCA9IDEyLCBoZWlnaHQgPSA2LCB1bml0cyA9ICdpbicpCmBgYAoKIVtdKGltYWdlcy9jdXJyaWN1bHVtL3FjX21pdG9fdmlvbGluLnBuZykKCkltbWVkaWF0ZWx5LCBIT0RheTByZXBsaWNhdGUxIGFwcGVhcnMgdG8gaGF2ZSBtYW55IGNlbGxzIHdpdGggYSBoaWdoIHBlcmNlbnRhZ2Ugb2YgbWl0b2Nob25kcmlhbCByZWFkcy4gV2Ugb2JzZXJ2ZSB0aGF0IHRoZSBvdGhlciBzYW1wbGVzIGFwcGVhciB0byBoYXZlIGEgZmV3IGNlbGxzIHdpdGggaGlnaCBwZXJjZW50YWdlIG9mIG1pdG9jaG9uZHJpYWwgcmVhZHMsIGJ1dCBvdmVyYWxsIG1vc3QgY2VsbHMgdGVuZCB0byBoYXZlIDwxMCUgbWl0b2Nob25kcmlhbCByZWFkcy4gVGhpcyBpcyBhIGdvb2Qgc2lnbi4KCkdlbmVyYWxseSwgbWFueSB0dXRvcmlhbHMgdXNlIGEgY3V0b2ZmIG9mIDUtMTAlIG1pdG9jaG9uZHJpYWwuIEhvd2V2ZXIsIGZvciBzb21lIGV4cGVyaW1lbnRzIGhpZ2ggbWl0b2Nob25kcmlhbCByZWFkcyB3b3VsZCBiZSBleHBlY3RlZCAoc3VjaCBhcyBpbiBjYXNlcyB3aGVyZSB0aGUgY29uZGl0aW9uL3RyZWF0bWVudCBvciBnZW5vdHlwZSBpbmNyZWFzZXMgY2VsbCBkZWF0aCksIHRoZW4gYSByZWxheGVkIHRocmVzaG9sZCB3b3VsZCBiZSBuZWNlc3NhcnkgdG8gcHJlc2VydmUgYmlvbG9naWNhbGx5IHJlbGV2YW50IGNlbGxzLgoKIyMgQ2VsbCBjb3VudHMKCkl0J3MgYSBnb29kIGlkZWEgdG8gcmVjb3JkIGhvdyBtYW55IGNlbGxzIHdlIHN0YXJ0ZWQgd2l0aCBpbiBvdXIgZXhwZXJpbWVudCwgYW5kIGhvdyBtYW55IGNlbGxzIHdlIGhhdmUgYWZ0ZXIgZmlsdGVyaW5nLiBTbyBiZWZvcmUgd2UgZGlzY3VzcyBmaWx0ZXJpbmcgZnVydGhlciwgbGV0J3MgcmVjb3JkIHRoZSBudW1iZXIgb2YgY2VsbHMgcGVyIHNhbXBsZS4KCmBgYHtyLCBldmFsID0gRkFMU0V9CmNlbGxfY291bnRzX3ByZV90YmwgPSBnZW9fc29AbWV0YS5kYXRhICU+JSBjb3VudChvcmlnLmlkZW50LCBuYW1lID0gJ3ByZWZpbHRlcl9jZWxscycpCmNlbGxfY291bnRzX3ByZV90YmwKYGBgCgp+fn4KICAgICAgICAgIG9yaWcuaWRlbnQgcHJlZmlsdGVyX2NlbGxzCjEgICBIT0RheTByZXBsaWNhdGUxICAgICAgICAgICAxMjY2NgoyICAgSE9EYXkwcmVwbGljYXRlMiAgICAgICAgICAgICA2MTQKMyAgIEhPRGF5MHJlcGxpY2F0ZTMgICAgICAgICAgICAxMTkxCjQgICBIT0RheTByZXBsaWNhdGU0ICAgICAgICAgICAgIDk0OQo1ICBIT0RheTIxcmVwbGljYXRlMSAgICAgICAgICAgIDE2MDcKNiAgSE9EYXkyMXJlcGxpY2F0ZTIgICAgICAgICAgICAgOTMyCjcgIEhPRGF5MjFyZXBsaWNhdGUzICAgICAgICAgICAgIDk2Nwo4ICBIT0RheTIxcmVwbGljYXRlNCAgICAgICAgICAgIDE5ODYKOSAgIEhPRGF5N3JlcGxpY2F0ZTEgICAgICAgICAgICAzNDA1CjEwICBIT0RheTdyZXBsaWNhdGUyICAgICAgICAgICAgMzY5NAoxMSAgSE9EYXk3cmVwbGljYXRlMyAgICAgICAgICAgIDM3ODYKMTIgIEhPRGF5N3JlcGxpY2F0ZTQgICAgICAgICAgICAyOTY0Cn5+fgoKSXQgYXBwZWFycyB0aGF0IENlbGwgUmFuZ2VyIGNhbGxlZCBtYW55IG1vcmUgY2VsbHMgaW4gSE9EYXkwcmVwbGljYXRlMSB0aGFuIHRoZSBvdGhlciBzYW1wbGVzLiBCYXNlZCBvbiB0aGUgUUMgdmlzdWFsaXphdGlvbiwgcHJvYmFibHkgZXJyb25lb3VzbHkgc28uCgo8IS0tIE90aGVyd2lzZSBjb21tZW50IG9uIGNlbGwgbnVtYmVycz8gLS0+CgojIyBVc2luZyBmaXhlZCB0aHJlc2hvbGRzCgpBZnRlciBsb29raW5nIGF0IHRoZSBwbG90cyBvZiBgbkZlYXR1cmVfUk5BYCwgYG5Db3VudF9STkFgLCBhbmQgYHBlcmNlbnQubXRgLCB3ZSBjb3VsZCBkZWNpZGUgdG8gY29uc2lkZXIgY2VsbHMgd2l0aCA8NTAwIGdlbmVzIHBlciBjZWxsLCBhbmQgPjI1JSBtaXRvY2hvbmRyaWFsIHJlYWRzIGFzIGxvdy1xdWFsaXR5LCBhbmQgZmlsdGVyIHRoZSBjZWxscyB1c2luZyB0aGUgYHN1YnNldCgpYCBmdW5jdGlvbi4gW1NvcmtpbiBldCBhbC5dKGh0dHBzOi8vd3d3Lm5jYmkubmxtLm5paC5nb3YvcG1jL2FydGljbGVzL1BNQzcwMDI0NTMvKSBjaG9zZSB0aGVzZSB0aHJlc2hvbGRzOgoKPiBXZSBmaWx0ZXJlZCBvdXQgY2VsbHMgd2l0aCBsZXNzIHRoYW4gNTAwIGdlbmVzIHBlciBjZWxsIGFuZCB3aXRoIG1vcmUgdGhhbiAyNSUgbWl0b2Nob25kcmlhbCByZWFkIGNvbnRlbnQuCgpXZSBjb3VsZCBwcmV2aWV3IHdoYXQgdGhlIHJlc3VsdGluZyBjZWxsIGNvdW50cyB3b3VsZCBiZSB3aXRoIHRoZXNlIHRocmVzaG9sZHM6CgpgYGB7ciwgZXZhbCA9IEZBTFNFfQpzdWJzZXQoZ2VvX3NvLCBzdWJzZXQgPSBuRmVhdHVyZV9STkEgPiA1MDAgJiBwZXJjZW50Lm10IDwgMjUpQG1ldGEuZGF0YSAlPiUgCiAgICBjb3VudChvcmlnLmlkZW50LCBuYW1lID0gJ3Bvc3RmaWx0ZXJfY2VsbHMnKQpgYGAKCn5+fgogICAgICAgICAgb3JpZy5pZGVudCBwb3N0ZmlsdGVyX2NlbGxzCjEgICBIT0RheTByZXBsaWNhdGUxICAgICAgICAgICAgIDEwMDMKMiAgIEhPRGF5MHJlcGxpY2F0ZTIgICAgICAgICAgICAgIDU3MQozICAgSE9EYXkwcmVwbGljYXRlMyAgICAgICAgICAgICAxMTExCjQgICBIT0RheTByZXBsaWNhdGU0ICAgICAgICAgICAgICA4NzYKNSAgSE9EYXkyMXJlcGxpY2F0ZTEgICAgICAgICAgICAgMTUzNwo2ICBIT0RheTIxcmVwbGljYXRlMiAgICAgICAgICAgICAgOTA3CjcgIEhPRGF5MjFyZXBsaWNhdGUzICAgICAgICAgICAgICA5NDUKOCAgSE9EYXkyMXJlcGxpY2F0ZTQgICAgICAgICAgICAgMTk1Ngo5ICAgSE9EYXk3cmVwbGljYXRlMSAgICAgICAgICAgICAzMjY1CjEwICBIT0RheTdyZXBsaWNhdGUyICAgICAgICAgICAgIDM1NzgKMTEgIEhPRGF5N3JlcGxpY2F0ZTMgICAgICAgICAgICAgMzY2OAoxMiAgSE9EYXk3cmVwbGljYXRlNCAgICAgICAgICAgICAyOTAzCn5+fgoKVGhpcyByZW1vdmVzIGEgc2l6ZWFibGUgbnVtYmVyIG9mIGNlbGxzIGZyb20gSE9EYXkwcmVwbGljYXRlMSwgYW5kIGJyaW5ncyB0aGF0IHNhbXBsZSBpbnRvIGxpbmUgd2l0aCB0aGUgb3RoZXIgc2FtcGxlcy4KCiMjIFVzaW5nIGFkYXB0aXZlIHRocmVzaG9sZHMKCldlIGNvdWxkIGNob29zZSB0byByZW1vdmUgb3V0bGllciBjZWxscyBhZGFwdGl2ZWx5LiBUaGlzIGFwcHJvYWNoIGFzc3VtZXMgdGhhdCBtb3N0IG9mIHRoZSBjZWxscyBhcmUgb2YgYWNjZXB0YWJsZSBxdWFsaXR5LiBOb3RlLCB3ZSd2ZSBhbHJlYWR5IHNlZW4gdGhhdCBtYW55IG9mIHRoZSBjZWxscyBpbiBIT0RheTByZXBsaWNhdGUxIGFwcGVhciB0byBiZSBvZiBwb29yIHF1YWxpdHksIGFuZCBtYW55IG9mIHRoZSBEYXkwIGNlbGxzIGhhdmUgbXVjaCBsb3dlciBgbkNvdW50YHMgYW5kIGBuRmVhdHVyZWBzIHRoYW4gdGhlaXIgRGF5NyBhbmQgRGF5MjEgY291bnRlcnBhcnRzLiBGb3IgdGh1cyB3b3Jrc2hvcCB3ZSB3aWxsIHVzZSB0aGUgYWJvdmUgZml4ZWQgdGhyZXNob2xkcyB0byBtYXRjaCB0aGUgcHVibGljYXRpb24uCgo8IS0tIFJlc291cmNlcyBmb3IgYWRhcHRpdmUgb3V0bGllciBkZXRlY3Rpb24gaHR0cHM6Ly9iaW9jb25kdWN0b3Iub3JnL2Jvb2tzLzMuMTIvT1NDQS9xdWFsaXR5LWNvbnRyb2wuaHRtbCNpZGVudGlmeWluZy1sb3ctcXVhbGl0eS1jZWxscyAtLT4KCiMgUmVtb3ZpbmcgbG93LXF1YWxpdHkgY2VsbHMKCkxldCdzIHJlbW92ZSB0aGUgY2VsbHMgd2l0aCBgbkZlYXR1cmVfUk5BIDw9IDUwMGAgYW5kIGBwZXJjZW50Lm10ID49IDI1YC4KCmBgYHtyLCBldmFsID0gRkFMU0V9Cmdlb19zbyA9IHN1YnNldChnZW9fc28sIHN1YnNldCA9IG5GZWF0dXJlX1JOQSA+IDUwMCAmIHBlcmNlbnQubXQgPCAyNSkKYGBgCgpOb3RlIHRoYXQgdGhlIGBzdWJzZXQoKWAgY29tbWFuZCB1c2VzIGFuIGV4cHJlc3Npb24gaW4gdGVybXMgb2YgdGhlIGNlbGxzIHdlICoqd2FudCB0byBrZWVwKiouIE5vdyB3ZSdsbCB0YWtlIGEgbG9vayBhdCB0aGUgY2VsbHMgcGVyIHNhbXBsZSBwb3N0LWZpbHRlcmluZzoKCmBgYHtyLCBldmFsID0gRkFMU0V9CmNlbGxfY291bnRzX3Bvc3RfdGJsID0gZ2VvX3NvQG1ldGEuZGF0YSAlPiUgY291bnQob3JpZy5pZGVudCwgbmFtZSA9ICdwb3N0ZmlsdGVyX2NlbGxzJykKY2VsbF9jb3VudHNfcG9zdF90YmwKYGBgCgp+fn4KICAgICAgICAgIG9yaWcuaWRlbnQgcG9zdGZpbHRlcl9jZWxscwoxICAgSE9EYXkwcmVwbGljYXRlMSAgICAgICAgICAgICAxMDAzCjIgICBIT0RheTByZXBsaWNhdGUyICAgICAgICAgICAgICA1NzEKMyAgIEhPRGF5MHJlcGxpY2F0ZTMgICAgICAgICAgICAgMTExMQo0ICAgSE9EYXkwcmVwbGljYXRlNCAgICAgICAgICAgICAgODc2CjUgIEhPRGF5MjFyZXBsaWNhdGUxICAgICAgICAgICAgIDE1MzcKNiAgSE9EYXkyMXJlcGxpY2F0ZTIgICAgICAgICAgICAgIDkwNwo3ICBIT0RheTIxcmVwbGljYXRlMyAgICAgICAgICAgICAgOTQ1CjggIEhPRGF5MjFyZXBsaWNhdGU0ICAgICAgICAgICAgIDE5NTYKOSAgIEhPRGF5N3JlcGxpY2F0ZTEgICAgICAgICAgICAgMzI2NQoxMCAgSE9EYXk3cmVwbGljYXRlMiAgICAgICAgICAgICAzNTc4CjExICBIT0RheTdyZXBsaWNhdGUzICAgICAgICAgICAgIDM2NjgKMTIgIEhPRGF5N3JlcGxpY2F0ZTQgICAgICAgICAgICAgMjkwMwp+fn4KCkxvb2tpbmcgYXQgdGhlIHRvdGFsIG51bWJlciBvZiBjZWxscyBwZXIgc2FtcGxlIGlzIGhlbHBmdWwgdG8gdW5kZXJzdGFuZCBib3RoIGhvdyB0aGUgY2FsbGVkICJjZWxscyIgY29tcGFyZSB0byB3aGF0IHdhcyBleHBlY3RlZCBmb3IgdGhlIGV4cGVyaW1lbnQuIEl0IGFsc28gYWxsb3dzIHVzIHRvIGRldGVybWluZSB0aGUgaW1wYWN0IG9mIG91ciBmaWx0ZXJpbmcgdGhyZXNob2xkcy4gTGV0J3MgY29tYmluZSB0aGUgcHJlIGFuZCBwb3N0IHRhYmxlczoKCmBgYHtyLCBldmFsID0gRkFMU0V9CmNlbGxfY291bnRzX3RibCA9IGNlbGxfY291bnRzX3ByZV90YmwgJT4lIGxlZnRfam9pbihjZWxsX2NvdW50c19wb3N0X3RibCwgYnkgPSAnb3JpZy5pZGVudCcpCmNlbGxfY291bnRzX3RibApgYGAKCn5+fgogICAgICAgICAgb3JpZy5pZGVudCBwcmVmaWx0ZXJfY2VsbHMgcG9zdGZpbHRlcl9jZWxscwoxICAgSE9EYXkwcmVwbGljYXRlMSAgICAgICAgICAgMTI2NjYgICAgICAgICAgICAgMTAwMwoyICAgSE9EYXkwcmVwbGljYXRlMiAgICAgICAgICAgICA2MTQgICAgICAgICAgICAgIDU3MQozICAgSE9EYXkwcmVwbGljYXRlMyAgICAgICAgICAgIDExOTEgICAgICAgICAgICAgMTExMQo0ICAgSE9EYXkwcmVwbGljYXRlNCAgICAgICAgICAgICA5NDkgICAgICAgICAgICAgIDg3Ngo1ICBIT0RheTIxcmVwbGljYXRlMSAgICAgICAgICAgIDE2MDcgICAgICAgICAgICAgMTUzNwo2ICBIT0RheTIxcmVwbGljYXRlMiAgICAgICAgICAgICA5MzIgICAgICAgICAgICAgIDkwNwo3ICBIT0RheTIxcmVwbGljYXRlMyAgICAgICAgICAgICA5NjcgICAgICAgICAgICAgIDk0NQo4ICBIT0RheTIxcmVwbGljYXRlNCAgICAgICAgICAgIDE5ODYgICAgICAgICAgICAgMTk1Ngo5ICAgSE9EYXk3cmVwbGljYXRlMSAgICAgICAgICAgIDM0MDUgICAgICAgICAgICAgMzI2NQoxMCAgSE9EYXk3cmVwbGljYXRlMiAgICAgICAgICAgIDM2OTQgICAgICAgICAgICAgMzU3OAoxMSAgSE9EYXk3cmVwbGljYXRlMyAgICAgICAgICAgIDM3ODYgICAgICAgICAgICAgMzY2OAoxMiAgSE9EYXk3cmVwbGljYXRlNCAgICAgICAgICAgIDI5NjQgICAgICAgICAgICAgMjkwMwp+fn4KCkxldCdzIGFsc28gd3JpdGUgdGhpcyB0YWJsZSB0byBhIGZpbGUuCgpgYGB7ciwgZXZhbCA9IEZBTFNFfQp3cml0ZV9jc3YoY2VsbF9jb3VudHNfdGJsLCBmaWxlID0gJ0lTQ19SL3Jlc3VsdHMvdGFibGVzL2NlbGxfZmlsdGVyaW5nX2NvdW50cy5jc3YnKQpgYGAKCjwhLS1XaGF0IHRocmVzaG9sZHMgd291bGQgd2Ugc3RhcnQgd2l0aCBiYXNlZCBvbiB0aGUgcGxvdHMgYWxvbmU/IEhvdyBkb2VzIHRoYXQgY29tcGFyZSB0byB0aGUgdGhyZXNob2xkcyByZXBvcnRlZCBpbiBwYXBlcj8tLT4KCjwhLS1PdGhlciDigJxhZHZhbmNlZOKAnSBtZXRob2RzOiBvdXQgb2Ygc2NvcGUgZm9yIHRoaXMgd29ya3Nob3AgYnV0IHRoZXJlIGFyZSBwYWNrYWdlcyAgc3BlY2lmaWNhbGx5IGRldmVsb3BlZCB0byBkZXRlY3QgImRvdWJsZXRzIiwgZS5nLiBkcm9wbGV0cyB0aGF0IGNvbnRhaW5lZCBtb3JlIHRoYW4gb25lIGNlbGwsIHN1Y2ggYXMgRG91YmxlRmluZGVyLS0+Cgo8IS0tQWRkaXRpb25hbCBhc2lkZSAtIEZvciBzaW5nbGUtbnVjbGVpIGV4cGVyaW1lbnRzIHJlbW92aW5nIGJhY2tncm91bmQvYW1iaWVudCBSTkEgd2l0aCBDZWxsQmxlbmRlciBPUiBEZWNvbnRYIGlzIGFuIGltcG9ydGFudCBhZGRpdGlvbmFsIHN0ZXAgc2luY2UgbnVjbGVpIGFyZSBib3RoIHN0aWNreSBhbmQgcG9yb3VzLS0+CgojIEFkZGluZyBwaGVub3R5cGUgZGF0YQoKVGhlIGBvcmlnLmlkZW50YCBjb2x1bW4gb2YgdGhlIGBtZXRhLmRhdGFgIHRhYmxlIGluY2x1ZGVzIGJvdGggcmVwbGljYXRlIGFuZCBkYXkgaW5mb3JtYXRpb24uIFdlJ2QgbGlrZSB0byB1c2UgdGhpcyBjb2x1bW4gdG8gY3JlYXRlIG5ldyBjb2x1bW5zIGZvciBkYXkgYW5kIHJlcGxpY2F0ZS4gQm90aCBvZiB3aGljaCB3aWxsIGNvbWUgaW4gaGFuZHkgbGF0ZXIuCgpgYGB7ciwgZXZhbCA9IEZBTFNFfQojIEFkZCAucyBzZXBhcmF0aW5nIHRoZSBpbmZvcm1hdGlvbiBpbiBvcmlnLmlkZW50CiMgTk9URSwgdGhpcyByZWxpZXMgb24gYSB1bmlmb3JtIG5hbWluZyBzY2hlbWUhCmdlb19zbyRvcmlnLmlkZW50ID0gZ3N1YignSE8nLCAnSE8uJywgZ2VvX3NvJG9yaWcuaWRlbnQpCmdlb19zbyRvcmlnLmlkZW50ID0gZ3N1YigncmVwJywgJy5yZXAnLCBnZW9fc28kb3JpZy5pZGVudCkKCiMgQWRkIGRheSBpbmZvcm1hdGlvbgpnZW9fc28kZGF5ID0gc3RyX3NwbGl0KGdlb19zbyRvcmlnLmlkZW50LCBwYXR0ZXJuID0gJ1suXScsIHNpbXBsaWZ5ID0gVFJVRSlbLDJdCgojIEFkZCByZXBsaWNhdGUgY29sdW1uCmdlb19zbyRyZXBsaWNhdGUgPSBzdHJfc3BsaXQoZ2VvX3NvJG9yaWcuaWRlbnQsIHBhdHRlcm4gPSAnWy5dJywgc2ltcGxpZnkgPSBUUlVFKVssM10KYGBgCgojIFN1bW1hcnkKCkluIHRoaXMgc2VjdGlvbiB3ZToKCi0gRGlzY3Vzc2VkIHF1YWxpdHkgbWV0cmljcyBgbkZlYXR1cmVgcywgYG5Db3VudGBzLCBhbmQgYHBlcmNlbnQubXRgLgotIFZpc3VhbGl6ZWQgdGhlc2UgbWV0cmljcyBhY3Jvc3MgY2VsbHMgLyBzYW1wbGVzIHRvIGhlbHAgaWRlbnRpZnkgbG93LXF1YWxpdHkgY2VsbHMuCi0gRmlsdGVyZWQgbG93LXF1YWxpdHkgY2VsbHMgdXNpbmcgZml4ZWQgdGhyZXNob2xkcy4KCk5leHQgc3RlcHM6IGRpbWVuc2lvbmFsaXR5IHJlZHVjdGlvbiB1c2luZyBQQ0EKCi0tLS0KClRoZXNlIG1hdGVyaWFscyBoYXZlIGJlZW4gYWRhcHRlZCBhbmQgZXh0ZW5kZWQgZnJvbSBtYXRlcmlhbHMgbGlzdGVkIGFib3ZlLiBUaGVzZSBhcmUgb3BlbiBhY2Nlc3MgbWF0ZXJpYWxzIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgW0NyZWF0aXZlIENvbW1vbnMgQXR0cmlidXRpb24gbGljZW5zZSAoQ0MgQlkgNC4wKV0oaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnkvNC4wLyksIHdoaWNoIHBlcm1pdHMgdW5yZXN0cmljdGVkIHVzZSwgZGlzdHJpYnV0aW9uLCBhbmQgcmVwcm9kdWN0aW9uIGluIGFueSBtZWRpdW0sIHByb3ZpZGVkIHRoZSBvcmlnaW5hbCBhdXRob3IgYW5kIHNvdXJjZSBhcmUgY3JlZGl0ZWQuCgo8YnIvPgo8YnIvPgo8aHIvPgp8IFtQcmV2aW91cyBsZXNzb25dKDAxLUdldHRpbmdTdGFydGVkLmh0bWwpIHwgW1RvcCBvZiB0aGlzIGxlc3Nvbl0oI3RvcCkgfCBbTmV4dCBsZXNzb25dKDAzLUludGVncmF0aW9uLmh0bWwpIHwKfCA6LS0tIHwgOi0tLS06IHwgLS0tOiB8CgoK</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("02-QCandFiltering.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
