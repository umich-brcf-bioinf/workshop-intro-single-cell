<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="UM Bioinformatics Core" />

<meta name="date" content="2024-02-27" />

<title>Normalization</title>

<script src="site_libs/header-attrs-2.24/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<!--
Favicon dervied from
https://twemoji.twitter.com/
https://favicon.io/emoji-favicons/dna/
-->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="shortcut icon" href="favicon-16x16.png" />
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Intro to scRNA-Seq</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="workshop_intro.html">Intro</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 1
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="00A-OrientingOnScRNASeq.html">Orienting on scRNA-Seq</a>
    </li>
    <li>
      <a href="00B-CellRangerInAction.html">Cell Ranger in Action</a>
    </li>
    <li>
      <a href="01-GettingStarted.html">Getting Started with Seurat</a>
    </li>
    <li>
      <a href="02-QCandFiltering.html">Secondary QC &amp; Filtering</a>
    </li>
    <li>
      <a href="03-Normalization.html">Normalization</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 2
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="04-PCAandIntegration.html">PCA &amp; Integration</a>
    </li>
    <li>
      <a href="05-ProjectionAndClustering.html">Projection &amp; Clustering</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 3
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="06-MarkerVisualization.html">Marker identification and visualization</a>
    </li>
    <li>
      <a href="07-CellTypeAnnos.html">Cell type annotation</a>
    </li>
    <li>
      <a href="08-DifferentialExpression.html">Differential expression analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="workshop_wrap_up.html">Wrap up</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Normalization</h1>
<h4 class="author">UM Bioinformatics Core</h4>
<h4 class="date">2024-02-27</h4>

</div>


<style type="text/css">
body, td {
   font-size: 18px;
}
code.r{
  font-size: 12px;
}
pre {
  font-size: 12px
}
</style>
<div id="workflow-overview" class="section level1 unlisted unnumbered">
<h1 class="unlisted unnumbered">Workflow Overview</h1>
<p><br/>
<img src="images/wayfinder/wayfinder.png" alt="wayfinder" style="height: 400px;"/>
<br/> <br/></p>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>After removing low-quality cells from the data, the next task is the
normalization and variance stabiliziation of the counts for downstream
analysis. Variation in scRNA-seq data comes from both biological and
technical sources. It is important to control for the technical sources
of variation as much as possible, without removing the biological
sources of variation.</p>
<p>Biological variation is related to differences in cell type and
state, and can help answer biologically meaningful questions. Whereas
technical variation may arise from fluctuations in cellular RNA content,
efficiency in lysis and reverse transcription, and stochastic sampling
during sequencing.</p>
<p>A key driver of technical variation is cellular sequencing depth
(that is, the number of UMIs sequenced per cell). The known relationship
between gene abundance and gene variance is also an important factor to
account for. While methods exist to address these issues in bulk
RNA-seq, the sparsity of scRNA-seq data presents challenges to existing
methods.</p>
<div id="objectives" class="section level2">
<h2>Objectives</h2>
<ul>
<li>Understand why normalization is needed.</li>
<li>Understand normalization options.</li>
<li>Normalize the counts with <code>SCTransform()</code>.</li>
</ul>
<hr />
</div>
</div>
<div id="normalization" class="section level1">
<h1>Normalization</h1>
<p>We will use the <code>SCTransform()</code> function, which uses a
generalized linear model (GLM) framework to account for cell-level
sequencing depth while also stabilizing the variance of the counts.
Let’s get the normalization started, as it takes a little time, and then
we can explain what it’s doing and why it is an improvement on alternate
methods.</p>
<p>First, we’ll run the following command to separate the data from each
sample into layers, a requirement of Seurat v5:</p>
<pre class="r"><code>geo_so[[&#39;RNA&#39;]] = split(geo_so[[&#39;RNA&#39;]], f = geo_so$orig.ident)
geo_so</code></pre>
<pre><code>An object of class Seurat 
26489 features across 29615 samples within 1 assay 
Active assay: RNA (26489 features, 0 variable features)
 12 layers present: counts.HO.Day0.replicate1, counts.HO.Day0.replicate2, counts.HO.Day0.replicate3, counts.HO.Day0.replicate4, counts.HO.Day21.replicate1, counts.HO.Day21.replicate2, counts.HO.Day21.replicate3, counts.HO.Day21.replicate4, counts.HO.Day7.replicate1, counts.HO.Day7.replicate2, counts.HO.Day7.replicate3, counts.HO.Day7.replicate4</code></pre>
<p>We see the 12 layers containing the count data for each of the
samples. Next, run <code>SCTransform()</code>:</p>
<pre class="r"><code>geo_so = SCTransform(geo_so)</code></pre>
<div id="details" class="section level2">
<h2>Details</h2>
<p>The full description and justification of the
<code>SCTransform()</code> function are provided in two excellent
papers:</p>
<ul>
<li><p>Hafemeister &amp; Satija, <em>Normalization and variance
stabilization of single-cell RNA-seq data using regularized negative
binomial regression</em>, 2019, Genome Biology (<a
href="https://genomebiology.biomedcentral.com/articles/10.1186/s13059-019-1874-1#availability-of-data-and-materials">link</a>)</p></li>
<li><p>Choudhary &amp; Satija, <em>Comparison and evaluation of
statistical error models for scRNA-seq</em>, 2022, Genome Biology (<a
href="https://genomebiology.biomedcentral.com/articles/10.1186/s13059-021-02584-9">link</a>)</p></li>
</ul>
<p>Contained in the title of the first paper is the kernel of the
approach: “regularized negative binomial regression”. Let’s explain the
parts of that phrase at a high-level.</p>
<ul>
<li><p>“Regression” means that for each gene in the scRNA-seq data, a
generalized linear model is fit whereby the vector of UMI counts for the
gene is estimated by a linear equation containing an intercept and the
vector of sequencing depth of the cells. As a term in the model, the
cell sequencing depth can be accounted for.</p></li>
<li><p>“Negative binomial” refers to the counts being modeled with a
negative binomial distribution. It has been observed in both bulk and
single-cell RNA-seq that the mean and variance of the count data are
related to one another. Put another way, the variance is non-constant.
The negative binomial distribution allows for the variance of the counts
to be a function of the mean of the counts.</p></li>
<li><p>“Regularized” refers to a method to constrain parameter
estimation. When computing the parameters of the model, the authors
observed that genes with low to moderate expression levels had widely
ranging model parameter estimates, even when the genes were similar to
one another. They concluded this was a result of model overfitting–not
of biological origin–and decided to constrain the model parameters by
combining information across similar genes. That is, regularization. In
this way, the variance of the gene counts is stabilized.</p></li>
</ul>
<p>Finally, the Choudhary &amp; Satija paper introduced a modified
version of the regularized negative binomial regression
(<code>sctransform</code> v2). The modifications include:</p>
<ul>
<li><p>The slope of the NB GLM is fixed at an analytically derived
<code>ln(10)</code>. Consequently, only the intercept and overdispersion
parameters remain to be estimated for each gene.</p></li>
<li><p>Genes with very low expression or with variance less than the
mean have their dispersion parameters set to infinity, essentially
reverting to a Poisson count distribution.</p></li>
<li><p>A lower bound on the minimum variance is used to prevent genes
with very low UMI counts from being given very high normalized
expression values.</p></li>
</ul>
<p>Additionally, the benefit of the GLM framework for normalization and
variance stabilization is that the GLM can include other terms which can
account for unwanted technical variation. One example of this is the
percent mitochondrial reads (<code>percent.mt</code>). The
<code>vars.to.regress</code> parameter of <code>SCTransform()</code> is
used for this purpose. See the <a
href="https://satijalab.org/seurat/reference/sctransform">documentation</a>
for details.</p>
</div>
<div id="other-normalizations" class="section level2">
<h2>Other normalizations</h2>
<p>From the Seurat documentation, the <code>SCTransform()</code>
function “replaces <code>NormalizeData()</code>,
<code>ScaleData()</code>, and <code>FindVariableFeatures()</code>”. This
chain of functions is referred to as the “log-normalization procedure”.
You may see these three commands in other vignettes, and even in other
Seurat vignettes (<a
href="https://satijalab.org/seurat/articles/sctransform_vignette">source</a>).
In the two papers referenced above, the authors show how the
log-normalization procedure does not always fully account for cell
sequencing depth and overdispersion. Therefore, we urge you to use this
alternative pipeline with caution.</p>
</div>
</div>
<div id="normalization-continued" class="section level1">
<h1>Normalization, continued</h1>
<p>By now, <code>SCTransform()</code> should have finished running, so
let’s take a look at the result:</p>
<pre class="r"><code>geo_so</code></pre>
<pre><code>An object of class Seurat 
47037 features across 29615 samples within 2 assays 
Active assay: SCT (20548 features, 3000 variable features)
 3 layers present: counts, data, scale.data
 1 other assay present: RNA</code></pre>
<p>We observe that the active assay is now “SCT”, but that the “RNA”
assay is still present. <code>SCTransform()</code> has also determined
the common variable features across the cells to be used in our
downstream analysis.</p>
</div>
<div id="save-the-seurat-object" class="section level1">
<h1>Save the Seurat object</h1>
<p>Let’s save this normalized form of our Seurat object.</p>
<pre class="r"><code>saveRDS(object = geo_so, file = &#39;results/rdata/geo_so_sct_normalized.rds&#39;)</code></pre>
</div>
<div id="summary" class="section level1">
<h1>Summary</h1>
<p>In this section we have run the <code>SCTransform()</code> function
to account for variation in cell sequencing depth and to stabilize the
variance of the counts.</p>
<p>Next steps: PCA and integration</p>
<hr />
<p>These materials have been adapted and extended from materials listed
above. These are open access materials distributed under the terms of
the <a href="http://creativecommons.org/licenses/by/4.0/">Creative
Commons Attribution license (CC BY 4.0)</a>, which permits unrestricted
use, distribution, and reproduction in any medium, provided the original
author and source are credited.</p>
<br/> <br/>
<hr/>
<table style="width:100%;">
<colgroup>
<col width="28%" />
<col width="42%" />
<col width="28%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><a href="02-QCandFiltering.html">Previous
lesson</a></th>
<th align="center"><a href="#top">Top of this lesson</a></th>
<th align="right"><a href="04-PCAandIntegration.html">Next
lesson</a></th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiTm9ybWFsaXphdGlvbiIKYXV0aG9yOiAiVU0gQmlvaW5mb3JtYXRpY3MgQ29yZSIKZGF0ZTogImByIFN5cy5EYXRlKClgIgpvdXRwdXQ6CiAgICAgICAgaHRtbF9kb2N1bWVudDoKICAgICAgICAgICAgaW5jbHVkZXM6CiAgICAgICAgICAgICAgICBpbl9oZWFkZXI6IGhlYWRlci5odG1sCiAgICAgICAgICAgIHRoZW1lOiBwYXBlcgogICAgICAgICAgICB0b2M6IHRydWUKICAgICAgICAgICAgdG9jX2RlcHRoOiA0CiAgICAgICAgICAgIHRvY19mbG9hdDogdHJ1ZQogICAgICAgICAgICBudW1iZXJfc2VjdGlvbnM6IGZhbHNlCiAgICAgICAgICAgIGZpZ19jYXB0aW9uOiB0cnVlCiAgICAgICAgICAgIG1hcmtkb3duOiBHRk0KICAgICAgICAgICAgY29kZV9kb3dubG9hZDogdHJ1ZQotLS0KCjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+CmJvZHksIHRkIHsKICAgZm9udC1zaXplOiAxOHB4Owp9CmNvZGUucnsKICBmb250LXNpemU6IDEycHg7Cn0KcHJlIHsKICBmb250LXNpemU6IDEycHgKfQo8L3N0eWxlPgoKYGBge3IsIGluY2x1ZGUgPSBGQUxTRX0Kc291cmNlKCIuLi9iaW4vY2h1bmstb3B0aW9ucy5SIikKa25pdHJfZmlnX3BhdGgoIlhYIikKYGBgCgojIFdvcmtmbG93IE92ZXJ2aWV3IHsudW5saXN0ZWQgLnVubnVtYmVyZWR9Cgo8YnIvPgo8aW1nIHNyYz0iaW1hZ2VzL3dheWZpbmRlci93YXlmaW5kZXIucG5nIiBhbHQ9IndheWZpbmRlciIgc3R5bGU9ImhlaWdodDogNDAwcHg7Ii8+Cjxici8+Cjxici8+IAoKIyBJbnRyb2R1Y3Rpb24gCgpBZnRlciByZW1vdmluZyBsb3ctcXVhbGl0eSBjZWxscyBmcm9tIHRoZSBkYXRhLCB0aGUgbmV4dCB0YXNrIGlzIHRoZSBub3JtYWxpemF0aW9uIGFuZCB2YXJpYW5jZSBzdGFiaWxpemlhdGlvbiBvZiB0aGUgY291bnRzIGZvciBkb3duc3RyZWFtIGFuYWx5c2lzLiBWYXJpYXRpb24gaW4gc2NSTkEtc2VxIGRhdGEgY29tZXMgZnJvbSBib3RoIGJpb2xvZ2ljYWwgYW5kIHRlY2huaWNhbCBzb3VyY2VzLiBJdCBpcyBpbXBvcnRhbnQgdG8gY29udHJvbCBmb3IgdGhlIHRlY2huaWNhbCBzb3VyY2VzIG9mIHZhcmlhdGlvbiBhcyBtdWNoIGFzIHBvc3NpYmxlLCB3aXRob3V0IHJlbW92aW5nIHRoZSBiaW9sb2dpY2FsIHNvdXJjZXMgb2YgdmFyaWF0aW9uLgoKQmlvbG9naWNhbCB2YXJpYXRpb24gaXMgcmVsYXRlZCB0byBkaWZmZXJlbmNlcyBpbiBjZWxsIHR5cGUgYW5kIHN0YXRlLCBhbmQgY2FuIGhlbHAgYW5zd2VyIGJpb2xvZ2ljYWxseSBtZWFuaW5nZnVsIHF1ZXN0aW9ucy4gV2hlcmVhcyB0ZWNobmljYWwgdmFyaWF0aW9uIG1heSBhcmlzZSBmcm9tIGZsdWN0dWF0aW9ucyBpbiBjZWxsdWxhciBSTkEgY29udGVudCwgZWZmaWNpZW5jeSBpbiBseXNpcyBhbmQgcmV2ZXJzZSB0cmFuc2NyaXB0aW9uLCBhbmQgc3RvY2hhc3RpYyBzYW1wbGluZyBkdXJpbmcgc2VxdWVuY2luZy4KCkEga2V5IGRyaXZlciBvZiB0ZWNobmljYWwgdmFyaWF0aW9uIGlzIGNlbGx1bGFyIHNlcXVlbmNpbmcgZGVwdGggKHRoYXQgaXMsIHRoZSBudW1iZXIgb2YgVU1JcyBzZXF1ZW5jZWQgcGVyIGNlbGwpLiBUaGUga25vd24gcmVsYXRpb25zaGlwIGJldHdlZW4gZ2VuZSBhYnVuZGFuY2UgYW5kIGdlbmUgdmFyaWFuY2UgaXMgYWxzbyBhbiBpbXBvcnRhbnQgZmFjdG9yIHRvIGFjY291bnQgZm9yLiBXaGlsZSBtZXRob2RzIGV4aXN0IHRvIGFkZHJlc3MgdGhlc2UgaXNzdWVzIGluIGJ1bGsgUk5BLXNlcSwgdGhlIHNwYXJzaXR5IG9mIHNjUk5BLXNlcSBkYXRhIHByZXNlbnRzIGNoYWxsZW5nZXMgdG8gZXhpc3RpbmcgbWV0aG9kcy4KCiMjIE9iamVjdGl2ZXMKCi0gVW5kZXJzdGFuZCB3aHkgbm9ybWFsaXphdGlvbiBpcyBuZWVkZWQuCi0gVW5kZXJzdGFuZCBub3JtYWxpemF0aW9uIG9wdGlvbnMuCi0gTm9ybWFsaXplIHRoZSBjb3VudHMgd2l0aCBgU0NUcmFuc2Zvcm0oKWAuCgotLS0KCiMgTm9ybWFsaXphdGlvbgoKV2Ugd2lsbCB1c2UgdGhlIGBTQ1RyYW5zZm9ybSgpYCBmdW5jdGlvbiwgd2hpY2ggdXNlcyBhIGdlbmVyYWxpemVkIGxpbmVhciBtb2RlbCAoR0xNKSBmcmFtZXdvcmsgdG8gYWNjb3VudCBmb3IgY2VsbC1sZXZlbCBzZXF1ZW5jaW5nIGRlcHRoIHdoaWxlIGFsc28gc3RhYmlsaXppbmcgdGhlIHZhcmlhbmNlIG9mIHRoZSBjb3VudHMuIExldCdzIGdldCB0aGUgbm9ybWFsaXphdGlvbiBzdGFydGVkLCBhcyBpdCB0YWtlcyBhIGxpdHRsZSB0aW1lLCBhbmQgdGhlbiB3ZSBjYW4gZXhwbGFpbiB3aGF0IGl0J3MgZG9pbmcgYW5kIHdoeSBpdCBpcyBhbiBpbXByb3ZlbWVudCBvbiBhbHRlcm5hdGUgbWV0aG9kcy4KCkZpcnN0LCB3ZSdsbCBydW4gdGhlIGZvbGxvd2luZyBjb21tYW5kIHRvIHNlcGFyYXRlIHRoZSBkYXRhIGZyb20gZWFjaCBzYW1wbGUgaW50byBsYXllcnMsIGEgcmVxdWlyZW1lbnQgb2YgU2V1cmF0IHY1OgoKYGBge3IsIGV2YWwgPSBGQUxTRX0KZ2VvX3NvW1snUk5BJ11dID0gc3BsaXQoZ2VvX3NvW1snUk5BJ11dLCBmID0gZ2VvX3NvJG9yaWcuaWRlbnQpCmdlb19zbwpgYGAKfn5+CkFuIG9iamVjdCBvZiBjbGFzcyBTZXVyYXQgCjI2NDg5IGZlYXR1cmVzIGFjcm9zcyAyOTYxNSBzYW1wbGVzIHdpdGhpbiAxIGFzc2F5IApBY3RpdmUgYXNzYXk6IFJOQSAoMjY0ODkgZmVhdHVyZXMsIDAgdmFyaWFibGUgZmVhdHVyZXMpCiAxMiBsYXllcnMgcHJlc2VudDogY291bnRzLkhPLkRheTAucmVwbGljYXRlMSwgY291bnRzLkhPLkRheTAucmVwbGljYXRlMiwgY291bnRzLkhPLkRheTAucmVwbGljYXRlMywgY291bnRzLkhPLkRheTAucmVwbGljYXRlNCwgY291bnRzLkhPLkRheTIxLnJlcGxpY2F0ZTEsIGNvdW50cy5ITy5EYXkyMS5yZXBsaWNhdGUyLCBjb3VudHMuSE8uRGF5MjEucmVwbGljYXRlMywgY291bnRzLkhPLkRheTIxLnJlcGxpY2F0ZTQsIGNvdW50cy5ITy5EYXk3LnJlcGxpY2F0ZTEsIGNvdW50cy5ITy5EYXk3LnJlcGxpY2F0ZTIsIGNvdW50cy5ITy5EYXk3LnJlcGxpY2F0ZTMsIGNvdW50cy5ITy5EYXk3LnJlcGxpY2F0ZTQKfn5+CgpXZSBzZWUgdGhlIDEyIGxheWVycyBjb250YWluaW5nIHRoZSBjb3VudCBkYXRhIGZvciBlYWNoIG9mIHRoZSBzYW1wbGVzLiBOZXh0LCBydW4gYFNDVHJhbnNmb3JtKClgOgoKYGBge3IsIGV2YWwgPSBGQUxTRX0KZ2VvX3NvID0gU0NUcmFuc2Zvcm0oZ2VvX3NvKQpgYGAKCiMjIERldGFpbHMKClRoZSBmdWxsIGRlc2NyaXB0aW9uIGFuZCBqdXN0aWZpY2F0aW9uIG9mIHRoZSBgU0NUcmFuc2Zvcm0oKWAgZnVuY3Rpb24gYXJlIHByb3ZpZGVkIGluIHR3byBleGNlbGxlbnQgcGFwZXJzOgoKLSBIYWZlbWVpc3RlciAmIFNhdGlqYSwgKk5vcm1hbGl6YXRpb24gYW5kIHZhcmlhbmNlIHN0YWJpbGl6YXRpb24gb2Ygc2luZ2xlLWNlbGwgUk5BLXNlcSBkYXRhIHVzaW5nIHJlZ3VsYXJpemVkIG5lZ2F0aXZlIGJpbm9taWFsIHJlZ3Jlc3Npb24qLCAyMDE5LCBHZW5vbWUgQmlvbG9neSAoW2xpbmtdKGh0dHBzOi8vZ2Vub21lYmlvbG9neS5iaW9tZWRjZW50cmFsLmNvbS9hcnRpY2xlcy8xMC4xMTg2L3MxMzA1OS0wMTktMTg3NC0xI2F2YWlsYWJpbGl0eS1vZi1kYXRhLWFuZC1tYXRlcmlhbHMpKQoKLSBDaG91ZGhhcnkgJiBTYXRpamEsICpDb21wYXJpc29uIGFuZCBldmFsdWF0aW9uIG9mIHN0YXRpc3RpY2FsIGVycm9yIG1vZGVscyBmb3Igc2NSTkEtc2VxKiwgMjAyMiwgR2Vub21lIEJpb2xvZ3kgKFtsaW5rXShodHRwczovL2dlbm9tZWJpb2xvZ3kuYmlvbWVkY2VudHJhbC5jb20vYXJ0aWNsZXMvMTAuMTE4Ni9zMTMwNTktMDIxLTAyNTg0LTkpKQoKQ29udGFpbmVkIGluIHRoZSB0aXRsZSBvZiB0aGUgZmlyc3QgcGFwZXIgaXMgdGhlIGtlcm5lbCBvZiB0aGUgYXBwcm9hY2g6ICJyZWd1bGFyaXplZCBuZWdhdGl2ZSBiaW5vbWlhbCByZWdyZXNzaW9uIi4gTGV0J3MgZXhwbGFpbiB0aGUgcGFydHMgb2YgdGhhdCBwaHJhc2UgYXQgYSBoaWdoLWxldmVsLgoKLSAiUmVncmVzc2lvbiIgbWVhbnMgdGhhdCBmb3IgZWFjaCBnZW5lIGluIHRoZSBzY1JOQS1zZXEgZGF0YSwgYSBnZW5lcmFsaXplZCBsaW5lYXIgbW9kZWwgaXMgZml0IHdoZXJlYnkgdGhlIHZlY3RvciBvZiBVTUkgY291bnRzIGZvciB0aGUgZ2VuZSBpcyBlc3RpbWF0ZWQgYnkgYSBsaW5lYXIgZXF1YXRpb24gY29udGFpbmluZyBhbiBpbnRlcmNlcHQgYW5kIHRoZSB2ZWN0b3Igb2Ygc2VxdWVuY2luZyBkZXB0aCBvZiB0aGUgY2VsbHMuIEFzIGEgdGVybSBpbiB0aGUgbW9kZWwsIHRoZSBjZWxsIHNlcXVlbmNpbmcgZGVwdGggY2FuIGJlIGFjY291bnRlZCBmb3IuCgotICJOZWdhdGl2ZSBiaW5vbWlhbCIgcmVmZXJzIHRvIHRoZSBjb3VudHMgYmVpbmcgbW9kZWxlZCB3aXRoIGEgbmVnYXRpdmUgYmlub21pYWwgZGlzdHJpYnV0aW9uLiBJdCBoYXMgYmVlbiBvYnNlcnZlZCBpbiBib3RoIGJ1bGsgYW5kIHNpbmdsZS1jZWxsIFJOQS1zZXEgdGhhdCB0aGUgbWVhbiBhbmQgdmFyaWFuY2Ugb2YgdGhlIGNvdW50IGRhdGEgYXJlIHJlbGF0ZWQgdG8gb25lIGFub3RoZXIuIFB1dCBhbm90aGVyIHdheSwgdGhlIHZhcmlhbmNlIGlzIG5vbi1jb25zdGFudC4gVGhlIG5lZ2F0aXZlIGJpbm9taWFsIGRpc3RyaWJ1dGlvbiBhbGxvd3MgZm9yIHRoZSB2YXJpYW5jZSBvZiB0aGUgY291bnRzIHRvIGJlIGEgZnVuY3Rpb24gb2YgdGhlIG1lYW4gb2YgdGhlIGNvdW50cy4KCi0gIlJlZ3VsYXJpemVkIiByZWZlcnMgdG8gYSBtZXRob2QgdG8gY29uc3RyYWluIHBhcmFtZXRlciBlc3RpbWF0aW9uLiBXaGVuIGNvbXB1dGluZyB0aGUgcGFyYW1ldGVycyBvZiB0aGUgbW9kZWwsIHRoZSBhdXRob3JzIG9ic2VydmVkIHRoYXQgZ2VuZXMgd2l0aCBsb3cgdG8gbW9kZXJhdGUgZXhwcmVzc2lvbiBsZXZlbHMgaGFkIHdpZGVseSByYW5naW5nIG1vZGVsIHBhcmFtZXRlciBlc3RpbWF0ZXMsIGV2ZW4gd2hlbiB0aGUgZ2VuZXMgd2VyZSBzaW1pbGFyIHRvIG9uZSBhbm90aGVyLiBUaGV5IGNvbmNsdWRlZCB0aGlzIHdhcyBhIHJlc3VsdCBvZiBtb2RlbCBvdmVyZml0dGluZy0tbm90IG9mIGJpb2xvZ2ljYWwgb3JpZ2luLS1hbmQgZGVjaWRlZCB0byBjb25zdHJhaW4gdGhlIG1vZGVsIHBhcmFtZXRlcnMgYnkgY29tYmluaW5nIGluZm9ybWF0aW9uIGFjcm9zcyBzaW1pbGFyIGdlbmVzLiBUaGF0IGlzLCByZWd1bGFyaXphdGlvbi4gSW4gdGhpcyB3YXksIHRoZSB2YXJpYW5jZSBvZiB0aGUgZ2VuZSBjb3VudHMgaXMgc3RhYmlsaXplZC4KCkZpbmFsbHksIHRoZSBDaG91ZGhhcnkgJiBTYXRpamEgcGFwZXIgaW50cm9kdWNlZCBhIG1vZGlmaWVkIHZlcnNpb24gb2YgdGhlIHJlZ3VsYXJpemVkIG5lZ2F0aXZlIGJpbm9taWFsIHJlZ3Jlc3Npb24gKGBzY3RyYW5zZm9ybWAgdjIpLiBUaGUgbW9kaWZpY2F0aW9ucyBpbmNsdWRlOgoKLSBUaGUgc2xvcGUgb2YgdGhlIE5CIEdMTSBpcyBmaXhlZCBhdCBhbiBhbmFseXRpY2FsbHkgZGVyaXZlZCBgbG4oMTApYC4gQ29uc2VxdWVudGx5LCBvbmx5IHRoZSBpbnRlcmNlcHQgYW5kIG92ZXJkaXNwZXJzaW9uIHBhcmFtZXRlcnMgcmVtYWluIHRvIGJlIGVzdGltYXRlZCBmb3IgZWFjaCBnZW5lLgoKLSBHZW5lcyB3aXRoIHZlcnkgbG93IGV4cHJlc3Npb24gb3Igd2l0aCB2YXJpYW5jZSBsZXNzIHRoYW4gdGhlIG1lYW4gaGF2ZSB0aGVpciBkaXNwZXJzaW9uIHBhcmFtZXRlcnMgc2V0IHRvIGluZmluaXR5LCBlc3NlbnRpYWxseSByZXZlcnRpbmcgdG8gYSBQb2lzc29uIGNvdW50IGRpc3RyaWJ1dGlvbi4KCi0gQSBsb3dlciBib3VuZCBvbiB0aGUgbWluaW11bSB2YXJpYW5jZSBpcyB1c2VkIHRvIHByZXZlbnQgZ2VuZXMgd2l0aCB2ZXJ5IGxvdyBVTUkgY291bnRzIGZyb20gYmVpbmcgZ2l2ZW4gdmVyeSBoaWdoIG5vcm1hbGl6ZWQgZXhwcmVzc2lvbiB2YWx1ZXMuCgpBZGRpdGlvbmFsbHksIHRoZSBiZW5lZml0IG9mIHRoZSBHTE0gZnJhbWV3b3JrIGZvciBub3JtYWxpemF0aW9uIGFuZCB2YXJpYW5jZSBzdGFiaWxpemF0aW9uIGlzIHRoYXQgdGhlIEdMTSBjYW4gaW5jbHVkZSBvdGhlciB0ZXJtcyB3aGljaCBjYW4gYWNjb3VudCBmb3IgdW53YW50ZWQgdGVjaG5pY2FsIHZhcmlhdGlvbi4gT25lIGV4YW1wbGUgb2YgdGhpcyBpcyB0aGUgcGVyY2VudCBtaXRvY2hvbmRyaWFsIHJlYWRzIChgcGVyY2VudC5tdGApLiBUaGUgYHZhcnMudG8ucmVncmVzc2AgcGFyYW1ldGVyIG9mIGBTQ1RyYW5zZm9ybSgpYCBpcyB1c2VkIGZvciB0aGlzIHB1cnBvc2UuIFNlZSB0aGUgW2RvY3VtZW50YXRpb25dKGh0dHBzOi8vc2F0aWphbGFiLm9yZy9zZXVyYXQvcmVmZXJlbmNlL3NjdHJhbnNmb3JtKSBmb3IgZGV0YWlscy4KCiMjIE90aGVyIG5vcm1hbGl6YXRpb25zCgpGcm9tIHRoZSBTZXVyYXQgZG9jdW1lbnRhdGlvbiwgdGhlIGBTQ1RyYW5zZm9ybSgpYCBmdW5jdGlvbiAicmVwbGFjZXMgYE5vcm1hbGl6ZURhdGEoKWAsIGBTY2FsZURhdGEoKWAsIGFuZCBgRmluZFZhcmlhYmxlRmVhdHVyZXMoKWAiLiBUaGlzIGNoYWluIG9mIGZ1bmN0aW9ucyBpcyByZWZlcnJlZCB0byBhcyB0aGUgImxvZy1ub3JtYWxpemF0aW9uIHByb2NlZHVyZSIuIFlvdSBtYXkgc2VlIHRoZXNlIHRocmVlIGNvbW1hbmRzIGluIG90aGVyIHZpZ25ldHRlcywgYW5kIGV2ZW4gaW4gb3RoZXIgU2V1cmF0IHZpZ25ldHRlcyAoW3NvdXJjZV0oaHR0cHM6Ly9zYXRpamFsYWIub3JnL3NldXJhdC9hcnRpY2xlcy9zY3RyYW5zZm9ybV92aWduZXR0ZSkpLiBJbiB0aGUgdHdvIHBhcGVycyByZWZlcmVuY2VkIGFib3ZlLCB0aGUgYXV0aG9ycyBzaG93IGhvdyB0aGUgbG9nLW5vcm1hbGl6YXRpb24gcHJvY2VkdXJlIGRvZXMgbm90IGFsd2F5cyBmdWxseSBhY2NvdW50IGZvciBjZWxsIHNlcXVlbmNpbmcgZGVwdGggYW5kIG92ZXJkaXNwZXJzaW9uLiBUaGVyZWZvcmUsIHdlIHVyZ2UgeW91IHRvIHVzZSB0aGlzIGFsdGVybmF0aXZlIHBpcGVsaW5lIHdpdGggY2F1dGlvbi4KCiMgTm9ybWFsaXphdGlvbiwgY29udGludWVkCgpCeSBub3csIGBTQ1RyYW5zZm9ybSgpYCBzaG91bGQgaGF2ZSBmaW5pc2hlZCBydW5uaW5nLCBzbyBsZXQncyB0YWtlIGEgbG9vayBhdCB0aGUgcmVzdWx0OgoKYGBge3IsIGV2YWwgPSBGQUxTRX0KZ2VvX3NvCmBgYAp+fn4KQW4gb2JqZWN0IG9mIGNsYXNzIFNldXJhdCAKNDcwMzcgZmVhdHVyZXMgYWNyb3NzIDI5NjE1IHNhbXBsZXMgd2l0aGluIDIgYXNzYXlzIApBY3RpdmUgYXNzYXk6IFNDVCAoMjA1NDggZmVhdHVyZXMsIDMwMDAgdmFyaWFibGUgZmVhdHVyZXMpCiAzIGxheWVycyBwcmVzZW50OiBjb3VudHMsIGRhdGEsIHNjYWxlLmRhdGEKIDEgb3RoZXIgYXNzYXkgcHJlc2VudDogUk5BCn5+fgoKV2Ugb2JzZXJ2ZSB0aGF0IHRoZSBhY3RpdmUgYXNzYXkgaXMgbm93ICJTQ1QiLCBidXQgdGhhdCB0aGUgIlJOQSIgYXNzYXkgaXMgc3RpbGwgcHJlc2VudC4gYFNDVHJhbnNmb3JtKClgIGhhcyBhbHNvIGRldGVybWluZWQgdGhlIGNvbW1vbiB2YXJpYWJsZSBmZWF0dXJlcyBhY3Jvc3MgdGhlIGNlbGxzIHRvIGJlIHVzZWQgaW4gb3VyIGRvd25zdHJlYW0gYW5hbHlzaXMuCgojIFNhdmUgdGhlIFNldXJhdCBvYmplY3QKCkxldCdzIHNhdmUgdGhpcyBub3JtYWxpemVkIGZvcm0gb2Ygb3VyIFNldXJhdCBvYmplY3QuCgpgYGB7ciwgZXZhbCA9IEZBTFNFfQpzYXZlUkRTKG9iamVjdCA9IGdlb19zbywgZmlsZSA9ICdyZXN1bHRzL3JkYXRhL2dlb19zb19zY3Rfbm9ybWFsaXplZC5yZHMnKQpgYGAKCiMgU3VtbWFyeQoKSW4gdGhpcyBzZWN0aW9uIHdlIGhhdmUgcnVuIHRoZSBgU0NUcmFuc2Zvcm0oKWAgZnVuY3Rpb24gdG8gYWNjb3VudCBmb3IgdmFyaWF0aW9uIGluIGNlbGwgc2VxdWVuY2luZyBkZXB0aCBhbmQgdG8gc3RhYmlsaXplIHRoZSB2YXJpYW5jZSBvZiB0aGUgY291bnRzLiAKCk5leHQgc3RlcHM6IFBDQSBhbmQgaW50ZWdyYXRpb24KCi0tLS0KClRoZXNlIG1hdGVyaWFscyBoYXZlIGJlZW4gYWRhcHRlZCBhbmQgZXh0ZW5kZWQgZnJvbSBtYXRlcmlhbHMgbGlzdGVkIGFib3ZlLiBUaGVzZSBhcmUgb3BlbiBhY2Nlc3MgbWF0ZXJpYWxzIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgW0NyZWF0aXZlIENvbW1vbnMgQXR0cmlidXRpb24gbGljZW5zZSAoQ0MgQlkgNC4wKV0oaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnkvNC4wLyksIHdoaWNoIHBlcm1pdHMgdW5yZXN0cmljdGVkIHVzZSwgZGlzdHJpYnV0aW9uLCBhbmQgcmVwcm9kdWN0aW9uIGluIGFueSBtZWRpdW0sIHByb3ZpZGVkIHRoZSBvcmlnaW5hbCBhdXRob3IgYW5kIHNvdXJjZSBhcmUgY3JlZGl0ZWQuCgo8YnIvPgo8YnIvPgo8aHIvPgp8IFtQcmV2aW91cyBsZXNzb25dKDAyLVFDYW5kRmlsdGVyaW5nLmh0bWwpIHwgW1RvcCBvZiB0aGlzIGxlc3Nvbl0oI3RvcCkgfCBbTmV4dCBsZXNzb25dKDA0LVBDQWFuZEludGVncmF0aW9uLmh0bWwpIHwKfCA6LS0tIHwgOi0tLS06IHwgLS0tOiB8CgoKCgo=</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("03-Normalization.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
