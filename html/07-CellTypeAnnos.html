<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="UM Bioinformatics Core" />

<meta name="date" content="2024-10-22" />

<title>Cell Type Annotation</title>

<script src="site_libs/header-attrs-2.28/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>
<!--
Favicon dervied from
https://twemoji.twitter.com/
https://favicon.io/emoji-favicons/dna/
-->
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="shortcut icon" href="favicon-16x16.png" />
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Intro to scRNA-Seq</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="workshop_intro.html">Intro</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 1
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="00A-OrientingOnScRNASeq.html">Orienting on scRNA-Seq</a>
    </li>
    <li>
      <a href="01-GettingStarted.html">Getting Started with Seurat</a>
    </li>
    <li>
      <a href="00B-CellRangerInAction.html">Cell Ranger in Action</a>
    </li>
    <li>
      <a href="02-QCandFiltering.html">Secondary QC &amp; Filtering</a>
    </li>
    <li>
      <a href="03-Normalization.html">Normalization</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 2
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="04-PCAandIntegration.html">PCA &amp; Integration</a>
    </li>
    <li>
      <a href="05-ProjectionAndClustering.html">Projection &amp; Clustering</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 3
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="06-MarkerVisualization.html">Marker identification and visualization</a>
    </li>
    <li>
      <a href="07-CellTypeAnnos.html">Cell type annotation</a>
    </li>
    <li>
      <a href="08-DifferentialExpression.html">Differential expression analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="workshop_wrap_up.html">Wrap up</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Cell Type Annotation</h1>
<h4 class="author">UM Bioinformatics Core</h4>
<h4 class="date">2024-10-22</h4>

</div>


<style type="text/css">
body, td {
   font-size: 18px;
}
code.r{
  font-size: 12px;
}
pre {
  font-size: 12px
}

table.fig, th.fig, td.fig {
  border: 1px solid black;
  border-collapse: collapse;
  padding: 15px;
}
</style>
<script>
  addClassKlippyTo("pre.r, pre.markdown, pre.bash");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<div id="workflow-overview" class="section level1 unlisted unnumbered">
<h1 class="unlisted unnumbered">Workflow Overview</h1>
<p><br/>
<img src="images/wayfinder/wayfinder.png" alt="wayfinder" style="height: 400px;"/>
<br/> <br/></p>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>A frequent bottleneck in the single-cell RNA-seq analysis workflow is
annotating our clustering results, as it requires bridging the gap
between the data and prior knowledge (<a
href="https://bioconductor.org/books/3.15/OSCA.basic/cell-type-annotation.html">source</a>).
While generating markers for each cluster and evaluating the expression
of known marker genes is important, it may or may not be sufficient to
assign cell-type or sub-type labels.</p>
<table class="fig">
<tr class="fig">
<td class="fig">
<img
src="images/graphical_abstracts/graphical_abstract_annotation.png" />
</td>
</tr>
<tr class="fig">
<td class="fig">
For each cell-type (A), the marker genes we derived in the prior step
(B) are compared with known marker genes for different cell types (C).
Concordance between derived marker genes and known cell markers produces
a suggested annotation for that cell type.
</td>
</tr>
</table>
<p>In this section, our goal is to use an automated annotation tool to
generate cell type predictions for our clusters.</p>
<p>Like the previous sections, the process to assign cell-types to
clusters can be very iterative. In addition, the steps to reach a
“Figure 1” level of labeled clusters may not be presented in detail, can
be very dataset dependent, and often is more challenging for less
characterized tissues.</p>
<div id="objectives" class="section level2">
<h2>Objectives</h2>
<ul>
<li>Understand the complexities of cell-type annotation<br />
</li>
<li>Use <code>scCATCH</code> cell-type predictions to annotate our
clusters</li>
</ul>
<hr />
</div>
</div>
<div id="cell-type-predictions" class="section level1">
<h1>Cell type predictions</h1>
<p>Automated tools have the advantage of being able to compare between
the expression patterns in our dataset and large numbers of reference
datasets or databases at a scale that is not feasible to do
manually.</p>
<p>As described <a
href="https://ouyanglab.com/singlecell/clust.html#annotating-clusters">in
more detail by the Ouyang Lab</a> and summarized in the figure below,
there are many computational tools that aim to assign cell type labels
for single-cell data. These methods generally fall into three
categories:</p>
<ol style="list-style-type: decimal">
<li>Marker based approaches that use gene sets drawn from the
literature, including previous single-cell studies,</li>
<li>Correlation based approaches that estimate the similarity between
the cells or clusters in the input data and some reference data</li>
<li>Machine learning approaches that include training on a single-cell
reference atlas.</li>
</ol>
<div class="float">
<img
src="images/curriculum/07-CellTypeAnnotation/Ouyang_clust-celltype.png"
alt="Image: Diagram of types of cell annotation approaches (from Oyang materials)." />
<div class="figcaption">Image: Diagram of types of cell annotation
approaches (from Oyang materials).</div>
</div>
<p>However, across any of these approaches the quality of the reference
data (and reliability of the authors labels) and relevancy to your
specific tissue/experiment (and the resolution of your biological
question) is crucial. Additionally, it’s important to consider that rare
or novel cell populations may not be present or well-characterized in
available references and that even after filtering, some clusters might
correspond to stressed or dying cells and not a particular cell-type or
subtype. Therefore, any prediction should be reviewed and considered in
the context both marker gene expression for the dataset and knowledge of
the biological system and broader literature.</p>
<p>Some tools and references are available solely or primarily for human
tissues (and not mouse or rat), particular for tissues other than PBMCs
and the brain. For human data, if a relevant reference is available for
your experiment, we would recommend trying <a
href="https://azimuth.hubmapconsortium.org/">Azimuth (created by authors
of Seurat)</a>. <a
href="https://www.10xgenomics.com/analysis-guides/automated-cell-type-annotation-from-r-to-loupe-using-louper">10x
has a tutorial</a> that includes example of using Azimuth, including a
feature of the tool that allows for first pass of cell-type assignment
of more common cell-types followed by identifying rarer populations that
may not be identified in the first pass.</p>
<details>
<summary>
<em>Additional automated annotation resources</em>
</summary>
Automated cell-type annotation is an active area of research and
development and many other tools and resources are available, including
<a
href="https://bioconductor.org/books/3.15/OSCA.basic/cell-type-annotation.html">OSCA’s
demonstration of the SingleR method</a>, a <a
href="https://pubmed.ncbi.nlm.nih.gov/34031612/">Tutorial by Clarke et
al. for cell-type annotations</a>, and an <a
href="https://www.sc-best-practices.org/cellular_structure/annotation.html#automated-annotation">entire
chapter of the SC best practices book</a>.
</details>
<p><br></p>
</div>
<div id="using-sccatch" class="section level1">
<h1>Using scCATCH</h1>
<p>A tool we often use for both mouse and human data cell-type
predictions is called <a
href="https://github.com/ZJUFanLab/scCATCH/wiki">scCATCH</a> which, per
the author’s description in <a
href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7031312/">Shao et al
(2020)</a>, annotates cell-types using a “tissue-specific cellular
taxonomy reference database (CellMatch) and [an] evidence-based scoring
(ES) protocol”. The CellMatch reference is compiled from CellMarker (<a
href="https://www.cell.com/servlet/linkout?suffix=e_1_5_1_2_33_2&amp;dbid=8&amp;doi=10.1016/j.isci.2020.100882&amp;key=30289549&amp;cf=">Zhang
et al., 2019b</a>), MCA (<a
href="https://www.cell.com/servlet/linkout?suffix=e_1_5_1_2_10_2&amp;dbid=8&amp;doi=10.1016/j.isci.2020.100882&amp;key=29775597&amp;cf=">Han
et al., 2018</a>), CancerSEA (<a
href="https://www.cell.com/servlet/linkout?suffix=e_1_5_1_2_29_2&amp;dbid=8&amp;doi=10.1016/j.isci.2020.100882&amp;key=30329142&amp;cf=">Yuan
et al., 2019</a>), and the <a
href="https://www.abcam.com/primary-antibodies/human-cd-antigen-guide">CD
Marker Handbook</a> and PMIDs for relevant literature are reported in
the prediction results.</p>
<!-- consider adding [scType](https://cran.r-project.org/web/packages/scCATCH/vignettes/tutorial.html) as an alternative -->
<div class="float">
<img
src="images/curriculum/07-CellTypeAnnotation/scCATCH-paper-VizAbstract.jpeg"
alt="Image: scCATCH summary from Shao et al (2020)." />
<div class="figcaption">Image: scCATCH summary from Shao et al
(2020).</div>
</div>
<p>First, we need to load the scCATCH library. Then, we’ll double check
that we are using the expected resolution cluster results (this is
particularly important if we generated multiple resolutions in our
clustering steps), before creating a new object from our
<code>counts</code> data with <code>createscCATCH()</code> and adding
our marker genes to the scCATCCH object.</p>
<p>To increase the speed and accuracy of our predictions, we’ll create
query of relevant tissues (which requires some prior knowledge of the
experiment and using the <a
href="https://github.com/ZJUFanLab/scCATCH/wiki">scCATCH wiki</a> to
select tissues from the species) before we run the tool:</p>
<pre class="r"><code>##### Day 3 - Cell Type Annotation

# Annotate clusters using scCATCH  ----------------------------------------
library(scCATCH)

# check that cell identities are set to expected resolution 
all(Idents(geo_so) == geo_so$integrated.sct.rpca.clusters)</code></pre>
<pre><code>[1] TRUE</code></pre>
<pre class="r"><code># create scCATCH object, using count data
geo_catch = createscCATCH(data = geo_so@assays$SCT@counts, cluster = as.character(Idents(geo_so)))

# add marker genes to use for predictions
geo_catch@markergene = geo_markers

# specify tissues/cell-types from the scCATCH reference
geo_catch@marker = cellmatch[cellmatch$species == &#39;Mouse&#39; &amp; cellmatch$tissue %in% c(&#39;Blood&#39;, &#39;Peripheral Blood&#39;, &#39;Muscle&#39;, &#39;Skeletal muscle&#39;, &#39;Epidermis&#39;, &#39;Skin&#39;), ]

# run scCATCH to generate predictions
geo_catch = findcelltype(geo_catch)

# look at the predictions
geo_catch@celltype %&gt;% select(cluster, cell_type, celltype_score)</code></pre>
<pre><code>   cluster                                 cell_type   celltype_score
1        0                                  Pericyte             0.75
2        1                   Hematopoietic Stem Cell             0.86
3        2                    Muscle Progenitor Cell             0.71
4        3                                Macrophage             0.82
5        4                                  Monocyte             0.82
6        5                            Dendritic Cell             0.86
7        6                                 Stem Cell             0.88
8        7                   Hematopoietic Stem Cell              0.9
9        8                   Hematopoietic Stem Cell             0.91
10       9                   Hematopoietic Stem Cell             0.86
11      10                            Dendritic Cell             0.84
12      11                         Regulatory T Cell              0.9
13      12                            Dendritic Cell             0.85
14      13                     Muscle Satellite Cell             0.94
15      14 Dendritic Cell, Monocyte, Progenitor Cell 0.71, 0.71, 0.71
16      15                   Hematopoietic Stem Cell             0.87
17      16                                 Stem Cell             0.84
18      17                               CD8+ T Cell             0.88
19      18                   Hematopoietic Stem Cell             0.87
20      19                               Muscle Cell             0.69</code></pre>
<p>When we look at our results we can see the cell type score, which
gives us an idea of the confidence of that prediction. Not shown here
but the full <code>celltype</code> table also includes marker genes and
PMIDs for relevant literature for each prediction.</p>
<p>In our experience, these kinds of results often help guide cluster
annotation but scores can vary and the predictions may need to be
revised based on researcher’s knowledge of the biological system. As
these cell-types correspond to the cell-types and subtypes we’d expect
to be present in these data and most of the prediction scores are quite
high, we can reasonably use these results to annotate our clusters with
some minor adjustments.</p>
<div id="using-known-cell-type-markers" class="section level2">
<h2>Using known cell-type markers</h2>
<p>To confirm and refine the scCATCH predictions, we’ll spot check some
known markers for immune populations. Then we’ll look look at some other
key marker genes from some other relevant resources like <a
href="https://www.nature.com/articles/s41467-021-27563-3">Chen et al
(2021)</a>, <a
href="https://www.nature.com/articles/s41586-021-03549-5">Buechler et al
(2021)</a> <a
href="https://pmc.ncbi.nlm.nih.gov/articles/PMC10296409/#sec3-biomolecules-13-00945">Roman
(2023)</a>, <a
href="https://bmcbioinformatics.biomedcentral.com/articles/10.1186/s12859-022-04817-5/figures/2">Li
et al (2022)</a> and <a
href="https://ashpublications.org/blood/article/128/8/e20/35749/A-single-cell-resolution-map-of-mouse">Nestorowa
et al (2016)</a> to see if other modifications should be made to the
scCATCH predictions:</p>
<pre class="r"><code># Plot other markers/features to assist with identification ---------------
# spot check known immune markers
immune_markers = list()
immune_markers[[&#39;Inflam. Macrophage&#39;]] = c(&#39;Cd14&#39;, &#39;Cxcl2&#39;) # Cd14 a- monocyte/macrophage cells
immune_markers[[&#39;Platelet&#39;]] = c(&#39;Pf4&#39;)
immune_markers[[&#39;Mast cells&#39;]] = c(&#39;Gata2&#39;, &#39;Kit&#39;)
immune_markers[[&#39;NK cells&#39;]] = c(&#39;Nkg7&#39;, &#39;Klrd1&#39;)
immune_markers[[&#39;B-cell&#39;]] = c( &#39;Ly6d&#39;, &#39;Cd19&#39;, &#39;Cd79b&#39;, &#39;Ms4a1&#39;)
immune_markers[[&#39;T-cell&#39;]] = c( &#39;Cd3d&#39;,&#39;Cd3e&#39;,&#39;Cd3g&#39;) # also Thy1

immune_markers_plot = DotPlot(geo_so, features = immune_markers, assay = &#39;SCT&#39;)  +
  theme(text=element_text(size=10), axis.text.x = element_text(angle = 45, vjust = 0.5))</code></pre>
<pre><code>Warning: The `facets` argument of `facet_grid()` is deprecated as of ggplot2 2.2.0.
ℹ Please use the `rows` argument instead.
ℹ The deprecated feature was likely used in the Seurat package.
  Please report the issue at &lt;https://github.com/satijalab/seurat/issues&gt;.
This warning is displayed once every 8 hours.
Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<pre class="r"><code>immune_markers_plot

# save to file
ggsave(filename = &#39;results/figures/immune_markers_sct_dot_plot.png&#39;, plot = immune_markers_plot, width = 10, height = 5, units = &#39;in&#39;)

# plot some known cell-type markers 
other_markers = list()
other_markers[[&#39;Pericyte&#39;]] = c(&#39;Acan&#39;,&#39;Sox9&#39;)
other_markers[[&#39;SMC&#39;]] = c(&#39;Acta2&#39;, &#39;Myh11&#39;) # SMC = mesenchymal smooth-muscle cell/mesenchymal lineage
other_markers[[&#39;Keratinocytes&#39;]] = c(&#39;Thy1&#39;, &#39;Dlk1&#39;) # fibro progenitors aso=Thy1
other_markers[[&#39;Myofibroblasts&#39;]] = c(&#39;Tmem100&#39;, &#39;Cd34&#39;, &#39;Ly6c1&#39;) # hematopoetic stem/activated fibroblast=Cd34
other_markers[[&#39;Fibroblast&#39;]] = c(&#39;Dpt&#39;, &#39;Fn1&#39;, &#39;Col3a1&#39;)  # activated fib = Fn1
other_markers[[&#39;Endothelial&#39;]] = c(&#39;Pecam1&#39;, &#39;Cd38&#39;) # from wound healing; Pecam1 also exp in endothelial
other_markers[[&#39;HSC&#39;]] = c(&#39;Ltb&#39;, &#39;Cd74&#39;) # less well defined/conflicting definitions
other_markers[[&#39;Erythroid&#39;]] = c(&#39;Hba-a1&#39;)

other_markers_dot_plot = DotPlot(geo_so, features = other_markers, assay = &#39;SCT&#39;) +
  theme(text=element_text(size=10), axis.text.x = element_text(angle = 45, vjust = 0.5))
other_markers_dot_plot

# save to file
ggsave(filename = &#39;results/figures/other_markers_sct_dot_plot.png&#39;, plot = other_markers_dot_plot, width = 12, height = 5, units = &#39;in&#39;)</code></pre>
<p><img src="images/curriculum/07-CellTypeAnnotation/07-marker_gene_check-1.png" width="816" style="display: block; margin: auto;" /><img src="images/curriculum/07-CellTypeAnnotation/07-marker_gene_check-2.png" width="816" style="display: block; margin: auto;" />
In the first plot, B-cell and T-cell markers seem to line up with the
predictions and are limited to single clusters. However, macrophage and
dendrocyte markers match to multiple clusters including some annotated
with different cell types, so we can consider modifying those cluster
labels.</p>
<p>From the other marker genes, the patterns are less clear so we may
want to test other clustering parameters and discuss the results with a
researcher familiar with the expected cell types. However, we can notice
some patterns that we can use to refine our cluster annotations.</p>
<div id="utilizing-genes-of-interest-from-the-original-paper"
class="section level4">
<h4>Utilizing genes of interest from the original paper</h4>
<details>
<summary>
<em>Plotting the expression of genes of interest from Sorkin, Huber et
al</em>
</summary>
<p>Often we have prior information about what cell types are expected in
our samples and key marker genes for those populations. This can be an
important part of evaluating our clusters, since if genes that are known
markers for a specific cell type are found in too many or too few
clusters as that can suggest that re-clustering is needed or that some
of the clusters should be manually combined before annotating. We can
create lists of markers used in figures from the <a
href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7002453/">original
paper</a> before using the same <code>DotPlot()</code> function to
visualize the expression level and frequency of these genes in our
current clusters:</p>
<pre class="r"><code># Visualize manually selected marker genes --------------------------------
# Create lists of genes from paper 
fig1g_markers = c(&#39;Cxcl1&#39;, &#39;Cxcl2&#39;, &#39;Ccl2&#39;, &#39;Ccl3&#39;, &#39;Ccl4&#39;, &#39;Il1b&#39;, &#39;Il6b&#39;, &#39;Tnf&#39;, &#39;Tgfb1&#39;, &#39;Tgfb2&#39;, &#39;Tgfb3&#39;, &#39;Cxcl5&#39;)
fig1h_markers = c(&#39;Cxcr2&#39;, &#39;Csf1r&#39;, &#39;Csf3r&#39;, &#39;Tgfbr1&#39;, &#39;Tgfbr3&#39;, &#39;Il1r1&#39;, &#39;Il6ra&#39;, &#39;Lifr&#39;, &#39;Tgfbr2&#39;)

# create DotPlots for genes from paper
fig1g_sct_dot_plot = DotPlot(geo_so, features = fig1g_markers, assay = &#39;SCT&#39;)</code></pre>
<pre><code>Warning: The following requested variables were not found: Il6b</code></pre>
<pre class="r"><code>fig1h_sct_dot_plot = DotPlot(geo_so, features = fig1h_markers, assay = &#39;SCT&#39;)

fig1g_sct_dot_plot
fig1h_sct_dot_plot

# save plots to file
ggsave(filename = &#39;results/figures/markers_fig1g_sct_dot_plot.png&#39;, plot = fig1g_sct_dot_plot, width = 8, height = 6, units = &#39;in&#39;)
ggsave(filename = &#39;results/figures/markers_fig1h_sct_dot_plot.png&#39;, plot = fig1h_sct_dot_plot, width = 8, height = 6, units = &#39;in&#39;)</code></pre>
<p><img src="images/curriculum/07-CellTypeAnnotation/07-known_dot_plots_sct-1.png" width="816" style="display: block; margin: auto;" /><img src="images/curriculum/07-CellTypeAnnotation/07-known_dot_plots_sct-2.png" width="816" style="display: block; margin: auto;" />
For known marker genes, it’s important to note that since scRNA-seq is
only measuring transcriptional signals that markers at the protein level
(e.g used for approaches like FACS) may be less effective. An
alternative or complement to using marker genes could be methods like
using gene set enrichment (GSEA) <a
href="https://bioconductor.org/books/3.15/OSCA.basic/cell-type-annotation.html#computing-gene-set-activities">as
demonstrated in the OSCA book</a> to aid in annotations. However, the
book <a
href="https://www.sc-best-practices.org/cellular_structure/annotation.html">“Best
practices for single-cell analysis across modalities” by Heumos, Schaar,
Lance, et al. </a> points out that “it is often useful to work together
with experts … [like a] biologist who has more extensive knowledge of
the tissue, the biology, the expected cell types and markers etc.”. In
our experience, we find that experience and knowledge of the researchers
we work with is invaluable.</p>
</details>
<p><br></p>
<details>
<summary>
<em>Using raw RNA values for genes of interest from Sorkin, Huber et
al</em>
</summary>
<p>We can also generate the same plots, but using the unintegrated data
by specifying the <code>RNA</code> assay:</p>
<pre class="r"><code># Visualize manually selected marker genes (from unintegrated data) ------
rna_dot_plot = DotPlot(geo_so, features = fig1g_markers, assay = &#39;RNA&#39;)
fig1h_rna_dot_plot = DotPlot(geo_so, features = fig1h_markers, assay = &#39;RNA&#39;)

ggsave(filename = &#39;results/figures/markers_fig1g_rna_dot_plot.png&#39;, plot = fig1g_rna_dot_plot, width = 8, height = 6, units = &#39;in&#39;)
ggsave(filename = &#39;results/figures/markers_fig1h_rna_dot_plot.png&#39;, plot = fig1h_rna_dot_plot, width = 8, height = 6, units = &#39;in&#39;)</code></pre>
</details>
<p><br></p>
</div>
</div>
</div>
<div id="annotate-clusters" class="section level1">
<h1>Annotate clusters</h1>
<p>Next, we’ll modify the cell type predictions and add the labels to
our Seurat object to replace our clusters’ numerical identities. Note:
we will create a new metadata object where we join cell types. However,
this will destroy the row names - which will cause a problem in Seurat -
so we have to add them back.
<!--- modify to have a hidden block that runs after to keep this large block intact --></p>
<pre class="r"><code># Annotate clusters using modified predictions ----------------------------
# First - Extract the cell types only from the predictions
celltype_annos = geo_catch@celltype %&gt;% select(cluster, cell_type) %&gt;% 
  mutate(cluster = factor(cluster, levels = c(0:19))) %&gt;% arrange(cluster)
celltype_annos</code></pre>
<pre><code>   cluster                                 cell_type
1        0                                  Pericyte
2        1                   Hematopoietic Stem Cell
3        2                    Muscle Progenitor Cell
4        3                                Macrophage
5        4                                  Monocyte
6        5                            Dendritic Cell
7        6                                 Stem Cell
8        7                   Hematopoietic Stem Cell
9        8                   Hematopoietic Stem Cell
10       9                   Hematopoietic Stem Cell
11      10                            Dendritic Cell
12      11                         Regulatory T Cell
13      12                            Dendritic Cell
14      13                     Muscle Satellite Cell
15      14 Dendritic Cell, Monocyte, Progenitor Cell
16      15                   Hematopoietic Stem Cell
17      16                                 Stem Cell
18      17                               CD8+ T Cell
19      18                   Hematopoietic Stem Cell
20      19                               Muscle Cell</code></pre>
<pre class="r"><code># Customize annotations, remembering that cluster 0 = row 1 in table
celltype_annos$cell_type[c(3,15)] &lt;- &quot;Inflammatory macrophage&quot; # resolves cluster 2 and 14
celltype_annos$cell_type[c(11)] &lt;- &quot;Macrophage&quot;

celltype_annos$cell_type[c(2)] &lt;- &quot;Fibroblast&quot; # revise clusters 1,6 based on markers
celltype_annos$cell_type[c(6)] &lt;- &quot;Myofibroblast&quot;
celltype_annos$cell_type[c(8,9)] &lt;- &quot;Endothelial&quot; # revise cluster 7,8; also have weaker mast cell signal
celltype_annos$cell_type[c(6,13)] &lt;- &quot;Hematopoietic stem cell&quot; # based on markers but could further revise
celltype_annos$cell_type[c(10,19)] &lt;- &quot;Mesenchymal stem/stromal cell&quot; # based on Acta2 signal
celltype_annos$cell_type[c(16)] &lt;- &quot;Erythroid&quot; # cluster 15, less confident but not near other dendritic cells
celltype_annos$cell_type[c(20, 17)] &lt;- &quot;Unknown&quot; # since such small populations, reset cluster 16 &amp; 19 as unknown for now


# Merge cell types in but as a new table to slide into @meta.data
new_metadata = geo_so@meta.data %&gt;% left_join(celltype_annos, by = c(&#39;integrated.sct.rpca.clusters&#39; = &#39;cluster&#39;))
rownames(new_metadata) = rownames(geo_so@meta.data) #  We are implicitly relying on the same row order!

# Replace the meta.data
geo_so@meta.data = new_metadata 

head(geo_so@meta.data)</code></pre>
<pre><code>                                            orig.ident nCount_RNA nFeature_RNA  day  replicate percent.mt nCount_SCT nFeature_SCT integrated.sct.rpca.clusters seurat_clusters unintegrated.sct.pca.clusters
HODay0replicate1_AAACCTGAGAGAACAG-1 HO.Day0.replicate1      10234         3226 Day0 replicate1   1.240962       6062         2867                            1               2                             2
HODay0replicate1_AAACCTGGTCATGCAT-1 HO.Day0.replicate1       3158         1499 Day0 replicate1   7.536415       4607         1509                            1               2                             2
HODay0replicate1_AAACCTGTCAGAGCTT-1 HO.Day0.replicate1      13464         4102 Day0 replicate1   3.112002       5314         2370                            6               2                             2
HODay0replicate1_AAACGGGAGAGACTTA-1 HO.Day0.replicate1        577          346 Day0 replicate1   1.559792       3877         1031                           10               9                             9
HODay0replicate1_AAACGGGAGGCCCGTT-1 HO.Day0.replicate1       1189          629 Day0 replicate1   3.700589       4166          915                            0               2                             2
HODay0replicate1_AAACGGGCAACTGGCC-1 HO.Day0.replicate1       7726         2602 Day0 replicate1   2.938131       5865         2588                            1               2                             2
                                     cell_type
HODay0replicate1_AAACCTGAGAGAACAG-1 Fibroblast
HODay0replicate1_AAACCTGGTCATGCAT-1 Fibroblast
HODay0replicate1_AAACCTGTCAGAGCTT-1  Stem Cell
HODay0replicate1_AAACGGGAGAGACTTA-1 Macrophage
HODay0replicate1_AAACGGGAGGCCCGTT-1   Pericyte
HODay0replicate1_AAACGGGCAACTGGCC-1 Fibroblast</code></pre>
<p><strong>Checkpoint</strong> : Has the metadata for your
<code>geo_so</code> object been updated?</p>
<p>We have now added a “cell_type” column to the <code>meta.data</code>
table:</p>
<div class="float">
<img src="images/seurat_schematic/Slide12.png"
alt="Image: Schematic after adding cell_type column." />
<div class="figcaption">Image: Schematic after adding cell_type
column.</div>
</div>
<div id="visualise-annotated-clusters" class="section level2">
<h2>Visualise annotated clusters</h2>
<p>Lastly, we can generate a revised UMAP plot with our descriptive
cluster labels by using our updated Seurat object and providing the new
<code>cell_type</code> label for the <code>group.by</code> argument:</p>
<pre class="r"><code># Make a labeled UMAP plot of clusters ------------------------------------
catch_umap_plot = DimPlot(geo_so, group.by = &#39;cell_type&#39;, label = TRUE, reduction = &#39;umap.integrated.sct.rpca&#39;)
catch_umap_plot

ggsave(filename = &#39;results/figures/umap_integrated_catch.png&#39;, plot = catch_umap_plot, width = 10, height = 8, units = &#39;in&#39;)

catch_umap_condition_plot = DimPlot(geo_so, group.by = &#39;cell_type&#39;, split.by = &#39;day&#39;, label = TRUE, reduction = &#39;umap.integrated.sct.rpca&#39;)
catch_umap_condition_plot

ggsave(filename = &#39;results/figures/umap_integrated_catch_byCondition.png&#39;, plot = catch_umap_plot, width = 10, height = 8, units = &#39;in&#39;)</code></pre>
<p><img src="images/curriculum/07-CellTypeAnnotation/07-catch_umap_plot-1.png" width="960" style="display: block; margin: auto;" /><img src="images/curriculum/07-CellTypeAnnotation/07-catch_umap_plot-2.png" width="960" style="display: block; margin: auto;" /></p>
<!-- to add - number of cells per cluster and condition/replicate after annotation --->
</div>
</div>
<div id="save-our-progress" class="section level1">
<h1>Save our progress</h1>
<p>We’ll save the scCATCH object. The Seurat object has not been changed
in this module.</p>
<pre class="r"><code># Save Seurat object and annotations --------------------------------------
saveRDS(geo_so, file = &#39;results/rdata/geo_so_sct_integrated_with_catch.rds&#39;)
saveRDS(geo_catch, file = &#39;results/rdata/geo_catch.rds&#39;)</code></pre>
</div>
<div id="summary" class="section level1">
<h1>Summary</h1>
<p>Now that we have generated reasonable annotations for our clusters,
we can proceed with the step of differential expression which is
essential to addressing our biological question for this experiment.</p>
<p>Next steps: Differential Expression</p>
<hr />
<p>These materials have been adapted and extended from materials listed
above. These are open access materials distributed under the terms of
the <a href="http://creativecommons.org/licenses/by/4.0/">Creative
Commons Attribution license (CC BY 4.0)</a>, which permits unrestricted
use, distribution, and reproduction in any medium, provided the original
author and source are credited.</p>
<br/> <br/>
<hr/>
<table style="width:100%;">
<colgroup>
<col width="28%" />
<col width="42%" />
<col width="28%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><a href="06-MarkerVisualization.html">Previous
lesson</a></th>
<th align="center"><a href="#top">Top of this lesson</a></th>
<th align="right"><a href="08-DifferentialExpression.html">Next
lesson</a></th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiQ2VsbCBUeXBlIEFubm90YXRpb24iCmF1dGhvcjogIlVNIEJpb2luZm9ybWF0aWNzIENvcmUiCmRhdGU6ICJgciBTeXMuRGF0ZSgpYCIKb3V0cHV0OgogICAgICAgIGh0bWxfZG9jdW1lbnQ6CiAgICAgICAgICAgIGluY2x1ZGVzOgogICAgICAgICAgICAgICAgaW5faGVhZGVyOiBoZWFkZXIuaHRtbAogICAgICAgICAgICB0aGVtZTogcGFwZXIKICAgICAgICAgICAgdG9jOiB0cnVlCiAgICAgICAgICAgIHRvY19kZXB0aDogNAogICAgICAgICAgICB0b2NfZmxvYXQ6IHRydWUKICAgICAgICAgICAgbnVtYmVyX3NlY3Rpb25zOiBmYWxzZQogICAgICAgICAgICBmaWdfY2FwdGlvbjogdHJ1ZQogICAgICAgICAgICBtYXJrZG93bjogR0ZNCiAgICAgICAgICAgIGNvZGVfZG93bmxvYWQ6IHRydWUKLS0tCgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgpib2R5LCB0ZCB7CiAgIGZvbnQtc2l6ZTogMThweDsKfQpjb2RlLnJ7CiAgZm9udC1zaXplOiAxMnB4Owp9CnByZSB7CiAgZm9udC1zaXplOiAxMnB4Cn0KCnRhYmxlLmZpZywgdGguZmlnLCB0ZC5maWcgewogIGJvcmRlcjogMXB4IHNvbGlkIGJsYWNrOwogIGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7CiAgcGFkZGluZzogMTVweDsKfQo8L3N0eWxlPgoKYGBge3Iga2xpcHB5LCBlY2hvPUZBTFNFLCBpbmNsdWRlPVRSVUV9CmtsaXBweTo6a2xpcHB5KGxhbmcgPSBjKCJyIiwgIm1hcmtkb3duIiwgImJhc2giKSwgcG9zaXRpb24gPSBjKCJ0b3AiLCAicmlnaHQiKSkKYGBgCgpgYGB7ciwgaW5jbHVkZSA9IEZBTFNFfQpzb3VyY2UoIi4uL2Jpbi9jaHVuay1vcHRpb25zLlIiKQprbml0cl9maWdfcGF0aCgiMDctQ2VsbFR5cGVBbm5vdGF0aW9uLzA3LSIpCmBgYAoKIyBXb3JrZmxvdyBPdmVydmlldyB7LnVubGlzdGVkIC51bm51bWJlcmVkfQoKPGJyLz4KPGltZyBzcmM9ImltYWdlcy93YXlmaW5kZXIvd2F5ZmluZGVyLnBuZyIgYWx0PSJ3YXlmaW5kZXIiIHN0eWxlPSJoZWlnaHQ6IDQwMHB4OyIvPgo8YnIvPgo8YnIvPgoKIyBJbnRyb2R1Y3Rpb24KCkEgZnJlcXVlbnQgYm90dGxlbmVjayBpbiB0aGUgc2luZ2xlLWNlbGwgUk5BLXNlcSBhbmFseXNpcyB3b3JrZmxvdyBpcyBhbm5vdGF0aW5nIG91ciBjbHVzdGVyaW5nIHJlc3VsdHMsIGFzIGl0IHJlcXVpcmVzIGJyaWRnaW5nIHRoZSBnYXAgYmV0d2VlbiB0aGUgZGF0YSBhbmQgcHJpb3Iga25vd2xlZGdlIChbc291cmNlXShodHRwczovL2Jpb2NvbmR1Y3Rvci5vcmcvYm9va3MvMy4xNS9PU0NBLmJhc2ljL2NlbGwtdHlwZS1hbm5vdGF0aW9uLmh0bWwpKS4gV2hpbGUgZ2VuZXJhdGluZyBtYXJrZXJzIGZvciBlYWNoIGNsdXN0ZXIgYW5kIGV2YWx1YXRpbmcgdGhlIGV4cHJlc3Npb24gb2Yga25vd24gbWFya2VyIGdlbmVzIGlzIGltcG9ydGFudCwgaXQgbWF5IG9yIG1heSBub3QgYmUgc3VmZmljaWVudCB0byBhc3NpZ24gY2VsbC10eXBlIG9yIHN1Yi10eXBlIGxhYmVscy4gCgo8dGFibGUgY2xhc3M9J2ZpZyc+Cjx0ciBjbGFzcz0nZmlnJz48dGQgY2xhc3M9J2ZpZyc+IVtdKGltYWdlcy9ncmFwaGljYWxfYWJzdHJhY3RzL2dyYXBoaWNhbF9hYnN0cmFjdF9hbm5vdGF0aW9uLnBuZyk8L3RkPjwvdHI+Cjx0ciBjbGFzcz0nZmlnJz48dGQgY2xhc3M9J2ZpZyc+Rm9yIGVhY2ggY2VsbC10eXBlIChBKSwgdGhlIG1hcmtlciBnZW5lcyB3ZSBkZXJpdmVkIGluIHRoZSBwcmlvciBzdGVwIChCKSBhcmUgY29tcGFyZWQgd2l0aCBrbm93biBtYXJrZXIgZ2VuZXMgZm9yIGRpZmZlcmVudCBjZWxsIHR5cGVzIChDKS4gQ29uY29yZGFuY2UgYmV0d2VlbiBkZXJpdmVkIG1hcmtlciBnZW5lcyBhbmQga25vd24gY2VsbCBtYXJrZXJzIHByb2R1Y2VzIGEgc3VnZ2VzdGVkIGFubm90YXRpb24gZm9yIHRoYXQgY2VsbCB0eXBlLgo8L3RkPjwvdHI+CjwvdGFibGU+CgpJbiB0aGlzIHNlY3Rpb24sIG91ciBnb2FsIGlzIHRvIHVzZSBhbiBhdXRvbWF0ZWQgYW5ub3RhdGlvbiB0b29sIHRvIGdlbmVyYXRlIGNlbGwgdHlwZSBwcmVkaWN0aW9ucyBmb3Igb3VyIGNsdXN0ZXJzLiAKCkxpa2UgdGhlIHByZXZpb3VzIHNlY3Rpb25zLCB0aGUgcHJvY2VzcyB0byBhc3NpZ24gY2VsbC10eXBlcyB0byBjbHVzdGVycyBjYW4gYmUgdmVyeSBpdGVyYXRpdmUuIEluIGFkZGl0aW9uLCB0aGUgc3RlcHMgdG8gcmVhY2ggYSAiRmlndXJlIDEiIGxldmVsIG9mIGxhYmVsZWQgY2x1c3RlcnMgbWF5IG5vdCBiZSBwcmVzZW50ZWQgaW4gZGV0YWlsLCBjYW4gYmUgdmVyeSBkYXRhc2V0IGRlcGVuZGVudCwgYW5kIG9mdGVuIGlzIG1vcmUgY2hhbGxlbmdpbmcgZm9yIGxlc3MgY2hhcmFjdGVyaXplZCB0aXNzdWVzLiAKCiMjIE9iamVjdGl2ZXMKCi0gIFVuZGVyc3RhbmQgdGhlIGNvbXBsZXhpdGllcyBvZiBjZWxsLXR5cGUgYW5ub3RhdGlvbiAgICAKLSAgVXNlIGBzY0NBVENIYCBjZWxsLXR5cGUgcHJlZGljdGlvbnMgdG8gYW5ub3RhdGUgb3VyIGNsdXN0ZXJzICAgIAoKLS0tLQoKYGBge3IsIHJlYWRfcmRzX2hpZGRlbiwgZWNobyA9IEZBTFNFLCB3YXJuaW5nID0gRkFMU0UsIG1lc3NhZ2UgPSBGQUxTRX0KaWYoIWV4aXN0cygnZ2VvX3NvJykpIHsKICBsaWJyYXJ5KFNldXJhdCkKICBsaWJyYXJ5KEJQQ2VsbHMpCiAgbGlicmFyeSh0aWR5dmVyc2UpCgogIG9wdGlvbnMoZnV0dXJlLmdsb2JhbHMubWF4U2l6ZSA9IDFlOSkKCiAgZ2VvX3NvID0gcmVhZFJEUygncmVzdWx0cy9yZGF0YS9nZW9fc29fc2N0X2ludGVncmF0ZWRfd2l0aF9tYXJrZXJzLnJkcycpCn0KCmlmKCFleGlzdHMoJ2dlb19tYXJrZXJzJykpIHsKICBsaWJyYXJ5KFNldXJhdCkKICBsaWJyYXJ5KEJQQ2VsbHMpCiAgbGlicmFyeSh0aWR5dmVyc2UpCgogIG9wdGlvbnMoZnV0dXJlLmdsb2JhbHMubWF4U2l6ZSA9IDFlOSkKCiAgZ2VvX21hcmtlcnMgPSByZWFkUkRTKCdyZXN1bHRzL3JkYXRhL2dlb19tYXJrZXJzLnJkcycpCn0KYGBgCgojIENlbGwgdHlwZSBwcmVkaWN0aW9ucwoKQXV0b21hdGVkIHRvb2xzIGhhdmUgdGhlIGFkdmFudGFnZSBvZiBiZWluZyBhYmxlIHRvIGNvbXBhcmUgYmV0d2VlbiB0aGUgZXhwcmVzc2lvbiBwYXR0ZXJucyBpbiBvdXIgZGF0YXNldCBhbmQgbGFyZ2UgbnVtYmVycyBvZiByZWZlcmVuY2UgZGF0YXNldHMgb3IgZGF0YWJhc2VzIGF0IGEgc2NhbGUgdGhhdCBpcyBub3QgZmVhc2libGUgdG8gZG8gbWFudWFsbHkuCgpBcyBkZXNjcmliZWQgW2luIG1vcmUgZGV0YWlsIGJ5IHRoZSBPdXlhbmcgTGFiXShodHRwczovL291eWFuZ2xhYi5jb20vc2luZ2xlY2VsbC9jbHVzdC5odG1sI2Fubm90YXRpbmctY2x1c3RlcnMpIGFuZCBzdW1tYXJpemVkIGluIHRoZSBmaWd1cmUgYmVsb3csIHRoZXJlIGFyZSBtYW55IGNvbXB1dGF0aW9uYWwgdG9vbHMgdGhhdCBhaW0gdG8gYXNzaWduIGNlbGwgdHlwZSBsYWJlbHMgZm9yIHNpbmdsZS1jZWxsIGRhdGEuIFRoZXNlIG1ldGhvZHMgZ2VuZXJhbGx5IGZhbGwgaW50byB0aHJlZSBjYXRlZ29yaWVzOiAKCjEuIE1hcmtlciBiYXNlZCBhcHByb2FjaGVzIHRoYXQgdXNlIGdlbmUgc2V0cyBkcmF3biBmcm9tIHRoZSBsaXRlcmF0dXJlLCBpbmNsdWRpbmcgcHJldmlvdXMgc2luZ2xlLWNlbGwgc3R1ZGllcywgCjIuIENvcnJlbGF0aW9uIGJhc2VkIGFwcHJvYWNoZXMgdGhhdCBlc3RpbWF0ZSB0aGUgc2ltaWxhcml0eSBiZXR3ZWVuIHRoZSBjZWxscyBvciBjbHVzdGVycyBpbiB0aGUgaW5wdXQgZGF0YSBhbmQgc29tZSByZWZlcmVuY2UgZGF0YQozLiBNYWNoaW5lIGxlYXJuaW5nIGFwcHJvYWNoZXMgdGhhdCBpbmNsdWRlIHRyYWluaW5nIG9uIGEgc2luZ2xlLWNlbGwgcmVmZXJlbmNlIGF0bGFzLiAKCiFbSW1hZ2U6IERpYWdyYW0gb2YgdHlwZXMgb2YgY2VsbCBhbm5vdGF0aW9uIGFwcHJvYWNoZXMgKGZyb20gT3lhbmcgbWF0ZXJpYWxzKS5dKC4vaW1hZ2VzL2N1cnJpY3VsdW0vMDctQ2VsbFR5cGVBbm5vdGF0aW9uL091eWFuZ19jbHVzdC1jZWxsdHlwZS5wbmcpICAgCgpIb3dldmVyLCBhY3Jvc3MgYW55IG9mIHRoZXNlIGFwcHJvYWNoZXMgdGhlIHF1YWxpdHkgb2YgdGhlIHJlZmVyZW5jZSBkYXRhIChhbmQgcmVsaWFiaWxpdHkgb2YgdGhlIGF1dGhvcnMgbGFiZWxzKSBhbmQgcmVsZXZhbmN5IHRvIHlvdXIgc3BlY2lmaWMgdGlzc3VlL2V4cGVyaW1lbnQgKGFuZCB0aGUgcmVzb2x1dGlvbiBvZiB5b3VyIGJpb2xvZ2ljYWwgcXVlc3Rpb24pIGlzIGNydWNpYWwuIEFkZGl0aW9uYWxseSwgaXQncyBpbXBvcnRhbnQgdG8gY29uc2lkZXIgdGhhdCByYXJlIG9yIG5vdmVsIGNlbGwgcG9wdWxhdGlvbnMgbWF5IG5vdCBiZSBwcmVzZW50IG9yIHdlbGwtY2hhcmFjdGVyaXplZCBpbiBhdmFpbGFibGUgcmVmZXJlbmNlcyBhbmQgdGhhdCBldmVuIGFmdGVyIGZpbHRlcmluZywgc29tZSBjbHVzdGVycyBtaWdodCBjb3JyZXNwb25kIHRvIHN0cmVzc2VkIG9yIGR5aW5nIGNlbGxzIGFuZCBub3QgYSBwYXJ0aWN1bGFyIGNlbGwtdHlwZSBvciBzdWJ0eXBlLiBUaGVyZWZvcmUsIGFueSBwcmVkaWN0aW9uIHNob3VsZCBiZSByZXZpZXdlZCBhbmQgY29uc2lkZXJlZCBpbiB0aGUgY29udGV4dCBib3RoIG1hcmtlciBnZW5lIGV4cHJlc3Npb24gZm9yIHRoZSBkYXRhc2V0IGFuZCBrbm93bGVkZ2Ugb2YgdGhlIGJpb2xvZ2ljYWwgc3lzdGVtIGFuZCBicm9hZGVyIGxpdGVyYXR1cmUuIAoKU29tZSB0b29scyBhbmQgcmVmZXJlbmNlcyBhcmUgYXZhaWxhYmxlIHNvbGVseSBvciBwcmltYXJpbHkgZm9yIGh1bWFuIHRpc3N1ZXMgKGFuZCBub3QgbW91c2Ugb3IgcmF0KSwgcGFydGljdWxhciBmb3IgdGlzc3VlcyBvdGhlciB0aGFuIFBCTUNzIGFuZCB0aGUgYnJhaW4uIEZvciBodW1hbiBkYXRhLCBpZiBhIHJlbGV2YW50IHJlZmVyZW5jZSBpcyBhdmFpbGFibGUgZm9yIHlvdXIgZXhwZXJpbWVudCwgd2Ugd291bGQgcmVjb21tZW5kIHRyeWluZyBbQXppbXV0aCAoY3JlYXRlZCBieSBhdXRob3JzIG9mIFNldXJhdCldKGh0dHBzOi8vYXppbXV0aC5odWJtYXBjb25zb3J0aXVtLm9yZy8pLiBbMTB4IGhhcyBhIHR1dG9yaWFsXShodHRwczovL3d3dy4xMHhnZW5vbWljcy5jb20vYW5hbHlzaXMtZ3VpZGVzL2F1dG9tYXRlZC1jZWxsLXR5cGUtYW5ub3RhdGlvbi1mcm9tLXItdG8tbG91cGUtdXNpbmctbG91cGVyKSB0aGF0IGluY2x1ZGVzIGV4YW1wbGUgb2YgdXNpbmcgQXppbXV0aCwgaW5jbHVkaW5nIGEgZmVhdHVyZSBvZiB0aGUgdG9vbCB0aGF0IGFsbG93cyBmb3IgZmlyc3QgcGFzcyBvZiBjZWxsLXR5cGUgYXNzaWdubWVudCBvZiBtb3JlIGNvbW1vbiBjZWxsLXR5cGVzIGZvbGxvd2VkIGJ5IGlkZW50aWZ5aW5nIHJhcmVyIHBvcHVsYXRpb25zIHRoYXQgbWF5IG5vdCBiZSBpZGVudGlmaWVkIGluIHRoZSBmaXJzdCBwYXNzLiAKCjxkZXRhaWxzPgogICAgPHN1bW1hcnk+KkFkZGl0aW9uYWwgYXV0b21hdGVkIGFubm90YXRpb24gcmVzb3VyY2VzKjwvc3VtbWFyeT4KICAgIEF1dG9tYXRlZCBjZWxsLXR5cGUgYW5ub3RhdGlvbiBpcyBhbiBhY3RpdmUgYXJlYSBvZiByZXNlYXJjaCBhbmQgZGV2ZWxvcG1lbnQgYW5kIG1hbnkgb3RoZXIgdG9vbHMgYW5kIHJlc291cmNlcyBhcmUgYXZhaWxhYmxlLCBpbmNsdWRpbmcgW09TQ0EncyBkZW1vbnN0cmF0aW9uIG9mIHRoZSBTaW5nbGVSIG1ldGhvZF0oaHR0cHM6Ly9iaW9jb25kdWN0b3Iub3JnL2Jvb2tzLzMuMTUvT1NDQS5iYXNpYy9jZWxsLXR5cGUtYW5ub3RhdGlvbi5odG1sKSwgYSBbVHV0b3JpYWwgYnkgQ2xhcmtlIGV0IGFsLiBmb3IgY2VsbC10eXBlIGFubm90YXRpb25zXShodHRwczovL3B1Ym1lZC5uY2JpLm5sbS5uaWguZ292LzM0MDMxNjEyLyksIGFuZCBhbiBbZW50aXJlIGNoYXB0ZXIgb2YgdGhlIFNDIGJlc3QgcHJhY3RpY2VzIGJvb2tdKGh0dHBzOi8vd3d3LnNjLWJlc3QtcHJhY3RpY2VzLm9yZy9jZWxsdWxhcl9zdHJ1Y3R1cmUvYW5ub3RhdGlvbi5odG1sI2F1dG9tYXRlZC1hbm5vdGF0aW9uKS4KPC9kZXRhaWxzPgo8YnI+CgojIFVzaW5nIHNjQ0FUQ0gKCkEgdG9vbCB3ZSBvZnRlbiB1c2UgZm9yIGJvdGggbW91c2UgYW5kIGh1bWFuIGRhdGEgY2VsbC10eXBlIHByZWRpY3Rpb25zIGlzIGNhbGxlZCBbc2NDQVRDSF0oaHR0cHM6Ly9naXRodWIuY29tL1pKVUZhbkxhYi9zY0NBVENIL3dpa2kpIHdoaWNoLCBwZXIgdGhlIGF1dGhvcidzIGRlc2NyaXB0aW9uIGluIFtTaGFvIGV0IGFsICgyMDIwKV0oaHR0cHM6Ly93d3cubmNiaS5ubG0ubmloLmdvdi9wbWMvYXJ0aWNsZXMvUE1DNzAzMTMxMi8pLCBhbm5vdGF0ZXMgY2VsbC10eXBlcyB1c2luZyBhICJ0aXNzdWUtc3BlY2lmaWMgY2VsbHVsYXIgdGF4b25vbXkgcmVmZXJlbmNlIGRhdGFiYXNlIChDZWxsTWF0Y2gpIGFuZCBbYW5dIGV2aWRlbmNlLWJhc2VkIHNjb3JpbmcgKEVTKSBwcm90b2NvbCIuIFRoZSBDZWxsTWF0Y2ggcmVmZXJlbmNlIGlzIGNvbXBpbGVkIGZyb20gQ2VsbE1hcmtlciAoW1poYW5nIGV0IGFsLiwgMjAxOWJdKGh0dHBzOi8vd3d3LmNlbGwuY29tL3NlcnZsZXQvbGlua291dD9zdWZmaXg9ZV8xXzVfMV8yXzMzXzImZGJpZD04JmRvaT0xMC4xMDE2L2ouaXNjaS4yMDIwLjEwMDg4MiZrZXk9MzAyODk1NDkmY2Y9KSksIE1DQSAoW0hhbiBldCBhbC4sIDIwMThdKGh0dHBzOi8vd3d3LmNlbGwuY29tL3NlcnZsZXQvbGlua291dD9zdWZmaXg9ZV8xXzVfMV8yXzEwXzImZGJpZD04JmRvaT0xMC4xMDE2L2ouaXNjaS4yMDIwLjEwMDg4MiZrZXk9Mjk3NzU1OTcmY2Y9KSksIENhbmNlclNFQSAoW1l1YW4gZXQgYWwuLCAyMDE5XShodHRwczovL3d3dy5jZWxsLmNvbS9zZXJ2bGV0L2xpbmtvdXQ/c3VmZml4PWVfMV81XzFfMl8yOV8yJmRiaWQ9OCZkb2k9MTAuMTAxNi9qLmlzY2kuMjAyMC4xMDA4ODIma2V5PTMwMzI5MTQyJmNmPSkpLCBhbmQgdGhlIFtDRCBNYXJrZXIgSGFuZGJvb2tdKGh0dHBzOi8vd3d3LmFiY2FtLmNvbS9wcmltYXJ5LWFudGlib2RpZXMvaHVtYW4tY2QtYW50aWdlbi1ndWlkZSkgYW5kIFBNSURzIGZvciByZWxldmFudCBsaXRlcmF0dXJlIGFyZSByZXBvcnRlZCBpbiB0aGUgcHJlZGljdGlvbiByZXN1bHRzLiAKCjwhLS0gY29uc2lkZXIgYWRkaW5nIFtzY1R5cGVdKGh0dHBzOi8vY3Jhbi5yLXByb2plY3Qub3JnL3dlYi9wYWNrYWdlcy9zY0NBVENIL3ZpZ25ldHRlcy90dXRvcmlhbC5odG1sKSBhcyBhbiBhbHRlcm5hdGl2ZSAtLT4KCiFbSW1hZ2U6IHNjQ0FUQ0ggc3VtbWFyeSBmcm9tIFNoYW8gZXQgYWwgKDIwMjApLl0oLi9pbWFnZXMvY3VycmljdWx1bS8wNy1DZWxsVHlwZUFubm90YXRpb24vc2NDQVRDSC1wYXBlci1WaXpBYnN0cmFjdC5qcGVnKSAKCkZpcnN0LCB3ZSBuZWVkIHRvIGxvYWQgdGhlIHNjQ0FUQ0ggbGlicmFyeS4gVGhlbiwgd2UnbGwgZG91YmxlIGNoZWNrIHRoYXQgd2UgYXJlIHVzaW5nIHRoZSBleHBlY3RlZCByZXNvbHV0aW9uIGNsdXN0ZXIgcmVzdWx0cyAodGhpcyBpcyBwYXJ0aWN1bGFybHkgaW1wb3J0YW50IGlmIHdlIGdlbmVyYXRlZCBtdWx0aXBsZSByZXNvbHV0aW9ucyBpbiBvdXIgY2x1c3RlcmluZyBzdGVwcyksIGJlZm9yZSBjcmVhdGluZyBhIG5ldyBvYmplY3QgZnJvbSBvdXIgYGNvdW50c2AgZGF0YSB3aXRoIGBjcmVhdGVzY0NBVENIKClgIGFuZCBhZGRpbmcgb3VyIG1hcmtlciBnZW5lcyB0byB0aGUgc2NDQVRDQ0ggb2JqZWN0LgoKVG8gaW5jcmVhc2UgdGhlIHNwZWVkIGFuZCBhY2N1cmFjeSBvZiBvdXIgcHJlZGljdGlvbnMsIHdlJ2xsIGNyZWF0ZSBxdWVyeSBvZiByZWxldmFudCB0aXNzdWVzICh3aGljaCByZXF1aXJlcyBzb21lIHByaW9yIGtub3dsZWRnZSBvZiB0aGUgZXhwZXJpbWVudCBhbmQgdXNpbmcgdGhlIFtzY0NBVENIIHdpa2ldKGh0dHBzOi8vZ2l0aHViLmNvbS9aSlVGYW5MYWIvc2NDQVRDSC93aWtpKSB0byBzZWxlY3QgdGlzc3VlcyBmcm9tIHRoZSBzcGVjaWVzKSBiZWZvcmUgd2UgcnVuIHRoZSB0b29sOgoKYGBge3IsIHNjY2F0Y2gsIG1lc3NhZ2UgPSBGQUxTRSwgd2FybmluZyA9IEZBTFNFfQojIyMjIyBEYXkgMyAtIENlbGwgVHlwZSBBbm5vdGF0aW9uCgojIEFubm90YXRlIGNsdXN0ZXJzIHVzaW5nIHNjQ0FUQ0ggIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KbGlicmFyeShzY0NBVENIKQoKIyBjaGVjayB0aGF0IGNlbGwgaWRlbnRpdGllcyBhcmUgc2V0IHRvIGV4cGVjdGVkIHJlc29sdXRpb24gCmFsbChJZGVudHMoZ2VvX3NvKSA9PSBnZW9fc28kaW50ZWdyYXRlZC5zY3QucnBjYS5jbHVzdGVycykKCiMgY3JlYXRlIHNjQ0FUQ0ggb2JqZWN0LCB1c2luZyBjb3VudCBkYXRhCmdlb19jYXRjaCA9IGNyZWF0ZXNjQ0FUQ0goZGF0YSA9IGdlb19zb0Bhc3NheXMkU0NUQGNvdW50cywgY2x1c3RlciA9IGFzLmNoYXJhY3RlcihJZGVudHMoZ2VvX3NvKSkpCgojIGFkZCBtYXJrZXIgZ2VuZXMgdG8gdXNlIGZvciBwcmVkaWN0aW9ucwpnZW9fY2F0Y2hAbWFya2VyZ2VuZSA9IGdlb19tYXJrZXJzCgojIHNwZWNpZnkgdGlzc3Vlcy9jZWxsLXR5cGVzIGZyb20gdGhlIHNjQ0FUQ0ggcmVmZXJlbmNlCmdlb19jYXRjaEBtYXJrZXIgPSBjZWxsbWF0Y2hbY2VsbG1hdGNoJHNwZWNpZXMgPT0gJ01vdXNlJyAmIGNlbGxtYXRjaCR0aXNzdWUgJWluJSBjKCdCbG9vZCcsICdQZXJpcGhlcmFsIEJsb29kJywgJ011c2NsZScsICdTa2VsZXRhbCBtdXNjbGUnLCAnRXBpZGVybWlzJywgJ1NraW4nKSwgXQoKIyBydW4gc2NDQVRDSCB0byBnZW5lcmF0ZSBwcmVkaWN0aW9ucwpnZW9fY2F0Y2ggPSBmaW5kY2VsbHR5cGUoZ2VvX2NhdGNoKQoKIyBsb29rIGF0IHRoZSBwcmVkaWN0aW9ucwpnZW9fY2F0Y2hAY2VsbHR5cGUgJT4lIHNlbGVjdChjbHVzdGVyLCBjZWxsX3R5cGUsIGNlbGx0eXBlX3Njb3JlKQpgYGAKCldoZW4gd2UgbG9vayBhdCBvdXIgcmVzdWx0cyB3ZSBjYW4gc2VlIHRoZSBjZWxsIHR5cGUgc2NvcmUsIHdoaWNoIGdpdmVzIHVzIGFuIGlkZWEgb2YgdGhlIGNvbmZpZGVuY2Ugb2YgdGhhdCBwcmVkaWN0aW9uLiBOb3Qgc2hvd24gaGVyZSBidXQgdGhlIGZ1bGwgYGNlbGx0eXBlYCB0YWJsZSBhbHNvIGluY2x1ZGVzIG1hcmtlciBnZW5lcyBhbmQgUE1JRHMgZm9yIHJlbGV2YW50IGxpdGVyYXR1cmUgZm9yIGVhY2ggcHJlZGljdGlvbi4KCkluIG91ciBleHBlcmllbmNlLCB0aGVzZSBraW5kcyBvZiByZXN1bHRzIG9mdGVuIGhlbHAgZ3VpZGUgY2x1c3RlciBhbm5vdGF0aW9uIGJ1dCBzY29yZXMgY2FuIHZhcnkgYW5kIHRoZSBwcmVkaWN0aW9ucyBtYXkgbmVlZCB0byBiZSByZXZpc2VkIGJhc2VkIG9uIHJlc2VhcmNoZXIncyBrbm93bGVkZ2Ugb2YgdGhlIGJpb2xvZ2ljYWwgc3lzdGVtLiBBcyB0aGVzZSBjZWxsLXR5cGVzIGNvcnJlc3BvbmQgdG8gdGhlIGNlbGwtdHlwZXMgYW5kIHN1YnR5cGVzIHdlJ2QgZXhwZWN0IHRvIGJlIHByZXNlbnQgaW4gdGhlc2UgZGF0YSBhbmQgbW9zdCBvZiB0aGUgcHJlZGljdGlvbiBzY29yZXMgYXJlIHF1aXRlIGhpZ2gsIHdlIGNhbiByZWFzb25hYmx5IHVzZSB0aGVzZSByZXN1bHRzIHRvIGFubm90YXRlIG91ciBjbHVzdGVycyB3aXRoIHNvbWUgbWlub3IgYWRqdXN0bWVudHMuIAoKIyMgVXNpbmcga25vd24gY2VsbC10eXBlIG1hcmtlcnMKClRvIGNvbmZpcm0gYW5kIHJlZmluZSB0aGUgc2NDQVRDSCBwcmVkaWN0aW9ucywgd2UnbGwgc3BvdCBjaGVjayBzb21lIGtub3duIG1hcmtlcnMgZm9yIGltbXVuZSBwb3B1bGF0aW9ucy4gVGhlbiB3ZSdsbCBsb29rIGxvb2sgYXQgc29tZSBvdGhlciBrZXkgbWFya2VyIGdlbmVzIGZyb20gc29tZSBvdGhlciByZWxldmFudCByZXNvdXJjZXMgbGlrZSBbQ2hlbiBldCBhbCAoMjAyMSldKGh0dHBzOi8vd3d3Lm5hdHVyZS5jb20vYXJ0aWNsZXMvczQxNDY3LTAyMS0yNzU2My0zKSwgW0J1ZWNobGVyIGV0IGFsICgyMDIxKV0oaHR0cHM6Ly93d3cubmF0dXJlLmNvbS9hcnRpY2xlcy9zNDE1ODYtMDIxLTAzNTQ5LTUpIFtSb21hbiAoMjAyMyldKGh0dHBzOi8vcG1jLm5jYmkubmxtLm5paC5nb3YvYXJ0aWNsZXMvUE1DMTAyOTY0MDkvI3NlYzMtYmlvbW9sZWN1bGVzLTEzLTAwOTQ1ICksICBbTGkgZXQgYWwgKDIwMjIpXShodHRwczovL2JtY2Jpb2luZm9ybWF0aWNzLmJpb21lZGNlbnRyYWwuY29tL2FydGljbGVzLzEwLjExODYvczEyODU5LTAyMi0wNDgxNy01L2ZpZ3VyZXMvMikgYW5kIFtOZXN0b3Jvd2EgZXQgYWwgKDIwMTYpXShodHRwczovL2FzaHB1YmxpY2F0aW9ucy5vcmcvYmxvb2QvYXJ0aWNsZS8xMjgvOC9lMjAvMzU3NDkvQS1zaW5nbGUtY2VsbC1yZXNvbHV0aW9uLW1hcC1vZi1tb3VzZSkgdG8gc2VlIGlmIG90aGVyIG1vZGlmaWNhdGlvbnMgc2hvdWxkIGJlIG1hZGUgdG8gdGhlIHNjQ0FUQ0ggcHJlZGljdGlvbnM6CmBgYHtyLCBtYXJrZXJfZ2VuZV9jaGVjaywgZmlnLnNob3c9J2hvbGQnfQojIFBsb3Qgb3RoZXIgbWFya2Vycy9mZWF0dXJlcyB0byBhc3Npc3Qgd2l0aCBpZGVudGlmaWNhdGlvbiAtLS0tLS0tLS0tLS0tLS0KIyBzcG90IGNoZWNrIGtub3duIGltbXVuZSBtYXJrZXJzCmltbXVuZV9tYXJrZXJzID0gbGlzdCgpCmltbXVuZV9tYXJrZXJzW1snSW5mbGFtLiBNYWNyb3BoYWdlJ11dID0gYygnQ2QxNCcsICdDeGNsMicpICMgQ2QxNCBhLSBtb25vY3l0ZS9tYWNyb3BoYWdlIGNlbGxzCmltbXVuZV9tYXJrZXJzW1snUGxhdGVsZXQnXV0gPSBjKCdQZjQnKQppbW11bmVfbWFya2Vyc1tbJ01hc3QgY2VsbHMnXV0gPSBjKCdHYXRhMicsICdLaXQnKQppbW11bmVfbWFya2Vyc1tbJ05LIGNlbGxzJ11dID0gYygnTmtnNycsICdLbHJkMScpCmltbXVuZV9tYXJrZXJzW1snQi1jZWxsJ11dID0gYyggJ0x5NmQnLCAnQ2QxOScsICdDZDc5YicsICdNczRhMScpCmltbXVuZV9tYXJrZXJzW1snVC1jZWxsJ11dID0gYyggJ0NkM2QnLCdDZDNlJywnQ2QzZycpICMgYWxzbyBUaHkxCgppbW11bmVfbWFya2Vyc19wbG90ID0gRG90UGxvdChnZW9fc28sIGZlYXR1cmVzID0gaW1tdW5lX21hcmtlcnMsIGFzc2F5ID0gJ1NDVCcpICArCiAgdGhlbWUodGV4dD1lbGVtZW50X3RleHQoc2l6ZT0xMCksIGF4aXMudGV4dC54ID0gZWxlbWVudF90ZXh0KGFuZ2xlID0gNDUsIHZqdXN0ID0gMC41KSkKaW1tdW5lX21hcmtlcnNfcGxvdAoKIyBzYXZlIHRvIGZpbGUKZ2dzYXZlKGZpbGVuYW1lID0gJ3Jlc3VsdHMvZmlndXJlcy9pbW11bmVfbWFya2Vyc19zY3RfZG90X3Bsb3QucG5nJywgcGxvdCA9IGltbXVuZV9tYXJrZXJzX3Bsb3QsIHdpZHRoID0gMTAsIGhlaWdodCA9IDUsIHVuaXRzID0gJ2luJykKCiMgcGxvdCBzb21lIGtub3duIGNlbGwtdHlwZSBtYXJrZXJzIApvdGhlcl9tYXJrZXJzID0gbGlzdCgpCm90aGVyX21hcmtlcnNbWydQZXJpY3l0ZSddXSA9IGMoJ0FjYW4nLCdTb3g5JykKb3RoZXJfbWFya2Vyc1tbJ1NNQyddXSA9IGMoJ0FjdGEyJywgJ015aDExJykgIyBTTUMgPSBtZXNlbmNoeW1hbCBzbW9vdGgtbXVzY2xlIGNlbGwvbWVzZW5jaHltYWwgbGluZWFnZQpvdGhlcl9tYXJrZXJzW1snS2VyYXRpbm9jeXRlcyddXSA9IGMoJ1RoeTEnLCAnRGxrMScpICMgZmlicm8gcHJvZ2VuaXRvcnMgYXNvPVRoeTEKb3RoZXJfbWFya2Vyc1tbJ015b2ZpYnJvYmxhc3RzJ11dID0gYygnVG1lbTEwMCcsICdDZDM0JywgJ0x5NmMxJykgIyBoZW1hdG9wb2V0aWMgc3RlbS9hY3RpdmF0ZWQgZmlicm9ibGFzdD1DZDM0Cm90aGVyX21hcmtlcnNbWydGaWJyb2JsYXN0J11dID0gYygnRHB0JywgJ0ZuMScsICdDb2wzYTEnKSAgIyBhY3RpdmF0ZWQgZmliID0gRm4xCm90aGVyX21hcmtlcnNbWydFbmRvdGhlbGlhbCddXSA9IGMoJ1BlY2FtMScsICdDZDM4JykgIyBmcm9tIHdvdW5kIGhlYWxpbmc7IFBlY2FtMSBhbHNvIGV4cCBpbiBlbmRvdGhlbGlhbApvdGhlcl9tYXJrZXJzW1snSFNDJ11dID0gYygnTHRiJywgJ0NkNzQnKSAjIGxlc3Mgd2VsbCBkZWZpbmVkL2NvbmZsaWN0aW5nIGRlZmluaXRpb25zCm90aGVyX21hcmtlcnNbWydFcnl0aHJvaWQnXV0gPSBjKCdIYmEtYTEnKQoKb3RoZXJfbWFya2Vyc19kb3RfcGxvdCA9IERvdFBsb3QoZ2VvX3NvLCBmZWF0dXJlcyA9IG90aGVyX21hcmtlcnMsIGFzc2F5ID0gJ1NDVCcpICsKICB0aGVtZSh0ZXh0PWVsZW1lbnRfdGV4dChzaXplPTEwKSwgYXhpcy50ZXh0LnggPSBlbGVtZW50X3RleHQoYW5nbGUgPSA0NSwgdmp1c3QgPSAwLjUpKQpvdGhlcl9tYXJrZXJzX2RvdF9wbG90CgojIHNhdmUgdG8gZmlsZQpnZ3NhdmUoZmlsZW5hbWUgPSAncmVzdWx0cy9maWd1cmVzL290aGVyX21hcmtlcnNfc2N0X2RvdF9wbG90LnBuZycsIHBsb3QgPSBvdGhlcl9tYXJrZXJzX2RvdF9wbG90LCB3aWR0aCA9IDEyLCBoZWlnaHQgPSA1LCB1bml0cyA9ICdpbicpCgpgYGAKSW4gdGhlIGZpcnN0IHBsb3QsIEItY2VsbCBhbmQgVC1jZWxsIG1hcmtlcnMgc2VlbSB0byBsaW5lIHVwIHdpdGggdGhlIHByZWRpY3Rpb25zIGFuZCBhcmUgbGltaXRlZCB0byBzaW5nbGUgY2x1c3RlcnMuIEhvd2V2ZXIsIG1hY3JvcGhhZ2UgYW5kIGRlbmRyb2N5dGUgbWFya2VycyBtYXRjaCB0byBtdWx0aXBsZSBjbHVzdGVycyBpbmNsdWRpbmcgc29tZSBhbm5vdGF0ZWQgd2l0aCBkaWZmZXJlbnQgY2VsbCB0eXBlcywgc28gd2UgY2FuIGNvbnNpZGVyIG1vZGlmeWluZyB0aG9zZSBjbHVzdGVyIGxhYmVscy4gCgoKRnJvbSB0aGUgb3RoZXIgbWFya2VyIGdlbmVzLCB0aGUgcGF0dGVybnMgYXJlIGxlc3MgY2xlYXIgc28gd2UgbWF5IHdhbnQgdG8gdGVzdCBvdGhlciBjbHVzdGVyaW5nIHBhcmFtZXRlcnMgYW5kIGRpc2N1c3MgdGhlIHJlc3VsdHMgd2l0aCBhIHJlc2VhcmNoZXIgZmFtaWxpYXIgd2l0aCB0aGUgZXhwZWN0ZWQgY2VsbCB0eXBlcy4gSG93ZXZlciwgd2UgY2FuIG5vdGljZSBzb21lIHBhdHRlcm5zIHRoYXQgd2UgY2FuIHVzZSB0byByZWZpbmUgb3VyIGNsdXN0ZXIgYW5ub3RhdGlvbnMuIAoKIyMjIyBVdGlsaXppbmcgZ2VuZXMgb2YgaW50ZXJlc3QgZnJvbSB0aGUgb3JpZ2luYWwgcGFwZXIgCgo8ZGV0YWlscz4KICAgIDxzdW1tYXJ5PipQbG90dGluZyB0aGUgZXhwcmVzc2lvbiBvZiBnZW5lcyBvZiBpbnRlcmVzdCBmcm9tIFNvcmtpbiwgSHViZXIgZXQgYWwqPC9zdW1tYXJ5PgogICAgT2Z0ZW4gd2UgaGF2ZSBwcmlvciBpbmZvcm1hdGlvbiBhYm91dCB3aGF0IGNlbGwgdHlwZXMgYXJlIGV4cGVjdGVkIGluIG91ciBzYW1wbGVzIGFuZCBrZXkgbWFya2VyIGdlbmVzIGZvciB0aG9zZSBwb3B1bGF0aW9ucy4gVGhpcyBjYW4gYmUgYW4gaW1wb3J0YW50IHBhcnQgb2YgZXZhbHVhdGluZyBvdXIgY2x1c3RlcnMsIHNpbmNlIGlmIGdlbmVzIHRoYXQgYXJlIGtub3duIG1hcmtlcnMgZm9yIGEgc3BlY2lmaWMgY2VsbCB0eXBlIGFyZSBmb3VuZCBpbiB0b28gbWFueSBvciB0b28gZmV3IGNsdXN0ZXJzIGFzIHRoYXQgY2FuIHN1Z2dlc3QgdGhhdCByZS1jbHVzdGVyaW5nIGlzIG5lZWRlZCBvciB0aGF0IHNvbWUgb2YgdGhlIGNsdXN0ZXJzIHNob3VsZCBiZSBtYW51YWxseSBjb21iaW5lZCBiZWZvcmUgYW5ub3RhdGluZy4gV2UgY2FuIGNyZWF0ZSBsaXN0cyBvZiBtYXJrZXJzIHVzZWQgaW4gZmlndXJlcyBmcm9tIHRoZSBbb3JpZ2luYWwgcGFwZXJdKGh0dHBzOi8vd3d3Lm5jYmkubmxtLm5paC5nb3YvcG1jL2FydGljbGVzL1BNQzcwMDI0NTMvKSBiZWZvcmUgdXNpbmcgdGhlIHNhbWUgYERvdFBsb3QoKWAgZnVuY3Rpb24gdG8gdmlzdWFsaXplIHRoZSBleHByZXNzaW9uIGxldmVsIGFuZCBmcmVxdWVuY3kgb2YgdGhlc2UgZ2VuZXMgaW4gb3VyIGN1cnJlbnQgY2x1c3RlcnM6CgpgYGB7ciwga25vd25fZG90X3Bsb3RzX3NjdCwgZmlnLnNob3c9J2hvbGQnfQojIFZpc3VhbGl6ZSBtYW51YWxseSBzZWxlY3RlZCBtYXJrZXIgZ2VuZXMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyBDcmVhdGUgbGlzdHMgb2YgZ2VuZXMgZnJvbSBwYXBlciAKZmlnMWdfbWFya2VycyA9IGMoJ0N4Y2wxJywgJ0N4Y2wyJywgJ0NjbDInLCAnQ2NsMycsICdDY2w0JywgJ0lsMWInLCAnSWw2YicsICdUbmYnLCAnVGdmYjEnLCAnVGdmYjInLCAnVGdmYjMnLCAnQ3hjbDUnKQpmaWcxaF9tYXJrZXJzID0gYygnQ3hjcjInLCAnQ3NmMXInLCAnQ3NmM3InLCAnVGdmYnIxJywgJ1RnZmJyMycsICdJbDFyMScsICdJbDZyYScsICdMaWZyJywgJ1RnZmJyMicpCgojIGNyZWF0ZSBEb3RQbG90cyBmb3IgZ2VuZXMgZnJvbSBwYXBlcgpmaWcxZ19zY3RfZG90X3Bsb3QgPSBEb3RQbG90KGdlb19zbywgZmVhdHVyZXMgPSBmaWcxZ19tYXJrZXJzLCBhc3NheSA9ICdTQ1QnKQpmaWcxaF9zY3RfZG90X3Bsb3QgPSBEb3RQbG90KGdlb19zbywgZmVhdHVyZXMgPSBmaWcxaF9tYXJrZXJzLCBhc3NheSA9ICdTQ1QnKQoKZmlnMWdfc2N0X2RvdF9wbG90CmZpZzFoX3NjdF9kb3RfcGxvdAoKIyBzYXZlIHBsb3RzIHRvIGZpbGUKZ2dzYXZlKGZpbGVuYW1lID0gJ3Jlc3VsdHMvZmlndXJlcy9tYXJrZXJzX2ZpZzFnX3NjdF9kb3RfcGxvdC5wbmcnLCBwbG90ID0gZmlnMWdfc2N0X2RvdF9wbG90LCB3aWR0aCA9IDgsIGhlaWdodCA9IDYsIHVuaXRzID0gJ2luJykKZ2dzYXZlKGZpbGVuYW1lID0gJ3Jlc3VsdHMvZmlndXJlcy9tYXJrZXJzX2ZpZzFoX3NjdF9kb3RfcGxvdC5wbmcnLCBwbG90ID0gZmlnMWhfc2N0X2RvdF9wbG90LCB3aWR0aCA9IDgsIGhlaWdodCA9IDYsIHVuaXRzID0gJ2luJykKYGBgCkZvciBrbm93biBtYXJrZXIgZ2VuZXMsIGl0J3MgaW1wb3J0YW50IHRvIG5vdGUgdGhhdCBzaW5jZSBzY1JOQS1zZXEgaXMgb25seSBtZWFzdXJpbmcgdHJhbnNjcmlwdGlvbmFsIHNpZ25hbHMgdGhhdCBtYXJrZXJzIGF0IHRoZSBwcm90ZWluIGxldmVsIChlLmcgdXNlZCBmb3IgYXBwcm9hY2hlcyBsaWtlIEZBQ1MpIG1heSBiZSBsZXNzIGVmZmVjdGl2ZS4gQW4gYWx0ZXJuYXRpdmUgb3IgY29tcGxlbWVudCB0byB1c2luZyBtYXJrZXIgZ2VuZXMgY291bGQgYmUgbWV0aG9kcyBsaWtlIHVzaW5nIGdlbmUgc2V0IGVucmljaG1lbnQgKEdTRUEpIFthcyBkZW1vbnN0cmF0ZWQgaW4gdGhlIE9TQ0EgYm9va10oaHR0cHM6Ly9iaW9jb25kdWN0b3Iub3JnL2Jvb2tzLzMuMTUvT1NDQS5iYXNpYy9jZWxsLXR5cGUtYW5ub3RhdGlvbi5odG1sI2NvbXB1dGluZy1nZW5lLXNldC1hY3Rpdml0aWVzKSB0byBhaWQgaW4gYW5ub3RhdGlvbnMuIEhvd2V2ZXIsIHRoZSBib29rIFsiQmVzdCBwcmFjdGljZXMgZm9yIHNpbmdsZS1jZWxsIGFuYWx5c2lzIGFjcm9zcyBtb2RhbGl0aWVzIiBieSBIZXVtb3MsIFNjaGFhciwgTGFuY2UsIGV0IGFsLiBdKGh0dHBzOi8vd3d3LnNjLWJlc3QtcHJhY3RpY2VzLm9yZy9jZWxsdWxhcl9zdHJ1Y3R1cmUvYW5ub3RhdGlvbi5odG1sKSBwb2ludHMgb3V0IHRoYXQgIml0IGlzIG9mdGVuIHVzZWZ1bCB0byB3b3JrIHRvZ2V0aGVyIHdpdGggZXhwZXJ0cyAuLi4gW2xpa2UgYV0gYmlvbG9naXN0IHdobyBoYXMgbW9yZSBleHRlbnNpdmUga25vd2xlZGdlIG9mIHRoZSB0aXNzdWUsIHRoZSBiaW9sb2d5LCB0aGUgZXhwZWN0ZWQgY2VsbCB0eXBlcyBhbmQgbWFya2VycyBldGMuIi4gSW4gb3VyIGV4cGVyaWVuY2UsIHdlIGZpbmQgdGhhdCBleHBlcmllbmNlIGFuZCBrbm93bGVkZ2Ugb2YgdGhlIHJlc2VhcmNoZXJzIHdlIHdvcmsgd2l0aCBpcyBpbnZhbHVhYmxlLiAKCjwvZGV0YWlscz4KPGJyPgoKPGRldGFpbHM+CiAgICA8c3VtbWFyeT4qVXNpbmcgcmF3IFJOQSB2YWx1ZXMgZm9yIGdlbmVzIG9mIGludGVyZXN0IGZyb20gU29ya2luLCBIdWJlciBldCBhbCo8L3N1bW1hcnk+CiAgICBXZSBjYW4gYWxzbyBnZW5lcmF0ZSB0aGUgc2FtZSBwbG90cywgYnV0IHVzaW5nIHRoZSB1bmludGVncmF0ZWQgZGF0YSBieSBzcGVjaWZ5aW5nIHRoZSBgUk5BYCBhc3NheToKCmBgYHtyLCBrbm93bl9kb3RfcGxvdF9ybmEsIGV2YWw9RkFMU0V9CiMgVmlzdWFsaXplIG1hbnVhbGx5IHNlbGVjdGVkIG1hcmtlciBnZW5lcyAoZnJvbSB1bmludGVncmF0ZWQgZGF0YSkgLS0tLS0tCnJuYV9kb3RfcGxvdCA9IERvdFBsb3QoZ2VvX3NvLCBmZWF0dXJlcyA9IGZpZzFnX21hcmtlcnMsIGFzc2F5ID0gJ1JOQScpCmZpZzFoX3JuYV9kb3RfcGxvdCA9IERvdFBsb3QoZ2VvX3NvLCBmZWF0dXJlcyA9IGZpZzFoX21hcmtlcnMsIGFzc2F5ID0gJ1JOQScpCgpnZ3NhdmUoZmlsZW5hbWUgPSAncmVzdWx0cy9maWd1cmVzL21hcmtlcnNfZmlnMWdfcm5hX2RvdF9wbG90LnBuZycsIHBsb3QgPSBmaWcxZ19ybmFfZG90X3Bsb3QsIHdpZHRoID0gOCwgaGVpZ2h0ID0gNiwgdW5pdHMgPSAnaW4nKQpnZ3NhdmUoZmlsZW5hbWUgPSAncmVzdWx0cy9maWd1cmVzL21hcmtlcnNfZmlnMWhfcm5hX2RvdF9wbG90LnBuZycsIHBsb3QgPSBmaWcxaF9ybmFfZG90X3Bsb3QsIHdpZHRoID0gOCwgaGVpZ2h0ID0gNiwgdW5pdHMgPSAnaW4nKQpgYGAKPC9kZXRhaWxzPgo8YnI+CgoKIyBBbm5vdGF0ZSBjbHVzdGVycwoKTmV4dCwgd2UnbGwgbW9kaWZ5IHRoZSBjZWxsIHR5cGUgcHJlZGljdGlvbnMgYW5kIGFkZCB0aGUgbGFiZWxzIHRvIG91ciBTZXVyYXQgb2JqZWN0IHRvIHJlcGxhY2Ugb3VyIGNsdXN0ZXJzJyBudW1lcmljYWwgaWRlbnRpdGllcy4gTm90ZTogd2Ugd2lsbCBjcmVhdGUgYSBuZXcgbWV0YWRhdGEgb2JqZWN0IHdoZXJlIHdlIGpvaW4gY2VsbCB0eXBlcy4gSG93ZXZlciwgdGhpcyB3aWxsIGRlc3Ryb3kgdGhlIHJvdyBuYW1lcyAtIHdoaWNoIHdpbGwgY2F1c2UgYSBwcm9ibGVtIGluIFNldXJhdCAtIHNvIHdlIGhhdmUgdG8gYWRkIHRoZW0gYmFjay4gPCEtLS0gbW9kaWZ5IHRvIGhhdmUgYSBoaWRkZW4gYmxvY2sgdGhhdCBydW5zIGFmdGVyIHRvIGtlZXAgdGhpcyBsYXJnZSBibG9jayBpbnRhY3QgLS0+CgpgYGB7ciwgYW5ub3RhdGVfY2x1c3RlcnN9CiMgQW5ub3RhdGUgY2x1c3RlcnMgdXNpbmcgbW9kaWZpZWQgcHJlZGljdGlvbnMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojIEZpcnN0IC0gRXh0cmFjdCB0aGUgY2VsbCB0eXBlcyBvbmx5IGZyb20gdGhlIHByZWRpY3Rpb25zCmNlbGx0eXBlX2Fubm9zID0gZ2VvX2NhdGNoQGNlbGx0eXBlICU+JSBzZWxlY3QoY2x1c3RlciwgY2VsbF90eXBlKSAlPiUgCiAgbXV0YXRlKGNsdXN0ZXIgPSBmYWN0b3IoY2x1c3RlciwgbGV2ZWxzID0gYygwOjE5KSkpICU+JSBhcnJhbmdlKGNsdXN0ZXIpCmNlbGx0eXBlX2Fubm9zCgojIEN1c3RvbWl6ZSBhbm5vdGF0aW9ucywgcmVtZW1iZXJpbmcgdGhhdCBjbHVzdGVyIDAgPSByb3cgMSBpbiB0YWJsZQpjZWxsdHlwZV9hbm5vcyRjZWxsX3R5cGVbYygzLDE1KV0gPC0gIkluZmxhbW1hdG9yeSBtYWNyb3BoYWdlIiAjIHJlc29sdmVzIGNsdXN0ZXIgMiBhbmQgMTQKY2VsbHR5cGVfYW5ub3MkY2VsbF90eXBlW2MoMTEpXSA8LSAiTWFjcm9waGFnZSIKCmNlbGx0eXBlX2Fubm9zJGNlbGxfdHlwZVtjKDIpXSA8LSAiRmlicm9ibGFzdCIgIyByZXZpc2UgY2x1c3RlcnMgMSw2IGJhc2VkIG9uIG1hcmtlcnMKY2VsbHR5cGVfYW5ub3MkY2VsbF90eXBlW2MoNildIDwtICJNeW9maWJyb2JsYXN0IgpjZWxsdHlwZV9hbm5vcyRjZWxsX3R5cGVbYyg4LDkpXSA8LSAiRW5kb3RoZWxpYWwiICMgcmV2aXNlIGNsdXN0ZXIgNyw4OyBhbHNvIGhhdmUgd2Vha2VyIG1hc3QgY2VsbCBzaWduYWwKY2VsbHR5cGVfYW5ub3MkY2VsbF90eXBlW2MoNiwxMyldIDwtICJIZW1hdG9wb2lldGljIHN0ZW0gY2VsbCIgIyBiYXNlZCBvbiBtYXJrZXJzIGJ1dCBjb3VsZCBmdXJ0aGVyIHJldmlzZQpjZWxsdHlwZV9hbm5vcyRjZWxsX3R5cGVbYygxMCwxOSldIDwtICJNZXNlbmNoeW1hbCBzdGVtL3N0cm9tYWwgY2VsbCIgIyBiYXNlZCBvbiBBY3RhMiBzaWduYWwKY2VsbHR5cGVfYW5ub3MkY2VsbF90eXBlW2MoMTYpXSA8LSAiRXJ5dGhyb2lkIiAjIGNsdXN0ZXIgMTUsIGxlc3MgY29uZmlkZW50IGJ1dCBub3QgbmVhciBvdGhlciBkZW5kcml0aWMgY2VsbHMKY2VsbHR5cGVfYW5ub3MkY2VsbF90eXBlW2MoMjAsIDE3KV0gPC0gIlVua25vd24iICMgc2luY2Ugc3VjaCBzbWFsbCBwb3B1bGF0aW9ucywgcmVzZXQgY2x1c3RlciAxNiAmIDE5IGFzIHVua25vd24gZm9yIG5vdwoKCiMgTWVyZ2UgY2VsbCB0eXBlcyBpbiBidXQgYXMgYSBuZXcgdGFibGUgdG8gc2xpZGUgaW50byBAbWV0YS5kYXRhCm5ld19tZXRhZGF0YSA9IGdlb19zb0BtZXRhLmRhdGEgJT4lIGxlZnRfam9pbihjZWxsdHlwZV9hbm5vcywgYnkgPSBjKCdpbnRlZ3JhdGVkLnNjdC5ycGNhLmNsdXN0ZXJzJyA9ICdjbHVzdGVyJykpCnJvd25hbWVzKG5ld19tZXRhZGF0YSkgPSByb3duYW1lcyhnZW9fc29AbWV0YS5kYXRhKSAjICBXZSBhcmUgaW1wbGljaXRseSByZWx5aW5nIG9uIHRoZSBzYW1lIHJvdyBvcmRlciEKCiMgUmVwbGFjZSB0aGUgbWV0YS5kYXRhCmdlb19zb0BtZXRhLmRhdGEgPSBuZXdfbWV0YWRhdGEgCgpoZWFkKGdlb19zb0BtZXRhLmRhdGEpCmBgYAoKKipDaGVja3BvaW50KiogOiBIYXMgdGhlIG1ldGFkYXRhIGZvciB5b3VyIGBnZW9fc29gIG9iamVjdCBiZWVuIHVwZGF0ZWQ/CgpXZSBoYXZlIG5vdyBhZGRlZCBhICJjZWxsX3R5cGUiIGNvbHVtbiB0byB0aGUgYG1ldGEuZGF0YWAgdGFibGU6CgohW0ltYWdlOiBTY2hlbWF0aWMgYWZ0ZXIgYWRkaW5nIGNlbGxfdHlwZSBjb2x1bW4uXShpbWFnZXMvc2V1cmF0X3NjaGVtYXRpYy9TbGlkZTEyLnBuZykKCiMjIFZpc3VhbGlzZSBhbm5vdGF0ZWQgY2x1c3RlcnMKCkxhc3RseSwgd2UgY2FuIGdlbmVyYXRlIGEgcmV2aXNlZCBVTUFQIHBsb3Qgd2l0aCBvdXIgZGVzY3JpcHRpdmUgY2x1c3RlciBsYWJlbHMgYnkgdXNpbmcgb3VyIHVwZGF0ZWQgU2V1cmF0IG9iamVjdCBhbmQgcHJvdmlkaW5nIHRoZSBuZXcgYGNlbGxfdHlwZWAgbGFiZWwgZm9yIHRoZSBgZ3JvdXAuYnlgIGFyZ3VtZW50OgoKYGBge3IsIGNhdGNoX3VtYXBfcGxvdCwgZmlnLndpZHRoID0gMTAsIGZpZy5oZWlnaHQgPSA4LCBmaWcuc2hvdz0naG9sZCd9CiMgTWFrZSBhIGxhYmVsZWQgVU1BUCBwbG90IG9mIGNsdXN0ZXJzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjYXRjaF91bWFwX3Bsb3QgPSBEaW1QbG90KGdlb19zbywgZ3JvdXAuYnkgPSAnY2VsbF90eXBlJywgbGFiZWwgPSBUUlVFLCByZWR1Y3Rpb24gPSAndW1hcC5pbnRlZ3JhdGVkLnNjdC5ycGNhJykKY2F0Y2hfdW1hcF9wbG90CgpnZ3NhdmUoZmlsZW5hbWUgPSAncmVzdWx0cy9maWd1cmVzL3VtYXBfaW50ZWdyYXRlZF9jYXRjaC5wbmcnLCBwbG90ID0gY2F0Y2hfdW1hcF9wbG90LCB3aWR0aCA9IDEwLCBoZWlnaHQgPSA4LCB1bml0cyA9ICdpbicpCgpjYXRjaF91bWFwX2NvbmRpdGlvbl9wbG90ID0gRGltUGxvdChnZW9fc28sIGdyb3VwLmJ5ID0gJ2NlbGxfdHlwZScsIHNwbGl0LmJ5ID0gJ2RheScsIGxhYmVsID0gVFJVRSwgcmVkdWN0aW9uID0gJ3VtYXAuaW50ZWdyYXRlZC5zY3QucnBjYScpCmNhdGNoX3VtYXBfY29uZGl0aW9uX3Bsb3QKCmdnc2F2ZShmaWxlbmFtZSA9ICdyZXN1bHRzL2ZpZ3VyZXMvdW1hcF9pbnRlZ3JhdGVkX2NhdGNoX2J5Q29uZGl0aW9uLnBuZycsIHBsb3QgPSBjYXRjaF91bWFwX3Bsb3QsIHdpZHRoID0gMTAsIGhlaWdodCA9IDgsIHVuaXRzID0gJ2luJykKYGBgCgo8IS0tIHRvIGFkZCAtIG51bWJlciBvZiBjZWxscyBwZXIgY2x1c3RlciBhbmQgY29uZGl0aW9uL3JlcGxpY2F0ZSBhZnRlciBhbm5vdGF0aW9uIC0tLT4KCiMgU2F2ZSBvdXIgcHJvZ3Jlc3MKCldlJ2xsIHNhdmUgdGhlIHNjQ0FUQ0ggb2JqZWN0LiBUaGUgU2V1cmF0IG9iamVjdCBoYXMgbm90IGJlZW4gY2hhbmdlZCBpbiB0aGlzIG1vZHVsZS4KCmBgYHtyLCBzYXZlX3Jkc19oaWRkZW4sIGVjaG8gPSBGQUxTRX0KaWYoIWZpbGUuZXhpc3RzKCdyZXN1bHRzL3JkYXRhL2dlb19zb19zY3RfaW50ZWdyYXRlZF93aXRoX2NhdGNoLnJkcycpKSB7CiAgc2F2ZVJEUyhnZW9fc28sIGZpbGUgPSAncmVzdWx0cy9yZGF0YS9nZW9fc29fc2N0X2ludGVncmF0ZWRfd2l0aF9jYXRjaC5yZHMnKQp9CgppZighZmlsZS5leGlzdHMoJ3Jlc3VsdHMvcmRhdGEvZ2VvX2NhdGNoLnJkcycpKSB7CiAgc2F2ZVJEUyhnZW9fY2F0Y2gsIGZpbGUgPSAncmVzdWx0cy9yZGF0YS9nZW9fY2F0Y2gucmRzJykKfQpgYGAKCmBgYHtyLCBzYXZlX3JkcywgZXZhbD1GQUxTRX0KIyBTYXZlIFNldXJhdCBvYmplY3QgYW5kIGFubm90YXRpb25zIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCnNhdmVSRFMoZ2VvX3NvLCBmaWxlID0gJ3Jlc3VsdHMvcmRhdGEvZ2VvX3NvX3NjdF9pbnRlZ3JhdGVkX3dpdGhfY2F0Y2gucmRzJykKc2F2ZVJEUyhnZW9fY2F0Y2gsIGZpbGUgPSAncmVzdWx0cy9yZGF0YS9nZW9fY2F0Y2gucmRzJykKYGBgCgojIFN1bW1hcnkKCk5vdyB0aGF0IHdlIGhhdmUgZ2VuZXJhdGVkIHJlYXNvbmFibGUgYW5ub3RhdGlvbnMgZm9yIG91ciBjbHVzdGVycywgd2UgY2FuIHByb2NlZWQgd2l0aCB0aGUgc3RlcCBvZiBkaWZmZXJlbnRpYWwgZXhwcmVzc2lvbiB3aGljaCBpcyBlc3NlbnRpYWwgdG8gYWRkcmVzc2luZyBvdXIgYmlvbG9naWNhbCBxdWVzdGlvbiBmb3IgdGhpcyBleHBlcmltZW50LgoKTmV4dCBzdGVwczogRGlmZmVyZW50aWFsIEV4cHJlc3Npb24KCi0tLS0KClRoZXNlIG1hdGVyaWFscyBoYXZlIGJlZW4gYWRhcHRlZCBhbmQgZXh0ZW5kZWQgZnJvbSBtYXRlcmlhbHMgbGlzdGVkIGFib3ZlLiBUaGVzZSBhcmUgb3BlbiBhY2Nlc3MgbWF0ZXJpYWxzIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgW0NyZWF0aXZlIENvbW1vbnMgQXR0cmlidXRpb24gbGljZW5zZSAoQ0MgQlkgNC4wKV0oaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnkvNC4wLyksIHdoaWNoIHBlcm1pdHMgdW5yZXN0cmljdGVkIHVzZSwgZGlzdHJpYnV0aW9uLCBhbmQgcmVwcm9kdWN0aW9uIGluIGFueSBtZWRpdW0sIHByb3ZpZGVkIHRoZSBvcmlnaW5hbCBhdXRob3IgYW5kIHNvdXJjZSBhcmUgY3JlZGl0ZWQuCgo8YnIvPgo8YnIvPgo8aHIvPgp8IFtQcmV2aW91cyBsZXNzb25dKDA2LU1hcmtlclZpc3VhbGl6YXRpb24uaHRtbCkgfCBbVG9wIG9mIHRoaXMgbGVzc29uXSgjdG9wKSB8IFtOZXh0IGxlc3Nvbl0oMDgtRGlmZmVyZW50aWFsRXhwcmVzc2lvbi5odG1sKSB8CnwgOi0tLSB8IDotLS0tOiB8IC0tLTogfAo=</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("07-CellTypeAnnos.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
