function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var CanvasImage=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(t){this.context.putImageData(t,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(t,e){return this.getPalette(t,5,e)[0]},ColorThief.prototype.getPalette=function(t,e,o){void 0===e&&(e=10),(void 0===o||o<1)&&(o=10);for(var n,r,i,a,u=new CanvasImage(t),c=u.getImageData().data,s=u.getPixelCount(),l=[],h=0;h<s;h+=o)r=c[(n=4*h)+0],i=c[n+1],a=c[n+2],c[n+3]>=125&&(r>250&&i>250&&a>250||l.push([r,i,a]));var f=MMCQ.quantize(l,e),v=f?f.palette():null;return u.removeCanvas(),v},!pv)var pv={map:function(t,e){var o={};return e?t.map(function(t,n){return o.index=n,e.call(o,t)}):t.slice()},naturalOrder:function(t,e){return t<e?-1:t>e?1:0},sum:function(t,e){var o={};return t.reduce(e?function(t,n,r){return o.index=r,t+e.call(o,n)}:function(t,e){return t+e},0)},max:function(t,e){return Math.max.apply(null,e?pv.map(t,e):t)}};var MMCQ=function(){function t(t,e,o){return(t<<2*u)+(e<<u)+o}function e(t){function e(){o.sort(t),n=!0}var o=[],n=!1;return{push:function(t){o.push(t),n=!1},peek:function(t){return n||e(),void 0===t&&(t=o.length-1),o[t]},pop:function(){return n||e(),o.pop()},size:function(){return o.length},map:function(t){return o.map(t)},debug:function(){return n||e(),o}}}function o(t,e,o,n,r,i,a){var u=this;u.r1=t,u.r2=e,u.g1=o,u.g2=n,u.b1=r,u.b2=i,u.histo=a}function n(){this.vboxes=new e(function(t,e){return pv.naturalOrder(t.vbox.count()*t.vbox.volume(),e.vbox.count()*e.vbox.volume())})}function r(e){var o,n,r,i,a=1<<3*u,s=new Array(a);return e.forEach(function(e){n=e[0]>>c,r=e[1]>>c,i=e[2]>>c,o=t(n,r,i),s[o]=(s[o]||0)+1}),s}function i(t,e){var n,r,i,a=1e6,u=0,s=1e6,l=0,h=1e6,f=0;return t.forEach(function(t){n=t[0]>>c,r=t[1]>>c,i=t[2]>>c,n<a?a=n:n>u&&(u=n),r<s?s=r:r>l&&(l=r),i<h?h=i:i>f&&(f=i)}),new o(a,u,s,l,h,f,e)}function a(e,o){if(o.count()){var n=o.r2-o.r1+1,r=o.g2-o.g1+1,i=o.b2-o.b1+1,a=pv.max([n,r,i]);if(1==o.count())return[o.copy()];var u,c,s,l,h=0,f=[],v=[];if(a==n)for(u=o.r1;u<=o.r2;u++){for(l=0,c=o.g1;c<=o.g2;c++)for(s=o.b1;s<=o.b2;s++)l+=e[t(u,c,s)]||0;h+=l,f[u]=h}else if(a==r)for(u=o.g1;u<=o.g2;u++){for(l=0,c=o.r1;c<=o.r2;c++)for(s=o.b1;s<=o.b2;s++)l+=e[t(c,u,s)]||0;h+=l,f[u]=h}else for(u=o.b1;u<=o.b2;u++){for(l=0,c=o.r1;c<=o.r2;c++)for(s=o.g1;s<=o.g2;s++)l+=e[t(c,s,u)]||0;h+=l,f[u]=h}return f.forEach(function(t,e){v[e]=h-t}),function(t){var e,n,r,i,a,c=t+"1",s=t+"2",l=0;for(u=o[c];u<=o[s];u++)if(f[u]>h/2){for(r=o.copy(),i=o.copy(),a=(e=u-o[c])<=(n=o[s]-u)?Math.min(o[s]-1,~~(u+n/2)):Math.max(o[c],~~(u-1-e/2));!f[a];)a++;for(l=v[a];!l&&f[a-1];)l=v[--a];return r[s]=a,i[c]=r[s]+1,[r,i]}}(a==n?"r":a==r?"g":"b")}}var u=5,c=8-u,s=1e3,l=.75;return o.prototype={volume:function(t){var e=this;return e._volume&&!t||(e._volume=(e.r2-e.r1+1)*(e.g2-e.g1+1)*(e.b2-e.b1+1)),e._volume},count:function(e){var o=this,n=o.histo;if(!o._count_set||e){var r,i,a,u=0;for(r=o.r1;r<=o.r2;r++)for(i=o.g1;i<=o.g2;i++)for(a=o.b1;a<=o.b2;a++)index=t(r,i,a),u+=n[index]||0;o._count=u,o._count_set=!0}return o._count},copy:function(){var t=this;return new o(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(e){var o=this,n=o.histo;if(!o._avg||e){var r,i,a,c,s=0,l=1<<8-u,h=0,f=0,v=0;for(i=o.r1;i<=o.r2;i++)for(a=o.g1;a<=o.g2;a++)for(c=o.b1;c<=o.b2;c++)s+=r=n[t(i,a,c)]||0,h+=r*(i+.5)*l,f+=r*(a+.5)*l,v+=r*(c+.5)*l;o._avg=s?[~~(h/s),~~(f/s),~~(v/s)]:[~~(l*(o.r1+o.r2+1)/2),~~(l*(o.g1+o.g2+1)/2),~~(l*(o.b1+o.b2+1)/2)]}return o._avg},contains:function(t){var e=this,o=t[0]>>c;return gval=t[1]>>c,bval=t[2]>>c,o>=e.r1&&o<=e.r2&&gval>=e.g1&&gval<=e.g2&&bval>=e.b1&&bval<=e.b2}},n.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var e=this.vboxes,o=0;o<e.size();o++)if(e.peek(o).vbox.contains(t))return e.peek(o).color;return this.nearest(t)},nearest:function(t){for(var e,o,n,r=this.vboxes,i=0;i<r.size();i++)((o=Math.sqrt(Math.pow(t[0]-r.peek(i).color[0],2)+Math.pow(t[1]-r.peek(i).color[1],2)+Math.pow(t[2]-r.peek(i).color[2],2)))<e||void 0===e)&&(e=o,n=r.peek(i).color);return n},forcebw:function(){var t=this.vboxes;t.sort(function(t,e){return pv.naturalOrder(pv.sum(t.color),pv.sum(e.color))});var e=t[0].color;e[0]<5&&e[1]<5&&e[2]<5&&(t[0].color=[0,0,0]);var o=t.length-1,n=t[o].color;n[0]>251&&n[1]>251&&n[2]>251&&(t[o].color=[255,255,255])}},{quantize:function(t,o){function u(t,e){for(var o,n=1,r=0;r<s;)if((o=t.pop()).count()){var i=a(c,o),u=i[0],l=i[1];if(!u)return;if(t.push(u),l&&(t.push(l),n++),n>=e)return;if(r++>s)return}else t.push(o),r++}if(!t.length||o<2||o>256)return!1;var c=r(t),h=0;c.forEach(function(){h++});var f=i(t,c),v=new e(function(t,e){return pv.naturalOrder(t.count(),e.count())});v.push(f),u(v,l*o);for(var g=new e(function(t,e){return pv.naturalOrder(t.count()*t.volume(),e.count()*e.volume())});v.size();)g.push(v.pop());u(g,o-g.size());for(var p=new n;g.size();)p.push(g.pop());return p}}}(),_createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}();window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(t,e){e=e||window;for(var o=0;o<this.length;o++)t.call(e,this[o],o,this)});var Dbox=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=e.element,n=void 0===o?".dbox":o,r=e.dialogBox,i=void 0===r?"#js-dbox":r,a=e.modal,u=void 0!==a&&a;_classCallCheck(this,t),this.element=document.querySelectorAll(n),this.dialogBox=document.querySelector(i),this.modal=u,this.lbImage=this.dialogBox.getElementsByTagName("img")[0],this.lbCaption=this.dialogBox.getElementsByTagName("p")[0]}return _createClass(t,[{key:"open",value:function(t){this.insertImage(t),this.dialogBox.showModal()}},{key:"closeDialog",value:function(){var t=this;this.modal?(this.closeButton=this.dialogBox.querySelector("button"),this.closeButton.addEventListener("click",function(e){e.preventDefault(),t.dialogBox.close(),t.removeImage()})):this.dialogBox.addEventListener("click",function(e){e.preventDefault(),t.dialogBox.close(),t.removeImage()})}},{key:"insertImage",value:function(t){this.lbImage.setAttribute("src",t.getAttribute("href")),this.lbImage.setAttribute("alt",t.querySelector("img").getAttribute("alt")),this.insertLightboxCaption(t),this.updateDialogBG(this.dialogBox,t.querySelector("img"))}},{key:"insertLightboxCaption",value:function(t){return this.lbCaption.textContent=t.querySelector("img").getAttribute("alt")}},{key:"removeImage",value:function(){this.lbImage.setAttribute("src","")}},{key:"getThumbColor",value:function(t){return(new ColorThief).getColor(t)}},{key:"updateDialogBG",value:function(t,e){var o=this.getThumbColor(e),n=t.querySelector(".dbox-dialog--container");t.querySelector("img").style.backgroundColor="rgb("+o+")",n.style.backgroundColor="rgb("+o+")",this.lbCaption.style.color=this.setTextContrast(o)}},{key:"setTextContrast",value:function(t){return Math.round((299*parseInt(t[0])+587*parseInt(t[1])+114*parseInt(t[2]))/1e3)>125?"#000":"#fff"}},{key:"run",value:function(){var t=this;this.element.forEach(function(e){e.addEventListener("click",function(o){o.preventDefault(),t.open(e)})}),this.closeDialog()}}]),t}();