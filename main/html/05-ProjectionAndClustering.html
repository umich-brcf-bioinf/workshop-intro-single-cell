<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="UM Bioinformatics Core" />

<meta name="date" content="2024-02-26" />

<title>Clustering and Projection</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<!--
Favicon dervied from
https://twemoji.twitter.com/
https://favicon.io/emoji-favicons/dna/
-->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="shortcut icon" href="favicon-16x16.png" />
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Intro to scRNA-Seq</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="workshop_intro.html">Intro</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 1
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="00A-OrientingOnScRNASeq.html">Orienting on scRNA-Seq</a>
    </li>
    <li>
      <a href="00B-CellRangerInAction.html">Cell Ranger in Action</a>
    </li>
    <li>
      <a href="01-GettingStarted.html">Seurat</a>
    </li>
    <li>
      <a href="02-QCandFiltering.html">Secondary QC &amp; Filtering</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 2
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="03-Integration.html">Normalization</a>
    </li>
    <li>
      <a href="04-PCAandDimReduction.html">PCA &amp; Integration</a>
    </li>
    <li>
      <a href="05-ProjectionAndClustering.html">Projection &amp; Clustering</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 3
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="06-MarkerVisualization.html">Marker identification and visualization</a>
    </li>
    <li>
      <a href="07-CellTypeAnnos.html">Cell type annotation</a>
    </li>
    <li>
      <a href="08-DifferentialExpression.html">Differential expression analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="workshop_wrap_up.html">Wrap up</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Clustering and Projection</h1>
<h4 class="author">UM Bioinformatics Core</h4>
<h4 class="date">2024-02-26</h4>

</div>


<style type="text/css">
body, td {
   font-size: 18px;
}
code.r{
  font-size: 12px;
}
pre {
  font-size: 12px
}
</style>
<div id="workflow-overview" class="section level1 unlisted unnumbered">
<h1 class="unlisted unnumbered">Workflow Overview</h1>
<p><br/>
<img src="images/wayfinder/wayfinder.png" alt="wayfinder" style="height: 400px;"/>
<br/> <br/></p>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<!--- General goal: to generate clusters that reasonably approximate cell-types or sub-types of interest --->
<p>One of our goals in a single-cell analysis is to generate clusters
that reasonably approximate cell-types or sub-types of interest in our
samples before determining if there are differences in the proportions
of these populations or differences in gene expression within these
populations between experimental conditions.</p>
<p>In this section, we will demonstrate how to generate clusters using
Seurat’s graph based clustering approach and visualizing those
clustering assignments via a lower dimensionality projection of the full
dataset.</p>
<p>Like other steps in our analysis, multiple parameters may need to be
tested and evaluated while we would expect that only the final would be
reported. Clustering is considered part of data exploration so an
iterative approach is reasonable and often expected <a
href="https://bioconductor.org/books/3.15/OSCA.basic/clustering.html">source</a>.</p>
<div id="objectives" class="section level2">
<h2>Objectives</h2>
<ul>
<li>Understand the clustering process and input parameters</li>
<li>Generate initial clusters and visualize the results</li>
</ul>
<hr />
</div>
</div>
<div id="clustering-and-projection" class="section level1">
<h1>Clustering and projection</h1>
<p>An important aspect of parameter selection for clustering is to
understand the “resolution” of the underlying biology and your
experimental design. Is answering your biological question dependent on
identifying rarer cell types or specific subtypes? Or are broader
cell-types more relevant to address your biological question?</p>
<p>The OSCA book has a <a
href="https://bioconductor.org/books/3.15/OSCA.basic/clustering.html#overview-1">helpful
analogy comparing clustering to microscopy</a> and points out that
“asking for an unqualified “best” clustering is akin to asking for the
best magnification on a microscope without any context”.</p>
<p>We’ve already selected a number of PCs that we think are likely to
represent biological variation in our data while excluding technical
variability. Next, we’ll need to determine the “community” of cells
based on the selected PCs (and the corresponding gene expression) and
before selecting a resolution to use to divide those communities into
discrete clusters.</p>
<!--- Contrast the previous dimensionality reduction versus nearest neighbors clustering and plotting the cells in lower dimensionality with the cluster labels? --->
<div id="clustering" class="section level2">
<h2>Clustering</h2>
<p>Seurat uses a graph-based clustering approach to assign cells to
clusters using a distance metric based on the previously generated PCs,
with improvements based on work by (<a
href="https://academic.oup.com/bioinformatics/article/31/12/1974/214505">Xu
and Su 2015</a>) and CyTOF data (<a
href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4508757/">Levine et
al. 2015</a> implemented in Seurat v3 and v5 and building on the initial
strategies for droplet based single cell technology <a
href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4481139/">Macosko et
al. 2015</a> <a
href="https://satijalab.org/seurat/articles/pbmc3k_tutorial.html">source</a>.
A key aspect of this process is that while the clusters are based on
similarity of expression between the cells, the clustering is based on
the selected PCs and therefore limited to the genes contributing to
those PCs.</p>
<div class="float">
<img
src="images/curriculum/05-ProjectionAndClustering/BioCellGene-NearestNeighborNetworks.png"
alt="KNN example - section on graph based clustering (from Cambridge Bioinformatics course)" />
<div class="figcaption">KNN example - section on graph based clustering
(from Cambridge Bioinformatics course)</div>
</div>
<p>To briefly summarize, cells are embedded in a KNN graph (illustrated
above) based on “the euclidean distance in PCA space” between the cells
<a
href="https://hbctraining.github.io/scRNA-seq_online/lessons/07_SC_clustering_cells_SCT.html">source</a>
and the edge weights between any two cells (e.g. their “closeness”) is
refined based on Jaccard similarity.</p>
<details>
<summary>
<em>Additional context and sources for graph-based clustering</em>
</summary>
<a
href="https://biocellgen-public.svi.edu.au/mig_2019_scrnaseq-workshop/clustering-and-cell-annotation.html">Cambridge
Bioinformatics’ Analysis of single cell RNA-seq data course
materials</a>, the source of the image above, delves into KNN and other
graph based clustering methods in much greater detail, including
outlining possible downsides for these methods. To described KNN, we
have also drawn from the <a
href="https://holab-hku.github.io/Fundamental-scRNA/downstream.html#perform-linear-dimensional-reduction">Ho
Lab’s description of this process for Seurat v3</a> as well as the <a
href="https://hbctraining.github.io/scRNA-seq_online/lessons/07_SC_clustering_cells_SCT.html">HBC
materials on clustering</a> and the <a
href="https://bioconductor.org/books/3.15/OSCA.basic/clustering.html#clustering-graph">OSCA
book’s more general overview of graph based clustering</a>, which also
describes the drawbacks for these methods.
</details>
<p><br></p>
<p>This process is performed with the <code>FindNeighbors</code> <a
href="https://satijalab.org/seurat/reference/findclusters">command</a>,
using the number of principal components we selected in the previous
section.</p>
<pre class="r"><code>geo_so = FindNeighbors(geo_so, dims = 1:pcs, reduction = &#39;integrated.sct.rpca.clusters&#39;)</code></pre>
<p>The second step is to iteratively partition the kNN graph into
“cliques” or clusters using the Louvain modularity optimization
algorithm (for the default parameters), with the “granularity” of the
clusters set by a <code>resolution</code> parameter <a
href="https://satijalab.org/seurat/articles/pbmc3k_tutorial.html">source</a>.</p>
<div class="float">
<img
src="images/curriculum/05-ProjectionAndClustering/HBC-07-k-meansFigure.png"
alt="K-means clustering example (from Cambridge Bioinformatics course)" />
<div class="figcaption">K-means clustering example (from Cambridge
Bioinformatics course)</div>
</div>
<p>We’ll use the <code>FindClusters</code> <a
href="https://satijalab.org/seurat/reference/findclusters">function</a>,
selecting a resolution of <code>0.4</code> to start, although we could
also add other resolutions at this stage to look at in later steps.</p>
<pre class="r"><code>geo_so = FindClusters(geo_so, resolution = 0.4, cluster.name = &#39;integrated.sct.rpca.clusters&#39;)</code></pre>
<blockquote>
<p>Note - Seurat’s <code>FindClusters</code> function is based on
algorithms described by <a
href="https://link.springer.com/article/10.1140/epjb/e2013-40829-0">Waltman
and Jan van Eck (2013)</a></p>
</blockquote>
<p>Generally it’s preferable to err on the side of too many clusters, as
they can be combined manually in later steps. However, this is another
parameter that in our experience may need to be iteratively revised and
reviewed.</p>
<details>
<summary>
<em>Resolution parameter recommendations</em>
</summary>
The <a
href="https://holab-hku.github.io/Fundamental-scRNA/downstream.html#perform-linear-dimensional-reduction">Seurat
clustering tutorial</a> recommends selecting a resolution between 0.4 -
1.2 for datasets of approximately 3k cells, while the <a
href="https://hbctraining.github.io/scRNA-seq_online/lessons/07_SC_clustering_cells_SCT.html">HBC
course</a> recommends 0.4-1.4 for 3k-5k cells. However, in our
experience reasonable starting resolutions can be very dataset
dependent.
</details>
<p><br></p>
<p>Again, how a “cell type” or “subtype” should be defined for your data
is helpful to consider in selecting a resolution - we’d start with a
higher resolution for smaller/more rare clusters and a lower resolution
for larger/more general clusters.</p>
<p>If we look at our object after running these commands, we don’t see a
change.</p>
<pre class="r"><code>geo_so</code></pre>
<pre><code># An object of class Seurat 
# 47037 features across 29615 samples within 2 assays 
# Active assay: SCT (20548 features, 3000 variable features)
#  3 layers present: counts, data, scale.data
#  1 other assay present: RNA
#  3 dimensional reductions calculated: unintegrated.sct.pca, integrated.sct.rpca, umap.unintegrated.sct.pca</code></pre>
<p>However, if we look at the meta data we can see that cluster labels
have now been added for each cell:</p>
<pre class="r"><code>head(geo_so@meta.data)</code></pre>
<pre><code>#                                             orig.ident nCount_RNA nFeature_RNA  day  replicate percent.mt nCount_SCT nFeature_SCT
HODay0replicate1_AAACCTGAGAGAACAG-1 HO.Day0.replicate1      10234         3226 Day0 replicate1   1.240962       6061         2865
HODay0replicate1_AAACCTGGTCATGCAT-1 HO.Day0.replicate1       3158         1499 Day0 replicate1   7.536415       4625         1510
HODay0replicate1_AAACCTGTCAGAGCTT-1 HO.Day0.replicate1      13464         4102 Day0 replicate1   3.112002       5426         2485
HODay0replicate1_AAACGGGAGGCCCGTT-1 HO.Day0.replicate1       1189          629 Day0 replicate1   3.700589       4165          919
HODay0replicate1_AAACGGGCAACTGGCC-1 HO.Day0.replicate1       7726         2602 Day0 replicate1   2.938131       5858         2585
HODay0replicate1_AAACGGGGTCCGAATT-1 HO.Day0.replicate1       5165         2362 Day0 replicate1   9.196515       5162         2348
#                                     unintegrated.sct.clusters seurat_clusters integrated.sct.rpca.clusters SCT_snn_res.0.4 SCT_snn_res.0.8
HODay0replicate1_AAACCTGAGAGAACAG-1                         4               8                            2               2               8
HODay0replicate1_AAACCTGGTCATGCAT-1                         4               8                            2               2               8
HODay0replicate1_AAACCTGTCAGAGCTT-1                         4               6                            3               3               6
HODay0replicate1_AAACGGGAGGCCCGTT-1                         4               2                            2               2               2
HODay0replicate1_AAACGGGCAACTGGCC-1                         4               8                            2               2               8
HODay0replicate1_AAACGGGGTCCGAATT-1                        11               9                            8               8               9</code></pre>
<p><em>Note - the example output has more resolutions represented than
is currently specified in the code above</em></p>
</div>
</div>
<div id="cluster-plots" class="section level1">
<h1>Cluster plots</h1>
<p>To visualize the cell clusters, we can use dimensionality reduction
techniques to visualize and explore our large, high dimensional dataset.
Two popular methods that are supported by Seurat are t-distributed
stochastic neighbor embedding (t-SNE) and Uniform Manifold Approximation
and Projection (UMAP) techniques. These techniques allow us to visualize
our high dimensional single-cell data in 2D space and see if cells
grouped together within graph-based clusters co-localize in these
representations <a
href="https://satijalab.org/seurat/articles/pbmc3k_tutorial.html#run-non-linear-dimensional-reduction-umaptsne">source</a>.</p>
<p>While we unfortunately don’t have time to compare and contrast tSNE,
and UMAP, we would highly recommend <a
href="https://pair-code.github.io/understanding-umap/">this blog post
contrasting tSNE and UMAP</a> for illustrative examples. The Seurat
authors additionally caution that while these methods are useful for
data exploration, to avoid drawing biological conclusions solely based
on these visualizations <a
href="https://satijalab.org/seurat/articles/pbmc3k_tutorial.html#run-non-linear-dimensional-reduction-umaptsne">source</a></p>
<p>To start this process, we’ll use the <code>RunUMAP</code> function to
calculate the UMAP reduction for our data. Notice how the previous
dimensionality choices carry through the downstream analysis and that
the number of PCs selected in the previous steps are included as an
argument.</p>
<pre class="r"><code>geo_so = RunUMAP(geo_so, dims = 1:pcs, reduction = &#39;integrated.sct.pca&#39;, reduction.name = &#39;umap.integrated.sct.pca&#39;)</code></pre>
</div>
<div id="visualizing-and-evaluating-clustering" class="section level1">
<h1>Visualizing and evaluating clustering</h1>
<!--- How many clusters should I get and how do I adjust the number? --->
<!--- Add example of changing resolution?--->
<p>After we generate the UMAP reduction, we can then visualize the
results using the <code>DimPlot</code> function, labeling our plot by
the auto generated <code>seurat_clusters</code> that correspond to the
most recent clustering results generated:</p>
<pre class="r"><code>post_integration_umap_plot_clusters = DimPlot(geo_so, group.by = &#39;seurat_clusters&#39;, label = FALSE, reduction = &#39;umap.integrated.sct.rpca&#39;)

ggsave(filename = &#39;results/figures/umap_integrated_sct_clusters.png&#39;, plot = post_integration_umap_plot_clusters, width = 8, height = 6, units = &#39;in&#39;)</code></pre>
<p><img
src="images/curriculum/05-ProjectionAndClustering/umap_integrated_sct_0.4.png" /></p>
<p>At this stage, we want to determine if the clusters look fairly well
separated, if they seem to correspond to how cells are grouped in the
UMAP, and if the number of clusters are aligned with the resolution of
our biological question.</p>
<p>We can also look at the same UMAP, but labeling by <code>day</code>
instead of cluster:</p>
<pre class="r"><code>post_integration_umap_plot_day = DimPlot(geo_so, group.by = &#39;day&#39;, label = FALSE, reduction = &#39;umap.integrated.sct.rpca&#39;)

ggsave(filename = &#39;results/figures/umap_integrated_sct_day.png&#39;, plot = post_integration_umap_plot_day)</code></pre>
<p>A plot like this can tell us how much possible technical sources of
variation groupings might be driving or stratifying the clusters or if
we see good correction after the normalization and integration
steps.</p>
<p><img
src="images/curriculum/05-ProjectionAndClustering/umap_integrated_sct_day.png" /></p>
<p>We can also evaluate the number of cells per cluster using the
<code>table()</code> function, split by <code>day</code>:</p>
<pre class="r"><code>table(geo_so@meta.data$day, geo_so@meta.data$integrated.sct.rpca.clusters)</code></pre>
<pre><code>#       0    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16   17   18   19
Day0    65  240  843  317  167   36   36  125  778  132  125  305   55   29  159  133   56  141   37   19
Day7  3184 2497  972 1689 2037 2374 1596  929  108  548  566  382  627  686  309   97  262   86   14   36
Day21 1329  355  964  663  461  147   81  452  383  499  379  227  108   72   42  252  117  195   80   12
</code></pre>
<p>… or split by <code>orig.ident</code> e.g. by individual sample:</p>
<pre class="r"><code>table(geo_so@meta.data$orig.ident, geo_so@meta.data$integrated.sct.rpca.clusters)</code></pre>
<pre><code>#                   0    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16   17   18   19
HO.Day0.replicate1    14   82  250   96   52   17   15   24  203   33   32   84   17   11   47   20    5   35    5    7
HO.Day0.replicate2    10   38  110   33   33    4    6   34  152   27   20   57    8    6   13   25   13   16    9    1
HO.Day0.replicate3    25   72  300  117   46    3    5   25  227   40   42   86   16    5   58   40   16   54   12    2
HO.Day0.replicate4    16   48  183   71   36   12   10   42  196   32   31   78   14    7   41   48   22   36   11    9
HO.Day7.replicate1   410  587  285  431  506  766  755  157   45  113  190   79  167  213   63   40   72   28    4   17
HO.Day7.replicate2  1156  616  184  361  580  468  220  372    7  158  135  126  180  160   86   19   88   12    1    3
HO.Day7.replicate3   887  722  377  592  534  395   90  241   48  178  146  110  163  164   93   27   72   36    8   14
HO.Day7.replicate4   731  572  126  305  417  745  531  159    8   99   95   67  117  149   67   11   30   10    1    2
HO.Day21.replicate1  338   96  317  221  144   40   30  139  115  145  110   73   35   14   13   65   26   56   20    3
HO.Day21.replicate2  168   69  189   86   82   25   12  106  113   78   48   40   15   14    6   51   29   29   17    5
HO.Day21.replicate3  184   72  168   93   91   26    8   62  100   90   69   34   16   20    7   55   20   39    9    3
HO.Day21.replicate4  639  118  290  263  144   56   31  145   55  186  152   80   42   24   16   81   42   71   34    1</code></pre>
<!-- consider adding later 
# Other approaches for visualizing scRNA-sq data

code for tSNE visualization --->
</div>
<div id="comparing-to-unintegrated-data" class="section level1">
<h1>Comparing to unintegrated data</h1>
<p>If we had proceeded with our filtered data and only normalized our
data without doing any integration, including through the dimensionality
reduction and clustering steps and then labeled the cells with their
sample of origin, then we would see the following for our data:</p>
<!--Add example of UMAP / sample labels for unintegrated data from analysis folder to images-->
<p><img
src="images/curriculum/05-ProjectionAndClustering/umap_unintegrated_sct_orig.ident.png" /></p>
<p>If we instead labeled our plot by <code>day</code>, then we would
see: <img
src="images/curriculum/05-ProjectionAndClustering/umap_unintegrated_sct_day.png" /></p>
<p>In this plot, we see that while there are distinct clusters, those
clusters seem to stratified by day. This suggests that without
integration, these batch effects could skew the biological variability
in our data.</p>
<!-- Edit section to incorporate --->
<details>
<summary>
<strong>Rewind: Pre-integration evaluation clustering and
visualization</strong>
</summary>
<p>Prior to integration, could follow the same steps we’ve just run for
the integrated to see if the resulting clusters tend to be determined by
sample or condition (in this case, the day):</p>
<pre class="r"><code>    # DefaultAssay(geo_so) = &#39;RNA&#39;
  
    geo_so = RunPCA(geo_so, reduction.name = &#39;unintegrated.sct.pca&#39;)
    geo_so = FindNeighbors(geo_so, dims = 1:25, reduction = &#39;unintegrated.sct.pca&#39;)
    geo_so = FindClusters(geo_so, resolution = 0.4, cluster.name = &#39;unintegrated.sct.clusters&#39;)
    geo_so = RunUMAP(geo_so, dims = 1:25, reduction = &#39;unintegrated.sct.pca&#39;,   reduction.name = &#39;umap.unintegrated.sct.pca&#39;)</code></pre>
<p>From this image, we can qualitatively see that some clusters seem to
be driven by the original identity. We can see this even more clearly if
we use <code>group.by = 'day'</code>:</p>
<pre class="r"><code>    pre_integration_umap_plot = DimPlot(geo_so, group.by = &#39;day&#39;, label = FALSE,    reduction = &#39;umap.unintegrated.sct.pca&#39;) + NoLegend()
    ggsave(filename = &#39;ISC_R/results/figures/umap_unintegrated_sct_day.png&#39;, plot = pre_integration_umap_plot)
    ```


    
    ```r
    pre_post_integration_plot = pre_integration_umap_plot_day |     post_integration_umap_plot_day
    
    ggsave(filename = &#39;results/figures/umap_comparison_sct.png&#39;, plot = pre_post_integration_plot, width = 12, height = 6, units = &#39;in&#39;)
    ```
&lt;/details&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;


&lt;details&gt;
    &lt;summary&gt;**Alternative clustering resolutions**&lt;/summary&gt;
    While we show a single resolution, we can generate and plot multiple resolutions iteratively and compare between them before selecting a clustering result for the next steps:
      
      ```r
      resolutions = c(0.4, 0.8)
      # seq(from = 0.1, to = 1, by = 0.1)
      
      for(res in resolutions) {
          message(res)
          
          cluster_column = sprintf(&#39;SCT_snn_res.%s&#39;, res)
          umap_file = sprintf(&#39;results/figures/umap_integrated_sct_%s.png&#39;, res)
          
          geo_so = FindClusters(geo_so, resolution = res)
          
          DimPlot(geo_so, group.by = cluster_column, label = FALSE, reduction = &#39;umap.integrated.sct.rpca&#39;)
          ggsave(filename = umap_file, width = 8, height = 7, units = &#39;in&#39;)
      }
      ```

    If we look at the results... :
      
      ```r
      head(geo_so@meta.data)
      ```
    ... multiple resolutions should now be added to the metadata slot.
&lt;/details&gt;
&lt;br&gt;


## Save our progress

Before moving on to our next section, we will output our updated Seurat object to file:

```r
saveRDS(object = geo_so, file = &#39;results/rdata/geo_so_sct_clustered.rda&#39;)</code></pre>
</div>
<div id="summary" class="section level1">
<h1>Summary</h1>
<p>In this section we:</p>
<ul>
<li>Generated cluster assignments for our cells using
<code>FindNeighbors</code> and <code>FindClusters</code></li>
<li>Evaluated our initial clusters using <code>RunUMAP</code>
dimensional reduction and visualization</li>
</ul>
<p>Next steps: Marker genes</p>
<hr />
<p>These materials have been adapted and extended from materials listed
above. These are open access materials distributed under the terms of
the <a href="http://creativecommons.org/licenses/by/4.0/">Creative
Commons Attribution license (CC BY 4.0)</a>, which permits unrestricted
use, distribution, and reproduction in any medium, provided the original
author and source are credited.</p>
<br/> <br/>
<hr/>
<table style="width:100%;">
<colgroup>
<col width="28%" />
<col width="42%" />
<col width="28%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><a href="04-PCAandDimReduction.html">Previous
lesson</a></th>
<th align="center"><a href="#top">Top of this lesson</a></th>
<th align="right"><a href="06-MarkerVisualization.html">Next
lesson</a></th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiQ2x1c3RlcmluZyBhbmQgUHJvamVjdGlvbiIKYXV0aG9yOiAiVU0gQmlvaW5mb3JtYXRpY3MgQ29yZSIKZGF0ZTogImByIFN5cy5EYXRlKClgIgpvdXRwdXQ6CiAgICAgICAgaHRtbF9kb2N1bWVudDoKICAgICAgICAgICAgaW5jbHVkZXM6CiAgICAgICAgICAgICAgICBpbl9oZWFkZXI6IGhlYWRlci5odG1sCiAgICAgICAgICAgIHRoZW1lOiBwYXBlcgogICAgICAgICAgICB0b2M6IHRydWUKICAgICAgICAgICAgdG9jX2RlcHRoOiA0CiAgICAgICAgICAgIHRvY19mbG9hdDogdHJ1ZQogICAgICAgICAgICBudW1iZXJfc2VjdGlvbnM6IGZhbHNlCiAgICAgICAgICAgIGZpZ19jYXB0aW9uOiB0cnVlCiAgICAgICAgICAgIG1hcmtkb3duOiBHRk0KICAgICAgICAgICAgY29kZV9kb3dubG9hZDogdHJ1ZQotLS0KCjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+CmJvZHksIHRkIHsKICAgZm9udC1zaXplOiAxOHB4Owp9CmNvZGUucnsKICBmb250LXNpemU6IDEycHg7Cn0KcHJlIHsKICBmb250LXNpemU6IDEycHgKfQo8L3N0eWxlPgoKYGBge3IsIGluY2x1ZGUgPSBGQUxTRX0Kc291cmNlKCIuLi9iaW4vY2h1bmstb3B0aW9ucy5SIikKa25pdHJfZmlnX3BhdGgoIlhYIikKYGBgCgojIFdvcmtmbG93IE92ZXJ2aWV3IHsudW5saXN0ZWQgLnVubnVtYmVyZWR9Cgo8YnIvPgo8aW1nIHNyYz0iaW1hZ2VzL3dheWZpbmRlci93YXlmaW5kZXIucG5nIiBhbHQ9IndheWZpbmRlciIgc3R5bGU9ImhlaWdodDogNDAwcHg7Ii8+Cjxici8+Cjxici8+CgojIEludHJvZHVjdGlvbgoKPCEtLS0gR2VuZXJhbCBnb2FsOiB0byBnZW5lcmF0ZSBjbHVzdGVycyB0aGF0IHJlYXNvbmFibHkgYXBwcm94aW1hdGUgY2VsbC10eXBlcyBvciBzdWItdHlwZXMgb2YgaW50ZXJlc3QgLS0tPgpPbmUgb2Ygb3VyIGdvYWxzIGluIGEgc2luZ2xlLWNlbGwgYW5hbHlzaXMgaXMgdG8gZ2VuZXJhdGUgY2x1c3RlcnMgdGhhdCByZWFzb25hYmx5IGFwcHJveGltYXRlIGNlbGwtdHlwZXMgb3Igc3ViLXR5cGVzIG9mIGludGVyZXN0IGluIG91ciBzYW1wbGVzIGJlZm9yZSBkZXRlcm1pbmluZyBpZiB0aGVyZSBhcmUgZGlmZmVyZW5jZXMgaW4gdGhlIHByb3BvcnRpb25zIG9mIHRoZXNlIHBvcHVsYXRpb25zIG9yIGRpZmZlcmVuY2VzIGluIGdlbmUgZXhwcmVzc2lvbiB3aXRoaW4gdGhlc2UgcG9wdWxhdGlvbnMgYmV0d2VlbiBleHBlcmltZW50YWwgY29uZGl0aW9ucy4KCgpJbiB0aGlzIHNlY3Rpb24sIHdlIHdpbGwgZGVtb25zdHJhdGUgaG93IHRvIGdlbmVyYXRlIGNsdXN0ZXJzIHVzaW5nIFNldXJhdCdzIGdyYXBoIGJhc2VkIGNsdXN0ZXJpbmcgYXBwcm9hY2ggYW5kIHZpc3VhbGl6aW5nIHRob3NlIGNsdXN0ZXJpbmcgYXNzaWdubWVudHMgdmlhIGEgbG93ZXIgZGltZW5zaW9uYWxpdHkgcHJvamVjdGlvbiBvZiB0aGUgZnVsbCBkYXRhc2V0LgoKTGlrZSBvdGhlciBzdGVwcyBpbiBvdXIgYW5hbHlzaXMsIG11bHRpcGxlIHBhcmFtZXRlcnMgbWF5IG5lZWQgdG8gYmUgdGVzdGVkIGFuZCBldmFsdWF0ZWQgd2hpbGUgd2Ugd291bGQgZXhwZWN0IHRoYXQgb25seSB0aGUgZmluYWwgd291bGQgYmUgcmVwb3J0ZWQuIENsdXN0ZXJpbmcgaXMgY29uc2lkZXJlZCBwYXJ0IG9mIGRhdGEgZXhwbG9yYXRpb24gc28gYW4gaXRlcmF0aXZlIGFwcHJvYWNoIGlzIHJlYXNvbmFibGUgYW5kIG9mdGVuIGV4cGVjdGVkIFtzb3VyY2VdKGh0dHBzOi8vYmlvY29uZHVjdG9yLm9yZy9ib29rcy8zLjE1L09TQ0EuYmFzaWMvY2x1c3RlcmluZy5odG1sKS4gCgoKIyMgT2JqZWN0aXZlcwoKLSBVbmRlcnN0YW5kIHRoZSBjbHVzdGVyaW5nIHByb2Nlc3MgYW5kIGlucHV0IHBhcmFtZXRlcnMKLSBHZW5lcmF0ZSBpbml0aWFsIGNsdXN0ZXJzIGFuZCB2aXN1YWxpemUgdGhlIHJlc3VsdHMKCi0tLQoKCiMgQ2x1c3RlcmluZyBhbmQgcHJvamVjdGlvbgoKCkFuIGltcG9ydGFudCBhc3BlY3Qgb2YgcGFyYW1ldGVyIHNlbGVjdGlvbiBmb3IgY2x1c3RlcmluZyBpcyB0byB1bmRlcnN0YW5kIHRoZSAicmVzb2x1dGlvbiIgb2YgdGhlIHVuZGVybHlpbmcgYmlvbG9neSBhbmQgeW91ciBleHBlcmltZW50YWwgZGVzaWduLiBJcyBhbnN3ZXJpbmcgeW91ciBiaW9sb2dpY2FsIHF1ZXN0aW9uIGRlcGVuZGVudCBvbiBpZGVudGlmeWluZyByYXJlciBjZWxsIHR5cGVzIG9yIHNwZWNpZmljIHN1YnR5cGVzPyBPciBhcmUgYnJvYWRlciBjZWxsLXR5cGVzIG1vcmUgcmVsZXZhbnQgdG8gYWRkcmVzcyB5b3VyIGJpb2xvZ2ljYWwgcXVlc3Rpb24/CgpUaGUgT1NDQSBib29rIGhhcyBhIFtoZWxwZnVsIGFuYWxvZ3kgY29tcGFyaW5nIGNsdXN0ZXJpbmcgdG8gbWljcm9zY29weV0oaHR0cHM6Ly9iaW9jb25kdWN0b3Iub3JnL2Jvb2tzLzMuMTUvT1NDQS5iYXNpYy9jbHVzdGVyaW5nLmh0bWwjb3ZlcnZpZXctMSkgYW5kIHBvaW50cyBvdXQgdGhhdCAiYXNraW5nIGZvciBhbiB1bnF1YWxpZmllZCDigJxiZXN04oCdIGNsdXN0ZXJpbmcgaXMgYWtpbiB0byBhc2tpbmcgZm9yIHRoZSBiZXN0IG1hZ25pZmljYXRpb24gb24gYSBtaWNyb3Njb3BlIHdpdGhvdXQgYW55IGNvbnRleHQiLiAKCldlJ3ZlIGFscmVhZHkgc2VsZWN0ZWQgYSBudW1iZXIgb2YgUENzIHRoYXQgd2UgdGhpbmsgYXJlIGxpa2VseSB0byByZXByZXNlbnQgYmlvbG9naWNhbCB2YXJpYXRpb24gaW4gb3VyIGRhdGEgd2hpbGUgZXhjbHVkaW5nIHRlY2huaWNhbCB2YXJpYWJpbGl0eS4gTmV4dCwgd2UnbGwgbmVlZCB0byBkZXRlcm1pbmUgdGhlICJjb21tdW5pdHkiIG9mIGNlbGxzIGJhc2VkIG9uIHRoZSBzZWxlY3RlZCBQQ3MgKGFuZCB0aGUgY29ycmVzcG9uZGluZyBnZW5lIGV4cHJlc3Npb24pIGFuZCBiZWZvcmUgc2VsZWN0aW5nIGEgcmVzb2x1dGlvbiB0byB1c2UgdG8gZGl2aWRlIHRob3NlIGNvbW11bml0aWVzIGludG8gZGlzY3JldGUgY2x1c3RlcnMuIAoKPCEtLS0gQ29udHJhc3QgdGhlIHByZXZpb3VzIGRpbWVuc2lvbmFsaXR5IHJlZHVjdGlvbiB2ZXJzdXMgbmVhcmVzdCBuZWlnaGJvcnMgY2x1c3RlcmluZyBhbmQgcGxvdHRpbmcgdGhlIGNlbGxzIGluIGxvd2VyIGRpbWVuc2lvbmFsaXR5IHdpdGggdGhlIGNsdXN0ZXIgbGFiZWxzPyAtLS0+CgoKIyMgQ2x1c3RlcmluZwoKU2V1cmF0IHVzZXMgYSBncmFwaC1iYXNlZCBjbHVzdGVyaW5nIGFwcHJvYWNoIHRvIGFzc2lnbiBjZWxscyB0byBjbHVzdGVycyB1c2luZyBhIGRpc3RhbmNlIG1ldHJpYyBiYXNlZCBvbiB0aGUgcHJldmlvdXNseSBnZW5lcmF0ZWQgUENzLCB3aXRoIGltcHJvdmVtZW50cyBiYXNlZCBvbiB3b3JrIGJ5IChbWHUgYW5kIFN1IDIwMTVdKGh0dHBzOi8vYWNhZGVtaWMub3VwLmNvbS9iaW9pbmZvcm1hdGljcy9hcnRpY2xlLzMxLzEyLzE5NzQvMjE0NTA1KSkgYW5kIEN5VE9GIGRhdGEgKFtMZXZpbmUgZXQgYWwuIDIwMTVdKGh0dHBzOi8vd3d3Lm5jYmkubmxtLm5paC5nb3YvcG1jL2FydGljbGVzL1BNQzQ1MDg3NTcvKSBpbXBsZW1lbnRlZCBpbiBTZXVyYXQgdjMgYW5kIHY1IGFuZCBidWlsZGluZyBvbiB0aGUgaW5pdGlhbCBzdHJhdGVnaWVzIGZvciBkcm9wbGV0IGJhc2VkIHNpbmdsZSBjZWxsIHRlY2hub2xvZ3kgW01hY29za28gZXQgYWwuIDIwMTVdKGh0dHBzOi8vd3d3Lm5jYmkubmxtLm5paC5nb3YvcG1jL2FydGljbGVzL1BNQzQ0ODExMzkvKSAgW3NvdXJjZV0oaHR0cHM6Ly9zYXRpamFsYWIub3JnL3NldXJhdC9hcnRpY2xlcy9wYm1jM2tfdHV0b3JpYWwuaHRtbCkuIEEga2V5IGFzcGVjdCBvZiB0aGlzIHByb2Nlc3MgaXMgdGhhdCB3aGlsZSB0aGUgY2x1c3RlcnMgYXJlIGJhc2VkIG9uIHNpbWlsYXJpdHkgb2YgZXhwcmVzc2lvbiBiZXR3ZWVuIHRoZSBjZWxscywgdGhlIGNsdXN0ZXJpbmcgaXMgYmFzZWQgb24gdGhlIHNlbGVjdGVkIFBDcyBhbmQgdGhlcmVmb3JlIGxpbWl0ZWQgdG8gdGhlIGdlbmVzIGNvbnRyaWJ1dGluZyB0byB0aG9zZSBQQ3MuIAoKCiFbS05OIGV4YW1wbGUgLSBzZWN0aW9uIG9uIGdyYXBoIGJhc2VkIGNsdXN0ZXJpbmcgKGZyb20gQ2FtYnJpZGdlIEJpb2luZm9ybWF0aWNzIGNvdXJzZSldKC4vaW1hZ2VzL2N1cnJpY3VsdW0vMDUtUHJvamVjdGlvbkFuZENsdXN0ZXJpbmcvQmlvQ2VsbEdlbmUtTmVhcmVzdE5laWdoYm9yTmV0d29ya3MucG5nKQoKVG8gYnJpZWZseSBzdW1tYXJpemUsIGNlbGxzIGFyZSBlbWJlZGRlZCBpbiBhIEtOTiBncmFwaCAoaWxsdXN0cmF0ZWQgYWJvdmUpIGJhc2VkIG9uICJ0aGUgZXVjbGlkZWFuIGRpc3RhbmNlIGluIFBDQSBzcGFjZSIgYmV0d2VlbiB0aGUgY2VsbHMgW3NvdXJjZV0oaHR0cHM6Ly9oYmN0cmFpbmluZy5naXRodWIuaW8vc2NSTkEtc2VxX29ubGluZS9sZXNzb25zLzA3X1NDX2NsdXN0ZXJpbmdfY2VsbHNfU0NULmh0bWwpIGFuZCB0aGUgZWRnZSB3ZWlnaHRzIGJldHdlZW4gYW55IHR3byBjZWxscyAoZS5nLiB0aGVpciAiY2xvc2VuZXNzIikgaXMgcmVmaW5lZCBiYXNlZCBvbiBKYWNjYXJkIHNpbWlsYXJpdHkuCgo8ZGV0YWlscz4KICAgIDxzdW1tYXJ5PipBZGRpdGlvbmFsIGNvbnRleHQgYW5kIHNvdXJjZXMgZm9yIGdyYXBoLWJhc2VkIGNsdXN0ZXJpbmcqPC9zdW1tYXJ5PgogICAgW0NhbWJyaWRnZSBCaW9pbmZvcm1hdGljcycgQW5hbHlzaXMgb2Ygc2luZ2xlIGNlbGwgUk5BLXNlcSBkYXRhIGNvdXJzZSBtYXRlcmlhbHNdKGh0dHBzOi8vYmlvY2VsbGdlbi1wdWJsaWMuc3ZpLmVkdS5hdS9taWdfMjAxOV9zY3JuYXNlcS13b3Jrc2hvcC9jbHVzdGVyaW5nLWFuZC1jZWxsLWFubm90YXRpb24uaHRtbCksIHRoZSBzb3VyY2Ugb2YgdGhlIGltYWdlIGFib3ZlLCBkZWx2ZXMgaW50byBLTk4gYW5kIG90aGVyIGdyYXBoIGJhc2VkIGNsdXN0ZXJpbmcgbWV0aG9kcyBpbiBtdWNoIGdyZWF0ZXIgZGV0YWlsLCBpbmNsdWRpbmcgb3V0bGluaW5nIHBvc3NpYmxlIGRvd25zaWRlcyBmb3IgdGhlc2UgbWV0aG9kcy4gCiAgICAgVG8gZGVzY3JpYmVkIEtOTiwgd2UgaGF2ZSBhbHNvIGRyYXduIGZyb20gdGhlIFtIbyBMYWIncyBkZXNjcmlwdGlvbiBvZiB0aGlzIHByb2Nlc3MgZm9yIFNldXJhdCB2M10oaHR0cHM6Ly9ob2xhYi1oa3UuZ2l0aHViLmlvL0Z1bmRhbWVudGFsLXNjUk5BL2Rvd25zdHJlYW0uaHRtbCNwZXJmb3JtLWxpbmVhci1kaW1lbnNpb25hbC1yZWR1Y3Rpb24pIGFzIHdlbGwgYXMgdGhlIFtIQkMgbWF0ZXJpYWxzIG9uIGNsdXN0ZXJpbmddKGh0dHBzOi8vaGJjdHJhaW5pbmcuZ2l0aHViLmlvL3NjUk5BLXNlcV9vbmxpbmUvbGVzc29ucy8wN19TQ19jbHVzdGVyaW5nX2NlbGxzX1NDVC5odG1sKSBhbmQgdGhlIFtPU0NBIGJvb2sncyBtb3JlIGdlbmVyYWwgb3ZlcnZpZXcgb2YgZ3JhcGggYmFzZWQgY2x1c3RlcmluZ10oaHR0cHM6Ly9iaW9jb25kdWN0b3Iub3JnL2Jvb2tzLzMuMTUvT1NDQS5iYXNpYy9jbHVzdGVyaW5nLmh0bWwjY2x1c3RlcmluZy1ncmFwaCksIHdoaWNoIGFsc28gZGVzY3JpYmVzIHRoZSBkcmF3YmFja3MgZm9yIHRoZXNlIG1ldGhvZHMuCjwvZGV0YWlscz4KPGJyPgoKClRoaXMgcHJvY2VzcyBpcyBwZXJmb3JtZWQgd2l0aCB0aGUgYEZpbmROZWlnaGJvcnNgIFtjb21tYW5kXShodHRwczovL3NhdGlqYWxhYi5vcmcvc2V1cmF0L3JlZmVyZW5jZS9maW5kY2x1c3RlcnMpLCB1c2luZyB0aGUgbnVtYmVyIG9mIHByaW5jaXBhbCBjb21wb25lbnRzIHdlIHNlbGVjdGVkIGluIHRoZSBwcmV2aW91cyBzZWN0aW9uLgoKYGBge3IsIGV2YWwgPSBGQUxTRX0KZ2VvX3NvID0gRmluZE5laWdoYm9ycyhnZW9fc28sIGRpbXMgPSAxOnBjcywgcmVkdWN0aW9uID0gJ2ludGVncmF0ZWQuc2N0LnJwY2EuY2x1c3RlcnMnKQpgYGAKClRoZSBzZWNvbmQgc3RlcCBpcyB0byBpdGVyYXRpdmVseSBwYXJ0aXRpb24gdGhlIGtOTiBncmFwaCBpbnRvICJjbGlxdWVzIiBvciBjbHVzdGVycyB1c2luZyB0aGUgTG91dmFpbiBtb2R1bGFyaXR5IG9wdGltaXphdGlvbiBhbGdvcml0aG0gKGZvciB0aGUgZGVmYXVsdCBwYXJhbWV0ZXJzKSwgd2l0aCB0aGUgImdyYW51bGFyaXR5IiBvZiB0aGUgY2x1c3RlcnMgc2V0IGJ5IGEgYHJlc29sdXRpb25gIHBhcmFtZXRlciBbc291cmNlXShodHRwczovL3NhdGlqYWxhYi5vcmcvc2V1cmF0L2FydGljbGVzL3BibWMza190dXRvcmlhbC5odG1sKS4KCiFbSy1tZWFucyBjbHVzdGVyaW5nIGV4YW1wbGUgKGZyb20gQ2FtYnJpZGdlIEJpb2luZm9ybWF0aWNzIGNvdXJzZSldKC4vaW1hZ2VzL2N1cnJpY3VsdW0vMDUtUHJvamVjdGlvbkFuZENsdXN0ZXJpbmcvSEJDLTA3LWstbWVhbnNGaWd1cmUucG5nKQoKCldlJ2xsIHVzZSB0aGUgYEZpbmRDbHVzdGVyc2AgW2Z1bmN0aW9uXShodHRwczovL3NhdGlqYWxhYi5vcmcvc2V1cmF0L3JlZmVyZW5jZS9maW5kY2x1c3RlcnMpLCBzZWxlY3RpbmcgYSByZXNvbHV0aW9uIG9mIGAwLjRgIHRvIHN0YXJ0LCBhbHRob3VnaCB3ZSBjb3VsZCBhbHNvIGFkZCBvdGhlciByZXNvbHV0aW9ucyBhdCB0aGlzIHN0YWdlIHRvIGxvb2sgYXQgaW4gbGF0ZXIgc3RlcHMuIApgYGB7ciwgZXZhbD1GQUxTRX0KZ2VvX3NvID0gRmluZENsdXN0ZXJzKGdlb19zbywgcmVzb2x1dGlvbiA9IDAuNCwgY2x1c3Rlci5uYW1lID0gJ2ludGVncmF0ZWQuc2N0LnJwY2EuY2x1c3RlcnMnKQpgYGAKCj4gTm90ZSAtIFNldXJhdCdzIGBGaW5kQ2x1c3RlcnNgIGZ1bmN0aW9uIGlzIGJhc2VkIG9uIGFsZ29yaXRobXMgZGVzY3JpYmVkIGJ5IFtXYWx0bWFuIGFuZCBKYW4gdmFuIEVjayAoMjAxMyldKGh0dHBzOi8vbGluay5zcHJpbmdlci5jb20vYXJ0aWNsZS8xMC4xMTQwL2VwamIvZTIwMTMtNDA4MjktMCkKCkdlbmVyYWxseSBpdCdzIHByZWZlcmFibGUgdG8gZXJyIG9uIHRoZSBzaWRlIG9mIHRvbyBtYW55IGNsdXN0ZXJzLCBhcyB0aGV5IGNhbiBiZSBjb21iaW5lZCBtYW51YWxseSBpbiBsYXRlciBzdGVwcy4gSG93ZXZlciwgdGhpcyBpcyBhbm90aGVyIHBhcmFtZXRlciB0aGF0IGluIG91ciBleHBlcmllbmNlIG1heSBuZWVkIHRvIGJlIGl0ZXJhdGl2ZWx5IHJldmlzZWQgYW5kIHJldmlld2VkLiAKCjxkZXRhaWxzPgogICAgPHN1bW1hcnk+KlJlc29sdXRpb24gcGFyYW1ldGVyIHJlY29tbWVuZGF0aW9ucyo8L3N1bW1hcnk+CiAgICBUaGUgW1NldXJhdCBjbHVzdGVyaW5nIHR1dG9yaWFsXShodHRwczovL2hvbGFiLWhrdS5naXRodWIuaW8vRnVuZGFtZW50YWwtc2NSTkEvZG93bnN0cmVhbS5odG1sI3BlcmZvcm0tbGluZWFyLWRpbWVuc2lvbmFsLXJlZHVjdGlvbikgcmVjb21tZW5kcyBzZWxlY3RpbmcgYSByZXNvbHV0aW9uIGJldHdlZW4gMC40IC0gMS4yIGZvciBkYXRhc2V0cyBvZiBhcHByb3hpbWF0ZWx5IDNrIGNlbGxzLCB3aGlsZSB0aGUgW0hCQyBjb3Vyc2VdKGh0dHBzOi8vaGJjdHJhaW5pbmcuZ2l0aHViLmlvL3NjUk5BLXNlcV9vbmxpbmUvbGVzc29ucy8wN19TQ19jbHVzdGVyaW5nX2NlbGxzX1NDVC5odG1sKSByZWNvbW1lbmRzIDAuNC0xLjQgZm9yIDNrLTVrIGNlbGxzLiBIb3dldmVyLCBpbiBvdXIgZXhwZXJpZW5jZSByZWFzb25hYmxlIHN0YXJ0aW5nIHJlc29sdXRpb25zIGNhbiBiZSB2ZXJ5IGRhdGFzZXQgZGVwZW5kZW50Lgo8L2RldGFpbHM+Cjxicj4KCkFnYWluLCBob3cgYSDigJxjZWxsIHR5cGXigJ0gb3Ig4oCcc3VidHlwZeKAnSBzaG91bGQgYmUgZGVmaW5lZCBmb3IgeW91ciBkYXRhIGlzIGhlbHBmdWwgdG8gY29uc2lkZXIgaW4gc2VsZWN0aW5nIGEgcmVzb2x1dGlvbiAtIHdlJ2Qgc3RhcnQgd2l0aCBhIGhpZ2hlciByZXNvbHV0aW9uIGZvciBzbWFsbGVyL21vcmUgcmFyZSBjbHVzdGVycyBhbmQgYSBsb3dlciByZXNvbHV0aW9uIGZvciBsYXJnZXIvbW9yZSBnZW5lcmFsIGNsdXN0ZXJzLiAgCgpJZiB3ZSBsb29rIGF0IG91ciBvYmplY3QgYWZ0ZXIgcnVubmluZyB0aGVzZSBjb21tYW5kcywgd2UgZG9uJ3Qgc2VlIGEgY2hhbmdlLgpgYGB7ciwgZXZhbD1GQUxTRX0KZ2VvX3NvCmBgYAoKfn5+CiMgQW4gb2JqZWN0IG9mIGNsYXNzIFNldXJhdCAKIyA0NzAzNyBmZWF0dXJlcyBhY3Jvc3MgMjk2MTUgc2FtcGxlcyB3aXRoaW4gMiBhc3NheXMgCiMgQWN0aXZlIGFzc2F5OiBTQ1QgKDIwNTQ4IGZlYXR1cmVzLCAzMDAwIHZhcmlhYmxlIGZlYXR1cmVzKQojICAzIGxheWVycyBwcmVzZW50OiBjb3VudHMsIGRhdGEsIHNjYWxlLmRhdGEKIyAgMSBvdGhlciBhc3NheSBwcmVzZW50OiBSTkEKIyAgMyBkaW1lbnNpb25hbCByZWR1Y3Rpb25zIGNhbGN1bGF0ZWQ6IHVuaW50ZWdyYXRlZC5zY3QucGNhLCBpbnRlZ3JhdGVkLnNjdC5ycGNhLCB1bWFwLnVuaW50ZWdyYXRlZC5zY3QucGNhCn5+fgoKSG93ZXZlciwgaWYgd2UgbG9vayBhdCB0aGUgbWV0YSBkYXRhIHdlIGNhbiBzZWUgdGhhdCBjbHVzdGVyIGxhYmVscyBoYXZlIG5vdyBiZWVuIGFkZGVkIGZvciBlYWNoIGNlbGw6CgpgYGB7ciwgZXZhbCA9IEZBTFNFfQpoZWFkKGdlb19zb0BtZXRhLmRhdGEpCmBgYAoKfn5+fgojICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZy5pZGVudCBuQ291bnRfUk5BIG5GZWF0dXJlX1JOQSAgZGF5ICByZXBsaWNhdGUgcGVyY2VudC5tdCBuQ291bnRfU0NUIG5GZWF0dXJlX1NDVApIT0RheTByZXBsaWNhdGUxX0FBQUNDVEdBR0FHQUFDQUctMSBITy5EYXkwLnJlcGxpY2F0ZTEgICAgICAxMDIzNCAgICAgICAgIDMyMjYgRGF5MCByZXBsaWNhdGUxICAgMS4yNDA5NjIgICAgICAgNjA2MSAgICAgICAgIDI4NjUKSE9EYXkwcmVwbGljYXRlMV9BQUFDQ1RHR1RDQVRHQ0FULTEgSE8uRGF5MC5yZXBsaWNhdGUxICAgICAgIDMxNTggICAgICAgICAxNDk5IERheTAgcmVwbGljYXRlMSAgIDcuNTM2NDE1ICAgICAgIDQ2MjUgICAgICAgICAxNTEwCkhPRGF5MHJlcGxpY2F0ZTFfQUFBQ0NUR1RDQUdBR0NUVC0xIEhPLkRheTAucmVwbGljYXRlMSAgICAgIDEzNDY0ICAgICAgICAgNDEwMiBEYXkwIHJlcGxpY2F0ZTEgICAzLjExMjAwMiAgICAgICA1NDI2ICAgICAgICAgMjQ4NQpIT0RheTByZXBsaWNhdGUxX0FBQUNHR0dBR0dDQ0NHVFQtMSBITy5EYXkwLnJlcGxpY2F0ZTEgICAgICAgMTE4OSAgICAgICAgICA2MjkgRGF5MCByZXBsaWNhdGUxICAgMy43MDA1ODkgICAgICAgNDE2NSAgICAgICAgICA5MTkKSE9EYXkwcmVwbGljYXRlMV9BQUFDR0dHQ0FBQ1RHR0NDLTEgSE8uRGF5MC5yZXBsaWNhdGUxICAgICAgIDc3MjYgICAgICAgICAyNjAyIERheTAgcmVwbGljYXRlMSAgIDIuOTM4MTMxICAgICAgIDU4NTggICAgICAgICAyNTg1CkhPRGF5MHJlcGxpY2F0ZTFfQUFBQ0dHR0dUQ0NHQUFUVC0xIEhPLkRheTAucmVwbGljYXRlMSAgICAgICA1MTY1ICAgICAgICAgMjM2MiBEYXkwIHJlcGxpY2F0ZTEgICA5LjE5NjUxNSAgICAgICA1MTYyICAgICAgICAgMjM0OAojICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaW50ZWdyYXRlZC5zY3QuY2x1c3RlcnMgc2V1cmF0X2NsdXN0ZXJzIGludGVncmF0ZWQuc2N0LnJwY2EuY2x1c3RlcnMgU0NUX3Nubl9yZXMuMC40IFNDVF9zbm5fcmVzLjAuOApIT0RheTByZXBsaWNhdGUxX0FBQUNDVEdBR0FHQUFDQUctMSAgICAgICAgICAgICAgICAgICAgICAgICA0ICAgICAgICAgICAgICAgOCAgICAgICAgICAgICAgICAgICAgICAgICAgICAyICAgICAgICAgICAgICAgMiAgICAgICAgICAgICAgIDgKSE9EYXkwcmVwbGljYXRlMV9BQUFDQ1RHR1RDQVRHQ0FULTEgICAgICAgICAgICAgICAgICAgICAgICAgNCAgICAgICAgICAgICAgIDggICAgICAgICAgICAgICAgICAgICAgICAgICAgMiAgICAgICAgICAgICAgIDIgICAgICAgICAgICAgICA4CkhPRGF5MHJlcGxpY2F0ZTFfQUFBQ0NUR1RDQUdBR0NUVC0xICAgICAgICAgICAgICAgICAgICAgICAgIDQgICAgICAgICAgICAgICA2ICAgICAgICAgICAgICAgICAgICAgICAgICAgIDMgICAgICAgICAgICAgICAzICAgICAgICAgICAgICAgNgpIT0RheTByZXBsaWNhdGUxX0FBQUNHR0dBR0dDQ0NHVFQtMSAgICAgICAgICAgICAgICAgICAgICAgICA0ICAgICAgICAgICAgICAgMiAgICAgICAgICAgICAgICAgICAgICAgICAgICAyICAgICAgICAgICAgICAgMiAgICAgICAgICAgICAgIDIKSE9EYXkwcmVwbGljYXRlMV9BQUFDR0dHQ0FBQ1RHR0NDLTEgICAgICAgICAgICAgICAgICAgICAgICAgNCAgICAgICAgICAgICAgIDggICAgICAgICAgICAgICAgICAgICAgICAgICAgMiAgICAgICAgICAgICAgIDIgICAgICAgICAgICAgICA4CkhPRGF5MHJlcGxpY2F0ZTFfQUFBQ0dHR0dUQ0NHQUFUVC0xICAgICAgICAgICAgICAgICAgICAgICAgMTEgICAgICAgICAgICAgICA5ICAgICAgICAgICAgICAgICAgICAgICAgICAgIDggICAgICAgICAgICAgICA4ICAgICAgICAgICAgICAgOQp+fn5+CgoqTm90ZSAtIHRoZSBleGFtcGxlIG91dHB1dCBoYXMgbW9yZSByZXNvbHV0aW9ucyByZXByZXNlbnRlZCB0aGFuIGlzIGN1cnJlbnRseSBzcGVjaWZpZWQgaW4gdGhlIGNvZGUgYWJvdmUqCgoKIyBDbHVzdGVyIHBsb3RzIAoKVG8gdmlzdWFsaXplIHRoZSBjZWxsIGNsdXN0ZXJzLCB3ZSBjYW4gdXNlIGRpbWVuc2lvbmFsaXR5IHJlZHVjdGlvbiB0ZWNobmlxdWVzIHRvIHZpc3VhbGl6ZSBhbmQgZXhwbG9yZSBvdXIgbGFyZ2UsIGhpZ2ggZGltZW5zaW9uYWwgZGF0YXNldC4gVHdvIHBvcHVsYXIgbWV0aG9kcyB0aGF0IGFyZSBzdXBwb3J0ZWQgYnkgU2V1cmF0IGFyZSB0LWRpc3RyaWJ1dGVkIHN0b2NoYXN0aWMgbmVpZ2hib3IgZW1iZWRkaW5nICh0LVNORSkgYW5kIFVuaWZvcm0gTWFuaWZvbGQgQXBwcm94aW1hdGlvbiBhbmQgUHJvamVjdGlvbiAoVU1BUCkgdGVjaG5pcXVlcy4gVGhlc2UgdGVjaG5pcXVlcyBhbGxvdyB1cyB0byB2aXN1YWxpemUgb3VyIGhpZ2ggZGltZW5zaW9uYWwgc2luZ2xlLWNlbGwgZGF0YSBpbiAyRCBzcGFjZSBhbmQgc2VlIGlmIGNlbGxzIGdyb3VwZWQgdG9nZXRoZXIgd2l0aGluIGdyYXBoLWJhc2VkIGNsdXN0ZXJzIGNvLWxvY2FsaXplIGluIHRoZXNlIHJlcHJlc2VudGF0aW9ucyBbc291cmNlXShodHRwczovL3NhdGlqYWxhYi5vcmcvc2V1cmF0L2FydGljbGVzL3BibWMza190dXRvcmlhbC5odG1sI3J1bi1ub24tbGluZWFyLWRpbWVuc2lvbmFsLXJlZHVjdGlvbi11bWFwdHNuZSkuCgpXaGlsZSB3ZSB1bmZvcnR1bmF0ZWx5IGRvbid0IGhhdmUgdGltZSB0byBjb21wYXJlIGFuZCBjb250cmFzdCB0U05FLCBhbmQgVU1BUCwgd2Ugd291bGQgaGlnaGx5IHJlY29tbWVuZCBbdGhpcyBibG9nIHBvc3QgY29udHJhc3RpbmcgdFNORSBhbmQgVU1BUF0oaHR0cHM6Ly9wYWlyLWNvZGUuZ2l0aHViLmlvL3VuZGVyc3RhbmRpbmctdW1hcC8pIGZvciBpbGx1c3RyYXRpdmUgZXhhbXBsZXMuIFRoZSBTZXVyYXQgYXV0aG9ycyBhZGRpdGlvbmFsbHkgY2F1dGlvbiB0aGF0IHdoaWxlIHRoZXNlIG1ldGhvZHMgYXJlIHVzZWZ1bCBmb3IgZGF0YSBleHBsb3JhdGlvbiwgdG8gYXZvaWQgZHJhd2luZyBiaW9sb2dpY2FsIGNvbmNsdXNpb25zIHNvbGVseSBiYXNlZCBvbiB0aGVzZSB2aXN1YWxpemF0aW9ucyBbc291cmNlXShodHRwczovL3NhdGlqYWxhYi5vcmcvc2V1cmF0L2FydGljbGVzL3BibWMza190dXRvcmlhbC5odG1sI3J1bi1ub24tbGluZWFyLWRpbWVuc2lvbmFsLXJlZHVjdGlvbi11bWFwdHNuZSkKClRvIHN0YXJ0IHRoaXMgcHJvY2Vzcywgd2UnbGwgdXNlIHRoZSBgUnVuVU1BUGAgZnVuY3Rpb24gdG8gY2FsY3VsYXRlIHRoZSBVTUFQIHJlZHVjdGlvbiBmb3Igb3VyIGRhdGEuIE5vdGljZSBob3cgdGhlIHByZXZpb3VzIGRpbWVuc2lvbmFsaXR5IGNob2ljZXMgY2FycnkgdGhyb3VnaCB0aGUgZG93bnN0cmVhbSBhbmFseXNpcyBhbmQgdGhhdCB0aGUgbnVtYmVyIG9mIFBDcyBzZWxlY3RlZCBpbiB0aGUgcHJldmlvdXMgc3RlcHMgYXJlIGluY2x1ZGVkIGFzIGFuIGFyZ3VtZW50LgoKYGBge3IsIGV2YWw9RkFMU0V9Cmdlb19zbyA9IFJ1blVNQVAoZ2VvX3NvLCBkaW1zID0gMTpwY3MsIHJlZHVjdGlvbiA9ICdpbnRlZ3JhdGVkLnNjdC5wY2EnLCByZWR1Y3Rpb24ubmFtZSA9ICd1bWFwLmludGVncmF0ZWQuc2N0LnBjYScpCmBgYAoKIyBWaXN1YWxpemluZyBhbmQgZXZhbHVhdGluZyBjbHVzdGVyaW5nCgo8IS0tLSBIb3cgbWFueSBjbHVzdGVycyBzaG91bGQgSSBnZXQgYW5kIGhvdyBkbyBJIGFkanVzdCB0aGUgbnVtYmVyPyAtLS0+Cgo8IS0tLSBBZGQgZXhhbXBsZSBvZiBjaGFuZ2luZyByZXNvbHV0aW9uPy0tLT4KCkFmdGVyIHdlIGdlbmVyYXRlIHRoZSBVTUFQIHJlZHVjdGlvbiwgd2UgY2FuIHRoZW4gdmlzdWFsaXplIHRoZSByZXN1bHRzIHVzaW5nIHRoZSBgRGltUGxvdGAgZnVuY3Rpb24sIGxhYmVsaW5nIG91ciBwbG90IGJ5IHRoZSBhdXRvIGdlbmVyYXRlZCBgc2V1cmF0X2NsdXN0ZXJzYCB0aGF0IGNvcnJlc3BvbmQgdG8gdGhlIG1vc3QgcmVjZW50IGNsdXN0ZXJpbmcgcmVzdWx0cyBnZW5lcmF0ZWQ6CgpgYGB7ciwgZXZhbCA9IEZBTFNFfQpwb3N0X2ludGVncmF0aW9uX3VtYXBfcGxvdF9jbHVzdGVycyA9IERpbVBsb3QoZ2VvX3NvLCBncm91cC5ieSA9ICdzZXVyYXRfY2x1c3RlcnMnLCBsYWJlbCA9IEZBTFNFLCByZWR1Y3Rpb24gPSAndW1hcC5pbnRlZ3JhdGVkLnNjdC5ycGNhJykKCmdnc2F2ZShmaWxlbmFtZSA9ICdyZXN1bHRzL2ZpZ3VyZXMvdW1hcF9pbnRlZ3JhdGVkX3NjdF9jbHVzdGVycy5wbmcnLCBwbG90ID0gcG9zdF9pbnRlZ3JhdGlvbl91bWFwX3Bsb3RfY2x1c3RlcnMsIHdpZHRoID0gOCwgaGVpZ2h0ID0gNiwgdW5pdHMgPSAnaW4nKQpgYGAKCiFbXSguL2ltYWdlcy9jdXJyaWN1bHVtLzA1LVByb2plY3Rpb25BbmRDbHVzdGVyaW5nL3VtYXBfaW50ZWdyYXRlZF9zY3RfMC40LnBuZykgCgpBdCB0aGlzIHN0YWdlLCB3ZSB3YW50IHRvIGRldGVybWluZSBpZiB0aGUgY2x1c3RlcnMgbG9vayBmYWlybHkgd2VsbCBzZXBhcmF0ZWQsIGlmIHRoZXkgc2VlbSB0byBjb3JyZXNwb25kIHRvIGhvdyBjZWxscyBhcmUgZ3JvdXBlZCBpbiB0aGUgVU1BUCwgYW5kIGlmIHRoZSBudW1iZXIgb2YgY2x1c3RlcnMgYXJlIGFsaWduZWQgd2l0aCB0aGUgcmVzb2x1dGlvbiBvZiBvdXIgYmlvbG9naWNhbCBxdWVzdGlvbi4gCgoKV2UgY2FuIGFsc28gbG9vayBhdCB0aGUgc2FtZSBVTUFQLCBidXQgbGFiZWxpbmcgYnkgYGRheWAgaW5zdGVhZCBvZiBjbHVzdGVyOgoKYGBge3IsIGV2YWwgPSBGQUxTRX0KcG9zdF9pbnRlZ3JhdGlvbl91bWFwX3Bsb3RfZGF5ID0gRGltUGxvdChnZW9fc28sIGdyb3VwLmJ5ID0gJ2RheScsIGxhYmVsID0gRkFMU0UsIHJlZHVjdGlvbiA9ICd1bWFwLmludGVncmF0ZWQuc2N0LnJwY2EnKQoKZ2dzYXZlKGZpbGVuYW1lID0gJ3Jlc3VsdHMvZmlndXJlcy91bWFwX2ludGVncmF0ZWRfc2N0X2RheS5wbmcnLCBwbG90ID0gcG9zdF9pbnRlZ3JhdGlvbl91bWFwX3Bsb3RfZGF5KQpgYGAKCkEgcGxvdCBsaWtlIHRoaXMgY2FuIHRlbGwgdXMgaG93IG11Y2ggcG9zc2libGUgdGVjaG5pY2FsIHNvdXJjZXMgb2YgdmFyaWF0aW9uIGdyb3VwaW5ncyBtaWdodCBiZSBkcml2aW5nIG9yIHN0cmF0aWZ5aW5nIHRoZSBjbHVzdGVycyBvciBpZiB3ZSBzZWUgZ29vZCBjb3JyZWN0aW9uIGFmdGVyIHRoZSBub3JtYWxpemF0aW9uIGFuZCBpbnRlZ3JhdGlvbiBzdGVwcy4KCiFbXSguL2ltYWdlcy9jdXJyaWN1bHVtLzA1LVByb2plY3Rpb25BbmRDbHVzdGVyaW5nL3VtYXBfaW50ZWdyYXRlZF9zY3RfZGF5LnBuZykKCgpXZSBjYW4gYWxzbyBldmFsdWF0ZSB0aGUgbnVtYmVyIG9mIGNlbGxzIHBlciBjbHVzdGVyIHVzaW5nIHRoZSBgdGFibGUoKWAgZnVuY3Rpb24sIHNwbGl0IGJ5IGBkYXlgOgoKYGBge3IsIGV2YWw9RkFMU0V9CnRhYmxlKGdlb19zb0BtZXRhLmRhdGEkZGF5LCBnZW9fc29AbWV0YS5kYXRhJGludGVncmF0ZWQuc2N0LnJwY2EuY2x1c3RlcnMpCmBgYAoKfn5+CiMgCQkwICAgIDEgICAgMiAgICAzICAgIDQgICAgNSAgICA2ICAgIDcgICAgOCAgICA5ICAgMTAgICAxMSAgIDEyICAgMTMgICAxNCAgIDE1ICAgMTYgICAxNyAgIDE4ICAgMTkKRGF5MCAgICA2NSAgMjQwICA4NDMgIDMxNyAgMTY3ICAgMzYgICAzNiAgMTI1ICA3NzggIDEzMiAgMTI1ICAzMDUgICA1NSAgIDI5ICAxNTkgIDEzMyAgIDU2ICAxNDEgICAzNyAgIDE5CkRheTcgIDMxODQgMjQ5NyAgOTcyIDE2ODkgMjAzNyAyMzc0IDE1OTYgIDkyOSAgMTA4ICA1NDggIDU2NiAgMzgyICA2MjcgIDY4NiAgMzA5ICAgOTcgIDI2MiAgIDg2ICAgMTQgICAzNgpEYXkyMSAxMzI5ICAzNTUgIDk2NCAgNjYzICA0NjEgIDE0NyAgIDgxICA0NTIgIDM4MyAgNDk5ICAzNzkgIDIyNyAgMTA4ICAgNzIgICA0MiAgMjUyICAxMTcgIDE5NSAgIDgwICAgMTIKCn5+fgoKCi4uLiBvciBzcGxpdCBieSBgb3JpZy5pZGVudGAgZS5nLiBieSBpbmRpdmlkdWFsIHNhbXBsZToKCmBgYHtyLCBldmFsPUZBTFNFfQp0YWJsZShnZW9fc29AbWV0YS5kYXRhJG9yaWcuaWRlbnQsIGdlb19zb0BtZXRhLmRhdGEkaW50ZWdyYXRlZC5zY3QucnBjYS5jbHVzdGVycykKYGBgCgp+fn4KIyAJCQkJCTAgICAgMSAgICAyICAgIDMgICAgNCAgICA1ICAgIDYgICAgNyAgICA4ICAgIDkgICAxMCAgIDExICAgMTIgICAxMyAgIDE0ICAgMTUgICAxNiAgIDE3ICAgMTggICAxOQpITy5EYXkwLnJlcGxpY2F0ZTEgICAgMTQgICA4MiAgMjUwICAgOTYgICA1MiAgIDE3ICAgMTUgICAyNCAgMjAzICAgMzMgICAzMiAgIDg0ICAgMTcgICAxMSAgIDQ3ICAgMjAgICAgNSAgIDM1ICAgIDUgICAgNwpITy5EYXkwLnJlcGxpY2F0ZTIgICAgMTAgICAzOCAgMTEwICAgMzMgICAzMyAgICA0ICAgIDYgICAzNCAgMTUyICAgMjcgICAyMCAgIDU3ICAgIDggICAgNiAgIDEzICAgMjUgICAxMyAgIDE2ICAgIDkgICAgMQpITy5EYXkwLnJlcGxpY2F0ZTMgICAgMjUgICA3MiAgMzAwICAxMTcgICA0NiAgICAzICAgIDUgICAyNSAgMjI3ICAgNDAgICA0MiAgIDg2ICAgMTYgICAgNSAgIDU4ICAgNDAgICAxNiAgIDU0ICAgMTIgICAgMgpITy5EYXkwLnJlcGxpY2F0ZTQgICAgMTYgICA0OCAgMTgzICAgNzEgICAzNiAgIDEyICAgMTAgICA0MiAgMTk2ICAgMzIgICAzMSAgIDc4ICAgMTQgICAgNyAgIDQxICAgNDggICAyMiAgIDM2ICAgMTEgICAgOQpITy5EYXk3LnJlcGxpY2F0ZTEgICA0MTAgIDU4NyAgMjg1ICA0MzEgIDUwNiAgNzY2ICA3NTUgIDE1NyAgIDQ1ICAxMTMgIDE5MCAgIDc5ICAxNjcgIDIxMyAgIDYzICAgNDAgICA3MiAgIDI4ICAgIDQgICAxNwpITy5EYXk3LnJlcGxpY2F0ZTIgIDExNTYgIDYxNiAgMTg0ICAzNjEgIDU4MCAgNDY4ICAyMjAgIDM3MiAgICA3ICAxNTggIDEzNSAgMTI2ICAxODAgIDE2MCAgIDg2ICAgMTkgICA4OCAgIDEyICAgIDEgICAgMwpITy5EYXk3LnJlcGxpY2F0ZTMgICA4ODcgIDcyMiAgMzc3ICA1OTIgIDUzNCAgMzk1ICAgOTAgIDI0MSAgIDQ4ICAxNzggIDE0NiAgMTEwICAxNjMgIDE2NCAgIDkzICAgMjcgICA3MiAgIDM2ICAgIDggICAxNApITy5EYXk3LnJlcGxpY2F0ZTQgICA3MzEgIDU3MiAgMTI2ICAzMDUgIDQxNyAgNzQ1ICA1MzEgIDE1OSAgICA4ICAgOTkgICA5NSAgIDY3ICAxMTcgIDE0OSAgIDY3ICAgMTEgICAzMCAgIDEwICAgIDEgICAgMgpITy5EYXkyMS5yZXBsaWNhdGUxICAzMzggICA5NiAgMzE3ICAyMjEgIDE0NCAgIDQwICAgMzAgIDEzOSAgMTE1ICAxNDUgIDExMCAgIDczICAgMzUgICAxNCAgIDEzICAgNjUgICAyNiAgIDU2ICAgMjAgICAgMwpITy5EYXkyMS5yZXBsaWNhdGUyICAxNjggICA2OSAgMTg5ICAgODYgICA4MiAgIDI1ICAgMTIgIDEwNiAgMTEzICAgNzggICA0OCAgIDQwICAgMTUgICAxNCAgICA2ICAgNTEgICAyOSAgIDI5ICAgMTcgICAgNQpITy5EYXkyMS5yZXBsaWNhdGUzICAxODQgICA3MiAgMTY4ICAgOTMgICA5MSAgIDI2ICAgIDggICA2MiAgMTAwICAgOTAgICA2OSAgIDM0ICAgMTYgICAyMCAgICA3ICAgNTUgICAyMCAgIDM5ICAgIDkgICAgMwpITy5EYXkyMS5yZXBsaWNhdGU0ICA2MzkgIDExOCAgMjkwICAyNjMgIDE0NCAgIDU2ICAgMzEgIDE0NSAgIDU1ICAxODYgIDE1MiAgIDgwICAgNDIgICAyNCAgIDE2ICAgODEgICA0MiAgIDcxICAgMzQgICAgMQp+fn4KCgo8IS0tIGNvbnNpZGVyIGFkZGluZyBsYXRlciAKIyBPdGhlciBhcHByb2FjaGVzIGZvciB2aXN1YWxpemluZyBzY1JOQS1zcSBkYXRhCgpjb2RlIGZvciB0U05FIHZpc3VhbGl6YXRpb24gLS0tPgoKCiMgQ29tcGFyaW5nIHRvIHVuaW50ZWdyYXRlZCBkYXRhCgpJZiB3ZSBoYWQgcHJvY2VlZGVkIHdpdGggb3VyIGZpbHRlcmVkIGRhdGEgYW5kIG9ubHkgbm9ybWFsaXplZCBvdXIgZGF0YSB3aXRob3V0IGRvaW5nIGFueSBpbnRlZ3JhdGlvbiwgaW5jbHVkaW5nIHRocm91Z2ggdGhlIGRpbWVuc2lvbmFsaXR5IHJlZHVjdGlvbiBhbmQgY2x1c3RlcmluZyBzdGVwcyBhbmQgdGhlbiBsYWJlbGVkIHRoZSBjZWxscyB3aXRoIHRoZWlyIHNhbXBsZSBvZiBvcmlnaW4sIHRoZW4gd2Ugd291bGQgc2VlIHRoZSBmb2xsb3dpbmcgZm9yIG91ciBkYXRhOgoKPCEtLUFkZCBleGFtcGxlIG9mIFVNQVAgLyBzYW1wbGUgbGFiZWxzIGZvciB1bmludGVncmF0ZWQgZGF0YSBmcm9tIGFuYWx5c2lzIGZvbGRlciB0byBpbWFnZXMtLT4KCgohW10oLi9pbWFnZXMvY3VycmljdWx1bS8wNS1Qcm9qZWN0aW9uQW5kQ2x1c3RlcmluZy91bWFwX3VuaW50ZWdyYXRlZF9zY3Rfb3JpZy5pZGVudC5wbmcpCgpJZiB3ZSBpbnN0ZWFkIGxhYmVsZWQgb3VyIHBsb3QgYnkgYGRheWAsIHRoZW4gd2Ugd291bGQgc2VlOgohW10oLi9pbWFnZXMvY3VycmljdWx1bS8wNS1Qcm9qZWN0aW9uQW5kQ2x1c3RlcmluZy91bWFwX3VuaW50ZWdyYXRlZF9zY3RfZGF5LnBuZykKCkluIHRoaXMgcGxvdCwgd2Ugc2VlIHRoYXQgd2hpbGUgdGhlcmUgYXJlIGRpc3RpbmN0IGNsdXN0ZXJzLCB0aG9zZSBjbHVzdGVycyBzZWVtIHRvIHN0cmF0aWZpZWQgYnkgZGF5LiBUaGlzIHN1Z2dlc3RzIHRoYXQgd2l0aG91dCBpbnRlZ3JhdGlvbiwgdGhlc2UgYmF0Y2ggZWZmZWN0cyBjb3VsZCBza2V3IHRoZSBiaW9sb2dpY2FsIHZhcmlhYmlsaXR5IGluIG91ciBkYXRhLiAKCjwhLS0gRWRpdCBzZWN0aW9uIHRvIGluY29ycG9yYXRlIC0tLT4KCjxkZXRhaWxzPgogICAgPHN1bW1hcnk+KipSZXdpbmQ6IFByZS1pbnRlZ3JhdGlvbiBldmFsdWF0aW9uIGNsdXN0ZXJpbmcgYW5kIHZpc3VhbGl6YXRpb24qKjwvc3VtbWFyeT4KICAgIFByaW9yIHRvIGludGVncmF0aW9uLCBjb3VsZCBmb2xsb3cgdGhlIHNhbWUgc3RlcHMgd2UndmUganVzdCBydW4gZm9yIHRoZSBpbnRlZ3JhdGVkIHRvIHNlZSBpZiB0aGUgcmVzdWx0aW5nIGNsdXN0ZXJzIHRlbmQgdG8gYmUgZGV0ZXJtaW5lZCBieSBzYW1wbGUgb3IgY29uZGl0aW9uIChpbiB0aGlzIGNhc2UsIHRoZSBkYXkpOgogIGBgYHtyLCBldmFsPUZBTFNFfQoJIyBEZWZhdWx0QXNzYXkoZ2VvX3NvKSA9ICdSTkEnCgoJZ2VvX3NvID0gUnVuUENBKGdlb19zbywgcmVkdWN0aW9uLm5hbWUgPSAndW5pbnRlZ3JhdGVkLnNjdC5wY2EnKQoJZ2VvX3NvID0gRmluZE5laWdoYm9ycyhnZW9fc28sIGRpbXMgPSAxOjI1LCByZWR1Y3Rpb24gPSAndW5pbnRlZ3JhdGVkLnNjdC5wY2EnKQoJZ2VvX3NvID0gRmluZENsdXN0ZXJzKGdlb19zbywgcmVzb2x1dGlvbiA9IDAuNCwgY2x1c3Rlci5uYW1lID0gJ3VuaW50ZWdyYXRlZC5zY3QuY2x1c3RlcnMnKQoJZ2VvX3NvID0gUnVuVU1BUChnZW9fc28sIGRpbXMgPSAxOjI1LCByZWR1Y3Rpb24gPSAndW5pbnRlZ3JhdGVkLnNjdC5wY2EnLCAJcmVkdWN0aW9uLm5hbWUgPSAndW1hcC51bmludGVncmF0ZWQuc2N0LnBjYScpCglgYGAKCQoJRnJvbSB0aGlzIGltYWdlLCB3ZSBjYW4gcXVhbGl0YXRpdmVseSBzZWUgdGhhdCBzb21lIGNsdXN0ZXJzIHNlZW0gdG8gYmUgZHJpdmVuIGJ5IHRoZSBvcmlnaW5hbCBpZGVudGl0eS4gV2UgY2FuIHNlZSB0aGlzIGV2ZW4gbW9yZSBjbGVhcmx5IGlmIHdlIHVzZSBgZ3JvdXAuYnkgPSAnZGF5J2A6CgoJYGBge3IsIGV2YWw9RkFMU0V9CglwcmVfaW50ZWdyYXRpb25fdW1hcF9wbG90ID0gRGltUGxvdChnZW9fc28sIGdyb3VwLmJ5ID0gJ2RheScsIGxhYmVsID0gRkFMU0UsIAlyZWR1Y3Rpb24gPSAndW1hcC51bmludGVncmF0ZWQuc2N0LnBjYScpICsgTm9MZWdlbmQoKQoJZ2dzYXZlKGZpbGVuYW1lID0gJ0lTQ19SL3Jlc3VsdHMvZmlndXJlcy91bWFwX3VuaW50ZWdyYXRlZF9zY3RfZGF5LnBuZycsIHBsb3QgPSBwcmVfaW50ZWdyYXRpb25fdW1hcF9wbG90KQoJYGBgCgoKCWBgYHtyLCBldmFsPUZBTFNFfQoJcHJlX3Bvc3RfaW50ZWdyYXRpb25fcGxvdCA9IHByZV9pbnRlZ3JhdGlvbl91bWFwX3Bsb3RfZGF5IHwgCXBvc3RfaW50ZWdyYXRpb25fdW1hcF9wbG90X2RheQoKCWdnc2F2ZShmaWxlbmFtZSA9ICdyZXN1bHRzL2ZpZ3VyZXMvdW1hcF9jb21wYXJpc29uX3NjdC5wbmcnLCBwbG90ID0gcHJlX3Bvc3RfaW50ZWdyYXRpb25fcGxvdCwgd2lkdGggPSAxMiwgaGVpZ2h0ID0gNiwgdW5pdHMgPSAnaW4nKQoJYGBgCjwvZGV0YWlscz4KPGJyPgo8YnI+Cjxicj4KCgo8ZGV0YWlscz4KICAgIDxzdW1tYXJ5PioqQWx0ZXJuYXRpdmUgY2x1c3RlcmluZyByZXNvbHV0aW9ucyoqPC9zdW1tYXJ5PgogICAgV2hpbGUgd2Ugc2hvdyBhIHNpbmdsZSByZXNvbHV0aW9uLCB3ZSBjYW4gZ2VuZXJhdGUgYW5kIHBsb3QgbXVsdGlwbGUgcmVzb2x1dGlvbnMgaXRlcmF0aXZlbHkgYW5kIGNvbXBhcmUgYmV0d2VlbiB0aGVtIGJlZm9yZSBzZWxlY3RpbmcgYSBjbHVzdGVyaW5nIHJlc3VsdCBmb3IgdGhlIG5leHQgc3RlcHM6CgkgIGBgYHtyLCBldmFsPUZBTFNFfQoJICByZXNvbHV0aW9ucyA9IGMoMC40LCAwLjgpCgkgICMgc2VxKGZyb20gPSAwLjEsIHRvID0gMSwgYnkgPSAwLjEpCgoJICBmb3IocmVzIGluIHJlc29sdXRpb25zKSB7CiAgICBtZXNzYWdlKHJlcykKICAgIAogICAgY2x1c3Rlcl9jb2x1bW4gPSBzcHJpbnRmKCdTQ1Rfc25uX3Jlcy4lcycsIHJlcykKICAgIHVtYXBfZmlsZSA9IHNwcmludGYoJ3Jlc3VsdHMvZmlndXJlcy91bWFwX2ludGVncmF0ZWRfc2N0XyVzLnBuZycsIHJlcykKICAgIAogICAgZ2VvX3NvID0gRmluZENsdXN0ZXJzKGdlb19zbywgcmVzb2x1dGlvbiA9IHJlcykKICAgIAogICAgRGltUGxvdChnZW9fc28sIGdyb3VwLmJ5ID0gY2x1c3Rlcl9jb2x1bW4sIGxhYmVsID0gRkFMU0UsIHJlZHVjdGlvbiA9ICd1bWFwLmludGVncmF0ZWQuc2N0LnJwY2EnKQogICAgZ2dzYXZlKGZpbGVuYW1lID0gdW1hcF9maWxlLCB3aWR0aCA9IDgsIGhlaWdodCA9IDcsIHVuaXRzID0gJ2luJykKCSAgfQoJICBgYGAKCglJZiB3ZSBsb29rIGF0IHRoZSByZXN1bHRzLi4uIDoKCSAgYGBge3IsIGV2YWw9RkFMU0V9CgkgIGhlYWQoZ2VvX3NvQG1ldGEuZGF0YSkKCSAgYGBgCgkuLi4gbXVsdGlwbGUgcmVzb2x1dGlvbnMgc2hvdWxkIG5vdyBiZSBhZGRlZCB0byB0aGUgbWV0YWRhdGEgc2xvdC4KPC9kZXRhaWxzPgo8YnI+CgoKIyMgU2F2ZSBvdXIgcHJvZ3Jlc3MKCkJlZm9yZSBtb3Zpbmcgb24gdG8gb3VyIG5leHQgc2VjdGlvbiwgd2Ugd2lsbCBvdXRwdXQgb3VyIHVwZGF0ZWQgU2V1cmF0IG9iamVjdCB0byBmaWxlOgpgYGB7ciwgZXZhbD1GQUxTRX0Kc2F2ZVJEUyhvYmplY3QgPSBnZW9fc28sIGZpbGUgPSAncmVzdWx0cy9yZGF0YS9nZW9fc29fc2N0X2NsdXN0ZXJlZC5yZGEnKQpgYGAKCiMgU3VtbWFyeQoKSW4gdGhpcyBzZWN0aW9uIHdlOgoKLSBHZW5lcmF0ZWQgY2x1c3RlciBhc3NpZ25tZW50cyBmb3Igb3VyIGNlbGxzIHVzaW5nIGBGaW5kTmVpZ2hib3JzYCBhbmQgYEZpbmRDbHVzdGVyc2AKLSBFdmFsdWF0ZWQgb3VyIGluaXRpYWwgY2x1c3RlcnMgdXNpbmcgYFJ1blVNQVBgIGRpbWVuc2lvbmFsIHJlZHVjdGlvbiBhbmQgdmlzdWFsaXphdGlvbgoKCk5leHQgc3RlcHM6IE1hcmtlciBnZW5lcwoKCi0tLS0KClRoZXNlIG1hdGVyaWFscyBoYXZlIGJlZW4gYWRhcHRlZCBhbmQgZXh0ZW5kZWQgZnJvbSBtYXRlcmlhbHMgbGlzdGVkIGFib3ZlLiBUaGVzZSBhcmUgb3BlbiBhY2Nlc3MgbWF0ZXJpYWxzIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgW0NyZWF0aXZlIENvbW1vbnMgQXR0cmlidXRpb24gbGljZW5zZSAoQ0MgQlkgNC4wKV0oaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnkvNC4wLyksIHdoaWNoIHBlcm1pdHMgdW5yZXN0cmljdGVkIHVzZSwgZGlzdHJpYnV0aW9uLCBhbmQgcmVwcm9kdWN0aW9uIGluIGFueSBtZWRpdW0sIHByb3ZpZGVkIHRoZSBvcmlnaW5hbCBhdXRob3IgYW5kIHNvdXJjZSBhcmUgY3JlZGl0ZWQuCgo8YnIvPgo8YnIvPgo8aHIvPgp8IFtQcmV2aW91cyBsZXNzb25dKDA0LVBDQWFuZERpbVJlZHVjdGlvbi5odG1sKSB8IFtUb3Agb2YgdGhpcyBsZXNzb25dKCN0b3ApIHwgW05leHQgbGVzc29uXSgwNi1NYXJrZXJWaXN1YWxpemF0aW9uLmh0bWwpIHwKfCA6LS0tIHwgOi0tLS06IHwgLS0tOiB8Cgo=</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("05-ProjectionAndClustering.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
