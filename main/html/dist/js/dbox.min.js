function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var CanvasImage=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(t){this.context.putImageData(t,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(t,e){return this.getPalette(t,5,e)[0]},ColorThief.prototype.getPalette=function(t,e,o){void 0===e&&(e=10),(void 0===o||o<1)&&(o=10);for(var n,i,r,a,s=new CanvasImage(t),l=s.getImageData().data,u=s.getPixelCount(),c=[],d=0;d<u;d+=o)n=4*d,i=l[n+0],r=l[n+1],a=l[n+2],l[n+3]>=125&&(i>250&&r>250&&a>250||c.push([i,r,a]));var h=MMCQ.quantize(c,e),g=h?h.palette():null;return s.removeCanvas(),g},!pv)var pv={map:function(t,e){var o={};return e?t.map(function(t,n){return o.index=n,e.call(o,t)}):t.slice()},naturalOrder:function(t,e){return t<e?-1:t>e?1:0},sum:function(t,e){var o={};return t.reduce(e?function(t,n,i){return o.index=i,t+e.call(o,n)}:function(t,e){return t+e},0)},max:function(t,e){return Math.max.apply(null,e?pv.map(t,e):t)}};var MMCQ=function(){function t(t,e,o){return(t<<2*s)+(e<<s)+o}function e(t){function e(){o.sort(t),n=!0}var o=[],n=!1;return{push:function(t){o.push(t),n=!1},peek:function(t){return n||e(),void 0===t&&(t=o.length-1),o[t]},pop:function(){return n||e(),o.pop()},size:function(){return o.length},map:function(t){return o.map(t)},debug:function(){return n||e(),o}}}function o(t,e,o,n,i,r,a){var s=this;s.r1=t,s.r2=e,s.g1=o,s.g2=n,s.b1=i,s.b2=r,s.histo=a}function n(){this.vboxes=new e(function(t,e){return pv.naturalOrder(t.vbox.count()*t.vbox.volume(),e.vbox.count()*e.vbox.volume())})}function i(e){var o,n,i,r,a=1<<3*s,u=new Array(a);return e.forEach(function(e){n=e[0]>>l,i=e[1]>>l,r=e[2]>>l,o=t(n,i,r),u[o]=(u[o]||0)+1}),u}function r(t,e){var n,i,r,a=1e6,s=0,u=1e6,c=0,d=1e6,h=0;return t.forEach(function(t){n=t[0]>>l,i=t[1]>>l,r=t[2]>>l,n<a?a=n:n>s&&(s=n),i<u?u=i:i>c&&(c=i),r<d?d=r:r>h&&(h=r)}),new o(a,s,u,c,d,h,e)}function a(e,o){if(o.count()){var n=o.r2-o.r1+1,i=o.g2-o.g1+1,r=o.b2-o.b1+1,a=pv.max([n,i,r]);if(1==o.count())return[o.copy()];var s,l,u,c,d,h=0,g=[],f=[];if(a==n)for(s=o.r1;s<=o.r2;s++){for(c=0,l=o.g1;l<=o.g2;l++)for(u=o.b1;u<=o.b2;u++)d=t(s,l,u),c+=e[d]||0;h+=c,g[s]=h}else if(a==i)for(s=o.g1;s<=o.g2;s++){for(c=0,l=o.r1;l<=o.r2;l++)for(u=o.b1;u<=o.b2;u++)d=t(l,s,u),c+=e[d]||0;h+=c,g[s]=h}else for(s=o.b1;s<=o.b2;s++){for(c=0,l=o.r1;l<=o.r2;l++)for(u=o.g1;u<=o.g2;u++)d=t(l,u,s),c+=e[d]||0;h+=c,g[s]=h}return g.forEach(function(t,e){f[e]=h-t}),function(t){var e,n,i,r,a,l=t+"1",u=t+"2",c=0;for(s=o[l];s<=o[u];s++)if(g[s]>h/2){for(i=o.copy(),r=o.copy(),a=(e=s-o[l])<=(n=o[u]-s)?Math.min(o[u]-1,~~(s+n/2)):Math.max(o[l],~~(s-1-e/2));!g[a];)a++;for(c=f[a];!c&&g[a-1];)c=f[--a];return i[u]=a,r[l]=i[u]+1,[i,r]}}(a==n?"r":a==i?"g":"b")}}var s=5,l=8-s,u=1e3,c=.75;return o.prototype={volume:function(t){var e=this;return e._volume&&!t||(e._volume=(e.r2-e.r1+1)*(e.g2-e.g1+1)*(e.b2-e.b1+1)),e._volume},count:function(e){var o=this,n=o.histo;if(!o._count_set||e){var i,r,a,s=0;for(i=o.r1;i<=o.r2;i++)for(r=o.g1;r<=o.g2;r++)for(a=o.b1;a<=o.b2;a++)index=t(i,r,a),s+=n[index]||0;o._count=s,o._count_set=!0}return o._count},copy:function(){var t=this;return new o(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(e){var o=this,n=o.histo;if(!o._avg||e){var i,r,a,l,u,c=0,d=1<<8-s,h=0,g=0,f=0;for(r=o.r1;r<=o.r2;r++)for(a=o.g1;a<=o.g2;a++)for(l=o.b1;l<=o.b2;l++)u=t(r,a,l),i=n[u]||0,c+=i,h+=i*(r+.5)*d,g+=i*(a+.5)*d,f+=i*(l+.5)*d;o._avg=c?[~~(h/c),~~(g/c),~~(f/c)]:[~~(d*(o.r1+o.r2+1)/2),~~(d*(o.g1+o.g2+1)/2),~~(d*(o.b1+o.b2+1)/2)]}return o._avg},contains:function(t){var e=this,o=t[0]>>l;return gval=t[1]>>l,bval=t[2]>>l,o>=e.r1&&o<=e.r2&&gval>=e.g1&&gval<=e.g2&&bval>=e.b1&&bval<=e.b2}},n.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var e=this.vboxes,o=0;o<e.size();o++)if(e.peek(o).vbox.contains(t))return e.peek(o).color;return this.nearest(t)},nearest:function(t){for(var e,o,n,i=this.vboxes,r=0;r<i.size();r++)((o=Math.sqrt(Math.pow(t[0]-i.peek(r).color[0],2)+Math.pow(t[1]-i.peek(r).color[1],2)+Math.pow(t[2]-i.peek(r).color[2],2)))<e||void 0===e)&&(e=o,n=i.peek(r).color);return n},forcebw:function(){var t=this.vboxes;t.sort(function(t,e){return pv.naturalOrder(pv.sum(t.color),pv.sum(e.color))});var e=t[0].color;e[0]<5&&e[1]<5&&e[2]<5&&(t[0].color=[0,0,0]);var o=t.length-1,n=t[o].color;n[0]>251&&n[1]>251&&n[2]>251&&(t[o].color=[255,255,255])}},{quantize:function(t,o){function s(t,e){for(var o,n=1,i=0;i<u;)if((o=t.pop()).count()){var r=a(l,o),s=r[0],c=r[1];if(!s)return;if(t.push(s),c&&(t.push(c),n++),n>=e)return;if(i++>u)return}else t.push(o),i++}if(!t.length||o<2||o>256)return!1;var l=i(t),d=0;l.forEach(function(){d++});var h=r(t,l),g=new e(function(t,e){return pv.naturalOrder(t.count(),e.count())});g.push(h),s(g,c*o);for(var f=new e(function(t,e){return pv.naturalOrder(t.count()*t.volume(),e.count()*e.volume())});g.size();)f.push(g.pop());s(f,o-f.size());for(var p=new n;f.size();)p.push(f.pop());return p}}}();!function(){function t(t){for(;t&&t!==document.body;){var e=window.getComputedStyle(t),o=function(t,o){return!(void 0===e[t]||e[t]===o)};if(e.opacity<1||o("zIndex","auto")||o("transform","none")||o("mixBlendMode","normal")||o("filter","none")||o("perspective","none")||"isolate"===e.isolation||"fixed"===e.position||"touch"===e.webkitOverflowScrolling)return!0;t=t.parentElement}return!1}function e(t){for(;t;){if("dialog"===t.localName)return t;t=t.parentElement}return null}function o(t){t&&t.blur&&t!=document.body&&t.blur()}function n(t,e){for(var o=0;o<t.length;++o)if(t[o]==e)return!0;return!1}function i(t){if(this.dialog_=t,this.replacedStyleTop_=!1,this.openAsModal_=!1,t.hasAttribute("role")||t.setAttribute("role","dialog"),t.show=this.show.bind(this),t.showModal=this.showModal.bind(this),t.close=this.close.bind(this),"returnValue"in t||(t.returnValue=""),"MutationObserver"in window)new MutationObserver(this.maybeHideModal.bind(this)).observe(t,{attributes:!0,attributeFilter:["open"]});else{var e,o=!1,n=function(){o?this.downgradeModal():this.maybeHideModal(),o=!1}.bind(this),i=function(t){var i="DOMNodeRemoved";o|=t.type.substr(0,i.length)===i,window.clearTimeout(e),e=window.setTimeout(n,0)};["DOMAttrModified","DOMNodeRemoved","DOMNodeRemovedFromDocument"].forEach(function(e){t.addEventListener(e,i)})}Object.defineProperty(t,"open",{set:this.setOpen.bind(this),get:t.hasAttribute.bind(t,"open")}),this.backdrop_=document.createElement("div"),this.backdrop_.className="backdrop",this.backdrop_.addEventListener("click",this.backdropClick_.bind(this))}var r=window.CustomEvent;r&&"object"!=typeof r||((r=function(t,e){e=e||{};var o=document.createEvent("CustomEvent");return o.initCustomEvent(t,!!e.bubbles,!!e.cancelable,e.detail||null),o}).prototype=window.Event.prototype),i.prototype={get dialog(){return this.dialog_},maybeHideModal:function(){this.dialog_.hasAttribute("open")&&document.body.contains(this.dialog_)||this.downgradeModal()},downgradeModal:function(){this.openAsModal_&&(this.openAsModal_=!1,this.dialog_.style.zIndex="",this.replacedStyleTop_&&(this.dialog_.style.top="",this.replacedStyleTop_=!1),this.backdrop_.parentNode&&this.backdrop_.parentNode.removeChild(this.backdrop_),a.dm.removeDialog(this))},setOpen:function(t){t?this.dialog_.hasAttribute("open")||this.dialog_.setAttribute("open",""):(this.dialog_.removeAttribute("open"),this.maybeHideModal())},backdropClick_:function(t){if(this.dialog_.hasAttribute("tabindex"))this.dialog_.focus();else{var e=document.createElement("div");this.dialog_.insertBefore(e,this.dialog_.firstChild),e.tabIndex=-1,e.focus(),this.dialog_.removeChild(e)}var o=document.createEvent("MouseEvents");o.initMouseEvent(t.type,t.bubbles,t.cancelable,window,t.detail,t.screenX,t.screenY,t.clientX,t.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.button,t.relatedTarget),this.dialog_.dispatchEvent(o),t.stopPropagation()},focus_:function(){var t=this.dialog_.querySelector("[autofocus]:not([disabled])");if(!t&&this.dialog_.tabIndex>=0&&(t=this.dialog_),!t){var e=["button","input","keygen","select","textarea"].map(function(t){return t+":not([disabled])"});e.push('[tabindex]:not([disabled]):not([tabindex=""])'),t=this.dialog_.querySelector(e.join(", "))}o(document.activeElement),t&&t.focus()},updateZIndex:function(t,e){if(t<e)throw new Error("dialogZ should never be < backdropZ");this.dialog_.style.zIndex=t,this.backdrop_.style.zIndex=e},show:function(){this.dialog_.open||(this.setOpen(!0),this.focus_())},showModal:function(){if(this.dialog_.hasAttribute("open"))throw new Error("Failed to execute 'showModal' on dialog: The element is already open, and therefore cannot be opened modally.");if(!document.body.contains(this.dialog_))throw new Error("Failed to execute 'showModal' on dialog: The element is not in a Document.");if(!a.dm.pushDialog(this))throw new Error("Failed to execute 'showModal' on dialog: There are too many open modal dialogs.");t(this.dialog_.parentElement)&&console.warn("A dialog is being shown inside a stacking context. This may cause it to be unusable. For more information, see this link: https://github.com/GoogleChrome/dialog-polyfill/#stacking-context"),this.setOpen(!0),this.openAsModal_=!0,a.needsCentering(this.dialog_)?(a.reposition(this.dialog_),this.replacedStyleTop_=!0):this.replacedStyleTop_=!1,this.dialog_.parentNode.insertBefore(this.backdrop_,this.dialog_.nextSibling),this.focus_()},close:function(t){if(!this.dialog_.hasAttribute("open"))throw new Error("Failed to execute 'close' on dialog: The element does not have an 'open' attribute, and therefore cannot be closed.");this.setOpen(!1),void 0!==t&&(this.dialog_.returnValue=t);var e=new r("close",{bubbles:!1,cancelable:!1});this.dialog_.dispatchEvent(e)}};var a={};a.reposition=function(t){var e=document.body.scrollTop||document.documentElement.scrollTop,o=e+(window.innerHeight-t.offsetHeight)/2;t.style.top=Math.max(e,o)+"px"},a.isInlinePositionSetByStylesheet=function(t){for(var e=0;e<document.styleSheets.length;++e){var o=document.styleSheets[e],i=null;try{i=o.cssRules}catch(t){}if(i)for(var r=0;r<i.length;++r){var a=i[r],s=null;try{s=document.querySelectorAll(a.selectorText)}catch(t){}if(s&&n(s,t)){var l=a.style.getPropertyValue("top"),u=a.style.getPropertyValue("bottom");if(l&&"auto"!=l||u&&"auto"!=u)return!0}}}return!1},a.needsCentering=function(t){return"absolute"==window.getComputedStyle(t).position&&(!("auto"!=t.style.top&&""!=t.style.top||"auto"!=t.style.bottom&&""!=t.style.bottom)&&!a.isInlinePositionSetByStylesheet(t))},a.forceRegisterDialog=function(t){if(t.showModal&&console.warn("This browser already supports <dialog>, the polyfill may not work correctly",t),"dialog"!==t.localName)throw new Error("Failed to register dialog: The element is not a dialog.");new i(t)},a.registerDialog=function(t){t.showModal||a.forceRegisterDialog(t)},a.DialogManager=function(){this.pendingDialogStack=[];var t=this.checkDOM_.bind(this);this.overlay=document.createElement("div"),this.overlay.className="_dialog_overlay",this.overlay.addEventListener("click",function(e){this.forwardTab_=void 0,e.stopPropagation(),t([])}.bind(this)),this.handleKey_=this.handleKey_.bind(this),this.handleFocus_=this.handleFocus_.bind(this),this.zIndexLow_=1e5,this.zIndexHigh_=100150,this.forwardTab_=void 0,"MutationObserver"in window&&(this.mo_=new MutationObserver(function(e){var o=[];e.forEach(function(t){for(var e,n=0;e=t.removedNodes[n];++n)if(e instanceof Element)if("dialog"===e.localName)o.push(e);else{var i=e.querySelector("dialog");i&&o.push(i)}}),o.length&&t(o)}))},a.DialogManager.prototype.blockDocument=function(){document.documentElement.addEventListener("focus",this.handleFocus_,!0),document.addEventListener("keydown",this.handleKey_),this.mo_&&this.mo_.observe(document,{childList:!0,subtree:!0})},a.DialogManager.prototype.unblockDocument=function(){document.documentElement.removeEventListener("focus",this.handleFocus_,!0),document.removeEventListener("keydown",this.handleKey_),this.mo_&&this.mo_.disconnect()},a.DialogManager.prototype.updateStacking=function(){for(var t,e=this.zIndexHigh_,o=0;t=this.pendingDialogStack[o];++o)t.updateZIndex(--e,--e),0===o&&(this.overlay.style.zIndex=--e);var n=this.pendingDialogStack[0];n?(n.dialog.parentNode||document.body).appendChild(this.overlay):this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay)},a.DialogManager.prototype.containedByTopDialog_=function(t){for(;t=e(t);){for(var o,n=0;o=this.pendingDialogStack[n];++n)if(o.dialog===t)return 0===n;t=t.parentElement}return!1},a.DialogManager.prototype.handleFocus_=function(t){if(!this.containedByTopDialog_(t.target)&&(t.preventDefault(),t.stopPropagation(),o(t.target),void 0!==this.forwardTab_)){var e=this.pendingDialogStack[0];return e.dialog.compareDocumentPosition(t.target)&Node.DOCUMENT_POSITION_PRECEDING&&(this.forwardTab_?e.focus_():document.documentElement.focus()),!1}},a.DialogManager.prototype.handleKey_=function(t){if(this.forwardTab_=void 0,27===t.keyCode){t.preventDefault(),t.stopPropagation();var e=new r("cancel",{bubbles:!1,cancelable:!0}),o=this.pendingDialogStack[0];o&&o.dialog.dispatchEvent(e)&&o.dialog.close()}else 9===t.keyCode&&(this.forwardTab_=!t.shiftKey)},a.DialogManager.prototype.checkDOM_=function(t){this.pendingDialogStack.slice().forEach(function(e){-1!==t.indexOf(e.dialog)?e.downgradeModal():e.maybeHideModal()})},a.DialogManager.prototype.pushDialog=function(t){var e=(this.zIndexHigh_-this.zIndexLow_)/2-1;return!(this.pendingDialogStack.length>=e)&&(1===this.pendingDialogStack.unshift(t)&&this.blockDocument(),this.updateStacking(),!0)},a.DialogManager.prototype.removeDialog=function(t){var e=this.pendingDialogStack.indexOf(t);-1!=e&&(this.pendingDialogStack.splice(e,1),0===this.pendingDialogStack.length&&this.unblockDocument(),this.updateStacking())},a.dm=new a.DialogManager,document.addEventListener("submit",function(t){var o=t.target;if(o&&o.hasAttribute("method")&&"dialog"===o.getAttribute("method").toLowerCase()){t.preventDefault();var n=e(t.target);if(n){var i,r=["BUTTON","INPUT"];[document.activeElement,t.explicitOriginalTarget].some(function(e){if(e&&e.form==t.target&&-1!=r.indexOf(e.nodeName.toUpperCase()))return i=e.value,!0}),n.close(i)}}},!0),a.forceRegisterDialog=a.forceRegisterDialog,a.registerDialog=a.registerDialog,"function"==typeof define&&"amd"in define?define(function(){return a}):"object"==typeof module&&"object"==typeof module.exports?module.exports=a:window.dialogPolyfill=a}();var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}();window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(t,e){e=e||window;for(var o=0;o<this.length;o++)t.call(e,this[o],o,this)});var Dbox=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=e.element,n=void 0===o?".dbox":o,i=e.dialogBox,r=void 0===i?"#js-dbox":i,a=e.modal,s=void 0!==a&&a;_classCallCheck(this,t),this.element=document.querySelectorAll(n),this.dialogBox=document.querySelector(r),this.modal=s,this.lbImage=this.dialogBox.getElementsByTagName("img")[0],this.lbCaption=this.dialogBox.getElementsByTagName("p")[0]}return _createClass(t,[{key:"open",value:function(t){dialogPolyfill.registerDialog(this.dialogBox),this.insertImage(t),this.dialogBox.showModal()}},{key:"closeDialog",value:function(){var t=this;this.modal?(this.closeButton=this.dialogBox.querySelector("button"),this.closeButton.addEventListener("click",function(e){e.preventDefault(),t.dialogBox.close(),t.removeImage()})):this.dialogBox.addEventListener("click",function(e){e.preventDefault(),t.dialogBox.close(),t.removeImage()})}},{key:"insertImage",value:function(t){this.lbImage.setAttribute("src",t.getAttribute("href")),this.lbImage.setAttribute("alt",t.querySelector("img").getAttribute("alt")),this.insertLightboxCaption(t),this.updateDialogBG(this.dialogBox,t.querySelector("img"))}},{key:"insertLightboxCaption",value:function(t){return this.lbCaption.textContent=t.querySelector("img").getAttribute("alt")}},{key:"removeImage",value:function(){this.lbImage.setAttribute("src","")}},{key:"getThumbColor",value:function(t){return(new ColorThief).getColor(t)}},{key:"updateDialogBG",value:function(t,e){var o=this.getThumbColor(e),n=t.querySelector(".dbox-dialog--container");t.querySelector("img").style.backgroundColor="rgb("+o+")",n.style.backgroundColor="rgb("+o+")",this.lbCaption.style.color=this.setTextContrast(o)}},{key:"setTextContrast",value:function(t){return Math.round((299*parseInt(t[0])+587*parseInt(t[1])+114*parseInt(t[2]))/1e3)>125?"#000":"#fff"}},{key:"run",value:function(){var t=this;this.element.forEach(function(e){e.addEventListener("click",function(o){o.preventDefault(),t.open(e)})}),this.closeDialog()}}]),t}();