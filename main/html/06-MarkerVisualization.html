<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="UM Bioinformatics Core" />

<meta name="date" content="2024-10-14" />

<title>Marker identification and visualization</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>
<!--
Favicon dervied from
https://twemoji.twitter.com/
https://favicon.io/emoji-favicons/dna/
-->
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="shortcut icon" href="favicon-16x16.png" />
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Intro to scRNA-Seq</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="workshop_intro.html">Intro</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 1
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="00A-OrientingOnScRNASeq.html">Orienting on scRNA-Seq</a>
    </li>
    <li>
      <a href="01-GettingStarted.html">Getting Started with Seurat</a>
    </li>
    <li>
      <a href="00B-CellRangerInAction.html">Cell Ranger in Action</a>
    </li>
    <li>
      <a href="02-QCandFiltering.html">Secondary QC &amp; Filtering</a>
    </li>
    <li>
      <a href="03-Normalization.html">Normalization</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 2
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="04-PCAandIntegration.html">PCA &amp; Integration</a>
    </li>
    <li>
      <a href="05-ProjectionAndClustering.html">Projection &amp; Clustering</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Day 3
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="06-MarkerVisualization.html">Marker identification and visualization</a>
    </li>
    <li>
      <a href="07-CellTypeAnnos.html">Cell type annotation</a>
    </li>
    <li>
      <a href="08-DifferentialExpression.html">Differential expression analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="workshop_wrap_up.html">Wrap up</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Marker identification and
visualization</h1>
<h4 class="author">UM Bioinformatics Core</h4>
<h4 class="date">2024-10-14</h4>

</div>


<style type="text/css">
body, td {
   font-size: 18px;
}
code.r{
  font-size: 12px;
}
pre {
  font-size: 12px
}

table.fig, th.fig, td.fig {
  border: 1px solid black;
  border-collapse: collapse;
  padding: 15px;
}
</style>
<script>
  addClassKlippyTo("pre.r, pre.markdown, pre.bash");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<div id="workflow-overview" class="section level1 unlisted unnumbered">
<h1 class="unlisted unnumbered">Workflow Overview</h1>
<p><br/>
<img src="images/wayfinder/wayfinder.png" alt="wayfinder" style="height: 400px;"/>
<br/> <br/></p>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>To interpret our initial clustering results for all cells in our
experiment, we’ll need to characterize the gene expression driving
separation between the clusters.</p>
<table class="fig">
<tr class="fig">
<td class="fig">
<img
src="images/graphical_abstracts/graphical_abstract_marker_id.png" />
</td>
</tr>
<tr class="fig">
<td class="fig">
Expression profiles (A) for for each cell cluster are evaluated against
all other clusters (B) to identify marker genes, i.e. genes useful for
segregating the cells into clusters (C).
</td>
</tr>
</table>
<p><br/></p>
<p>In this section, we will demonstrate: - How to generate “analytical”
markers based on gene expression in each cluster - How to visualize the
expression of genes of interest to aid in cluster identification and
labeling</p>
<p>This process can be a highly variable, from seeing well-characterized
marker genes as top markers to needing to dig through the literature and
plot the expression for multiple sets of genes of interest. Like the
previous sections (and like other areas of research), when this process
is more involved or iterative, often only the final results are
reported.</p>
<div id="objectives" class="section level2">
<h2>Objectives</h2>
<!--Add specific goals for section-->
<ul>
<li>Determine gene markers for each of the clusters using
<code>FindAllMarkers()</code></li>
<li>Visualize expression across clusters for genes of interest using
<code>DotPlot()</code></li>
</ul>
<hr />
</div>
</div>
<div id="cluster-markers-and-characterization" class="section level1">
<h1>Cluster markers and characterization</h1>
<p>After generating clusters, we need to perform differential expression
analysis to identify the genes that distinguish those clusters (<a
href="https://ouyanglab.com/singlecell/clust.html#identifying-marker-genes">source</a>).
This should allow us to get visibility on some key questions for our
clusters, as <a
href="https://hbctraining.github.io/scRNA-seq_online/lessons/09_merged_SC_marker_identification.html">highlighted
by the HBC materials</a>, namely:</p>
<ul>
<li>Are there are biologically meaningful gene expression differences
between the clusters?</li>
<li>Does the gene expression of the generated clusters correspond to
expected cell-types or sub-types?</li>
<li>Are there clusters with similar expression that should be combined
and/or clusters that might need to be sub-clustered into smaller
populations?</li>
</ul>
<p>Many of the differential expression (DE) tools designed for bulk
RNA-seq samples have been benchmarked for performance on scRNA-seq in <a
href="https://pubmed.ncbi.nlm.nih.gov/29481549/">Soneson and Robinson
(2018)</a> and there are also dedicated DE tools for scRNA-seq, like <a
href="https://genomebiology.biomedcentral.com/articles/10.1186/s13059-015-0844-5">MAST</a>,
that use models that account for the expected sparse structure of
scRNA-seq data. However in our and others’ experience, the default
Wilcoxon test is often sufficient for simple pairwise DE comparisons,
while edgeR (<a
href="https://pubmed.ncbi.nlm.nih.gov/19910308/">Robinson, McCarthy, and
Smyth 2010</a>) is recommended by the <a
href="%5BOuyang%5D(https://ouyanglab.com/singlecell/clust.html#identifying-marker-genes)">Ouyang
Lab</a> for more complex comparison designs, such as those that include
covariates.</p>
<!-- Additional context from [Ouyang](https://ouyanglab.com/singlecell/clust.html#identifying-marker-genes) regarding tool options and [HBC materials](https://hbctraining.github.io/scRNA-seq_online/lessons/09_merged_SC_marker_identification.html) regarding FindMarkers vs FindConservedMarkers, etc. -->
<div class="float">
<img
src="images/curriculum/06-MarkerVisualization/Ouyang_clust-deCompare.png"
alt="Image: Comparison of the performance of DE methods applied to scRNA-seq datasets. Methods are ranked by their average performance across all the listed criteria. Image taken from Soneson and Robinson (2018)." />
<div class="figcaption">Image: Comparison of the performance of DE
methods applied to scRNA-seq datasets. Methods are ranked by their
average performance across all the listed criteria. Image taken from
Soneson and Robinson (2018).</div>
</div>
<details>
<summary>
<em>Additional considerations for differential expression</em>
</summary>
The Ouyang Lab has a <a
href="https://ouyanglab.com/singlecell/clust.html#sec:diffexpr">section
of their tutorial</a> that discusses the methods available for
differential expression including some highlighted in the figure below,
as well as a more extensive section on <a
href="https://ouyanglab.com/singlecell/clust.html#sec:diffexpr">threshold
considerations</a>, while the <a
href="https://hbctraining.github.io/scRNA-seq_online/lessons/09_merged_SC_marker_identification.html">HBC
section on marker genes identification</a> highlights the different
types of marker identification options available via Seurat.
</details>
<p><br></p>
<div id="marker-identification" class="section level2">
<h2>Marker identification</h2>
<p>First, we’ll ensure that the correct resolution is selected from our
Seurat object and then we’ll use the <code>PrepSCTFindMarkers()</code>
<a
href="https://satijalab.org/seurat/reference/prepsctfindmarkers">function</a>
in preparation for DE comaprisons to “reverse the individual SCT
regression model using minimum of median UMI as the sequencing depth
covariate” according to the <a
href="https://satijalab.org/seurat/reference/prepsctfindmarkers">Seurat
documentation</a>.</p>
<!-- if we want to use the normalized RNA data (not the integrated data) `DefaultAssay(geo_so) <- "RNA"`, although need to check if that still makes sense for Seurat v5 -->
<p>Then we’ll run the<code>FindAllMarkers()</code> <a
href="https://satijalab.org/seurat/reference/findallmarkers">function</a>
to generate comparisons between each cluster and all other cells,
regardless of the experimental group. Note - the statistical test to
perform can be specified in <code>FindAllMarkers()</code>, but the
default is a Wilcoxon test.</p>
<pre class="r"><code># Code block - find empirical markers
# Prep for cluster comparisons
geo_so = SetIdent(geo_so, value = &#39;integrated.sct.rpca.clusters&#39;)
geo_so = PrepSCTFindMarkers(geo_so)

# Run comparisons for each cluster to generate markers
geo_markers = FindAllMarkers(geo_so, only.pos = TRUE, min.pct = 0.05)

# Take a look at the first few rows of the result
head(geo_markers)</code></pre>
<pre><code>        p_val avg_log2FC pct.1 pct.2 p_val_adj cluster    gene
Col12a1     0   4.447290 0.913 0.118         0       0 Col12a1
Lox         0   3.202537 0.902 0.151         0       0     Lox
Thbs2       0   3.923020 0.880 0.141         0       0   Thbs2
Tnc         0   4.325543 0.815 0.088         0       0     Tnc
Col11a1     0   5.275764 0.744 0.052         0       0 Col11a1
Aebp1       0   2.434328 0.972 0.283         0       0   Aebp1</code></pre>
<pre class="r"><code># Write out full cluster marker results to file
write_csv(geo_markers, file = &#39;results/tables/marker_genes_0.4res.csv&#39;)</code></pre>
<p>Note that with <code>SetIdent()</code> above, we are changing
identities of the cells to “integrated.sct.rpca.clusters” explicitly.
The “seurat_clusters” column is the default column for cell identities
and changes each time a new clustering is performed.</p>
<div class="float">
<img src="images/seurat_schematic/Slide11.png"
alt="Image: Schematic after SetIdent()." />
<div class="figcaption">Image: Schematic after SetIdent().</div>
</div>
<!--- Consider how to represent the result of PrepSCTFindMarkers() in the schematic. It's a little too subtle... -->
<!--- Consider adding figure showing example of what's being compared (circle cluster 1 and then circle all other cells for example) -->
<details>
<summary>
<em>Seurat v5 improvements</em>
</summary>
For marker generation, Seurat v5 uses the <a
href="https://www.biorxiv.org/content/10.1101/653253v1">presto
package</a> to reduce the time required to run DE comparisons,
particularly for large datasets. For users who are not using presto,
Seurat recommends increasing the min.pct and logfc.threshold
parameterscto increase the speed of DE testing (<a
href="https://satijalab.org/seurat/articles/pbmc3k_tutorial.html#finding-differentially-expressed-features-cluster-biomarkers">source</a>).
</details>
<p><br></p>
<p>Note that over-interpretation of these results should be avoided,
since each cell is used as a replicate in these comparisons which can
lead to inflated (e.g. very low) p-values, the top markers are more
likely to be trustworthy (<a
href="https://hbctraining.github.io/scRNA-seq_online/lessons/09_merged_SC_marker_identification.html">source</a>).</p>
<p>Therefore, it’s useful to filter the results to highlight the top
positive markers (since a positive fold-change would mean that gene is
more highly expressed in the cluster compared to all other cells),
before looking at our results</p>
<pre class="r"><code># Code block - identify marker genes for each cluster
# Create table of top 5 markers per cluster (using default ranking)
top_5 = geo_markers %&gt;% filter(p_val_adj &lt; 0.01) %&gt;% group_by(cluster) %&gt;% slice_head(n = 5)

# Look at results
head(top_5, n = 10)</code></pre>
<pre><code># A tibble: 10 × 7
# Groups:   cluster [2]
   p_val avg_log2FC pct.1 pct.2 p_val_adj cluster gene    
   &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;   &lt;chr&gt;   
 1     0       4.45 0.913 0.118         0 0       Col12a1 
 2     0       3.20 0.902 0.151         0 0       Lox     
 3     0       3.92 0.88  0.141         0 0       Thbs2   
 4     0       4.33 0.815 0.088         0 0       Tnc     
 5     0       5.28 0.744 0.052         0 0       Col11a1 
 6     0       5.04 0.867 0.076         0 1       Clec3b  
 7     0       3.35 0.969 0.258         0 1       Serping1
 8     0       3.08 0.874 0.177         0 1       Dpt     
 9     0       3.21 0.781 0.113         0 1       C1s1    
10     0       4.86 0.7   0.045         0 1       Tnxb    </code></pre>
<pre class="r"><code># Optional - Create table of top 5 markers per cluster (ranked by logFC)
top_5_by_log2FC = geo_markers %&gt;% group_by(cluster) %&gt;% arrange(p_val_adj, desc(avg_log2FC)) %&gt;% slice_head(n = 5)

# Look at results after ranking
head(top_5_by_log2FC, n = 10) # notice difference in pct.1 column between tables</code></pre>
<pre><code># A tibble: 10 × 7
# Groups:   cluster [2]
   p_val avg_log2FC pct.1 pct.2 p_val_adj cluster gene     
   &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;   &lt;chr&gt;    
 1     0       6.57 0.078 0.003         0 0       Ucma     
 2     0       6.27 0.118 0.004         0 0       Cilp2    
 3     0       5.80 0.392 0.012         0 0       Scx      
 4     0       5.66 0.074 0.003         0 0       Matn3    
 5     0       5.38 0.56  0.043         0 0       Fmod     
 6     0       7.27 0.058 0             0 1       Gm31378  
 7     0       6.33 0.108 0.001         0 1       Serpina3c
 8     0       5.95 0.143 0.003         0 1       Lvrn     
 9     0       5.91 0.134 0.003         0 1       Inmt     
10     0       5.91 0.19  0.003         0 1       C7       </code></pre>
<p>We expect to see several columns:</p>
<ul>
<li><code>gene</code>: gene symbol</li>
<li><code>p_val</code>: p-value not adjusted for multiple test
correction</li>
<li><code>avg_logFC</code>: average log fold change. Positive values
indicate that the gene is more highly expressed in the cluster.</li>
<li><code>pct.1</code>: percentage of cells where the gene is detected
in the cluster</li>
<li><code>pct.2</code>: percentage of cells where the gene is detected
on average across all other clusters</li>
<li><code>p_val_adj</code>: adjusted p-value based on bonferroni
correction using all genes in the dataset, used to determine
significance</li>
<li><code>cluster</code>: cluster represented by <code>pct.1</code> and
for which the statistics in the row are reported</li>
</ul>
<p>When looking at the output, it is important to prioritize marker
genes with both larger fold-change differences and larger difference
between pct.1 and pct.2, particularly if pct.1 is high (e.g. if 80% of
cells in the cluster evaluated express the gene that more reliable than
if only 20% of cells express that gene) (<a
href="https://hbctraining.github.io/scRNA-seq_online/lessons/09_merged_SC_marker_identification.html">source</a>).</p>
</div>
<div id="marker-visualization" class="section level2">
<h2>Marker visualization</h2>
<p>Now that we have generated a set of marker genes for our clusters, it
is useful to visualize the expression of those markers to aid in
evaluating them. While the expression of individual genes per cell can
be overlaid on our UMAPs (as with the <code>FeaturePlot()</code> <a
href="https://satijalab.org/seurat/reference/featureplot">function</a>),
it’s often more useful to visualize the expression of multiple genes
simultaneously. While there are <a
href="https://satijalab.org/seurat/articles/visualization_vignette">multiple
methods supported by Seurat</a> for visualizing marker gene expression,
a heatmap or a related plot called a dotplot are commonly used.</p>
<p>We’ll use the <code>DotPlot()</code> <a
href="https://satijalab.org/seurat/reference/dotplot">function</a> with
the SCT values to visualize the top 5 marker genes per cluster:</p>
<pre class="r"><code>top_5_sct_dot_plot = DotPlot(geo_so, features = unique(top_5$gene)) + 
    theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
    labs(title = &#39;Top 5 Cluster Genes by FDR and avg_log2FC&#39;) + coord_flip()
top_5_sct_dot_plot</code></pre>
<p><img src="images/curriculum/06-MarkerVisualization/06-top_5_dot_plot_sct-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggsave(filename = &#39;results/figures/markers_top_5_sct_dot_plot.png&#39;, plot = top_5_sct_dot_plot, width = 8, height = 18, units = &#39;in&#39;) </code></pre>
<p>In the dotplot we can see that the color indicates the expression of
the gene while the size of the dot indicates the proportion of cells
expressing that gene in each cluster (<a
href="https://ouyanglab.com/singlecell/clust.html#visualising-marker-genes">source</a>).</p>
<details>
<summary>
<em>Using raw RNA values in Dotplots</em>
</summary>
<p>In addition to plotting the SCT values, the raw or normalized RNA
values can be plotted as well:</p>
<pre class="r"><code>top_5_rna_dot_plot = DotPlot(geo_so, features = unique(top_5_by_log2FC$gene), assay = &#39;RNA&#39;) + 
    theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
    labs(title = &#39;Top 5 Cluster Genes by FDR and avg_log2FC&#39;) + coord_flip()

ggsave(filename = &#39;results/figures/markers_top_5_rna_dot_plot.png&#39;, plot = top_5_rna_dot_plot, width = 8, height = 18, units = &#39;in&#39;) </code></pre>
</details>
<p><br> <br></p>
</div>
</div>
<div id="utilizing-genes-of-interest" class="section level1">
<h1>Utilizing genes of interest</h1>
<p>Often we have prior information about what cell types are expected in
our samples and key marker genes for those populations. This can be an
important part of evaluating our clusters, since if genes that are known
markers for a specific cell type are found in too many or too few
clusters as that can suggest that re-clustering is needed or that some
of the clusters should be manually combined before annotating.</p>
<p>We can create lists of markers used in figures from the <a
href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7002453/">original
paper</a> before using the same <code>DotPlot()</code> function to
visualize the expression level and frequency of these genes in our
current clusters:</p>
<pre class="r"><code># manually create lists of genes from paper
fig1g_markers = c(&#39;Cxcl1&#39;, &#39;Cxcl2&#39;, &#39;Ccl2&#39;, &#39;Ccl3&#39;, &#39;Ccl4&#39;, &#39;Il1b&#39;, &#39;Il6b&#39;, &#39;Tnf&#39;, &#39;Tgfb1&#39;, &#39;Tgfb2&#39;, &#39;Tgfb3&#39;, &#39;Cxcl5&#39;)
fig1h_markers = c(&#39;Cxcr2&#39;, &#39;Csf1r&#39;, &#39;Csf3r&#39;, &#39;Tgfbr1&#39;, &#39;Tgfbr3&#39;, &#39;Il1r1&#39;, &#39;Il6ra&#39;, &#39;Lifr&#39;, &#39;Tgfbr2&#39;)

# create DotPlots for genes from paper
fig1g_sct_dot_plot = DotPlot(geo_so, features = fig1g_markers, assay = &#39;SCT&#39;)</code></pre>
<pre><code>Warning: The following requested variables were not found: Il6b</code></pre>
<pre class="r"><code>fig1h_sct_dot_plot = DotPlot(geo_so, features = fig1h_markers, assay = &#39;SCT&#39;)

fig1g_sct_dot_plot
fig1h_sct_dot_plot

# save plots to file
ggsave(filename = &#39;results/figures/markers_fig1g_sct_dot_plot.png&#39;, plot = fig1g_sct_dot_plot, width = 8, height = 6, units = &#39;in&#39;)
ggsave(filename = &#39;results/figures/markers_fig1h_sct_dot_plot.png&#39;, plot = fig1h_sct_dot_plot, width = 8, height = 6, units = &#39;in&#39;)</code></pre>
<p><img src="images/curriculum/06-MarkerVisualization/06-known_dot_plots_sct-1.png" width="816" style="display: block; margin: auto;" /><img src="images/curriculum/06-MarkerVisualization/06-known_dot_plots_sct-2.png" width="816" style="display: block; margin: auto;" /></p>
<details>
<summary>
<em>Using raw RNA values for genes of interest</em>
</summary>
<p>We can also generate the same plots, but using the unintegrated data
by specifying the <code>RNA</code> assay:</p>
<pre class="r"><code>rna_dot_plot = DotPlot(geo_so, features = fig1g_markers, assay = &#39;RNA&#39;)
fig1h_rna_dot_plot = DotPlot(geo_so, features = fig1h_markers, assay = &#39;RNA&#39;)

ggsave(filename = &#39;results/figures/markers_fig1g_rna_dot_plot.png&#39;, plot = fig1g_rna_dot_plot, width = 8, height = 6, units = &#39;in&#39;)
ggsave(filename = &#39;results/figures/markers_fig1h_rna_dot_plot.png&#39;, plot = fig1h_rna_dot_plot, width = 8, height = 6, units = &#39;in&#39;)</code></pre>
</details>
<p><br></p>
<p>For known marker genes, it’s important to note that since scRNA-seq
is only measuring transcriptional signals that markers at the protein
level (e.g used for approaches like FACS) may be less effective. An
alternative or complement to using marker genes could be methods like
using gene set enrichment (GSEA) <a
href="https://bioconductor.org/books/3.15/OSCA.basic/cell-type-annotation.html#computing-gene-set-activities">as
demonstrated in the OSCA book</a> to aid in annotations. However, the
book <a
href="https://www.sc-best-practices.org/cellular_structure/annotation.html">“Best
practices for single-cell analysis across modalities” by Heumos, Schaar,
Lance, et al. </a> points out that “it is often useful to work together
with experts … [like a] biologist who has more extensive knowledge of
the tissue, the biology, the expected cell types and markers etc.”. In
our experience, we find that experience and knowledge of the researchers
we work with is invaluable.</p>
</div>
<div id="save-our-progress" class="section level1">
<h1>Save our progress</h1>
<p>Finally, we’ll create an output file for our updated Seurat object
and for the cluster marker results:</p>
<pre class="r"><code>saveRDS(geo_so, file = &#39;results/rdata/geo_so_sct_integrated_with_markers.rds&#39;)
saveRDS(geo_markers, file = &#39;results/rdata/geo_markers.rds&#39;)</code></pre>
</div>
<div id="summary" class="section level1">
<h1>Summary</h1>
<p>Now that we have characterized the expression of both analytical
marker genes and literature / knowledge-based marker genes, we may have
a better sense of what cell-types or subtypes our clusters might
correspond to.</p>
<p>However, marker genes alone might not be sufficient to determine
cell-type or sub-type labels for our clusters so we will discuss other
more automated approaches to complement these results.</p>
<p>Next steps: Cell type prediction tools</p>
<hr />
<p>These materials have been adapted and extended from materials listed
above. These are open access materials distributed under the terms of
the <a href="http://creativecommons.org/licenses/by/4.0/">Creative
Commons Attribution license (CC BY 4.0)</a>, which permits unrestricted
use, distribution, and reproduction in any medium, provided the original
author and source are credited.</p>
<br/> <br/>
<hr/>
<table style="width:100%;">
<colgroup>
<col width="28%" />
<col width="42%" />
<col width="28%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><a href="05-ProjectionAndClustering.html">Previous
lesson</a></th>
<th align="center"><a href="#top">Top of this lesson</a></th>
<th align="right"><a href="07-CellTypeAnnos.html">Next lesson</a></th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiTWFya2VyIGlkZW50aWZpY2F0aW9uIGFuZCB2aXN1YWxpemF0aW9uIgphdXRob3I6ICJVTSBCaW9pbmZvcm1hdGljcyBDb3JlIgpkYXRlOiAiYHIgU3lzLkRhdGUoKWAiCm91dHB1dDoKICAgICAgICBodG1sX2RvY3VtZW50OgogICAgICAgICAgICBpbmNsdWRlczoKICAgICAgICAgICAgICAgIGluX2hlYWRlcjogaGVhZGVyLmh0bWwKICAgICAgICAgICAgdGhlbWU6IHBhcGVyCiAgICAgICAgICAgIHRvYzogdHJ1ZQogICAgICAgICAgICB0b2NfZGVwdGg6IDQKICAgICAgICAgICAgdG9jX2Zsb2F0OiB0cnVlCiAgICAgICAgICAgIG51bWJlcl9zZWN0aW9uczogZmFsc2UKICAgICAgICAgICAgZmlnX2NhcHRpb246IHRydWUKICAgICAgICAgICAgbWFya2Rvd246IEdGTQogICAgICAgICAgICBjb2RlX2Rvd25sb2FkOiB0cnVlCi0tLQoKPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KYm9keSwgdGQgewogICBmb250LXNpemU6IDE4cHg7Cn0KY29kZS5yewogIGZvbnQtc2l6ZTogMTJweDsKfQpwcmUgewogIGZvbnQtc2l6ZTogMTJweAp9Cgp0YWJsZS5maWcsIHRoLmZpZywgdGQuZmlnIHsKICBib3JkZXI6IDFweCBzb2xpZCBibGFjazsKICBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOwogIHBhZGRpbmc6IDE1cHg7Cn0KPC9zdHlsZT4KCmBgYHtyIGtsaXBweSwgZWNobz1GQUxTRSwgaW5jbHVkZT1UUlVFfQprbGlwcHk6OmtsaXBweShsYW5nID0gYygiciIsICJtYXJrZG93biIsICJiYXNoIiksIHBvc2l0aW9uID0gYygidG9wIiwgInJpZ2h0IikpCmBgYAoKYGBge3IsIGluY2x1ZGUgPSBGQUxTRX0Kc291cmNlKCIuLi9iaW4vY2h1bmstb3B0aW9ucy5SIikKa25pdHJfZmlnX3BhdGgoIjA2LU1hcmtlclZpc3VhbGl6YXRpb24vMDYtIikKYGBgCgojIFdvcmtmbG93IE92ZXJ2aWV3IHsudW5saXN0ZWQgLnVubnVtYmVyZWR9Cgo8YnIvPgo8aW1nIHNyYz0iaW1hZ2VzL3dheWZpbmRlci93YXlmaW5kZXIucG5nIiBhbHQ9IndheWZpbmRlciIgc3R5bGU9ImhlaWdodDogNDAwcHg7Ii8+Cjxici8+Cjxici8+CgojIEludHJvZHVjdGlvbgoKVG8gaW50ZXJwcmV0IG91ciBpbml0aWFsIGNsdXN0ZXJpbmcgcmVzdWx0cyBmb3IgYWxsIGNlbGxzIGluIG91ciBleHBlcmltZW50LCB3ZSdsbCBuZWVkIHRvIGNoYXJhY3Rlcml6ZSB0aGUgZ2VuZSBleHByZXNzaW9uIGRyaXZpbmcgc2VwYXJhdGlvbiBiZXR3ZWVuIHRoZSBjbHVzdGVycy4gCgo8dGFibGUgY2xhc3M9J2ZpZyc+Cjx0ciBjbGFzcz0nZmlnJz48dGQgY2xhc3M9J2ZpZyc+IVtdKGltYWdlcy9ncmFwaGljYWxfYWJzdHJhY3RzL2dyYXBoaWNhbF9hYnN0cmFjdF9tYXJrZXJfaWQucG5nKTwvdGQ+PC90cj4KPHRyIGNsYXNzPSdmaWcnPjx0ZCBjbGFzcz0nZmlnJz5FeHByZXNzaW9uIHByb2ZpbGVzIChBKSBmb3IgZm9yIGVhY2ggY2VsbCBjbHVzdGVyIGFyZSBldmFsdWF0ZWQgYWdhaW5zdCBhbGwgb3RoZXIgY2x1c3RlcnMgKEIpIHRvIGlkZW50aWZ5IG1hcmtlciBnZW5lcywgaS5lLiBnZW5lcyB1c2VmdWwgZm9yIHNlZ3JlZ2F0aW5nIHRoZSBjZWxscyBpbnRvIGNsdXN0ZXJzIChDKS4gCjwvdGQ+PC90cj4KPC90YWJsZT4KPGJyLz4KCkluIHRoaXMgc2VjdGlvbiwgd2Ugd2lsbCBkZW1vbnN0cmF0ZToKLSBIb3cgdG8gZ2VuZXJhdGUgImFuYWx5dGljYWwiIG1hcmtlcnMgYmFzZWQgb24gZ2VuZSBleHByZXNzaW9uIGluIGVhY2ggY2x1c3RlciAKLSBIb3cgdG8gdmlzdWFsaXplIHRoZSBleHByZXNzaW9uIG9mIGdlbmVzIG9mIGludGVyZXN0IHRvIGFpZCBpbiBjbHVzdGVyIGlkZW50aWZpY2F0aW9uIGFuZCBsYWJlbGluZwoKVGhpcyBwcm9jZXNzIGNhbiBiZSBhIGhpZ2hseSB2YXJpYWJsZSwgZnJvbSBzZWVpbmcgd2VsbC1jaGFyYWN0ZXJpemVkIG1hcmtlciBnZW5lcyBhcyB0b3AgbWFya2VycyB0byBuZWVkaW5nIHRvIGRpZyB0aHJvdWdoIHRoZSBsaXRlcmF0dXJlIGFuZCBwbG90IHRoZSBleHByZXNzaW9uIGZvciBtdWx0aXBsZSBzZXRzIG9mIGdlbmVzIG9mIGludGVyZXN0LiBMaWtlIHRoZSBwcmV2aW91cyBzZWN0aW9ucyAoYW5kIGxpa2Ugb3RoZXIgYXJlYXMgb2YgcmVzZWFyY2gpLCB3aGVuIHRoaXMgcHJvY2VzcyBpcyBtb3JlIGludm9sdmVkIG9yIGl0ZXJhdGl2ZSwgb2Z0ZW4gb25seSB0aGUgZmluYWwgcmVzdWx0cyBhcmUgcmVwb3J0ZWQuCgojIyBPYmplY3RpdmVzCjwhLS1BZGQgc3BlY2lmaWMgZ29hbHMgZm9yIHNlY3Rpb24tLT4KLSBEZXRlcm1pbmUgZ2VuZSBtYXJrZXJzIGZvciBlYWNoIG9mIHRoZSBjbHVzdGVycyB1c2luZyBgRmluZEFsbE1hcmtlcnMoKWAKLSBWaXN1YWxpemUgZXhwcmVzc2lvbiBhY3Jvc3MgY2x1c3RlcnMgZm9yIGdlbmVzIG9mIGludGVyZXN0IHVzaW5nIGBEb3RQbG90KClgCgotLS0KCmBgYHtyLCByZWFkX3Jkc19oaWRkZW4sIGVjaG8gPSBGQUxTRSwgd2FybmluZyA9IEZBTFNFLCBtZXNzYWdlID0gRkFMU0V9CmlmKCFleGlzdHMoJ2dlb19zbycpKSB7CiAgbGlicmFyeShTZXVyYXQpCiAgbGlicmFyeShCUENlbGxzKQogIGxpYnJhcnkodGlkeXZlcnNlKQoKICBvcHRpb25zKGZ1dHVyZS5nbG9iYWxzLm1heFNpemUgPSAxZTkpCgogIGdlb19zbyA9IHJlYWRSRFMoJ3Jlc3VsdHMvcmRhdGEvZ2VvX3NvX3NjdF9jbHVzdGVyZWQucmRzJykKfQpgYGAKCiMgQ2x1c3RlciBtYXJrZXJzIGFuZCBjaGFyYWN0ZXJpemF0aW9uCgpBZnRlciBnZW5lcmF0aW5nIGNsdXN0ZXJzLCB3ZSBuZWVkIHRvIHBlcmZvcm0gZGlmZmVyZW50aWFsIGV4cHJlc3Npb24gYW5hbHlzaXMgdG8gaWRlbnRpZnkgdGhlIGdlbmVzIHRoYXQgZGlzdGluZ3Vpc2ggdGhvc2UgY2x1c3RlcnMgKFtzb3VyY2VdKGh0dHBzOi8vb3V5YW5nbGFiLmNvbS9zaW5nbGVjZWxsL2NsdXN0Lmh0bWwjaWRlbnRpZnlpbmctbWFya2VyLWdlbmVzKSkuICBUaGlzIHNob3VsZCBhbGxvdyB1cyB0byBnZXQgdmlzaWJpbGl0eSBvbiBzb21lIGtleSBxdWVzdGlvbnMgZm9yIG91ciBjbHVzdGVycywgYXMgW2hpZ2hsaWdodGVkIGJ5IHRoZSBIQkMgbWF0ZXJpYWxzXShodHRwczovL2hiY3RyYWluaW5nLmdpdGh1Yi5pby9zY1JOQS1zZXFfb25saW5lL2xlc3NvbnMvMDlfbWVyZ2VkX1NDX21hcmtlcl9pZGVudGlmaWNhdGlvbi5odG1sKSwgbmFtZWx5OgoKLSBBcmUgdGhlcmUgYXJlIGJpb2xvZ2ljYWxseSBtZWFuaW5nZnVsIGdlbmUgZXhwcmVzc2lvbiBkaWZmZXJlbmNlcyBiZXR3ZWVuIHRoZSBjbHVzdGVycz8gCi0gRG9lcyB0aGUgZ2VuZSBleHByZXNzaW9uIG9mIHRoZSBnZW5lcmF0ZWQgY2x1c3RlcnMgY29ycmVzcG9uZCB0byBleHBlY3RlZCBjZWxsLXR5cGVzIG9yIHN1Yi10eXBlcz8gCi0gQXJlIHRoZXJlIGNsdXN0ZXJzIHdpdGggc2ltaWxhciBleHByZXNzaW9uIHRoYXQgc2hvdWxkIGJlIGNvbWJpbmVkIGFuZC9vciBjbHVzdGVycyB0aGF0IG1pZ2h0IG5lZWQgdG8gYmUgc3ViLWNsdXN0ZXJlZCBpbnRvIHNtYWxsZXIgcG9wdWxhdGlvbnM/CgpNYW55IG9mIHRoZSBkaWZmZXJlbnRpYWwgZXhwcmVzc2lvbiAoREUpIHRvb2xzIGRlc2lnbmVkIGZvciBidWxrIFJOQS1zZXEgc2FtcGxlcyBoYXZlIGJlZW4gYmVuY2htYXJrZWQgZm9yIHBlcmZvcm1hbmNlIG9uIHNjUk5BLXNlcSBpbiBbU29uZXNvbiBhbmQgUm9iaW5zb24gKDIwMTgpXShodHRwczovL3B1Ym1lZC5uY2JpLm5sbS5uaWguZ292LzI5NDgxNTQ5LykgYW5kIHRoZXJlIGFyZSBhbHNvIGRlZGljYXRlZCBERSB0b29scyBmb3Igc2NSTkEtc2VxLCBsaWtlIFtNQVNUXShodHRwczovL2dlbm9tZWJpb2xvZ3kuYmlvbWVkY2VudHJhbC5jb20vYXJ0aWNsZXMvMTAuMTE4Ni9zMTMwNTktMDE1LTA4NDQtNSksIHRoYXQgdXNlIG1vZGVscyB0aGF0IGFjY291bnQgZm9yIHRoZSBleHBlY3RlZCBzcGFyc2Ugc3RydWN0dXJlIG9mIHNjUk5BLXNlcSBkYXRhLiBIb3dldmVyIGluIG91ciBhbmQgb3RoZXJzJyBleHBlcmllbmNlLCB0aGUgZGVmYXVsdCBXaWxjb3hvbiB0ZXN0IGlzIG9mdGVuIHN1ZmZpY2llbnQgZm9yIHNpbXBsZSBwYWlyd2lzZSBERSBjb21wYXJpc29ucywgd2hpbGUgZWRnZVIgKFtSb2JpbnNvbiwgTWNDYXJ0aHksIGFuZCBTbXl0aCAyMDEwXShodHRwczovL3B1Ym1lZC5uY2JpLm5sbS5uaWguZ292LzE5OTEwMzA4LykpIGlzIHJlY29tbWVuZGVkIGJ5IHRoZSBbT3V5YW5nIExhYl0oW091eWFuZ10oaHR0cHM6Ly9vdXlhbmdsYWIuY29tL3NpbmdsZWNlbGwvY2x1c3QuaHRtbCNpZGVudGlmeWluZy1tYXJrZXItZ2VuZXMpKSBmb3IgbW9yZSBjb21wbGV4IGNvbXBhcmlzb24gZGVzaWducywgc3VjaCBhcyB0aG9zZSB0aGF0IGluY2x1ZGUgY292YXJpYXRlcy4KCjwhLS0gQWRkaXRpb25hbCBjb250ZXh0IGZyb20gW091eWFuZ10oaHR0cHM6Ly9vdXlhbmdsYWIuY29tL3NpbmdsZWNlbGwvY2x1c3QuaHRtbCNpZGVudGlmeWluZy1tYXJrZXItZ2VuZXMpIHJlZ2FyZGluZyB0b29sIG9wdGlvbnMgYW5kIFtIQkMgbWF0ZXJpYWxzXShodHRwczovL2hiY3RyYWluaW5nLmdpdGh1Yi5pby9zY1JOQS1zZXFfb25saW5lL2xlc3NvbnMvMDlfbWVyZ2VkX1NDX21hcmtlcl9pZGVudGlmaWNhdGlvbi5odG1sKSByZWdhcmRpbmcgRmluZE1hcmtlcnMgdnMgRmluZENvbnNlcnZlZE1hcmtlcnMsIGV0Yy4gLS0+CgohW0ltYWdlOiBDb21wYXJpc29uIG9mIHRoZSBwZXJmb3JtYW5jZSBvZiBERSBtZXRob2RzIGFwcGxpZWQgdG8gc2NSTkEtc2VxIGRhdGFzZXRzLiBNZXRob2RzIGFyZSByYW5rZWQgYnkgdGhlaXIgYXZlcmFnZSBwZXJmb3JtYW5jZSBhY3Jvc3MgYWxsIHRoZSBsaXN0ZWQgY3JpdGVyaWEuIEltYWdlIHRha2VuIGZyb20gU29uZXNvbiBhbmQgUm9iaW5zb24gKDIwMTgpLl0oLi9pbWFnZXMvY3VycmljdWx1bS8wNi1NYXJrZXJWaXN1YWxpemF0aW9uL091eWFuZ19jbHVzdC1kZUNvbXBhcmUucG5nKQoKPGRldGFpbHM+CiAgICA8c3VtbWFyeT4qQWRkaXRpb25hbCBjb25zaWRlcmF0aW9ucyBmb3IgZGlmZmVyZW50aWFsIGV4cHJlc3Npb24qPC9zdW1tYXJ5PgogICAgVGhlIE91eWFuZyBMYWIgaGFzIGEgW3NlY3Rpb24gb2YgdGhlaXIgdHV0b3JpYWxdKGh0dHBzOi8vb3V5YW5nbGFiLmNvbS9zaW5nbGVjZWxsL2NsdXN0Lmh0bWwjc2VjOmRpZmZleHByKSB0aGF0IGRpc2N1c3NlcyB0aGUgbWV0aG9kcyBhdmFpbGFibGUgZm9yIGRpZmZlcmVudGlhbCBleHByZXNzaW9uIGluY2x1ZGluZyBzb21lIGhpZ2hsaWdodGVkIGluIHRoZSBmaWd1cmUgYmVsb3csIGFzIHdlbGwgYXMgYSBtb3JlIGV4dGVuc2l2ZSBzZWN0aW9uIG9uIFt0aHJlc2hvbGQgY29uc2lkZXJhdGlvbnNdKGh0dHBzOi8vb3V5YW5nbGFiLmNvbS9zaW5nbGVjZWxsL2NsdXN0Lmh0bWwjc2VjOmRpZmZleHByKSwgd2hpbGUgdGhlIFtIQkMgc2VjdGlvbiBvbiBtYXJrZXIgZ2VuZXMgaWRlbnRpZmljYXRpb25dKGh0dHBzOi8vaGJjdHJhaW5pbmcuZ2l0aHViLmlvL3NjUk5BLXNlcV9vbmxpbmUvbGVzc29ucy8wOV9tZXJnZWRfU0NfbWFya2VyX2lkZW50aWZpY2F0aW9uLmh0bWwpIGhpZ2hsaWdodHMgdGhlIGRpZmZlcmVudCB0eXBlcyBvZiBtYXJrZXIgaWRlbnRpZmljYXRpb24gb3B0aW9ucyBhdmFpbGFibGUgdmlhIFNldXJhdC4KPC9kZXRhaWxzPgo8YnI+CgojIyBNYXJrZXIgaWRlbnRpZmljYXRpb24KCkZpcnN0LCB3ZSdsbCBlbnN1cmUgdGhhdCB0aGUgY29ycmVjdCByZXNvbHV0aW9uIGlzIHNlbGVjdGVkIGZyb20gb3VyIFNldXJhdCBvYmplY3QgYW5kIHRoZW4gd2UnbGwgdXNlIHRoZSBgUHJlcFNDVEZpbmRNYXJrZXJzKClgIFtmdW5jdGlvbl0oaHR0cHM6Ly9zYXRpamFsYWIub3JnL3NldXJhdC9yZWZlcmVuY2UvcHJlcHNjdGZpbmRtYXJrZXJzKSBpbiBwcmVwYXJhdGlvbiBmb3IgREUgY29tYXByaXNvbnMgdG8gInJldmVyc2UgdGhlIGluZGl2aWR1YWwgU0NUIHJlZ3Jlc3Npb24gbW9kZWwgdXNpbmcgbWluaW11bSBvZiBtZWRpYW4gVU1JIGFzIHRoZSBzZXF1ZW5jaW5nIGRlcHRoIGNvdmFyaWF0ZSIgYWNjb3JkaW5nIHRvIHRoZSBbU2V1cmF0IGRvY3VtZW50YXRpb25dKGh0dHBzOi8vc2F0aWphbGFiLm9yZy9zZXVyYXQvcmVmZXJlbmNlL3ByZXBzY3RmaW5kbWFya2VycykuIAoKPCEtLSBpZiB3ZSB3YW50IHRvIHVzZSB0aGUgbm9ybWFsaXplZCBSTkEgZGF0YSAobm90IHRoZSBpbnRlZ3JhdGVkIGRhdGEpIGBEZWZhdWx0QXNzYXkoZ2VvX3NvKSA8LSAiUk5BImAsIGFsdGhvdWdoIG5lZWQgdG8gY2hlY2sgaWYgdGhhdCBzdGlsbCBtYWtlcyBzZW5zZSBmb3IgU2V1cmF0IHY1IC0tPiAKClRoZW4gd2UnbGwgcnVuIHRoZWBGaW5kQWxsTWFya2VycygpYCBbZnVuY3Rpb25dKGh0dHBzOi8vc2F0aWphbGFiLm9yZy9zZXVyYXQvcmVmZXJlbmNlL2ZpbmRhbGxtYXJrZXJzKSB0byBnZW5lcmF0ZSBjb21wYXJpc29ucyBiZXR3ZWVuIGVhY2ggY2x1c3RlciBhbmQgYWxsIG90aGVyIGNlbGxzLCByZWdhcmRsZXNzIG9mIHRoZSBleHBlcmltZW50YWwgZ3JvdXAuIE5vdGUgLSB0aGUgc3RhdGlzdGljYWwgdGVzdCB0byBwZXJmb3JtIGNhbiBiZSBzcGVjaWZpZWQgaW4gYEZpbmRBbGxNYXJrZXJzKClgLCBidXQgdGhlIGRlZmF1bHQgaXMgYSBXaWxjb3hvbiB0ZXN0LiAKCmBgYHtyLCBmaW5kX2FsbF9tYXJrZXJzLCBjYWNoZSA9IFRSVUUsIGNhY2hlLmxhenkgPSBGQUxTRSwgd2FybmluZyA9IEZBTFNFLCBtZXNzYWdlID0gRkFMU0V9CiMgQ29kZSBibG9jayAtIGZpbmQgZW1waXJpY2FsIG1hcmtlcnMKIyBQcmVwIGZvciBjbHVzdGVyIGNvbXBhcmlzb25zCmdlb19zbyA9IFNldElkZW50KGdlb19zbywgdmFsdWUgPSAnaW50ZWdyYXRlZC5zY3QucnBjYS5jbHVzdGVycycpCmdlb19zbyA9IFByZXBTQ1RGaW5kTWFya2VycyhnZW9fc28pCgojIFJ1biBjb21wYXJpc29ucyBmb3IgZWFjaCBjbHVzdGVyIHRvIGdlbmVyYXRlIG1hcmtlcnMKZ2VvX21hcmtlcnMgPSBGaW5kQWxsTWFya2VycyhnZW9fc28sIG9ubHkucG9zID0gVFJVRSwgbWluLnBjdCA9IDAuMDUpCgojIFRha2UgYSBsb29rIGF0IHRoZSBmaXJzdCBmZXcgcm93cyBvZiB0aGUgcmVzdWx0CmhlYWQoZ2VvX21hcmtlcnMpCgojIFdyaXRlIG91dCBmdWxsIGNsdXN0ZXIgbWFya2VyIHJlc3VsdHMgdG8gZmlsZQp3cml0ZV9jc3YoZ2VvX21hcmtlcnMsIGZpbGUgPSAncmVzdWx0cy90YWJsZXMvbWFya2VyX2dlbmVzXzAuNHJlcy5jc3YnKQpgYGAKCk5vdGUgdGhhdCB3aXRoIGBTZXRJZGVudCgpYCBhYm92ZSwgd2UgYXJlIGNoYW5naW5nIGlkZW50aXRpZXMgb2YgdGhlIGNlbGxzIHRvICJpbnRlZ3JhdGVkLnNjdC5ycGNhLmNsdXN0ZXJzIiBleHBsaWNpdGx5LiBUaGUgInNldXJhdF9jbHVzdGVycyIgY29sdW1uIGlzIHRoZSBkZWZhdWx0IGNvbHVtbiBmb3IgY2VsbCBpZGVudGl0aWVzIGFuZCBjaGFuZ2VzIGVhY2ggdGltZSBhIG5ldyBjbHVzdGVyaW5nIGlzIHBlcmZvcm1lZC4KCiFbSW1hZ2U6IFNjaGVtYXRpYyBhZnRlciBTZXRJZGVudCgpLl0oaW1hZ2VzL3NldXJhdF9zY2hlbWF0aWMvU2xpZGUxMS5wbmcpCgo8IS0tLSBDb25zaWRlciBob3cgdG8gcmVwcmVzZW50IHRoZSByZXN1bHQgb2YgUHJlcFNDVEZpbmRNYXJrZXJzKCkgaW4gdGhlIHNjaGVtYXRpYy4gSXQncyBhIGxpdHRsZSB0b28gc3VidGxlLi4uIC0tPgoKPCEtLS0gQ29uc2lkZXIgYWRkaW5nIGZpZ3VyZSBzaG93aW5nIGV4YW1wbGUgb2Ygd2hhdCdzIGJlaW5nIGNvbXBhcmVkIChjaXJjbGUgY2x1c3RlciAxIGFuZCB0aGVuIGNpcmNsZSBhbGwgb3RoZXIgY2VsbHMgZm9yIGV4YW1wbGUpIC0tPgoKPGRldGFpbHM+CiAgICA8c3VtbWFyeT4qU2V1cmF0IHY1IGltcHJvdmVtZW50cyo8L3N1bW1hcnk+CiAgICBGb3IgbWFya2VyIGdlbmVyYXRpb24sIFNldXJhdCB2NSB1c2VzIHRoZSBbcHJlc3RvIHBhY2thZ2VdKGh0dHBzOi8vd3d3LmJpb3J4aXYub3JnL2NvbnRlbnQvMTAuMTEwMS82NTMyNTN2MSkgdG8gcmVkdWNlIHRoZSB0aW1lIHJlcXVpcmVkIHRvIHJ1biBERSBjb21wYXJpc29ucywgcGFydGljdWxhcmx5IGZvciBsYXJnZSBkYXRhc2V0cy4gRm9yIHVzZXJzIHdobyBhcmUgbm90IHVzaW5nIHByZXN0bywgU2V1cmF0IHJlY29tbWVuZHMgaW5jcmVhc2luZyB0aGUgbWluLnBjdCBhbmQgbG9nZmMudGhyZXNob2xkIHBhcmFtZXRlcnNjdG8gaW5jcmVhc2UgdGhlIHNwZWVkIG9mIERFIHRlc3RpbmcgKFtzb3VyY2VdKGh0dHBzOi8vc2F0aWphbGFiLm9yZy9zZXVyYXQvYXJ0aWNsZXMvcGJtYzNrX3R1dG9yaWFsLmh0bWwjZmluZGluZy1kaWZmZXJlbnRpYWxseS1leHByZXNzZWQtZmVhdHVyZXMtY2x1c3Rlci1iaW9tYXJrZXJzKSkuCjwvZGV0YWlscz4KPGJyPgoKTm90ZSB0aGF0IG92ZXItaW50ZXJwcmV0YXRpb24gb2YgdGhlc2UgcmVzdWx0cyBzaG91bGQgYmUgYXZvaWRlZCwgc2luY2UgZWFjaCBjZWxsIGlzIHVzZWQgYXMgYSByZXBsaWNhdGUgaW4gdGhlc2UgY29tcGFyaXNvbnMgd2hpY2ggY2FuIGxlYWQgdG8gaW5mbGF0ZWQgKGUuZy4gdmVyeSBsb3cpIHAtdmFsdWVzLCB0aGUgdG9wIG1hcmtlcnMgYXJlIG1vcmUgbGlrZWx5IHRvIGJlIHRydXN0d29ydGh5IChbc291cmNlXShodHRwczovL2hiY3RyYWluaW5nLmdpdGh1Yi5pby9zY1JOQS1zZXFfb25saW5lL2xlc3NvbnMvMDlfbWVyZ2VkX1NDX21hcmtlcl9pZGVudGlmaWNhdGlvbi5odG1sKSkuIAoKVGhlcmVmb3JlLCBpdCdzIHVzZWZ1bCB0byBmaWx0ZXIgdGhlIHJlc3VsdHMgdG8gaGlnaGxpZ2h0IHRoZSB0b3AgcG9zaXRpdmUgbWFya2VycyAoc2luY2UgYSBwb3NpdGl2ZSBmb2xkLWNoYW5nZSB3b3VsZCBtZWFuIHRoYXQgZ2VuZSBpcyBtb3JlIGhpZ2hseSBleHByZXNzZWQgaW4gdGhlIGNsdXN0ZXIgY29tcGFyZWQgdG8gYWxsIG90aGVyIGNlbGxzKSwgYmVmb3JlIGxvb2tpbmcgYXQgb3VyIHJlc3VsdHMKCmBgYHtyLCB0b3BfNV9jbHVzdGVyX21hcmtlcnN9CiMgQ29kZSBibG9jayAtIGlkZW50aWZ5IG1hcmtlciBnZW5lcyBmb3IgZWFjaCBjbHVzdGVyCiMgQ3JlYXRlIHRhYmxlIG9mIHRvcCA1IG1hcmtlcnMgcGVyIGNsdXN0ZXIgKHVzaW5nIGRlZmF1bHQgcmFua2luZykKdG9wXzUgPSBnZW9fbWFya2VycyAlPiUgZmlsdGVyKHBfdmFsX2FkaiA8IDAuMDEpICU+JSBncm91cF9ieShjbHVzdGVyKSAlPiUgc2xpY2VfaGVhZChuID0gNSkKCiMgTG9vayBhdCByZXN1bHRzCmhlYWQodG9wXzUsIG4gPSAxMCkKCiMgT3B0aW9uYWwgLSBDcmVhdGUgdGFibGUgb2YgdG9wIDUgbWFya2VycyBwZXIgY2x1c3RlciAocmFua2VkIGJ5IGxvZ0ZDKQp0b3BfNV9ieV9sb2cyRkMgPSBnZW9fbWFya2VycyAlPiUgZ3JvdXBfYnkoY2x1c3RlcikgJT4lIGFycmFuZ2UocF92YWxfYWRqLCBkZXNjKGF2Z19sb2cyRkMpKSAlPiUgc2xpY2VfaGVhZChuID0gNSkKCiMgTG9vayBhdCByZXN1bHRzIGFmdGVyIHJhbmtpbmcKaGVhZCh0b3BfNV9ieV9sb2cyRkMsIG4gPSAxMCkgIyBub3RpY2UgZGlmZmVyZW5jZSBpbiBwY3QuMSBjb2x1bW4gYmV0d2VlbiB0YWJsZXMKYGBgCgpXZSBleHBlY3QgdG8gc2VlIHNldmVyYWwgY29sdW1uczoKCi0gYGdlbmVgOiBnZW5lIHN5bWJvbAotIGBwX3ZhbGA6IHAtdmFsdWUgbm90IGFkanVzdGVkIGZvciBtdWx0aXBsZSB0ZXN0IGNvcnJlY3Rpb24KLSBgYXZnX2xvZ0ZDYDogYXZlcmFnZSBsb2cgZm9sZCBjaGFuZ2UuIFBvc2l0aXZlIHZhbHVlcyBpbmRpY2F0ZSB0aGF0IHRoZSBnZW5lIGlzIG1vcmUgaGlnaGx5IGV4cHJlc3NlZCBpbiB0aGUgY2x1c3Rlci4KLSBgcGN0LjFgOiBwZXJjZW50YWdlIG9mIGNlbGxzIHdoZXJlIHRoZSBnZW5lIGlzIGRldGVjdGVkIGluIHRoZSBjbHVzdGVyIAotIGBwY3QuMmA6IHBlcmNlbnRhZ2Ugb2YgY2VsbHMgd2hlcmUgdGhlIGdlbmUgaXMgZGV0ZWN0ZWQgb24gYXZlcmFnZSBhY3Jvc3MgYWxsIG90aGVyIGNsdXN0ZXJzIAotIGBwX3ZhbF9hZGpgOiBhZGp1c3RlZCBwLXZhbHVlIGJhc2VkIG9uIGJvbmZlcnJvbmkgY29ycmVjdGlvbiB1c2luZyBhbGwgZ2VuZXMgaW4gdGhlIGRhdGFzZXQsIHVzZWQgdG8gZGV0ZXJtaW5lIHNpZ25pZmljYW5jZQotIGBjbHVzdGVyYDogY2x1c3RlciByZXByZXNlbnRlZCBieSBgcGN0LjFgIGFuZCBmb3Igd2hpY2ggdGhlIHN0YXRpc3RpY3MgaW4gdGhlIHJvdyBhcmUgcmVwb3J0ZWQKCldoZW4gbG9va2luZyBhdCB0aGUgb3V0cHV0LCBpdCBpcyBpbXBvcnRhbnQgdG8gcHJpb3JpdGl6ZSBtYXJrZXIgZ2VuZXMgd2l0aCBib3RoIGxhcmdlciBmb2xkLWNoYW5nZSBkaWZmZXJlbmNlcyBhbmQgbGFyZ2VyIGRpZmZlcmVuY2UgYmV0d2VlbiBwY3QuMSBhbmQgcGN0LjIsIHBhcnRpY3VsYXJseSBpZiBwY3QuMSBpcyBoaWdoIChlLmcuIGlmIDgwJSBvZiBjZWxscyBpbiB0aGUgY2x1c3RlciBldmFsdWF0ZWQgZXhwcmVzcyB0aGUgZ2VuZSB0aGF0IG1vcmUgcmVsaWFibGUgdGhhbiBpZiBvbmx5IDIwJSBvZiBjZWxscyBleHByZXNzIHRoYXQgZ2VuZSkgKFtzb3VyY2VdKGh0dHBzOi8vaGJjdHJhaW5pbmcuZ2l0aHViLmlvL3NjUk5BLXNlcV9vbmxpbmUvbGVzc29ucy8wOV9tZXJnZWRfU0NfbWFya2VyX2lkZW50aWZpY2F0aW9uLmh0bWwpKS4KCiMjIE1hcmtlciB2aXN1YWxpemF0aW9uCgpOb3cgdGhhdCB3ZSBoYXZlIGdlbmVyYXRlZCBhIHNldCBvZiBtYXJrZXIgZ2VuZXMgZm9yIG91ciBjbHVzdGVycywgaXQgaXMgdXNlZnVsIHRvIHZpc3VhbGl6ZSB0aGUgZXhwcmVzc2lvbiBvZiB0aG9zZSBtYXJrZXJzIHRvIGFpZCBpbiBldmFsdWF0aW5nIHRoZW0uIFdoaWxlIHRoZSBleHByZXNzaW9uIG9mIGluZGl2aWR1YWwgZ2VuZXMgcGVyIGNlbGwgY2FuIGJlIG92ZXJsYWlkIG9uIG91ciBVTUFQcyAoYXMgd2l0aCB0aGUgYEZlYXR1cmVQbG90KClgIFtmdW5jdGlvbl0oaHR0cHM6Ly9zYXRpamFsYWIub3JnL3NldXJhdC9yZWZlcmVuY2UvZmVhdHVyZXBsb3QpKSwgaXQncyBvZnRlbiBtb3JlIHVzZWZ1bCB0byB2aXN1YWxpemUgdGhlIGV4cHJlc3Npb24gb2YgbXVsdGlwbGUgZ2VuZXMgc2ltdWx0YW5lb3VzbHkuIFdoaWxlIHRoZXJlIGFyZSBbbXVsdGlwbGUgbWV0aG9kcyBzdXBwb3J0ZWQgYnkgU2V1cmF0XShodHRwczovL3NhdGlqYWxhYi5vcmcvc2V1cmF0L2FydGljbGVzL3Zpc3VhbGl6YXRpb25fdmlnbmV0dGUpIGZvciAgdmlzdWFsaXppbmcgbWFya2VyIGdlbmUgZXhwcmVzc2lvbiwgYSBoZWF0bWFwIG9yIGEgcmVsYXRlZCBwbG90IGNhbGxlZCBhIGRvdHBsb3QgYXJlIGNvbW1vbmx5IHVzZWQuIAoKV2UnbGwgdXNlIHRoZSBgRG90UGxvdCgpYCBbZnVuY3Rpb25dKGh0dHBzOi8vc2F0aWphbGFiLm9yZy9zZXVyYXQvcmVmZXJlbmNlL2RvdHBsb3QpIHdpdGggdGhlIFNDVCB2YWx1ZXMgdG8gdmlzdWFsaXplIHRoZSB0b3AgNSBtYXJrZXIgZ2VuZXMgcGVyIGNsdXN0ZXI6CgpgYGB7ciwgdG9wXzVfZG90X3Bsb3Rfc2N0LCBmaWcuaGVpZ2h0ID0gMTgsIGZpZy53aWR0aCA9IDh9CnRvcF81X3NjdF9kb3RfcGxvdCA9IERvdFBsb3QoZ2VvX3NvLCBmZWF0dXJlcyA9IHVuaXF1ZSh0b3BfNSRnZW5lKSkgKyAKICAgIHRoZW1lKGF4aXMudGV4dC54ID0gZWxlbWVudF90ZXh0KGFuZ2xlID0gOTAsIGhqdXN0ID0gMSwgdmp1c3QgPSAwLjUpKSArCiAgICBsYWJzKHRpdGxlID0gJ1RvcCA1IENsdXN0ZXIgR2VuZXMgYnkgRkRSIGFuZCBhdmdfbG9nMkZDJykgKyBjb29yZF9mbGlwKCkKdG9wXzVfc2N0X2RvdF9wbG90CgpnZ3NhdmUoZmlsZW5hbWUgPSAncmVzdWx0cy9maWd1cmVzL21hcmtlcnNfdG9wXzVfc2N0X2RvdF9wbG90LnBuZycsIHBsb3QgPSB0b3BfNV9zY3RfZG90X3Bsb3QsIHdpZHRoID0gOCwgaGVpZ2h0ID0gMTgsIHVuaXRzID0gJ2luJykgCmBgYAoKSW4gdGhlIGRvdHBsb3Qgd2UgY2FuIHNlZSB0aGF0IHRoZSBjb2xvciBpbmRpY2F0ZXMgdGhlIGV4cHJlc3Npb24gb2YgdGhlIGdlbmUgd2hpbGUgdGhlIHNpemUgb2YgdGhlIGRvdCBpbmRpY2F0ZXMgdGhlIHByb3BvcnRpb24gb2YgY2VsbHMgZXhwcmVzc2luZyB0aGF0IGdlbmUgaW4gZWFjaCBjbHVzdGVyIChbc291cmNlXShodHRwczovL291eWFuZ2xhYi5jb20vc2luZ2xlY2VsbC9jbHVzdC5odG1sI3Zpc3VhbGlzaW5nLW1hcmtlci1nZW5lcykpLiAKCjxkZXRhaWxzPgogICAgPHN1bW1hcnk+KlVzaW5nIHJhdyBSTkEgdmFsdWVzIGluIERvdHBsb3RzKjwvc3VtbWFyeT4KICAgIEluIGFkZGl0aW9uIHRvIHBsb3R0aW5nIHRoZSBTQ1QgdmFsdWVzLCB0aGUgcmF3IG9yIG5vcm1hbGl6ZWQgUk5BIHZhbHVlcyBjYW4gYmUgcGxvdHRlZCBhcyB3ZWxsOgoKYGBge3IsIHRvcF81X2RvdF9wbG90X3JuYSwgZXZhbD1GQUxTRX0KdG9wXzVfcm5hX2RvdF9wbG90ID0gRG90UGxvdChnZW9fc28sIGZlYXR1cmVzID0gdW5pcXVlKHRvcF81X2J5X2xvZzJGQyRnZW5lKSwgYXNzYXkgPSAnUk5BJykgKyAKICAgIHRoZW1lKGF4aXMudGV4dC54ID0gZWxlbWVudF90ZXh0KGFuZ2xlID0gOTAsIGhqdXN0ID0gMSwgdmp1c3QgPSAwLjUpKSArCiAgICBsYWJzKHRpdGxlID0gJ1RvcCA1IENsdXN0ZXIgR2VuZXMgYnkgRkRSIGFuZCBhdmdfbG9nMkZDJykgKyBjb29yZF9mbGlwKCkKCmdnc2F2ZShmaWxlbmFtZSA9ICdyZXN1bHRzL2ZpZ3VyZXMvbWFya2Vyc190b3BfNV9ybmFfZG90X3Bsb3QucG5nJywgcGxvdCA9IHRvcF81X3JuYV9kb3RfcGxvdCwgd2lkdGggPSA4LCBoZWlnaHQgPSAxOCwgdW5pdHMgPSAnaW4nKSAKYGBgCgo8L2RldGFpbHM+Cjxicj4KPGJyPgoKIyBVdGlsaXppbmcgZ2VuZXMgb2YgaW50ZXJlc3QKCk9mdGVuIHdlIGhhdmUgcHJpb3IgaW5mb3JtYXRpb24gYWJvdXQgd2hhdCBjZWxsIHR5cGVzIGFyZSBleHBlY3RlZCBpbiBvdXIgc2FtcGxlcyBhbmQga2V5IG1hcmtlciBnZW5lcyBmb3IgdGhvc2UgcG9wdWxhdGlvbnMuIFRoaXMgY2FuIGJlIGFuIGltcG9ydGFudCBwYXJ0IG9mIGV2YWx1YXRpbmcgb3VyIGNsdXN0ZXJzLCBzaW5jZSBpZiBnZW5lcyB0aGF0IGFyZSBrbm93biBtYXJrZXJzIGZvciBhIHNwZWNpZmljIGNlbGwgdHlwZSBhcmUgZm91bmQgaW4gdG9vIG1hbnkgb3IgdG9vIGZldyBjbHVzdGVycyBhcyB0aGF0IGNhbiBzdWdnZXN0IHRoYXQgcmUtY2x1c3RlcmluZyBpcyBuZWVkZWQgb3IgdGhhdCBzb21lIG9mIHRoZSBjbHVzdGVycyBzaG91bGQgYmUgbWFudWFsbHkgY29tYmluZWQgYmVmb3JlIGFubm90YXRpbmcuCgpXZSBjYW4gY3JlYXRlIGxpc3RzIG9mIG1hcmtlcnMgdXNlZCBpbiBmaWd1cmVzIGZyb20gdGhlIFtvcmlnaW5hbCBwYXBlcl0oaHR0cHM6Ly93d3cubmNiaS5ubG0ubmloLmdvdi9wbWMvYXJ0aWNsZXMvUE1DNzAwMjQ1My8pIGJlZm9yZSB1c2luZyB0aGUgc2FtZSBgRG90UGxvdCgpYCBmdW5jdGlvbiB0byB2aXN1YWxpemUgdGhlIGV4cHJlc3Npb24gbGV2ZWwgYW5kIGZyZXF1ZW5jeSBvZiB0aGVzZSBnZW5lcyBpbiBvdXIgY3VycmVudCBjbHVzdGVyczoKCmBgYHtyLCBrbm93bl9kb3RfcGxvdHNfc2N0LCBmaWcuc2hvdz0naG9sZCd9CiMgbWFudWFsbHkgY3JlYXRlIGxpc3RzIG9mIGdlbmVzIGZyb20gcGFwZXIKZmlnMWdfbWFya2VycyA9IGMoJ0N4Y2wxJywgJ0N4Y2wyJywgJ0NjbDInLCAnQ2NsMycsICdDY2w0JywgJ0lsMWInLCAnSWw2YicsICdUbmYnLCAnVGdmYjEnLCAnVGdmYjInLCAnVGdmYjMnLCAnQ3hjbDUnKQpmaWcxaF9tYXJrZXJzID0gYygnQ3hjcjInLCAnQ3NmMXInLCAnQ3NmM3InLCAnVGdmYnIxJywgJ1RnZmJyMycsICdJbDFyMScsICdJbDZyYScsICdMaWZyJywgJ1RnZmJyMicpCgojIGNyZWF0ZSBEb3RQbG90cyBmb3IgZ2VuZXMgZnJvbSBwYXBlcgpmaWcxZ19zY3RfZG90X3Bsb3QgPSBEb3RQbG90KGdlb19zbywgZmVhdHVyZXMgPSBmaWcxZ19tYXJrZXJzLCBhc3NheSA9ICdTQ1QnKQpmaWcxaF9zY3RfZG90X3Bsb3QgPSBEb3RQbG90KGdlb19zbywgZmVhdHVyZXMgPSBmaWcxaF9tYXJrZXJzLCBhc3NheSA9ICdTQ1QnKQoKZmlnMWdfc2N0X2RvdF9wbG90CmZpZzFoX3NjdF9kb3RfcGxvdAoKIyBzYXZlIHBsb3RzIHRvIGZpbGUKZ2dzYXZlKGZpbGVuYW1lID0gJ3Jlc3VsdHMvZmlndXJlcy9tYXJrZXJzX2ZpZzFnX3NjdF9kb3RfcGxvdC5wbmcnLCBwbG90ID0gZmlnMWdfc2N0X2RvdF9wbG90LCB3aWR0aCA9IDgsIGhlaWdodCA9IDYsIHVuaXRzID0gJ2luJykKZ2dzYXZlKGZpbGVuYW1lID0gJ3Jlc3VsdHMvZmlndXJlcy9tYXJrZXJzX2ZpZzFoX3NjdF9kb3RfcGxvdC5wbmcnLCBwbG90ID0gZmlnMWhfc2N0X2RvdF9wbG90LCB3aWR0aCA9IDgsIGhlaWdodCA9IDYsIHVuaXRzID0gJ2luJykKYGBgCgo8ZGV0YWlscz4KICAgIDxzdW1tYXJ5PipVc2luZyByYXcgUk5BIHZhbHVlcyBmb3IgZ2VuZXMgb2YgaW50ZXJlc3QqPC9zdW1tYXJ5PgogICAgV2UgY2FuIGFsc28gZ2VuZXJhdGUgdGhlIHNhbWUgcGxvdHMsIGJ1dCB1c2luZyB0aGUgdW5pbnRlZ3JhdGVkIGRhdGEgYnkgc3BlY2lmeWluZyB0aGUgYFJOQWAgYXNzYXk6CgpgYGB7ciwga25vd25fZG90X3Bsb3Rfcm5hLCBldmFsPUZBTFNFfQpybmFfZG90X3Bsb3QgPSBEb3RQbG90KGdlb19zbywgZmVhdHVyZXMgPSBmaWcxZ19tYXJrZXJzLCBhc3NheSA9ICdSTkEnKQpmaWcxaF9ybmFfZG90X3Bsb3QgPSBEb3RQbG90KGdlb19zbywgZmVhdHVyZXMgPSBmaWcxaF9tYXJrZXJzLCBhc3NheSA9ICdSTkEnKQoKZ2dzYXZlKGZpbGVuYW1lID0gJ3Jlc3VsdHMvZmlndXJlcy9tYXJrZXJzX2ZpZzFnX3JuYV9kb3RfcGxvdC5wbmcnLCBwbG90ID0gZmlnMWdfcm5hX2RvdF9wbG90LCB3aWR0aCA9IDgsIGhlaWdodCA9IDYsIHVuaXRzID0gJ2luJykKZ2dzYXZlKGZpbGVuYW1lID0gJ3Jlc3VsdHMvZmlndXJlcy9tYXJrZXJzX2ZpZzFoX3JuYV9kb3RfcGxvdC5wbmcnLCBwbG90ID0gZmlnMWhfcm5hX2RvdF9wbG90LCB3aWR0aCA9IDgsIGhlaWdodCA9IDYsIHVuaXRzID0gJ2luJykKYGBgCjwvZGV0YWlscz4KPGJyPgoKRm9yIGtub3duIG1hcmtlciBnZW5lcywgaXQncyBpbXBvcnRhbnQgdG8gbm90ZSB0aGF0IHNpbmNlIHNjUk5BLXNlcSBpcyBvbmx5IG1lYXN1cmluZyB0cmFuc2NyaXB0aW9uYWwgc2lnbmFscyB0aGF0IG1hcmtlcnMgYXQgdGhlIHByb3RlaW4gbGV2ZWwgKGUuZyB1c2VkIGZvciBhcHByb2FjaGVzIGxpa2UgRkFDUykgbWF5IGJlIGxlc3MgZWZmZWN0aXZlLiBBbiBhbHRlcm5hdGl2ZSBvciBjb21wbGVtZW50IHRvIHVzaW5nIG1hcmtlciBnZW5lcyBjb3VsZCBiZSBtZXRob2RzIGxpa2UgdXNpbmcgZ2VuZSBzZXQgZW5yaWNobWVudCAoR1NFQSkgW2FzIGRlbW9uc3RyYXRlZCBpbiB0aGUgT1NDQSBib29rXShodHRwczovL2Jpb2NvbmR1Y3Rvci5vcmcvYm9va3MvMy4xNS9PU0NBLmJhc2ljL2NlbGwtdHlwZS1hbm5vdGF0aW9uLmh0bWwjY29tcHV0aW5nLWdlbmUtc2V0LWFjdGl2aXRpZXMpIHRvIGFpZCBpbiBhbm5vdGF0aW9ucy4gSG93ZXZlciwgdGhlIGJvb2sgWyJCZXN0IHByYWN0aWNlcyBmb3Igc2luZ2xlLWNlbGwgYW5hbHlzaXMgYWNyb3NzIG1vZGFsaXRpZXMiIGJ5IEhldW1vcywgU2NoYWFyLCBMYW5jZSwgZXQgYWwuIF0oaHR0cHM6Ly93d3cuc2MtYmVzdC1wcmFjdGljZXMub3JnL2NlbGx1bGFyX3N0cnVjdHVyZS9hbm5vdGF0aW9uLmh0bWwpIHBvaW50cyBvdXQgdGhhdCAiaXQgaXMgb2Z0ZW4gdXNlZnVsIHRvIHdvcmsgdG9nZXRoZXIgd2l0aCBleHBlcnRzIC4uLiBbbGlrZSBhXSBiaW9sb2dpc3Qgd2hvIGhhcyBtb3JlIGV4dGVuc2l2ZSBrbm93bGVkZ2Ugb2YgdGhlIHRpc3N1ZSwgdGhlIGJpb2xvZ3ksIHRoZSBleHBlY3RlZCBjZWxsIHR5cGVzIGFuZCBtYXJrZXJzIGV0Yy4iLiBJbiBvdXIgZXhwZXJpZW5jZSwgd2UgZmluZCB0aGF0IGV4cGVyaWVuY2UgYW5kIGtub3dsZWRnZSBvZiB0aGUgcmVzZWFyY2hlcnMgd2Ugd29yayB3aXRoIGlzIGludmFsdWFibGUuIAoKIyBTYXZlIG91ciBwcm9ncmVzcwoKRmluYWxseSwgd2UnbGwgY3JlYXRlIGFuIG91dHB1dCBmaWxlIGZvciBvdXIgdXBkYXRlZCBTZXVyYXQgb2JqZWN0IGFuZCBmb3IgdGhlIGNsdXN0ZXIgbWFya2VyIHJlc3VsdHM6CgpgYGB7ciwgc2F2ZV9yZHNfaGlkZGVuLCBlY2hvID0gRkFMU0V9CmlmKCFmaWxlLmV4aXN0cygncmVzdWx0cy9yZGF0YS9nZW9fc29fc2N0X2ludGVncmF0ZWRfd2l0aF9tYXJrZXJzLnJkcycpKSB7CiAgc2F2ZVJEUyhnZW9fc28sIGZpbGUgPSAncmVzdWx0cy9yZGF0YS9nZW9fc29fc2N0X2ludGVncmF0ZWRfd2l0aF9tYXJrZXJzLnJkcycpCn0KCmlmKCFmaWxlLmV4aXN0cygncmVzdWx0cy9yZGF0YS9nZW9fbWFya2Vycy5yZHMnKSkgewogIHNhdmVSRFMoZ2VvX21hcmtlcnMsIGZpbGUgPSAncmVzdWx0cy9yZGF0YS9nZW9fbWFya2Vycy5yZHMnKQp9CmBgYAoKYGBge3IsIHNhdmVfcmRzLCBldmFsPUZBTFNFfQpzYXZlUkRTKGdlb19zbywgZmlsZSA9ICdyZXN1bHRzL3JkYXRhL2dlb19zb19zY3RfaW50ZWdyYXRlZF93aXRoX21hcmtlcnMucmRzJykKc2F2ZVJEUyhnZW9fbWFya2VycywgZmlsZSA9ICdyZXN1bHRzL3JkYXRhL2dlb19tYXJrZXJzLnJkcycpCmBgYAoKIyBTdW1tYXJ5CgpOb3cgdGhhdCB3ZSBoYXZlIGNoYXJhY3Rlcml6ZWQgdGhlIGV4cHJlc3Npb24gb2YgYm90aCBhbmFseXRpY2FsIG1hcmtlciBnZW5lcyBhbmQgbGl0ZXJhdHVyZSAvIGtub3dsZWRnZS1iYXNlZCBtYXJrZXIgZ2VuZXMsIHdlIG1heSBoYXZlIGEgYmV0dGVyIHNlbnNlIG9mIHdoYXQgY2VsbC10eXBlcyBvciBzdWJ0eXBlcyBvdXIgY2x1c3RlcnMgbWlnaHQgY29ycmVzcG9uZCB0by4gICAKCkhvd2V2ZXIsIG1hcmtlciBnZW5lcyBhbG9uZSBtaWdodCBub3QgYmUgc3VmZmljaWVudCB0byBkZXRlcm1pbmUgY2VsbC10eXBlIG9yIHN1Yi10eXBlIGxhYmVscyBmb3Igb3VyIGNsdXN0ZXJzIHNvIHdlIHdpbGwgZGlzY3VzcyBvdGhlciBtb3JlIGF1dG9tYXRlZCBhcHByb2FjaGVzIHRvIGNvbXBsZW1lbnQgdGhlc2UgcmVzdWx0cy4KCk5leHQgc3RlcHM6IENlbGwgdHlwZSBwcmVkaWN0aW9uIHRvb2xzCgotLS0tCgpUaGVzZSBtYXRlcmlhbHMgaGF2ZSBiZWVuIGFkYXB0ZWQgYW5kIGV4dGVuZGVkIGZyb20gbWF0ZXJpYWxzIGxpc3RlZCBhYm92ZS4gVGhlc2UgYXJlIG9wZW4gYWNjZXNzIG1hdGVyaWFscyBkaXN0cmlidXRlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIFtDcmVhdGl2ZSBDb21tb25zIEF0dHJpYnV0aW9uIGxpY2Vuc2UgKENDIEJZIDQuMCldKGh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LzQuMC8pLCB3aGljaCBwZXJtaXRzIHVucmVzdHJpY3RlZCB1c2UsIGRpc3RyaWJ1dGlvbiwgYW5kIHJlcHJvZHVjdGlvbiBpbiBhbnkgbWVkaXVtLCBwcm92aWRlZCB0aGUgb3JpZ2luYWwgYXV0aG9yIGFuZCBzb3VyY2UgYXJlIGNyZWRpdGVkLgoKPGJyLz4KPGJyLz4KPGhyLz4KfCBbUHJldmlvdXMgbGVzc29uXSgwNS1Qcm9qZWN0aW9uQW5kQ2x1c3RlcmluZy5odG1sKSB8IFtUb3Agb2YgdGhpcyBsZXNzb25dKCN0b3ApIHwgW05leHQgbGVzc29uXSgwNy1DZWxsVHlwZUFubm9zLmh0bWwpIHwKfCA6LS0tIHwgOi0tLS06IHwgLS0tOiB8Cg==</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("06-MarkerVisualization.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
